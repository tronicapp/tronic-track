{"version":3,"file":"queryString.bundle.5011b0847e2658d5273f.js","mappings":"uIAQO,SAASA,EACdC,EACAC,GAEA,OAAOC,OAAOC,KAAKF,GAAQG,QAAO,SAACC,EAAwBC,GACrDA,EAAIC,WAAWP,KAEjBK,EADcC,EAAIE,OAAOR,EAAOS,SACnBR,EAAOK,IAEtB,OAAOD,CACT,GAAG,CAAC,EACN,C,uECTO,SAASK,EACdC,EACAC,GAEA,IAAMC,EAAIC,SAASC,cAAc,KACjCF,EAAEG,KAAOJ,EACT,IACMK,EADSJ,EAAEK,OAAOC,MAAM,GACRC,MAAM,KAAKhB,QAAO,SAACC,EAAwBgB,GACzD,MAASA,EAAID,MAAM,KAAlBE,EAAC,KAAEC,EAAC,KAEX,OADAlB,EAAIiB,IAAK,EAAAE,EAAA,GAA2BD,GAC7BlB,CACT,GAAG,CAAC,GAEEoB,EAAQ,GAENC,EAAgCT,EAAM,QAA7BU,EAAuBV,EAAM,UAAlBW,EAAYX,EAAM,QACxC,GAAqD,QACzDN,EAASkB,QAAQC,gBAEfnB,EAASkB,QAAQC,eACjB,CAAC,EAJG,IAAAC,IAAKC,OAAU,IAAG,OAAI,EAAE,IAAAC,IAAKC,OAAU,IAAG,OAAI,EAMtD,GAAIN,EAAS,CACX,IAAMO,EAASC,MAAMC,QAAQpB,EAAOW,SAChCX,EAAOW,QAAQ,GACfX,EAAOW,QAEPI,EAAWM,KAAKH,IAClBxB,EAAS4B,eAAeJ,E,CAI5B,GAAIT,EAAS,CACX,IAAMO,EAAMG,MAAMC,QAAQpB,EAAOS,SAC7BT,EAAOS,QAAQ,GACfT,EAAOS,QAEX,GAAIQ,EAAWI,KAAKL,GAAM,CACxB,IAAMO,EAASzC,EAAW,aAAckB,GAExCQ,EAAMgB,KAAK9B,EAAS+B,SAAST,EAAKO,G,EAItC,GAAIb,EAAW,CACb,IAAMgB,EAAYP,MAAMC,QAAQpB,EAAO2B,gBACnC3B,EAAO2B,eAAe,GACtB3B,EAAO2B,eACLC,EAAST,MAAMC,QAAQpB,EAAO6B,aAChC7B,EAAO6B,YAAY,GACnB7B,EAAO6B,YACLC,EAAQX,MAAMC,QAAQpB,EAAOU,WAC/BV,EAAOU,UAAU,GACjBV,EAAOU,UACLqB,EAAQjD,EAAW,YAAakB,GACtCQ,EAAMgB,KAAK9B,EAASsC,MAAMN,EAAWE,EAAQE,EAAOC,G,CAGtD,OAAOE,QAAQC,IAAI1B,EACrB,C","sources":["webpack://@tronic/receiver-browser/./src/core/query-string/pickPrefix.ts","webpack://@tronic/receiver-browser/./src/core/query-string/index.ts"],"sourcesContent":["import { QueryStringParams } from '.'\n\n/**\n * Returns an object containing only the properties prefixed by the input\n * string.\n * Ex: prefix('ajs_traits_', { ajs_traits_address: '123 St' })\n * will return { address: '123 St' }\n **/\nexport function pickPrefix(\n  prefix: string,\n  object: QueryStringParams\n): QueryStringParams {\n  return Object.keys(object).reduce((acc: QueryStringParams, key: string) => {\n    if (key.startsWith(prefix)) {\n      const field = key.substr(prefix.length)\n      acc[field] = object[key]!\n    }\n    return acc\n  }, {})\n}\n","import { pickPrefix } from './pickPrefix'\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent'\nimport { Receiver } from '../receiver'\nimport { Context } from '../context'\nimport { isPlainObject } from '@tronic/receiver-core'\n\nexport interface QueryStringParams {\n  [key: string]: string | null\n}\n\nexport function queryString(\n  receiver: Receiver,\n  query: string\n): Promise<Context[]> {\n  const a = document.createElement('a')\n  a.href = query\n  const parsed = a.search.slice(1)\n  const params = parsed.split('&').reduce((acc: QueryStringParams, str) => {\n    const [k, v] = str.split('=')\n    acc[k] = gracefulDecodeURIComponent(v)\n    return acc\n  }, {})\n\n  const calls = []\n\n  const { ajs_uid, ajs_event, ajs_aid } = params\n  const { aid: aidPattern = /.+/, uid: uidPattern = /.+/ } = isPlainObject(\n    receiver.options.useQueryString\n  )\n    ? receiver.options.useQueryString\n    : {}\n\n  if (ajs_aid) {\n    const anonId = Array.isArray(params.ajs_aid)\n      ? params.ajs_aid[0]\n      : params.ajs_aid\n\n    if (aidPattern.test(anonId)) {\n      receiver.setAnonymousId(anonId)\n    }\n  }\n\n  if (ajs_uid) {\n    const uid = Array.isArray(params.ajs_uid)\n      ? params.ajs_uid[0]\n      : params.ajs_uid\n\n    if (uidPattern.test(uid)) {\n      const traits = pickPrefix('ajs_trait_', params)\n\n      calls.push(receiver.identify(uid, traits))\n    }\n  }\n\n  if (ajs_event) {\n    const channelId = Array.isArray(params.ajs_channel_id)\n      ? params.ajs_channel_id[0]\n      : params.ajs_channel_id\n    const userId = Array.isArray(params.ajs_user_id)\n      ? params.ajs_user_id[0]\n      : params.ajs_user_id\n    const event = Array.isArray(params.ajs_event)\n      ? params.ajs_event[0]\n      : params.ajs_event\n    const props = pickPrefix('ajs_prop_', params)\n    calls.push(receiver.track(channelId, userId, event, props))\n  }\n\n  return Promise.all(calls)\n}\n"],"names":["pickPrefix","prefix","object","Object","keys","reduce","acc","key","startsWith","substr","length","queryString","receiver","query","a","document","createElement","href","params","search","slice","split","str","k","v","gracefulDecodeURIComponent","calls","ajs_uid","ajs_event","ajs_aid","options","useQueryString","aid","aidPattern","uid","uidPattern","anonId","Array","isArray","test","setAnonymousId","traits","push","identify","channelId","ajs_channel_id","userId","ajs_user_id","event","props","track","Promise","all"],"sourceRoot":""}