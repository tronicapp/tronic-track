{"version":3,"file":"queryString.bundle.09943f895fe69bb55f77.js","mappings":"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","sources":["webpack://@tronic/receiver-browser/./src/core/query-string/pickPrefix.ts","webpack://@tronic/receiver-browser/./src/core/query-string/index.ts"],"sourcesContent":["import { QueryStringParams } from '.'\n\n/**\n * Returns an object containing only the properties prefixed by the input\n * string.\n * Ex: prefix('ajs_traits_', { ajs_traits_address: '123 St' })\n * will return { address: '123 St' }\n **/\nexport function pickPrefix(\n  prefix: string,\n  object: QueryStringParams\n): QueryStringParams {\n  return Object.keys(object).reduce((acc: QueryStringParams, key: string) => {\n    if (key.startsWith(prefix)) {\n      const field = key.substr(prefix.length)\n      acc[field] = object[key]!\n    }\n    return acc\n  }, {})\n}\n","import { pickPrefix } from './pickPrefix'\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent'\nimport { Receiver } from '../receiver'\nimport { Context } from '../context'\nimport { isPlainObject } from '@tronic/receiver-core'\n\nexport interface QueryStringParams {\n  [key: string]: string | null\n}\n\nexport function queryString(\n  receiver: Receiver,\n  query: string\n): Promise<Context[]> {\n  const a = document.createElement('a')\n  a.href = query\n  const parsed = a.search.slice(1)\n  const params = parsed.split('&').reduce((acc: QueryStringParams, str) => {\n    const [k, v] = str.split('=')\n    acc[k] = gracefulDecodeURIComponent(v)\n    return acc\n  }, {})\n\n  const calls = []\n\n  const { rjs_uid, rjs_event, rjs_aid } = params\n  const { aid: aidPattern = /.+/, uid: uidPattern = /.+/ } = isPlainObject(\n    receiver.options.useQueryString\n  )\n    ? receiver.options.useQueryString\n    : {}\n\n  if (rjs_aid) {\n    const anonId = Array.isArray(params.rjs_aid)\n      ? params.rjs_aid[0]\n      : params.rjs_aid\n\n    if (aidPattern.test(anonId)) {\n      receiver.setAnonymousId(anonId)\n    }\n  }\n\n  if (rjs_uid) {\n    const uid = Array.isArray(params.rjs_uid)\n      ? params.rjs_uid[0]\n      : params.rjs_uid\n\n    if (uidPattern.test(uid)) {\n      const traits = pickPrefix('rjs_trait_', params)\n\n      // requires channelId\n      // calls.push(receiver.identify(uid, traits))\n    }\n  }\n\n  if (rjs_event) {\n    const channelId = Array.isArray(params.rjs_channel_id)\n      ? params.rjs_channel_id[0]\n      : params.rjs_channel_id\n    const userId = Array.isArray(params.rjs_user_id)\n      ? params.rjs_user_id[0]\n      : params.rjs_user_id\n    const event = Array.isArray(params.rjs_event)\n      ? params.rjs_event[0]\n      : params.rjs_event\n    const props = pickPrefix('rjs_prop_', params)\n    calls.push(receiver.track(channelId, userId, event, props))\n  }\n\n  return Promise.all(calls)\n}\n"],"names":[],"sourceRoot":""}