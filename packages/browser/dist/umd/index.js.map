{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@tronic/receiver-browser/webpack/universalModuleDefinition","webpack://@tronic/receiver-browser/webpack/runtime/load script","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/address.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/alias.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/clone.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/delete.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/facade.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/group.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/identify.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/index.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/is-email.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/is-enabled.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/page.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/screen.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/track.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/isodate-traverse/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/isodate/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/inherits/inherits_browser.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/milliseconds.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/seconds.js","webpack://@tronic/receiver-browser/../../node_modules/obj-case/index.js","webpack://@tronic/receiver-browser/./src/core/environment/index.ts","webpack://@tronic/receiver-browser/./src/core/query-string/gracefulDecodeURIComponent.ts","webpack://@tronic/receiver-browser/./src/lib/global-receiver-helper.ts","webpack://@tronic/receiver-browser/./src/lib/load-script.ts","webpack://@tronic/receiver-browser/./src/lib/parse-cdn.ts","webpack://@tronic/receiver-browser/./src/lib/to-facade.ts","webpack://@tronic/receiver-browser/./src/plugins/middleware/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/callback/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/logger/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/context/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/stats/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/validation/helpers.js","webpack://@tronic/receiver-browser/../../node_modules/@lukeed/uuid/dist/index.mjs","webpack://@tronic/receiver-browser/../../node_modules/dset/dist/index.mjs","webpack://@tronic/receiver-browser/webpack/bootstrap","webpack://@tronic/receiver-browser/webpack/runtime/compat get default export","webpack://@tronic/receiver-browser/webpack/runtime/define property getters","webpack://@tronic/receiver-browser/webpack/runtime/ensure chunk","webpack://@tronic/receiver-browser/webpack/runtime/get javascript chunk filename","webpack://@tronic/receiver-browser/webpack/runtime/hasOwnProperty shorthand","webpack://@tronic/receiver-browser/webpack/runtime/make namespace object","webpack://@tronic/receiver-browser/webpack/runtime/publicPath","webpack://@tronic/receiver-browser/webpack/runtime/jsonp chunk loading","webpack://@tronic/receiver-browser/./src/lib/version-type.ts","webpack://@tronic/receiver-browser/../../node_modules/unfetch/dist/unfetch.module.js","webpack://@tronic/receiver-browser/./src/lib/get-global.ts","webpack://@tronic/receiver-browser/./src/lib/fetch.ts","webpack://@tronic/receiver-browser/./src/core/arguments-resolver/index.ts","webpack://@tronic/receiver-browser/./src/core/connection/index.ts","webpack://@tronic/receiver-browser/./src/generated/version.ts","webpack://@tronic/receiver-browser/./src/core/constants/index.ts","webpack://@tronic/receiver-browser/./src/core/stats/remote-metrics.ts","webpack://@tronic/receiver-browser/./src/core/stats/index.ts","webpack://@tronic/receiver-browser/./src/core/context/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/receiver/dispatch.js","webpack://@tronic/receiver-browser/../core/dist/esm/emitter/index.js","webpack://@tronic/receiver-browser/./src/core/page/get-page-context.ts","webpack://@tronic/receiver-browser/./src/core/page/add-page-context.ts","webpack://@tronic/receiver-browser/./src/core/events/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/priority-queue/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/priority-queue/backoff.js","webpack://@tronic/receiver-browser/./src/lib/priority-queue/persisted.ts","webpack://@tronic/receiver-browser/../core/dist/esm/utils/group-by.js","webpack://@tronic/receiver-browser/../core/dist/esm/utils/is-thenable.js","webpack://@tronic/receiver-browser/../core/dist/esm/queue/delivery.js","webpack://@tronic/receiver-browser/../core/dist/esm/queue/event-queue.js","webpack://@tronic/receiver-browser/../core/dist/esm/task/task-group.js","webpack://@tronic/receiver-browser/./src/core/queue/event-queue.ts","webpack://@tronic/receiver-browser/./src/lib/bind-all.ts","webpack://@tronic/receiver-browser/./src/core/storage/types.ts","webpack://@tronic/receiver-browser/./src/core/storage/universalStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/memoryStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/settings.ts","webpack://@tronic/receiver-browser/../../node_modules/js-cookie/dist/js.cookie.mjs","webpack://@tronic/receiver-browser/./src/core/user/tld.ts","webpack://@tronic/receiver-browser/./src/core/storage/cookieStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/localStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/index.ts","webpack://@tronic/receiver-browser/./src/core/user/index.ts","webpack://@tronic/receiver-browser/./src/core/buffer/index.ts","webpack://@tronic/receiver-browser/./src/lib/is-thenable.ts","webpack://@tronic/receiver-browser/./src/core/receiver/index.ts","webpack://@tronic/receiver-browser/./src/lib/create-deferred.ts","webpack://@tronic/receiver-browser/./src/lib/client-hints/index.ts","webpack://@tronic/receiver-browser/./src/plugins/env-enrichment/index.ts","webpack://@tronic/receiver-browser/./src/plugins/remote-loader/index.ts","webpack://@tronic/receiver-browser/./src/lib/on-page-change.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/batched-dispatcher.ts","webpack://@tronic/receiver-browser/./src/lib/p-while.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/schedule-flush.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/index.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/fetch-dispatcher.ts","webpack://@tronic/receiver-browser/../core/dist/esm/validation/errors.js","webpack://@tronic/receiver-browser/../core/dist/esm/validation/assertions.js","webpack://@tronic/receiver-browser/./src/plugins/validation/index.ts","webpack://@tronic/receiver-browser/./src/core/inspector/index.ts","webpack://@tronic/receiver-browser/./src/browser/index.ts","webpack://@tronic/receiver-browser/./src/lib/merged-options.ts","webpack://@tronic/receiver-browser/./src/browser/browser-umd.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TronicReceiver\"] = factory();\n\telse\n\t\troot[\"TronicReceiver\"] = factory();\n})(self, function() {\nreturn ","var inProgress = {};\nvar dataWebpackPrefix = \"@tronic/receiver-browser:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = function(url, done, key, chunkId) {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function(prev, event) {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach(function(fn) { return fn(event); });\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nfunction trait(a, b) {\n    return function () {\n        var traits = this.traits();\n        var props = this.properties ? this.properties() : {};\n        return (obj_case_1.default(traits, \"address.\" + a) ||\n            obj_case_1.default(traits, a) ||\n            (b ? obj_case_1.default(traits, \"address.\" + b) : null) ||\n            (b ? obj_case_1.default(traits, b) : null) ||\n            obj_case_1.default(props, \"address.\" + a) ||\n            obj_case_1.default(props, a) ||\n            (b ? obj_case_1.default(props, \"address.\" + b) : null) ||\n            (b ? obj_case_1.default(props, b) : null));\n    };\n}\nfunction default_1(proto) {\n    proto.zip = trait(\"postalCode\", \"zip\");\n    proto.country = trait(\"country\");\n    proto.street = trait(\"street\");\n    proto.state = trait(\"state\");\n    proto.city = trait(\"city\");\n    proto.region = trait(\"region\");\n}\nexports.default = default_1;\n//# sourceMappingURL=address.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Alias = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nfunction Alias(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Alias = Alias;\ninherits_1.default(Alias, facade_1.Facade);\nAlias.prototype.action = function () {\n    return \"alias\";\n};\nAlias.prototype.type = Alias.prototype.action;\nAlias.prototype.previousId = function () {\n    return this.field(\"previousId\") || this.field(\"from\");\n};\nAlias.prototype.from = Alias.prototype.previousId;\nAlias.prototype.userId = function () {\n    return this.field(\"userId\") || this.field(\"to\");\n};\nAlias.prototype.to = Alias.prototype.userId;\n//# sourceMappingURL=alias.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.clone = void 0;\nfunction clone(properties) {\n    if (typeof properties !== 'object')\n        return properties;\n    if (Object.prototype.toString.call(properties) === '[object Object]') {\n        var temp = {};\n        for (var key in properties) {\n            if (Object.prototype.hasOwnProperty.call(properties, key)) {\n                temp[key] = clone(properties[key]);\n            }\n        }\n        return temp;\n    }\n    else if (Array.isArray(properties)) {\n        return properties.map(clone);\n    }\n    else {\n        return properties;\n    }\n}\nexports.clone = clone;\n//# sourceMappingURL=clone.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delete = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nfunction Delete(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Delete = Delete;\ninherits_1.default(Delete, facade_1.Facade);\nDelete.prototype.type = function () {\n    return \"delete\";\n};\n//# sourceMappingURL=delete.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Facade = void 0;\nvar address_1 = __importDefault(require(\"./address\"));\nvar clone_1 = require(\"./clone\");\nvar is_enabled_1 = __importDefault(require(\"./is-enabled\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nvar isodate_traverse_1 = __importDefault(require(\"@segment/isodate-traverse\"));\nfunction Facade(obj, opts) {\n    opts = opts || {};\n    this.raw = clone_1.clone(obj);\n    if (!(\"clone\" in opts))\n        opts.clone = true;\n    if (opts.clone)\n        obj = clone_1.clone(obj);\n    if (!(\"traverse\" in opts))\n        opts.traverse = true;\n    if (!(\"timestamp\" in obj))\n        obj.timestamp = new Date();\n    else\n        obj.timestamp = new_date_1.default(obj.timestamp);\n    if (opts.traverse)\n        isodate_traverse_1.default(obj);\n    this.opts = opts;\n    this.obj = obj;\n}\nexports.Facade = Facade;\nvar f = Facade.prototype;\nf.proxy = function (field) {\n    var fields = field.split(\".\");\n    field = fields.shift();\n    var obj = this[field] || this.obj[field];\n    if (!obj)\n        return obj;\n    if (typeof obj === \"function\")\n        obj = obj.call(this) || {};\n    if (fields.length === 0)\n        return this.opts.clone ? transform(obj) : obj;\n    obj = obj_case_1.default(obj, fields.join(\".\"));\n    return this.opts.clone ? transform(obj) : obj;\n};\nf.field = function (field) {\n    var obj = this.obj[field];\n    return this.opts.clone ? transform(obj) : obj;\n};\nFacade.proxy = function (field) {\n    return function () {\n        return this.proxy(field);\n    };\n};\nFacade.field = function (field) {\n    return function () {\n        return this.field(field);\n    };\n};\nFacade.multi = function (path) {\n    return function () {\n        var multi = this.proxy(path + \"s\");\n        if (Array.isArray(multi))\n            return multi;\n        var one = this.proxy(path);\n        if (one)\n            one = [this.opts.clone ? clone_1.clone(one) : one];\n        return one || [];\n    };\n};\nFacade.one = function (path) {\n    return function () {\n        var one = this.proxy(path);\n        if (one)\n            return one;\n        var multi = this.proxy(path + \"s\");\n        if (Array.isArray(multi))\n            return multi[0];\n    };\n};\nf.json = function () {\n    var ret = this.opts.clone ? clone_1.clone(this.obj) : this.obj;\n    if (this.type)\n        ret.type = this.type();\n    return ret;\n};\nf.rawEvent = function () {\n    return this.raw;\n};\nf.options = function (integration) {\n    var obj = this.obj.options || this.obj.context || {};\n    var options = this.opts.clone ? clone_1.clone(obj) : obj;\n    if (!integration)\n        return options;\n    if (!this.enabled(integration))\n        return;\n    var integrations = this.integrations();\n    var value = integrations[integration] || obj_case_1.default(integrations, integration);\n    if (typeof value !== \"object\")\n        value = obj_case_1.default(this.options(), integration);\n    return typeof value === \"object\" ? value : {};\n};\nf.context = f.options;\nf.enabled = function (integration) {\n    var allEnabled = this.proxy(\"options.providers.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = this.proxy(\"options.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = this.proxy(\"integrations.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = true;\n    var enabled = allEnabled && is_enabled_1.default(integration);\n    var options = this.integrations();\n    if (options.providers && options.providers.hasOwnProperty(integration)) {\n        enabled = options.providers[integration];\n    }\n    if (options.hasOwnProperty(integration)) {\n        var settings = options[integration];\n        if (typeof settings === \"boolean\") {\n            enabled = settings;\n        }\n        else {\n            enabled = true;\n        }\n    }\n    return !!enabled;\n};\nf.integrations = function () {\n    return (this.obj.integrations || this.proxy(\"options.providers\") || this.options());\n};\nf.active = function () {\n    var active = this.proxy(\"options.active\");\n    if (active === null || active === undefined)\n        active = true;\n    return active;\n};\nf.anonymousId = function () {\n    return this.field(\"anonymousId\") || this.field(\"sessionId\");\n};\nf.sessionId = f.anonymousId;\nf.groupId = Facade.proxy(\"options.groupId\");\nf.traits = function (aliases) {\n    var ret = this.proxy(\"options.traits\") || {};\n    var id = this.userId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"options.traits.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\nf.library = function () {\n    var library = this.proxy(\"options.library\");\n    if (!library)\n        return { name: \"unknown\", version: null };\n    if (typeof library === \"string\")\n        return { name: library, version: null };\n    return library;\n};\nf.device = function () {\n    var device = this.proxy(\"context.device\");\n    if (typeof device !== \"object\" || device === null) {\n        device = {};\n    }\n    var library = this.library().name;\n    if (device.type)\n        return device;\n    if (library.indexOf(\"ios\") > -1)\n        device.type = \"ios\";\n    if (library.indexOf(\"android\") > -1)\n        device.type = \"android\";\n    return device;\n};\nf.userAgent = Facade.proxy(\"context.userAgent\");\nf.timezone = Facade.proxy(\"context.timezone\");\nf.timestamp = Facade.field(\"timestamp\");\nf.channel = Facade.field(\"channel\");\nf.ip = Facade.proxy(\"context.ip\");\nf.userId = Facade.field(\"userId\");\naddress_1.default(f);\nfunction transform(obj) {\n    return clone_1.clone(obj);\n}\n//# sourceMappingURL=facade.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Group = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar facade_1 = require(\"./facade\");\nfunction Group(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Group = Group;\ninherits_1.default(Group, facade_1.Facade);\nvar g = Group.prototype;\ng.action = function () {\n    return \"group\";\n};\ng.type = g.action;\ng.groupId = facade_1.Facade.field(\"groupId\");\ng.created = function () {\n    var created = this.proxy(\"traits.createdAt\") ||\n        this.proxy(\"traits.created\") ||\n        this.proxy(\"properties.createdAt\") ||\n        this.proxy(\"properties.created\");\n    if (created)\n        return new_date_1.default(created);\n};\ng.email = function () {\n    var email = this.proxy(\"traits.email\");\n    if (email)\n        return email;\n    var groupId = this.groupId();\n    if (is_email_1.default(groupId))\n        return groupId;\n};\ng.traits = function (aliases) {\n    var ret = this.properties();\n    var id = this.groupId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"traits.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\ng.name = facade_1.Facade.proxy(\"traits.name\");\ng.industry = facade_1.Facade.proxy(\"traits.industry\");\ng.employees = facade_1.Facade.proxy(\"traits.employees\");\ng.properties = function () {\n    return this.field(\"traits\") || this.field(\"properties\") || {};\n};\n//# sourceMappingURL=group.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Identify = void 0;\nvar facade_1 = require(\"./facade\");\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar trim = function (str) { return str.trim(); };\nfunction Identify(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Identify = Identify;\ninherits_1.default(Identify, facade_1.Facade);\nvar i = Identify.prototype;\ni.action = function () {\n    return \"identify\";\n};\ni.type = i.action;\ni.traits = function (aliases) {\n    var ret = this.field(\"traits\") || {};\n    var id = this.userId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        var value = this[alias] == null ? this.proxy(\"traits.\" + alias) : this[alias]();\n        if (value == null)\n            continue;\n        ret[aliases[alias]] = value;\n        if (alias !== aliases[alias])\n            delete ret[alias];\n    }\n    return ret;\n};\ni.email = function () {\n    var email = this.proxy(\"traits.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\ni.created = function () {\n    var created = this.proxy(\"traits.created\") || this.proxy(\"traits.createdAt\");\n    if (created)\n        return new_date_1.default(created);\n};\ni.companyCreated = function () {\n    var created = this.proxy(\"traits.company.created\") ||\n        this.proxy(\"traits.company.createdAt\");\n    if (created) {\n        return new_date_1.default(created);\n    }\n};\ni.companyName = function () {\n    return this.proxy(\"traits.company.name\");\n};\ni.name = function () {\n    var name = this.proxy(\"traits.name\");\n    if (typeof name === \"string\") {\n        return trim(name);\n    }\n    var firstName = this.firstName();\n    var lastName = this.lastName();\n    if (firstName && lastName) {\n        return trim(firstName + \" \" + lastName);\n    }\n};\ni.firstName = function () {\n    var firstName = this.proxy(\"traits.firstName\");\n    if (typeof firstName === \"string\") {\n        return trim(firstName);\n    }\n    var name = this.proxy(\"traits.name\");\n    if (typeof name === \"string\") {\n        return trim(name).split(\" \")[0];\n    }\n};\ni.lastName = function () {\n    var lastName = this.proxy(\"traits.lastName\");\n    if (typeof lastName === \"string\") {\n        return trim(lastName);\n    }\n    var name = this.proxy(\"traits.name\");\n    if (typeof name !== \"string\") {\n        return;\n    }\n    var space = trim(name).indexOf(\" \");\n    if (space === -1) {\n        return;\n    }\n    return trim(name.substr(space + 1));\n};\ni.uid = function () {\n    return this.userId() || this.username() || this.email();\n};\ni.description = function () {\n    return this.proxy(\"traits.description\") || this.proxy(\"traits.background\");\n};\ni.age = function () {\n    var date = this.birthday();\n    var age = obj_case_1.default(this.traits(), \"age\");\n    if (age != null)\n        return age;\n    if (!(date instanceof Date))\n        return;\n    var now = new Date();\n    return now.getFullYear() - date.getFullYear();\n};\ni.avatar = function () {\n    var traits = this.traits();\n    return (obj_case_1.default(traits, \"avatar\") || obj_case_1.default(traits, \"photoUrl\") || obj_case_1.default(traits, \"avatarUrl\"));\n};\ni.position = function () {\n    var traits = this.traits();\n    return obj_case_1.default(traits, \"position\") || obj_case_1.default(traits, \"jobTitle\");\n};\ni.username = facade_1.Facade.proxy(\"traits.username\");\ni.website = facade_1.Facade.one(\"traits.website\");\ni.websites = facade_1.Facade.multi(\"traits.website\");\ni.phone = facade_1.Facade.one(\"traits.phone\");\ni.phones = facade_1.Facade.multi(\"traits.phone\");\ni.address = facade_1.Facade.proxy(\"traits.address\");\ni.gender = facade_1.Facade.proxy(\"traits.gender\");\ni.birthday = facade_1.Facade.proxy(\"traits.birthday\");\n//# sourceMappingURL=identify.js.map","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delete = exports.Screen = exports.Page = exports.Track = exports.Identify = exports.Group = exports.Alias = exports.Facade = void 0;\nvar facade_1 = require(\"./facade\");\nObject.defineProperty(exports, \"Facade\", { enumerable: true, get: function () { return facade_1.Facade; } });\nvar alias_1 = require(\"./alias\");\nObject.defineProperty(exports, \"Alias\", { enumerable: true, get: function () { return alias_1.Alias; } });\nvar group_1 = require(\"./group\");\nObject.defineProperty(exports, \"Group\", { enumerable: true, get: function () { return group_1.Group; } });\nvar identify_1 = require(\"./identify\");\nObject.defineProperty(exports, \"Identify\", { enumerable: true, get: function () { return identify_1.Identify; } });\nvar track_1 = require(\"./track\");\nObject.defineProperty(exports, \"Track\", { enumerable: true, get: function () { return track_1.Track; } });\nvar page_1 = require(\"./page\");\nObject.defineProperty(exports, \"Page\", { enumerable: true, get: function () { return page_1.Page; } });\nvar screen_1 = require(\"./screen\");\nObject.defineProperty(exports, \"Screen\", { enumerable: true, get: function () { return screen_1.Screen; } });\nvar delete_1 = require(\"./delete\");\nObject.defineProperty(exports, \"Delete\", { enumerable: true, get: function () { return delete_1.Delete; } });\nexports.default = __assign(__assign({}, facade_1.Facade), { Alias: alias_1.Alias,\n    Group: group_1.Group,\n    Identify: identify_1.Identify,\n    Track: track_1.Track,\n    Page: page_1.Page,\n    Screen: screen_1.Screen,\n    Delete: delete_1.Delete });\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar matcher = /.+\\@.+\\..+/;\nfunction isEmail(string) {\n    return matcher.test(string);\n}\nexports.default = isEmail;\n//# sourceMappingURL=is-email.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar disabled = {\n    Salesforce: true,\n};\nfunction default_1(integration) {\n    return !disabled[integration];\n}\nexports.default = default_1;\n//# sourceMappingURL=is-enabled.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Page = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nvar track_1 = require(\"./track\");\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nfunction Page(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Page = Page;\ninherits_1.default(Page, facade_1.Facade);\nvar p = Page.prototype;\np.action = function () {\n    return \"page\";\n};\np.type = p.action;\np.category = facade_1.Facade.field(\"category\");\np.name = facade_1.Facade.field(\"name\");\np.title = facade_1.Facade.proxy(\"properties.title\");\np.path = facade_1.Facade.proxy(\"properties.path\");\np.url = facade_1.Facade.proxy(\"properties.url\");\np.referrer = function () {\n    return (this.proxy(\"context.referrer.url\") ||\n        this.proxy(\"context.page.referrer\") ||\n        this.proxy(\"properties.referrer\"));\n};\np.properties = function (aliases) {\n    var props = this.field(\"properties\") || {};\n    var category = this.category();\n    var name = this.name();\n    aliases = aliases || {};\n    if (category)\n        props.category = category;\n    if (name)\n        props.name = name;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"properties.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            props[aliases[alias]] = value;\n            if (alias !== aliases[alias])\n                delete props[alias];\n        }\n    }\n    return props;\n};\np.email = function () {\n    var email = this.proxy(\"context.traits.email\") || this.proxy(\"properties.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\np.fullName = function () {\n    var category = this.category();\n    var name = this.name();\n    return name && category ? category + \" \" + name : name;\n};\np.event = function (name) {\n    return name ? \"Viewed \" + name + \" Page\" : \"Loaded a Page\";\n};\np.track = function (name) {\n    var json = this.json();\n    json.event = this.event(name);\n    json.timestamp = this.timestamp();\n    json.properties = this.properties();\n    return new track_1.Track(json, this.opts);\n};\n//# sourceMappingURL=page.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Screen = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar page_1 = require(\"./page\");\nvar track_1 = require(\"./track\");\nfunction Screen(dictionary, opts) {\n    page_1.Page.call(this, dictionary, opts);\n}\nexports.Screen = Screen;\ninherits_1.default(Screen, page_1.Page);\nScreen.prototype.action = function () {\n    return \"screen\";\n};\nScreen.prototype.type = Screen.prototype.action;\nScreen.prototype.event = function (name) {\n    return name ? \"Viewed \" + name + \" Screen\" : \"Loaded a Screen\";\n};\nScreen.prototype.track = function (name) {\n    var json = this.json();\n    json.event = this.event(name);\n    json.timestamp = this.timestamp();\n    json.properties = this.properties();\n    return new track_1.Track(json, this.opts);\n};\n//# sourceMappingURL=screen.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Track = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nvar identify_1 = require(\"./identify\");\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nfunction Track(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Track = Track;\ninherits_1.default(Track, facade_1.Facade);\nvar t = Track.prototype;\nt.action = function () {\n    return \"track\";\n};\nt.type = t.action;\nt.event = facade_1.Facade.field(\"event\");\nt.value = facade_1.Facade.proxy(\"properties.value\");\nt.category = facade_1.Facade.proxy(\"properties.category\");\nt.id = facade_1.Facade.proxy(\"properties.id\");\nt.productId = function () {\n    return (this.proxy(\"properties.product_id\") || this.proxy(\"properties.productId\"));\n};\nt.promotionId = function () {\n    return (this.proxy(\"properties.promotion_id\") ||\n        this.proxy(\"properties.promotionId\"));\n};\nt.cartId = function () {\n    return this.proxy(\"properties.cart_id\") || this.proxy(\"properties.cartId\");\n};\nt.checkoutId = function () {\n    return (this.proxy(\"properties.checkout_id\") || this.proxy(\"properties.checkoutId\"));\n};\nt.paymentId = function () {\n    return (this.proxy(\"properties.payment_id\") || this.proxy(\"properties.paymentId\"));\n};\nt.couponId = function () {\n    return (this.proxy(\"properties.coupon_id\") || this.proxy(\"properties.couponId\"));\n};\nt.wishlistId = function () {\n    return (this.proxy(\"properties.wishlist_id\") || this.proxy(\"properties.wishlistId\"));\n};\nt.reviewId = function () {\n    return (this.proxy(\"properties.review_id\") || this.proxy(\"properties.reviewId\"));\n};\nt.orderId = function () {\n    return (this.proxy(\"properties.id\") ||\n        this.proxy(\"properties.order_id\") ||\n        this.proxy(\"properties.orderId\"));\n};\nt.sku = facade_1.Facade.proxy(\"properties.sku\");\nt.tax = facade_1.Facade.proxy(\"properties.tax\");\nt.name = facade_1.Facade.proxy(\"properties.name\");\nt.price = facade_1.Facade.proxy(\"properties.price\");\nt.total = facade_1.Facade.proxy(\"properties.total\");\nt.repeat = facade_1.Facade.proxy(\"properties.repeat\");\nt.coupon = facade_1.Facade.proxy(\"properties.coupon\");\nt.shipping = facade_1.Facade.proxy(\"properties.shipping\");\nt.discount = facade_1.Facade.proxy(\"properties.discount\");\nt.shippingMethod = function () {\n    return (this.proxy(\"properties.shipping_method\") ||\n        this.proxy(\"properties.shippingMethod\"));\n};\nt.paymentMethod = function () {\n    return (this.proxy(\"properties.payment_method\") ||\n        this.proxy(\"properties.paymentMethod\"));\n};\nt.description = facade_1.Facade.proxy(\"properties.description\");\nt.plan = facade_1.Facade.proxy(\"properties.plan\");\nt.subtotal = function () {\n    var subtotal = obj_case_1.default(this.properties(), \"subtotal\");\n    var total = this.total() || this.revenue();\n    if (subtotal)\n        return subtotal;\n    if (!total)\n        return 0;\n    if (this.total()) {\n        var n = this.tax();\n        if (n)\n            total -= n;\n        n = this.shipping();\n        if (n)\n            total -= n;\n        n = this.discount();\n        if (n)\n            total += n;\n    }\n    return total;\n};\nt.products = function () {\n    var props = this.properties();\n    var products = obj_case_1.default(props, \"products\");\n    if (Array.isArray(products)) {\n        return products.filter(function (item) { return item !== null; });\n    }\n    return [];\n};\nt.quantity = function () {\n    var props = this.obj.properties || {};\n    return props.quantity || 1;\n};\nt.currency = function () {\n    var props = this.obj.properties || {};\n    return props.currency || \"USD\";\n};\nt.referrer = function () {\n    return (this.proxy(\"context.referrer.url\") ||\n        this.proxy(\"context.page.referrer\") ||\n        this.proxy(\"properties.referrer\"));\n};\nt.query = facade_1.Facade.proxy(\"options.query\");\nt.properties = function (aliases) {\n    var ret = this.field(\"properties\") || {};\n    aliases = aliases || {};\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"properties.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\nt.username = function () {\n    return (this.proxy(\"traits.username\") ||\n        this.proxy(\"properties.username\") ||\n        this.userId() ||\n        this.sessionId());\n};\nt.email = function () {\n    var email = this.proxy(\"traits.email\") ||\n        this.proxy(\"properties.email\") ||\n        this.proxy(\"options.traits.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\nt.revenue = function () {\n    var revenue = this.proxy(\"properties.revenue\");\n    var event = this.event();\n    var orderCompletedRegExp = /^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i;\n    if (!revenue && event && event.match(orderCompletedRegExp)) {\n        revenue = this.proxy(\"properties.total\");\n    }\n    return currency(revenue);\n};\nt.cents = function () {\n    var revenue = this.revenue();\n    return typeof revenue !== \"number\" ? this.value() || 0 : revenue * 100;\n};\nt.identify = function () {\n    var json = this.json();\n    json.traits = this.traits();\n    return new identify_1.Identify(json, this.opts);\n};\nfunction currency(val) {\n    if (!val)\n        return;\n    if (typeof val === \"number\") {\n        return val;\n    }\n    if (typeof val !== \"string\") {\n        return;\n    }\n    val = val.replace(/\\$/g, \"\");\n    val = parseFloat(val);\n    if (!isNaN(val)) {\n        return val;\n    }\n}\n//# sourceMappingURL=track.js.map","'use strict';\n\nvar isodate = require('@segment/isodate');\n\n/**\n * Expose `traverse`.\n */\nmodule.exports = traverse;\n\n/**\n * Recursively traverse an object or array, and convert\n * all ISO date strings parse into Date objects.\n *\n * @param {Object} input - object, array, or string to convert\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Object}\n */\nfunction traverse(input, strict) {\n  if (strict === undefined) strict = true;\n  if (input && typeof input === 'object') {\n    return traverseObject(input, strict);\n  } else if (Array.isArray(input)) {\n    return traverseArray(input, strict);\n  } else if (isodate.is(input, strict)) {\n    return isodate.parse(input);\n  }\n  return input;\n}\n\n/**\n * Object traverser helper function.\n *\n * @param {Object} obj - object to traverse\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Object}\n */\nfunction traverseObject(obj, strict) {\n  Object.keys(obj).forEach(function(key) {\n    obj[key] = traverse(obj[key], strict);\n  });\n  return obj;\n}\n\n/**\n * Array traverser helper function\n *\n * @param {Array} arr - array to traverse\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Array}\n */\nfunction traverseArray(arr, strict) {\n  arr.forEach(function(value, index) {\n    arr[index] = traverse(value, strict);\n  });\n  return arr;\n}\n","'use strict';\n\n/**\n * Matcher, slightly modified from:\n *\n * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js\n */\n\nvar matcher = /^(\\d{4})(?:-?(\\d{2})(?:-?(\\d{2}))?)?(?:([ T])(\\d{2}):?(\\d{2})(?::?(\\d{2})(?:[,\\.](\\d{1,}))?)?(?:(Z)|([+\\-])(\\d{2})(?::?(\\d{2}))?)?)?$/;\n\n/**\n * Convert an ISO date string to a date. Fallback to native `Date.parse`.\n *\n * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js\n *\n * @param {String} iso\n * @return {Date}\n */\n\nexports.parse = function(iso) {\n  var numericKeys = [1, 5, 6, 7, 11, 12];\n  var arr = matcher.exec(iso);\n  var offset = 0;\n\n  // fallback to native parsing\n  if (!arr) {\n    return new Date(iso);\n  }\n\n  /* eslint-disable no-cond-assign */\n  // remove undefined values\n  for (var i = 0, val; val = numericKeys[i]; i++) {\n    arr[val] = parseInt(arr[val], 10) || 0;\n  }\n  /* eslint-enable no-cond-assign */\n\n  // allow undefined days and months\n  arr[2] = parseInt(arr[2], 10) || 1;\n  arr[3] = parseInt(arr[3], 10) || 1;\n\n  // month is 0-11\n  arr[2]--;\n\n  // allow abitrary sub-second precision\n  arr[8] = arr[8] ? (arr[8] + '00').substring(0, 3) : 0;\n\n  // apply timezone if one exists\n  if (arr[4] === ' ') {\n    offset = new Date().getTimezoneOffset();\n  } else if (arr[9] !== 'Z' && arr[10]) {\n    offset = arr[11] * 60 + arr[12];\n    if (arr[10] === '+') {\n      offset = 0 - offset;\n    }\n  }\n\n  var millis = Date.UTC(arr[1], arr[2], arr[3], arr[5], arr[6] + offset, arr[7], arr[8]);\n  return new Date(millis);\n};\n\n\n/**\n * Checks whether a `string` is an ISO date string. `strict` mode requires that\n * the date string at least have a year, month and date.\n *\n * @param {String} string\n * @param {Boolean} strict\n * @return {Boolean}\n */\n\nexports.is = function(string, strict) {\n  if (typeof string !== 'string') {\n    return false;\n  }\n  if (strict && (/^\\d{4}-\\d{2}-\\d{2}/).test(string) === false) {\n    return false;\n  }\n  return matcher.test(string);\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","\"use strict\";\n\nvar isodate = require(\"@segment/isodate\");\nvar milliseconds = require(\"./milliseconds\");\nvar seconds = require(\"./seconds\");\n\nvar objProto = Object.prototype;\nvar toStr = objProto.toString;\n\nfunction isDate(value) {\n  return toStr.call(value) === \"[object Date]\";\n}\n\nfunction isNumber(value) {\n  return toStr.call(value) === \"[object Number]\";\n}\n\n/**\n * Returns a new Javascript Date object, allowing a variety of extra input types\n * over the native Date constructor.\n *\n * @param {Date|string|number} val\n */\nmodule.exports = function newDate(val) {\n  if (isDate(val)) return val;\n  if (isNumber(val)) return new Date(toMs(val));\n\n  // date strings\n  if (isodate.is(val)) {\n    return isodate.parse(val);\n  }\n  if (milliseconds.is(val)) {\n    return milliseconds.parse(val);\n  }\n  if (seconds.is(val)) {\n    return seconds.parse(val);\n  }\n\n  // fallback to Date.parse\n  return new Date(val);\n};\n\n/**\n * If the number passed val is seconds from the epoch, turn it into milliseconds.\n * Milliseconds would be greater than 31557600000 (December 31, 1970).\n *\n * @param {number} num\n */\nfunction toMs(num) {\n  if (num < 31557600000) return num * 1000;\n  return num;\n}\n","\"use strict\";\n\n/**\n * Matcher.\n */\n\nvar matcher = /\\d{13}/;\n\n/**\n * Check whether a string is a millisecond date string.\n *\n * @param {string} string\n * @return {boolean}\n */\nexports.is = function (string) {\n  return matcher.test(string);\n};\n\n/**\n * Convert a millisecond string to a date.\n *\n * @param {string} millis\n * @return {Date}\n */\nexports.parse = function (millis) {\n  millis = parseInt(millis, 10);\n  return new Date(millis);\n};\n","\"use strict\";\n\n/**\n * Matcher.\n */\n\nvar matcher = /\\d{10}/;\n\n/**\n * Check whether a string is a second date string.\n *\n * @param {string} string\n * @return {Boolean}\n */\nexports.is = function (string) {\n  return matcher.test(string);\n};\n\n/**\n * Convert a second string to a date.\n *\n * @param {string} seconds\n * @return {Date}\n */\nexports.parse = function (seconds) {\n  var millis = parseInt(seconds, 10) * 1000;\n  return new Date(millis);\n};\n","\nvar identity = function(_){ return _; };\n\n\n/**\n * Module exports, export\n */\n\nmodule.exports = multiple(find);\nmodule.exports.find = module.exports;\n\n\n/**\n * Export the replacement function, return the modified object\n */\n\nmodule.exports.replace = function (obj, key, val, options) {\n  multiple(replace).call(this, obj, key, val, options);\n  return obj;\n};\n\n\n/**\n * Export the delete function, return the modified object\n */\n\nmodule.exports.del = function (obj, key, options) {\n  multiple(del).call(this, obj, key, null, options);\n  return obj;\n};\n\n\n/**\n * Compose applying the function to a nested key\n */\n\nfunction multiple (fn) {\n  return function (obj, path, val, options) {\n    var normalize = options && isFunction(options.normalizer) ? options.normalizer : defaultNormalize;\n    path = normalize(path);\n\n    var key;\n    var finished = false;\n\n    while (!finished) loop();\n\n    function loop() {\n      for (key in obj) {\n        var normalizedKey = normalize(key);\n        if (0 === path.indexOf(normalizedKey)) {\n          var temp = path.substr(normalizedKey.length);\n          if (temp.charAt(0) === '.' || temp.length === 0) {\n            path = temp.substr(1);\n            var child = obj[key];\n\n            // we're at the end and there is nothing.\n            if (null == child) {\n              finished = true;\n              return;\n            }\n\n            // we're at the end and there is something.\n            if (!path.length) {\n              finished = true;\n              return;\n            }\n\n            // step into child\n            obj = child;\n\n            // but we're done here\n            return;\n          }\n        }\n      }\n\n      key = undefined;\n      // if we found no matching properties\n      // on the current object, there's no match.\n      finished = true;\n    }\n\n    if (!key) return;\n    if (null == obj) return obj;\n\n    // the `obj` and `key` is one above the leaf object and key, so\n    // start object: { a: { 'b.c': 10 } }\n    // end object: { 'b.c': 10 }\n    // end key: 'b.c'\n    // this way, you can do `obj[key]` and get `10`.\n    return fn(obj, key, val);\n  };\n}\n\n\n/**\n * Find an object by its key\n *\n * find({ first_name : 'Calvin' }, 'firstName')\n */\n\nfunction find (obj, key) {\n  if (obj.hasOwnProperty(key)) return obj[key];\n}\n\n\n/**\n * Delete a value for a given key\n *\n * del({ a : 'b', x : 'y' }, 'X' }) -> { a : 'b' }\n */\n\nfunction del (obj, key) {\n  if (obj.hasOwnProperty(key)) delete obj[key];\n  return obj;\n}\n\n\n/**\n * Replace an objects existing value with a new one\n *\n * replace({ a : 'b' }, 'a', 'c') -> { a : 'c' }\n */\n\nfunction replace (obj, key, val) {\n  if (obj.hasOwnProperty(key)) obj[key] = val;\n  return obj;\n}\n\n/**\n * Normalize a `dot.separated.path`.\n *\n * A.HELL(!*&#(!)O_WOR   LD.bar => ahelloworldbar\n *\n * @param {String} path\n * @return {String}\n */\n\nfunction defaultNormalize(path) {\n  return path.replace(/[^a-zA-Z0-9\\.]+/g, '').toLowerCase();\n}\n\n/**\n * Check if a value is a function.\n *\n * @param {*} val\n * @return {boolean} Returns `true` if `val` is a function, otherwise `false`.\n */\n\nfunction isFunction(val) {\n  return typeof val === 'function';\n}\n","export function isBrowser(): boolean {\n  return typeof window !== 'undefined'\n}\n\nexport function isServer(): boolean {\n  return !isBrowser()\n}\n","/**\n * Tries to gets the unencoded version of an encoded component of a\n * Uniform Resource Identifier (URI). If input string is malformed,\n * returns it back as-is.\n *\n * Note: All occurences of the `+` character become ` ` (spaces).\n **/\nexport function gracefulDecodeURIComponent(\n  encodedURIComponent: string\n): string {\n  try {\n    return decodeURIComponent(encodedURIComponent.replace(/\\+/g, ' '))\n  } catch {\n    return encodedURIComponent\n  }\n}\n","import { ReceiverSnippet } from '../browser/standalone-interface'\n\n/**\n * Stores the global window receiver key\n */\nlet _globalReceiverKey = 'receiver'\n\n/**\n * Gets the global receiver/buffer\n * @param key name of the window property where the buffer is stored (default: receiver)\n * @returns ReceiverSnippet\n */\nexport function getGlobalReceiver(): ReceiverSnippet | undefined {\n  return (window as any)[_globalReceiverKey]\n}\n\n/**\n * Replaces the global window key for the receiver/buffer object\n * @param key key name\n */\nexport function setGlobalReceiverKey(key: string) {\n  _globalReceiverKey = key\n}\n\n/**\n * Sets the global receiver object\n * @param receiver receiver snippet\n */\nexport function setGlobalReceiver(receiver: ReceiverSnippet): void {\n  ;(window as any)[_globalReceiverKey] = receiver\n}\n","function findScript(src: string): HTMLScriptElement | undefined {\n  const scripts = Array.prototype.slice.call(\n    window.document.querySelectorAll('script')\n  )\n  return scripts.find((s) => s.src === src)\n}\n\nexport function loadScript(\n  src: string,\n  attributes?: Record<string, string>\n): Promise<HTMLScriptElement> {\n  const found = findScript(src)\n\n  if (found !== undefined) {\n    const status = found?.getAttribute('status')\n\n    if (status === 'loaded') {\n      return Promise.resolve(found)\n    }\n\n    if (status === 'loading') {\n      return new Promise((resolve, reject) => {\n        found.addEventListener('load', () => resolve(found))\n        found.addEventListener('error', (err) => reject(err))\n      })\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    const script = window.document.createElement('script')\n\n    script.type = 'text/javascript'\n    script.src = src\n    script.async = true\n\n    script.setAttribute('status', 'loading')\n    for (const [k, v] of Object.entries(attributes ?? {})) {\n      script.setAttribute(k, v)\n    }\n\n    script.onload = (): void => {\n      script.onerror = script.onload = null\n      script.setAttribute('status', 'loaded')\n      resolve(script)\n    }\n\n    script.onerror = (): void => {\n      script.onerror = script.onload = null\n      script.setAttribute('status', 'error')\n      reject(new Error(`Failed to load ${src}`))\n    }\n\n    const tag = window.document.getElementsByTagName('script')[0]\n    tag.parentElement?.insertBefore(script, tag)\n  })\n}\n\nexport function unloadScript(src: string): Promise<void> {\n  const found = findScript(src)\n\n  if (found !== undefined) {\n    found.remove()\n  }\n\n  return Promise.resolve()\n}\n","import { getGlobalReceiver } from './global-receiver-helper'\nimport { embeddedWriteKey } from './embedded-write-key'\n\nconst receiverScriptRegex =\n  /(https:\\/\\/.*)\\/receiver\\.js\\/v1\\/(?:.*?)\\/(?:platform|receiver.*)?/\nconst getCDNUrlFromScriptTag = (): string | undefined => {\n  let cdn: string | undefined\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  scripts.forEach((s) => {\n    const src = s.getAttribute('src') ?? ''\n    const result = receiverScriptRegex.exec(src)\n\n    if (result && result[1]) {\n      cdn = result[1]\n    }\n  })\n  return cdn\n}\n\nlet _globalCDN: string | undefined // set globalCDN as in-memory singleton\nconst getGlobalCDNUrl = (): string | undefined => {\n  const result = _globalCDN ?? getGlobalReceiver()?._cdn\n  return result\n}\n\nexport const setGlobalCDNUrl = (cdn: string) => {\n  const globalReceiver = getGlobalReceiver()\n  if (globalReceiver) {\n    globalReceiver._cdn = cdn\n  }\n  _globalCDN = cdn\n}\n\nexport const getCDN = (): string => {\n  const globalCdnUrl = getGlobalCDNUrl()\n\n  if (globalCdnUrl) return globalCdnUrl\n\n  const cdnFromScriptTag = getCDNUrlFromScriptTag()\n\n  if (cdnFromScriptTag) {\n    return cdnFromScriptTag\n  } else {\n    // it's possible that the CDN is not found in the page because:\n    // - the script is loaded through a proxy\n    // - the script is removed after execution\n    // in this case, we fall back to the default Tronic CDN\n    return `https://cdn.tronic.com`\n  }\n}\n\nexport const getNextIntegrationsURL = () => {\n  const cdn = getCDN()\n  return `${cdn}/next-integrations`\n}\n\n/**\n * Replaces the CDN URL in the script tag with the one from Receiver.js 1.0\n *\n * @returns the path to Receiver JS 1.0\n **/\nexport function getLegacyAJSPath(): string {\n  const writeKey = embeddedWriteKey() ?? getGlobalReceiver()?._writeKey\n\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  let path: string | undefined = undefined\n\n  for (const s of scripts) {\n    const src = s.getAttribute('src') ?? ''\n    const result = receiverScriptRegex.exec(src)\n\n    if (result && result[1]) {\n      path = src\n      break\n    }\n  }\n\n  if (path) {\n    return path.replace('receiver.min.js', 'receiver.classic.js')\n  }\n\n  return `https://cdn.tronic.com/receiver.js/v1/${writeKey}/receiver.classic.js`\n}\n","import {\n  Facade,\n  Identify,\n  Options,\n  Track,\n} from '@segment/facade'\nimport { TronicEvent } from '../core/events'\n\nexport type SegmentFacade = Facade<TronicEvent> & {\n  obj: TronicEvent\n}\n\nexport function toFacade(evt: TronicEvent, options?: Options): SegmentFacade {\n  let fcd = new Facade(evt, options)\n\n  if (evt.type === 'track') {\n    fcd = new Track(evt, options)\n  }\n\n  if (evt.type === 'identify') {\n    fcd = new Identify(evt, options)\n  }\n\n  /*\n  if (evt.type === 'page') {\n    fcd = new Page(evt, options)\n  }\n\n  if (evt.type === 'alias') {\n    fcd = new Alias(evt, options)\n  }\n\n  if (evt.type === 'group') {\n    fcd = new Group(evt, options)\n  }\n\n  if (evt.type === 'screen') {\n    fcd = new Screen(evt, options)\n  }\n   */\n\n  Object.defineProperty(fcd, 'obj', {\n    value: evt,\n    writable: true,\n  })\n\n  return fcd as SegmentFacade\n}\n","import { Context, ContextCancelation } from '../../core/context'\nimport { TronicEvent } from '../../core/events'\nimport { Plugin } from '../../core/plugin'\nimport { SegmentFacade, toFacade } from '../../lib/to-facade'\n\nexport interface MiddlewareParams {\n  payload: SegmentFacade\n\n  // integrations?: TronicEvent['integrations']\n  next: (payload: MiddlewareParams['payload'] | null) => void\n}\n\nexport interface DestinationMiddlewareParams {\n  payload: SegmentFacade\n  // integration: string\n  next: (payload: MiddlewareParams['payload'] | null) => void\n}\n\nexport type MiddlewareFunction = (\n  middleware: MiddlewareParams\n) => void | Promise<void>\n\nexport type DestinationMiddlewareFunction = (\n  middleware: DestinationMiddlewareParams\n) => void | Promise<void>\n\nexport async function applyDestinationMiddleware(\n  destination: string,\n  evt: TronicEvent,\n  middleware: DestinationMiddlewareFunction[]\n): Promise<TronicEvent | null> {\n  // Clone the event so mutations are localized to a single destination.\n  let modifiedEvent = toFacade(evt, {\n    clone: true,\n    traverse: false,\n  }).rawEvent() as TronicEvent\n  async function applyMiddleware(\n    event: TronicEvent,\n    fn: DestinationMiddlewareFunction\n  ): Promise<TronicEvent | null> {\n    let nextCalled = false\n    let returnedEvent: TronicEvent | null = null\n\n    await fn({\n      payload: toFacade(event, {\n        clone: true,\n        traverse: false,\n      }),\n      // integration: destination,\n      next(evt) {\n        nextCalled = true\n\n        if (evt === null) {\n          returnedEvent = null\n        }\n\n        if (evt) {\n          returnedEvent = evt.obj\n        }\n      },\n    })\n\n    if (!nextCalled && returnedEvent !== null) {\n      returnedEvent = returnedEvent as TronicEvent\n        /*\n      returnedEvent.integrations = {\n        ...event.integrations,\n        [destination]: false,\n      }\n         */\n    }\n\n    return returnedEvent\n  }\n\n  for (const md of middleware) {\n    const result = await applyMiddleware(modifiedEvent, md)\n    if (result === null) {\n      return null\n    }\n    modifiedEvent = result\n  }\n\n  return modifiedEvent\n}\n\nexport function sourceMiddlewarePlugin(\n  fn: MiddlewareFunction,\n  // integrations: TronicEvent['integrations']\n): Plugin {\n  async function apply(ctx: Context): Promise<Context> {\n    let nextCalled = false\n\n    await fn({\n      payload: toFacade(ctx.event, {\n        clone: true,\n        traverse: false,\n      }),\n      // integrations: integrations ?? {},\n      next(evt) {\n        nextCalled = true\n        if (evt) {\n          ctx.event = evt.obj\n        }\n      },\n    })\n\n    if (!nextCalled) {\n      throw new ContextCancelation({\n        retry: false,\n        type: 'middleware_cancellation',\n        reason: 'Middleware `next` function skipped',\n      })\n    }\n\n    return ctx\n  }\n\n  return {\n    name: `Source Middleware ${fn.name}`,\n    type: 'before',\n    version: '0.1.0',\n\n    isLoaded: (): boolean => true,\n    load: (ctx): Promise<Context> => Promise.resolve(ctx),\n\n    track: apply,\n    identify: apply,\n  }\n}\n","export function pTimeout(promise, timeout) {\n    return new Promise(function (resolve, reject) {\n        var timeoutId = setTimeout(function () {\n            reject(Error('Promise timed out'));\n        }, timeout);\n        promise\n            .then(function (val) {\n            clearTimeout(timeoutId);\n            return resolve(val);\n        })\n            .catch(reject);\n    });\n}\nexport function sleep(timeoutInMs) {\n    return new Promise(function (resolve) { return setTimeout(resolve, timeoutInMs); });\n}\n/**\n * @param ctx\n * @param callback - the function to invoke\n * @param delay - aka \"timeout\". The amount of time in ms to wait before invoking the callback.\n */\nexport function invokeCallback(ctx, callback, delay) {\n    var cb = function () {\n        try {\n            return Promise.resolve(callback(ctx));\n        }\n        catch (err) {\n            return Promise.reject(err);\n        }\n    };\n    return (sleep(delay)\n        // pTimeout ensures that the callback can't cause the context to hang\n        .then(function () { return pTimeout(cb(), 1000); })\n        .catch(function (err) {\n        ctx === null || ctx === void 0 ? void 0 : ctx.log('warn', 'Callback Error', { error: err });\n        ctx === null || ctx === void 0 ? void 0 : ctx.stats.increment('callback_error');\n    })\n        .then(function () { return ctx; }));\n}\n//# sourceMappingURL=index.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar CoreLogger = /** @class */ (function () {\n    function CoreLogger() {\n        this._logs = [];\n    }\n    CoreLogger.prototype.log = function (level, message, extras) {\n        var time = new Date();\n        this._logs.push({\n            level: level,\n            message: message,\n            time: time,\n            extras: extras,\n        });\n    };\n    Object.defineProperty(CoreLogger.prototype, \"logs\", {\n        get: function () {\n            return this._logs;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CoreLogger.prototype.flush = function () {\n        if (this.logs.length > 1) {\n            var formatted = this._logs.reduce(function (logs, log) {\n                var _a;\n                var _b, _c;\n                var line = __assign(__assign({}, log), { json: JSON.stringify(log.extras, null, ' '), extras: log.extras });\n                delete line['time'];\n                var key = (_c = (_b = log.time) === null || _b === void 0 ? void 0 : _b.toISOString()) !== null && _c !== void 0 ? _c : '';\n                if (logs[key]) {\n                    key = \"\".concat(key, \"-\").concat(Math.random());\n                }\n                return __assign(__assign({}, logs), (_a = {}, _a[key] = line, _a));\n            }, {});\n            // ie doesn't like console.table\n            if (console.table) {\n                console.table(formatted);\n            }\n            else {\n                console.log(formatted);\n            }\n        }\n        else {\n            this.logs.forEach(function (logEntry) {\n                var level = logEntry.level, message = logEntry.message, extras = logEntry.extras;\n                if (level === 'info' || level === 'debug') {\n                    console.log(message, extras !== null && extras !== void 0 ? extras : '');\n                }\n                else {\n                    console[level](message, extras !== null && extras !== void 0 ? extras : '');\n                }\n            });\n        }\n        this._logs = [];\n    };\n    return CoreLogger;\n}());\nexport { CoreLogger };\n//# sourceMappingURL=index.js.map","import { v4 as uuid } from '@lukeed/uuid';\nimport { dset } from 'dset';\nimport { CoreLogger } from '../logger';\nimport { NullStats } from '../stats';\nvar ContextCancelation = /** @class */ (function () {\n    function ContextCancelation(options) {\n        var _a, _b, _c;\n        this.retry = (_a = options.retry) !== null && _a !== void 0 ? _a : true;\n        this.type = (_b = options.type) !== null && _b !== void 0 ? _b : 'plugin Error';\n        this.reason = (_c = options.reason) !== null && _c !== void 0 ? _c : '';\n    }\n    return ContextCancelation;\n}());\nexport { ContextCancelation };\nvar CoreContext = /** @class */ (function () {\n    function CoreContext(event, id, stats, logger) {\n        if (id === void 0) { id = uuid(); }\n        if (stats === void 0) { stats = new NullStats(); }\n        if (logger === void 0) { logger = new CoreLogger(); }\n        this.attempts = 0;\n        this.event = event;\n        this._id = id;\n        this.logger = logger;\n        this.stats = stats;\n    }\n    CoreContext.system = function () {\n        // This should be overridden by the subclass to return an instance of the subclass.\n    };\n    CoreContext.prototype.isSame = function (other) {\n        return other.id === this.id;\n    };\n    CoreContext.prototype.cancel = function (error) {\n        if (error) {\n            throw error;\n        }\n        throw new ContextCancelation({ reason: 'Context Cancel' });\n    };\n    CoreContext.prototype.log = function (level, message, extras) {\n        this.logger.log(level, message, extras);\n    };\n    Object.defineProperty(CoreContext.prototype, \"id\", {\n        get: function () {\n            return this._id;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CoreContext.prototype.updateEvent = function (path, val) {\n        // Don't allow integrations that are set to false to be overwritten with integration settings.\n        /*\n        if (path.split('.')[0] === 'integrations') {\n          const integrationName = path.split('.')[1]\n    \n          if (this.event.integrations?.[integrationName] === false) {\n            return this.event\n          }\n        }\n          */\n        dset(this.event, path, val);\n        return this.event;\n    };\n    CoreContext.prototype.failedDelivery = function () {\n        return this._failedDelivery;\n    };\n    CoreContext.prototype.setFailedDelivery = function (options) {\n        this._failedDelivery = options;\n    };\n    CoreContext.prototype.logs = function () {\n        return this.logger.logs;\n    };\n    CoreContext.prototype.flush = function () {\n        this.logger.flush();\n        this.stats.flush();\n    };\n    CoreContext.prototype.toJSON = function () {\n        return {\n            id: this._id,\n            event: this.event,\n            logs: this.logger.logs,\n            metrics: this.stats.metrics,\n        };\n    };\n    return CoreContext;\n}());\nexport { CoreContext };\n//# sourceMappingURL=index.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar compactMetricType = function (type) {\n    var enums = {\n        gauge: 'g',\n        counter: 'c',\n    };\n    return enums[type];\n};\nvar CoreStats = /** @class */ (function () {\n    function CoreStats() {\n        this.metrics = [];\n    }\n    CoreStats.prototype.increment = function (metric, by, tags) {\n        if (by === void 0) { by = 1; }\n        this.metrics.push({\n            metric: metric,\n            value: by,\n            tags: tags !== null && tags !== void 0 ? tags : [],\n            type: 'counter',\n            timestamp: Date.now(),\n        });\n    };\n    CoreStats.prototype.gauge = function (metric, value, tags) {\n        this.metrics.push({\n            metric: metric,\n            value: value,\n            tags: tags !== null && tags !== void 0 ? tags : [],\n            type: 'gauge',\n            timestamp: Date.now(),\n        });\n    };\n    CoreStats.prototype.flush = function () {\n        var formatted = this.metrics.map(function (m) { return (__assign(__assign({}, m), { tags: m.tags.join(',') })); });\n        // ie doesn't like console.table\n        if (console.table) {\n            console.table(formatted);\n        }\n        else {\n            console.log(formatted);\n        }\n        this.metrics = [];\n    };\n    /**\n     * compact keys for smaller payload\n     */\n    CoreStats.prototype.serialize = function () {\n        return this.metrics.map(function (m) {\n            return {\n                m: m.metric,\n                v: m.value,\n                t: m.tags,\n                k: compactMetricType(m.type),\n                e: m.timestamp,\n            };\n        });\n    };\n    return CoreStats;\n}());\nexport { CoreStats };\nvar NullStats = /** @class */ (function (_super) {\n    __extends(NullStats, _super);\n    function NullStats() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NullStats.prototype.gauge = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.increment = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.flush = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.serialize = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n        return [];\n    };\n    return NullStats;\n}(CoreStats));\nexport { NullStats };\n//# sourceMappingURL=index.js.map","export function isString(obj) {\n    return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n    return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n    return typeof obj === 'function';\n}\nexport function exists(val) {\n    return val !== undefined && val !== null;\n}\nexport function isPlainObject(obj) {\n    return (Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object');\n}\n//# sourceMappingURL=helpers.js.map","var IDX=256, HEX=[], BUFFER;\nwhile (IDX--) HEX[IDX] = (IDX + 256).toString(16).substring(1);\n\nexport function v4() {\n\tvar i=0, num, out='';\n\n\tif (!BUFFER || ((IDX + 16) > 256)) {\n\t\tBUFFER = Array(i=256);\n\t\twhile (i--) BUFFER[i] = 256 * Math.random() | 0;\n\t\ti = IDX = 0;\n\t}\n\n\tfor (; i < 16; i++) {\n\t\tnum = BUFFER[IDX + i];\n\t\tif (i==6) out += HEX[num & 15 | 64];\n\t\telse if (i==8) out += HEX[num & 63 | 128];\n\t\telse out += HEX[num];\n\n\t\tif (i & 1 && i > 1 && i < 11) out += '-';\n\t}\n\n\tIDX++;\n\treturn out;\n}\n","export function dset(obj, keys, val) {\n\tkeys.split && (keys=keys.split('.'));\n\tvar i=0, l=keys.length, t=obj, x, k;\n\twhile (i < l) {\n\t\tk = keys[i++];\n\t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n\t\tt = t[k] = (i === l) ? val : (typeof(x=t[k])===typeof(keys)) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + {\"96\":\"queryString\",\"119\":\"auto-track\",\"214\":\"remoteMiddleware\"}[chunkId] + \".bundle.\" + {\"96\":\"ff94b41a75f57fbcd624\",\"119\":\"adec29ef96724b419515\",\"214\":\"e2d0030c368988b4e809\"}[chunkId] + \".js\";\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t826: 0\n};\n\n__webpack_require__.f.j = function(chunkId, promises) {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise(function(resolve, reject) { installedChunkData = installedChunks[chunkId] = [resolve, reject]; });\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = function(event) {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_tronic_receiver_browser\"] = self[\"webpackChunk_tronic_receiver_browser\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// Default value will be updated to 'web' in `bundle-umd.ts` for web build.\nlet _version: 'web' | 'npm' = 'npm'\n\nexport function setVersionType(version: typeof _version) {\n  _version = version\n}\n\nexport function getVersionType(): typeof _version {\n  return _version\n}\n","export default function(e,n){return n=n||{},new Promise(function(t,r){var s=new XMLHttpRequest,o=[],u=[],i={},a=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(s.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:a,headers:{keys:function(){return o},entries:function(){return u},get:function(e){return i[e.toLowerCase()]},has:function(e){return e.toLowerCase()in i}}}};for(var l in s.open(n.method||\"get\",e,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm,function(e,n,t){o.push(n=n.toLowerCase()),u.push([n,t]),i[n]=i[n]?i[n]+\",\"+t:t}),t(a())},s.onerror=r,s.withCredentials=\"include\"==n.credentials,n.headers)s.setRequestHeader(l,n.headers[l]);s.send(n.body||null)})}\n//# sourceMappingURL=unfetch.module.js.map\n","// This an imperfect polyfill for globalThis\nexport const getGlobal = () => {\n  if (typeof globalThis !== 'undefined') {\n    return globalThis\n  }\n  if (typeof self !== 'undefined') {\n    return self\n  }\n  if (typeof window !== 'undefined') {\n    return window\n  }\n  if (typeof global !== 'undefined') {\n    return global\n  }\n  return null\n}\n","import unfetch from 'unfetch'\nimport { getGlobal } from './get-global'\n\n/**\n * Wrapper around native `fetch` containing `unfetch` fallback.\n */\n// @ts-ignore\nexport const fetch: typeof global.fetch = (...args) => {\n  const global = getGlobal()\n  // @ts-ignore\n  return ((global && global.fetch) || unfetch)(...args)\n}\n","import {\n  isFunction,\n  isPlainObject,\n  isString,\n  isNumber,\n} from '@tronic/receiver-core'\nimport { Context } from '../context'\nimport {\n  Callback,\n  JSONObject,\n  Options,\n  EventProperties,\n  TronicEvent,\n  Traits,\n  UserTraits,\n} from '../events'\nimport { ID, User } from '../user'\n\n/**\n * Helper for the track method\n */\nexport function resolveArguments(\n  channelId: string,\n  userId: string,\n  eventName: string | TronicEvent,\n  properties?: EventProperties | Callback,\n  options?: Options | Callback,\n  callback?: Callback\n): [string, string, string, EventProperties | Callback, Options, Callback | undefined] {\n  const args = [channelId, userId, eventName, properties, options, callback]\n\n  if (!channelId || !isString(channelId)) {\n    throw new Error('ChannelId missing')\n  }\n\n  if (!userId || !isString(userId)) {\n    throw new Error('UserId missing')\n  }\n\n  const name = isPlainObject(eventName) ? eventName.event : eventName\n  if (!name || !isString(name)) {\n    throw new Error('Event missing')\n  }\n\n  const data = isPlainObject(eventName)\n    ? eventName.properties ?? {}\n    : isPlainObject(properties)\n    ? properties\n    : {}\n\n  let opts: Options = {}\n  if (!isFunction(options)) {\n    opts = options ?? {}\n  }\n\n  if (isPlainObject(eventName) && !isFunction(properties)) {\n    opts = properties ?? {}\n  }\n\n  const cb = args.find(isFunction) as Callback | undefined\n  return [channelId, userId, name, data, opts, cb]\n}\n\n/**\n * Helper for group, identify methods\n */\nexport const resolveUserArguments = <T extends Traits, U extends User>(\n  user: U\n): ResolveUser<T> => {\n  return (...args): ReturnType<ResolveUser<T>> => {\n    const values: {\n      // channelId?: string\n      id?: ID\n      traits?: T | null\n      options?: Options\n      callback?: Callback\n    } = {}\n    // It's a stack so it's reversed so that we go through each of the expected arguments\n    const orderStack: Array<keyof typeof values> = [\n      'callback',\n      'options',\n      'traits',\n      'id',\n      // 'channelId',\n    ]\n\n    // Read each argument and eval the possible values here\n    for (const arg of args) {\n      let current = orderStack.pop()\n      if (current === 'id') {\n        if (isString(arg) || isNumber(arg)) {\n          values.id = arg.toString()\n          continue\n        }\n        if (arg === null || arg === undefined) {\n          continue\n        }\n        // First argument should always be the id, if it is not a valid value we can skip it\n        current = orderStack.pop()\n      }\n\n      // Traits and Options\n      if (\n        (current === 'traits' || current === 'options') &&\n        (arg === null || arg === undefined || isPlainObject(arg))\n      ) {\n        values[current] = arg as T\n      }\n\n      // Callback\n      if (isFunction(arg)) {\n        values.callback = arg as Callback\n        break // This is always the last argument\n      }\n    }\n\n    return [\n      // values.channelId,\n      values.id ?? user.id(),\n      (values.traits ?? {}) as T,\n      values.options ?? {},\n      values.callback,\n    ]\n  }\n}\n\ntype ResolveUser<T extends Traits> = (\n  // channelId: string,\n  id?: ID | object,\n  traits?: T | Callback | null,\n  options?: Options | Callback,\n  callback?: Callback\n) => [ID, T, Options, Callback | undefined]\n\nexport type IdentifyParams = Parameters<ResolveUser<UserTraits>>\nexport type EventParams = Parameters<typeof resolveArguments>\n\nexport type DispatchedEvent = Context\n","import { isBrowser } from '../environment'\n\nexport function isOnline(): boolean {\n  if (isBrowser()) {\n    return window.navigator.onLine\n  }\n\n  return true\n}\n\nexport function isOffline(): boolean {\n  return !isOnline()\n}\n","// This file is generated.\nexport const version = '0.0.1'\n","export const TRONIC_API_HOST = 'localhost:3000'\n","import { fetch } from '../../lib/fetch'\nimport { version } from '../../generated/version'\nimport { getVersionType } from '../../lib/version-type'\nimport { TRONIC_API_HOST } from '../constants'\n\nexport interface MetricsOptions {\n  host?: string\n  sampleRate?: number\n  flushTimer?: number\n  maxQueueSize?: number\n}\n\n/**\n * Type expected by the tronic metrics API endpoint\n */\ntype RemoteMetric = {\n  type: 'Counter'\n  metric: string\n  value: 1\n  tags: {\n    library: string\n    library_version: string\n    [key: string]: string\n  }\n}\n\nconst createRemoteMetric = (\n  metric: string,\n  tags: string[],\n  versionType: 'web' | 'npm'\n): RemoteMetric => {\n  const formattedTags = tags.reduce((acc, t) => {\n    const [k, v] = t.split(':')\n    acc[k] = v\n    return acc\n  }, {} as Record<string, string>)\n\n  return {\n    type: 'Counter',\n    metric,\n    value: 1,\n    tags: {\n      ...formattedTags,\n      library: 'receiver.js',\n      library_version:\n        versionType === 'web' ? `next-${version}` : `npm:next-${version}`,\n    },\n  }\n}\n\nfunction logError(err: unknown): void {\n  console.error('Error sending tronic performance metrics', err)\n}\n\nexport class RemoteMetrics {\n  private host: string\n  private flushTimer: number\n  private maxQueueSize: number\n\n  sampleRate: number\n  queue: RemoteMetric[]\n\n  constructor(options?: MetricsOptions) {\n    this.host = options?.host ?? TRONIC_API_HOST\n    this.sampleRate = options?.sampleRate ?? 1\n    this.flushTimer = options?.flushTimer ?? 30 * 1000 /* 30s */\n    this.maxQueueSize = options?.maxQueueSize ?? 20\n\n    this.queue = []\n\n    if (this.sampleRate > 0) {\n      let flushing = false\n\n      const run = (): void => {\n        if (flushing) {\n          return\n        }\n\n        flushing = true\n        this.flush().catch(logError)\n\n        flushing = false\n\n        setTimeout(run, this.flushTimer)\n      }\n      run()\n    }\n  }\n\n  increment(metric: string, tags: string[]): void {\n    // All metrics are part of an allow list in Tracking API\n    if (!metric.includes('receiver_js.')) {\n      return\n    }\n\n    // /m doesn't like empty tags\n    if (tags.length === 0) {\n      return\n    }\n\n    if (Math.random() > this.sampleRate) {\n      return\n    }\n\n    if (this.queue.length >= this.maxQueueSize) {\n      return\n    }\n\n    const remoteMetric = createRemoteMetric(metric, tags, getVersionType())\n    this.queue.push(remoteMetric)\n\n    if (metric.includes('error')) {\n      this.flush().catch(logError)\n    }\n  }\n\n  async flush(): Promise<void> {\n    if (this.queue.length <= 0) {\n      return\n    }\n\n    await this.send().catch((error) => {\n      logError(error)\n      this.sampleRate = 0\n    })\n  }\n\n  private async send(): Promise<Response> {\n    const payload = { series: this.queue }\n    this.queue = []\n\n    const headers = { 'Content-Type': 'text/plain' }\n    const url = `https://${this.host}/m`\n\n    return fetch(url, {\n      headers,\n      body: JSON.stringify(payload),\n      method: 'POST',\n    })\n  }\n}\n","import { CoreStats } from '@tronic/receiver-core'\nimport { MetricsOptions, RemoteMetrics } from './remote-metrics'\n\nlet remoteMetrics: RemoteMetrics | undefined\n\nexport class Stats extends CoreStats {\n  static initRemoteMetrics(options?: MetricsOptions) {\n    remoteMetrics = new RemoteMetrics(options)\n  }\n\n  override increment(metric: string, by?: number, tags?: string[]): void {\n    super.increment(metric, by, tags)\n    remoteMetrics?.increment(metric, tags ?? [])\n  }\n}\n","import {\n  CoreContext,\n  ContextCancelation,\n  ContextFailedDelivery,\n  SerializedContext,\n  CancelationOptions,\n} from '@tronic/receiver-core'\nimport { TronicEvent } from '../events/interfaces'\nimport { Stats } from '../stats'\n\nexport class Context extends CoreContext<TronicEvent> {\n  static override system() {\n    return new this({ type: 'track', event: 'system', channelId: '' })\n  }\n  constructor(event: TronicEvent, id?: string) {\n    super(event, id, new Stats())\n  }\n}\n\nexport { ContextCancelation }\nexport type { ContextFailedDelivery, SerializedContext, CancelationOptions }\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { invokeCallback } from '../callback';\n/* The amount of time in ms to wait before invoking the callback. */\nexport var getDelay = function (startTimeInEpochMS, timeoutInMS) {\n    var elapsedTime = Date.now() - startTimeInEpochMS;\n    // increasing the timeout increases the delay by almost the same amount -- this is weird legacy behavior.\n    return Math.max((timeoutInMS !== null && timeoutInMS !== void 0 ? timeoutInMS : 300) - elapsedTime, 0);\n};\n/**\n * Push an event into the dispatch queue and invoke any callbacks.\n *\n * @param event - Event to enqueue.\n * @param queue - Queue to dispatch against.\n * @param emitter - This is typically an instance of \"Receiver\" -- used for metrics / progress information.\n * @param options\n */\nexport function dispatch(ctx, queue, emitter, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var startTime, dispatched;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    emitter.emit('dispatch_start', ctx);\n                    startTime = Date.now();\n                    if (!queue.isEmpty()) return [3 /*break*/, 2];\n                    return [4 /*yield*/, queue.dispatchSingle(ctx)];\n                case 1:\n                    dispatched = _a.sent();\n                    return [3 /*break*/, 4];\n                case 2: return [4 /*yield*/, queue.dispatch(ctx)];\n                case 3:\n                    dispatched = _a.sent();\n                    _a.label = 4;\n                case 4:\n                    if (!(options === null || options === void 0 ? void 0 : options.callback)) return [3 /*break*/, 6];\n                    return [4 /*yield*/, invokeCallback(dispatched, options.callback, getDelay(startTime, options.timeout))];\n                case 5:\n                    dispatched = _a.sent();\n                    _a.label = 6;\n                case 6:\n                    if (options === null || options === void 0 ? void 0 : options.debug) {\n                        dispatched.flush();\n                    }\n                    return [2 /*return*/, dispatched];\n            }\n        });\n    });\n}\n//# sourceMappingURL=dispatch.js.map","/**\n * Event Emitter that takes the expected contract as a generic\n * @example\n * ```ts\n *  type Contract = {\n *    delivery_success: [DeliverySuccessResponse, Metrics],\n *    delivery_failure: [DeliveryError]\n * }\n *  new Emitter<Contract>()\n *  .on('delivery_success', (res, metrics) => ...)\n *  .on('delivery_failure', (err) => ...)\n * ```\n */\nvar Emitter = /** @class */ (function () {\n    function Emitter() {\n        this.callbacks = {};\n    }\n    Emitter.prototype.on = function (event, callback) {\n        if (!this.callbacks[event]) {\n            this.callbacks[event] = [callback];\n        }\n        else {\n            this.callbacks[event].push(callback);\n        }\n        return this;\n    };\n    Emitter.prototype.once = function (event, callback) {\n        var _this = this;\n        var on = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            _this.off(event, on);\n            callback.apply(_this, args);\n        };\n        this.on(event, on);\n        return this;\n    };\n    Emitter.prototype.off = function (event, callback) {\n        var _a;\n        var fns = (_a = this.callbacks[event]) !== null && _a !== void 0 ? _a : [];\n        var without = fns.filter(function (fn) { return fn !== callback; });\n        this.callbacks[event] = without;\n        return this;\n    };\n    Emitter.prototype.emit = function (event) {\n        var _this = this;\n        var _a;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var callbacks = (_a = this.callbacks[event]) !== null && _a !== void 0 ? _a : [];\n        callbacks.forEach(function (callback) {\n            callback.apply(_this, args);\n        });\n        return this;\n    };\n    return Emitter;\n}());\nexport { Emitter };\n//# sourceMappingURL=index.js.map","import { isPlainObject } from '@tronic/receiver-core'\n\n/**\n * Final Page Context object expected in the Event context\n */\nexport interface PageContext {\n  path: string\n  referrer: string\n  search: string\n  title: string\n  url: string\n}\n\ntype CanonicalUrl = string | undefined\n\nexport const BufferedPageContextDiscriminant = 'bpc' as const\n/**\n * Page Context expected to be built by the snippet.\n * Note: The key names are super short because we want to keep the strings in the html snippet short to save bytes.\n */\nexport interface BufferedPageContext {\n  __t: typeof BufferedPageContextDiscriminant // for extra uniqeness\n  c: CanonicalUrl\n  p: PageContext['path']\n  u: PageContext['url']\n  s: PageContext['search']\n  t: PageContext['title']\n  r: PageContext['referrer']\n}\n\n/**\n * `BufferedPageContext` object builder\n */\nexport const createBufferedPageContext = (\n  url: string,\n  canonicalUrl: CanonicalUrl,\n  search: string,\n  path: string,\n  title: string,\n  referrer: string\n): BufferedPageContext => ({\n  __t: BufferedPageContextDiscriminant,\n  c: canonicalUrl,\n  p: path,\n  u: url,\n  s: search,\n  t: title,\n  r: referrer,\n})\n\n// my clever/dubious way of making sure this type guard does not get out sync with the type definition\nconst BUFFERED_PAGE_CONTEXT_KEYS = Object.keys(\n  createBufferedPageContext('', '', '', '', '', '')\n) as (keyof BufferedPageContext)[]\n\nexport function isBufferedPageContext(\n  bufferedPageCtx: unknown\n): bufferedPageCtx is BufferedPageContext {\n  if (!isPlainObject(bufferedPageCtx)) return false\n  if (bufferedPageCtx.__t !== BufferedPageContextDiscriminant) return false\n\n  // ensure obj has all the keys we expect, and none we don't.\n  for (const k in bufferedPageCtx) {\n    if (!BUFFERED_PAGE_CONTEXT_KEYS.includes(k as keyof BufferedPageContext)) {\n      return false\n    }\n  }\n  return true\n}\n\n//  Legacy logic: we are we appending search parameters to the canonical URL -- I guess the canonical URL is  \"not canonical enough\" (lol)\nconst createCanonicalURL = (canonicalUrl: string, searchParams: string) => {\n  return canonicalUrl.indexOf('?') > -1\n    ? canonicalUrl\n    : canonicalUrl + searchParams\n}\n\n/**\n * Strips hash from URL.\n */\nconst removeHash = (href: string) => {\n  const hashIdx = href.indexOf('#')\n  return hashIdx === -1 ? href : href.slice(0, hashIdx)\n}\n\nconst parseCanonicalPath = (canonicalUrl: string): string => {\n  try {\n    return new URL(canonicalUrl).pathname\n  } catch (_e) {\n    // this is classic behavior -- we assume that if the canonical URL is invalid, it's a raw path.\n    return canonicalUrl[0] === '/' ? canonicalUrl : '/' + canonicalUrl\n  }\n}\n\n/**\n * Create a `PageContext` from a `BufferedPageContext`.\n * `BufferedPageContext` keys are minified to save bytes in the snippet.\n */\nexport const createPageContext = ({\n  c: canonicalUrl,\n  p: pathname,\n  s: search,\n  u: url,\n  r: referrer,\n  t: title,\n}: BufferedPageContext): PageContext => {\n  const newPath = canonicalUrl ? parseCanonicalPath(canonicalUrl) : pathname\n  const newUrl = canonicalUrl\n    ? createCanonicalURL(canonicalUrl, search)\n    : removeHash(url)\n  return {\n    path: newPath,\n    referrer,\n    search,\n    title,\n    url: newUrl,\n  }\n}\n\n/**\n * Get page properties from the browser window/document.\n */\nexport const getDefaultBufferedPageContext = (): BufferedPageContext => {\n  const c = document.querySelector(\"link[rel='canonical']\")\n  return createBufferedPageContext(\n    location.href,\n    (c && c.getAttribute('href')) || undefined,\n    location.search,\n    location.pathname,\n    document.title,\n    document.referrer\n  )\n}\n\n/**\n * Get page properties from the browser window/document.\n */\nexport const getDefaultPageContext = (): PageContext =>\n  createPageContext(getDefaultBufferedPageContext())\n","import { pick } from '../../lib/pick'\nimport { EventProperties, TronicEvent } from '../events'\nimport { getDefaultPageContext } from './get-page-context'\n\n/**\n * Augments a Tronic event with information about the current page.\n * Page information like URL changes frequently, so this is meant to be captured as close to the event call as possible.\n * Things like `userAgent` do not change, so they can be added later in the flow.\n * We prefer not to add this information to this function, as it increases the main bundle size.\n */\nexport const addPageContext = (\n  event: TronicEvent,\n  pageCtx = getDefaultPageContext()\n): void => {\n  const evtCtx = event.context! // Context should be set earlier in the flow\n  let pageContextFromEventProps: Pick<EventProperties, string> | undefined\n  /*\n  if (event.type === 'page') {\n    pageContextFromEventProps =\n      event.properties && pick(event.properties, Object.keys(pageCtx))\n\n    event.properties = {\n      ...pageCtx,\n      ...event.properties,\n      ...(event.name ? { name: event.name } : {}),\n    }\n  }\n   */\n  evtCtx.page = {\n    ...pageCtx,\n    ...pageContextFromEventProps,\n    ...evtCtx.page,\n  }\n}\n","import { v4 as uuid } from '@lukeed/uuid'\nimport { dset } from 'dset'\nimport { ID, User } from '../user'\nimport {\n  // Options,\n  // Integrations,\n  EventProperties,\n  Traits,\n  TronicEvent,\n} from './interfaces'\nimport md5 from 'spark-md5'\nimport { addPageContext, PageContext } from '../page'\n\nexport * from './interfaces'\n\nexport class EventFactory {\n  constructor(public user: User) {}\n\n  track(\n    channelId: string,\n    userId: string,\n    event: string,\n    properties?: EventProperties,\n    // options?: Options,\n    // globalIntegrations?: Integrations,\n    pageCtx?: PageContext\n  ): TronicEvent {\n    return this.normalize(\n      {\n        ...this.baseEvent(),\n        channelId,\n        userId,\n        event,\n        type: 'track' as const,\n        properties,\n        // options: { ...options },\n        // integrations: { ...globalIntegrations },\n      },\n      pageCtx\n    )\n  }\n\n  identify(\n    channelId: string,\n    userId: ID,\n    traits?: Traits,\n    // options?: Options,\n    // globalIntegrations?: Integrations,\n    pageCtx?: PageContext\n  ): TronicEvent {\n    return this.normalize(\n      {\n        channelId,\n        ...this.baseEvent(),\n        type: 'identify' as const,\n        userId,\n        traits,\n        // options: { ...options },\n        // integrations: { ...globalIntegrations },\n      },\n      pageCtx\n    )\n  }\n\n  private baseEvent(): Partial<TronicEvent> {\n    const base: Partial<TronicEvent> = {\n      // integrations: {},\n      // options: {},\n    }\n\n      /*\n    const user = this.user\n\n    if (user.id()) {\n      base.userId = user.id()\n    }\n\n    if (user.anonymousId()) {\n      base.anonymousId = user.anonymousId()\n    }\n      */\n\n    return base\n  }\n\n  /**\n   * Builds the context part of an event based on \"foreign\" keys that\n   * are provided in the `Options` parameter for an Event\n   */\n  private context(event: TronicEvent): [object, object] {\n    const optionsKeys = ['integrations', 'anonymousId', 'timestamp', 'userId']\n\n    const options: Record<string, any> = /* event.options ?? */ {}\n    // delete options['integrations']\n\n    const providedOptionsKeys = Object.keys(options)\n\n    const context = /* event.options?.context ?? */ {}\n    const overrides: Record<string, any> = {}\n\n    providedOptionsKeys.forEach((key) => {\n      if (key === 'context') {\n        return\n      }\n\n      if (optionsKeys.includes(key)) {\n        dset(overrides, key, options[key])\n      } else {\n        dset(context, key, options[key])\n      }\n    })\n\n    return [context, overrides]\n  }\n\n  public normalize(event: TronicEvent, pageCtx?: PageContext): TronicEvent {\n    /*\n    // set anonymousId globally if we encounter an override\n\n    event.options?.anonymousId &&\n      this.user.anonymousId(event.options.anonymousId)\n\n    const integrationBooleans = Object.keys(event.integrations ?? {}).reduce(\n      (integrationNames, name) => {\n        return {\n          ...integrationNames,\n          [name]: Boolean(event.integrations?.[name]),\n        }\n      },\n      {} as Record<string, boolean>\n    )\n\n    // This is pretty trippy, but here's what's going on:\n    // - a) We don't pass initial integration options as part of the event, only if they're true or false\n    // - b) We do accept per integration overrides (like integrations.Amplitude.sessionId) at the event level\n    // Hence the need to convert base integration options to booleans, but maintain per event integration overrides\n    const allIntegrations = {\n      // Base config integrations object as booleans\n      ...integrationBooleans,\n\n      // Per event overrides, for things like amplitude sessionId, for example\n      ...event.options?.integrations,\n    }\n     */\n\n    const [context, overrides] = this.context(event)\n    const { /* options, */ ...rest } = event\n\n    const newEvent: TronicEvent = {\n      timestamp: new Date(),\n      ...rest,\n      context,\n      // integrations: allIntegrations,\n      ...overrides,\n      // messageId: 'ajs-next-' + md5.hash(JSON.stringify(event) + uuid()),\n    }\n    addPageContext(newEvent, pageCtx)\n\n    return newEvent\n  }\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Emitter } from '../emitter';\nimport { backoff } from './backoff';\n/**\n * @internal\n */\nexport var ON_REMOVE_FROM_FUTURE = 'onRemoveFromFuture';\nvar PriorityQueue = /** @class */ (function (_super) {\n    __extends(PriorityQueue, _super);\n    function PriorityQueue(maxAttempts, queue, seen) {\n        var _this = _super.call(this) || this;\n        _this.future = [];\n        _this.maxAttempts = maxAttempts;\n        _this.queue = queue;\n        _this.seen = seen !== null && seen !== void 0 ? seen : {};\n        return _this;\n    }\n    PriorityQueue.prototype.push = function () {\n        var _this = this;\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var accepted = items.map(function (operation) {\n            var attempts = _this.updateAttempts(operation);\n            if (attempts > _this.maxAttempts || _this.includes(operation)) {\n                return false;\n            }\n            _this.queue.push(operation);\n            return true;\n        });\n        this.queue = this.queue.sort(function (a, b) { return _this.getAttempts(a) - _this.getAttempts(b); });\n        return accepted;\n    };\n    PriorityQueue.prototype.pushWithBackoff = function (item) {\n        var _this = this;\n        if (this.getAttempts(item) === 0) {\n            return this.push(item)[0];\n        }\n        var attempt = this.updateAttempts(item);\n        if (attempt > this.maxAttempts || this.includes(item)) {\n            return false;\n        }\n        var timeout = backoff({ attempt: attempt - 1 });\n        setTimeout(function () {\n            _this.queue.push(item);\n            // remove from future list\n            _this.future = _this.future.filter(function (f) { return f.id !== item.id; });\n            // Lets listeners know that a 'future' message is now available in the queue\n            _this.emit(ON_REMOVE_FROM_FUTURE);\n        }, timeout);\n        this.future.push(item);\n        return true;\n    };\n    PriorityQueue.prototype.getAttempts = function (item) {\n        var _a;\n        return (_a = this.seen[item.id]) !== null && _a !== void 0 ? _a : 0;\n    };\n    PriorityQueue.prototype.updateAttempts = function (item) {\n        this.seen[item.id] = this.getAttempts(item) + 1;\n        return this.getAttempts(item);\n    };\n    PriorityQueue.prototype.includes = function (item) {\n        return (this.queue.includes(item) ||\n            this.future.includes(item) ||\n            Boolean(this.queue.find(function (i) { return i.id === item.id; })) ||\n            Boolean(this.future.find(function (i) { return i.id === item.id; })));\n    };\n    PriorityQueue.prototype.pop = function () {\n        return this.queue.shift();\n    };\n    Object.defineProperty(PriorityQueue.prototype, \"length\", {\n        get: function () {\n            return this.queue.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PriorityQueue.prototype, \"todo\", {\n        get: function () {\n            return this.queue.length + this.future.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return PriorityQueue;\n}(Emitter));\nexport { PriorityQueue };\n//# sourceMappingURL=index.js.map","export function backoff(params) {\n    var random = Math.random() + 1;\n    var _a = params.minTimeout, minTimeout = _a === void 0 ? 500 : _a, _b = params.factor, factor = _b === void 0 ? 2 : _b, attempt = params.attempt, _c = params.maxTimeout, maxTimeout = _c === void 0 ? Infinity : _c;\n    return Math.min(random * minTimeout * Math.pow(factor, attempt), maxTimeout);\n}\n//# sourceMappingURL=backoff.js.map","import { PriorityQueue } from '.'\nimport { Context, SerializedContext } from '../../core/context'\nimport { isBrowser } from '../../core/environment'\n\nlet loc:\n  | Storage\n  | { getItem: () => void; setItem: () => void; removeItem: () => void } = {\n  getItem() {},\n  setItem() {},\n  removeItem() {},\n}\n\ntry {\n  loc = isBrowser() && window.localStorage ? window.localStorage : loc\n} catch (err) {\n  console.warn('Unable to access localStorage', err)\n}\n\nfunction persisted(key: string): Context[] {\n  const items = loc.getItem(key)\n  return (items ? JSON.parse(items) : []).map(\n    (p: SerializedContext) => new Context(p.event, p.id)\n  )\n}\n\nfunction persistItems(key: string, items: Context[]): void {\n  const existing = persisted(key)\n  const all = [...items, ...existing]\n\n  const merged = all.reduce((acc, item) => {\n    return {\n      ...acc,\n      [item.id]: item,\n    }\n  }, {} as Record<string, Context>)\n\n  loc.setItem(key, JSON.stringify(Object.values(merged)))\n}\n\nfunction seen(key: string): Record<string, number> {\n  const stored = loc.getItem(key)\n  return stored ? JSON.parse(stored) : {}\n}\n\nfunction persistSeen(key: string, memory: Record<string, number>): void {\n  const stored = seen(key)\n\n  loc.setItem(\n    key,\n    JSON.stringify({\n      ...stored,\n      ...memory,\n    })\n  )\n}\n\nfunction remove(key: string): void {\n  loc.removeItem(key)\n}\n\nconst now = (): number => new Date().getTime()\n\nfunction mutex(key: string, onUnlock: Function, attempt = 0): void {\n  const lockTimeout = 50\n  const lockKey = `persisted-queue:v1:${key}:lock`\n\n  const expired = (lock: number): boolean => new Date().getTime() > lock\n  const rawLock = loc.getItem(lockKey)\n  const lock = rawLock ? (JSON.parse(rawLock) as number) : null\n\n  const allowed = lock === null || expired(lock)\n  if (allowed) {\n    loc.setItem(lockKey, JSON.stringify(now() + lockTimeout))\n    onUnlock()\n    loc.removeItem(lockKey)\n    return\n  }\n\n  if (!allowed && attempt < 3) {\n    setTimeout(() => {\n      mutex(key, onUnlock, attempt + 1)\n    }, lockTimeout)\n  } else {\n    console.error('Unable to retrieve lock')\n  }\n}\n\nexport class PersistedPriorityQueue extends PriorityQueue<Context> {\n  constructor(maxAttempts: number, key: string) {\n    super(maxAttempts, [])\n\n    const itemsKey = `persisted-queue:v1:${key}:items`\n    const seenKey = `persisted-queue:v1:${key}:seen`\n\n    let saved: Context[] = []\n    let lastSeen: Record<string, number> = {}\n\n    mutex(key, () => {\n      try {\n        saved = persisted(itemsKey)\n        lastSeen = seen(seenKey)\n        remove(itemsKey)\n        remove(seenKey)\n\n        this.queue = [...saved, ...this.queue]\n        this.seen = { ...lastSeen, ...this.seen }\n      } catch (err) {\n        console.error(err)\n      }\n    })\n\n    window.addEventListener('pagehide', () => {\n      // we deliberately want to use the less powerful 'pagehide' API to only persist on events where the receiver instance gets destroyed, and not on tab away.\n      if (this.todo > 0) {\n        const items = [...this.queue, ...this.future]\n        try {\n          mutex(key, () => {\n            persistItems(itemsKey, items)\n            persistSeen(seenKey, this.seen)\n          })\n        } catch (err) {\n          console.error(err)\n        }\n      }\n    })\n  }\n}\n","var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nexport function groupBy(collection, grouper) {\n    var results = {};\n    collection.forEach(function (item) {\n        var _a;\n        var key = undefined;\n        if (typeof grouper === 'string') {\n            var suggestedKey = item[grouper];\n            key =\n                typeof suggestedKey !== 'string'\n                    ? JSON.stringify(suggestedKey)\n                    : suggestedKey;\n        }\n        else if (grouper instanceof Function) {\n            key = grouper(item);\n        }\n        if (key === undefined) {\n            return;\n        }\n        results[key] = __spreadArray(__spreadArray([], ((_a = results[key]) !== null && _a !== void 0 ? _a : []), true), [item], false);\n    });\n    return results;\n}\n//# sourceMappingURL=group-by.js.map","/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport var isThenable = function (value) {\n    return typeof value === 'object' &&\n        value !== null &&\n        'then' in value &&\n        typeof value.then === 'function';\n};\n//# sourceMappingURL=is-thenable.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { CoreContext, ContextCancelation } from '../context';\nfunction tryAsync(fn) {\n    return __awaiter(this, void 0, void 0, function () {\n        var err_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 2, , 3]);\n                    return [4 /*yield*/, fn()];\n                case 1: return [2 /*return*/, _a.sent()];\n                case 2:\n                    err_1 = _a.sent();\n                    return [2 /*return*/, Promise.reject(err_1)];\n                case 3: return [2 /*return*/];\n            }\n        });\n    });\n}\nexport function attempt(ctx, plugin) {\n    ctx.log('debug', 'plugin', { plugin: plugin.name });\n    var start = new Date().getTime();\n    var hook = plugin[ctx.event.type];\n    if (hook === undefined) {\n        return Promise.resolve(ctx);\n    }\n    var newCtx = tryAsync(function () { return hook.apply(plugin, [ctx]); })\n        .then(function (ctx) {\n        var done = new Date().getTime() - start;\n        ctx.stats.gauge('plugin_time', done, [\"plugin:\".concat(plugin.name)]);\n        return ctx;\n    })\n        .catch(function (err) {\n        if (err instanceof ContextCancelation &&\n            err.type === 'middleware_cancellation') {\n            throw err;\n        }\n        if (err instanceof ContextCancelation) {\n            ctx.log('warn', err.type, {\n                plugin: plugin.name,\n                error: err,\n            });\n            return err;\n        }\n        ctx.log('error', 'plugin Error', {\n            plugin: plugin.name,\n            error: err,\n        });\n        ctx.stats.increment('plugin_error', 1, [\"plugin:\".concat(plugin.name)]);\n        return err;\n    });\n    return newCtx;\n}\nexport function ensure(ctx, plugin) {\n    return attempt(ctx, plugin).then(function (newContext) {\n        if (newContext instanceof CoreContext) {\n            return newContext;\n        }\n        ctx.log('debug', 'Context canceled');\n        ctx.stats.increment('context_canceled');\n        ctx.cancel(newContext);\n    });\n}\n//# sourceMappingURL=delivery.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { groupBy } from '../utils/group-by';\nimport { ON_REMOVE_FROM_FUTURE } from '../priority-queue';\nimport { CoreContext, ContextCancelation } from '../context';\nimport { Emitter } from '../emitter';\nimport { createTaskGroup } from '../task/task-group';\nimport { attempt, ensure } from './delivery';\nvar CoreEventQueue = /** @class */ (function (_super) {\n    __extends(CoreEventQueue, _super);\n    function CoreEventQueue(priorityQueue) {\n        var _this = _super.call(this) || this;\n        /**\n         * All event deliveries get suspended until all the tasks in this task group are complete.\n         * For example: a middleware that augments the event object should be loaded safely as a\n         * critical task, this way, event queue will wait for it to be ready before sending events.\n         *\n         * This applies to all the events already in the queue, and the upcoming ones\n         */\n        _this.criticalTasks = createTaskGroup();\n        _this.plugins = [];\n        _this.failedInitializations = [];\n        _this.flushing = false;\n        _this.queue = priorityQueue;\n        _this.queue.on(ON_REMOVE_FROM_FUTURE, function () {\n            _this.scheduleFlush(0);\n        });\n        return _this;\n    }\n    CoreEventQueue.prototype.register = function (ctx, plugin, instance) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.resolve(plugin.load(ctx, instance))\n                            .then(function () {\n                            _this.plugins.push(plugin);\n                        })\n                            .catch(function (err) {\n                            if (plugin.type === 'destination') {\n                                _this.failedInitializations.push(plugin.name);\n                                console.warn(plugin.name, err);\n                                ctx.log('warn', 'Failed to load destination', {\n                                    plugin: plugin.name,\n                                    error: err,\n                                });\n                                return;\n                            }\n                            throw err;\n                        })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.deregister = function (ctx, plugin, instance) {\n        return __awaiter(this, void 0, void 0, function () {\n            var e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        if (!plugin.unload) return [3 /*break*/, 2];\n                        return [4 /*yield*/, Promise.resolve(plugin.unload(ctx, instance))];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        this.plugins = this.plugins.filter(function (p) { return p.name !== plugin.name; });\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        ctx.log('warn', 'Failed to unload destination', {\n                            plugin: plugin.name,\n                            error: e_1,\n                        });\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.dispatch = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var willDeliver;\n            return __generator(this, function (_a) {\n                ctx.log('debug', 'Dispatching');\n                ctx.stats.increment('message_dispatched');\n                this.queue.push(ctx);\n                willDeliver = this.subscribeToDelivery(ctx);\n                this.scheduleFlush(0);\n                return [2 /*return*/, willDeliver];\n            });\n        });\n    };\n    CoreEventQueue.prototype.subscribeToDelivery = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve) {\n                        var onDeliver = function (flushed, delivered) {\n                            if (flushed.isSame(ctx)) {\n                                _this.off('flush', onDeliver);\n                                if (delivered) {\n                                    resolve(flushed);\n                                }\n                                else {\n                                    resolve(flushed);\n                                }\n                            }\n                        };\n                        _this.on('flush', onDeliver);\n                    })];\n            });\n        });\n    };\n    CoreEventQueue.prototype.dispatchSingle = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                ctx.log('debug', 'Dispatching');\n                ctx.stats.increment('message_dispatched');\n                this.queue.updateAttempts(ctx);\n                ctx.attempts = 1;\n                return [2 /*return*/, this.deliver(ctx).catch(function (err) {\n                        var accepted = _this.enqueuRetry(err, ctx);\n                        if (!accepted) {\n                            ctx.setFailedDelivery({ reason: err });\n                            return ctx;\n                        }\n                        return _this.subscribeToDelivery(ctx);\n                    })];\n            });\n        });\n    };\n    CoreEventQueue.prototype.isEmpty = function () {\n        return this.queue.length === 0;\n    };\n    CoreEventQueue.prototype.scheduleFlush = function (timeout) {\n        var _this = this;\n        if (timeout === void 0) { timeout = 500; }\n        if (this.flushing) {\n            return;\n        }\n        this.flushing = true;\n        setTimeout(function () {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            _this.flush().then(function () {\n                setTimeout(function () {\n                    _this.flushing = false;\n                    if (_this.queue.length) {\n                        _this.scheduleFlush(0);\n                    }\n                }, 0);\n            });\n        }, timeout);\n    };\n    CoreEventQueue.prototype.deliver = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var start, done, err_1, error;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.criticalTasks.done()];\n                    case 1:\n                        _a.sent();\n                        start = Date.now();\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 5]);\n                        return [4 /*yield*/, this.flushOne(ctx)];\n                    case 3:\n                        ctx = _a.sent();\n                        done = Date.now() - start;\n                        this.emit('delivery_success', ctx);\n                        ctx.stats.gauge('delivered', done);\n                        ctx.log('debug', 'Delivered', ctx.event);\n                        return [2 /*return*/, ctx];\n                    case 4:\n                        err_1 = _a.sent();\n                        error = err_1;\n                        ctx.log('error', 'Failed to deliver', error);\n                        this.emit('delivery_failure', ctx, error);\n                        ctx.stats.increment('delivery_failed');\n                        throw err_1;\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.enqueuRetry = function (err, ctx) {\n        var retriable = !(err instanceof ContextCancelation) || err.retry;\n        if (!retriable) {\n            return false;\n        }\n        return this.queue.pushWithBackoff(ctx);\n    };\n    CoreEventQueue.prototype.flush = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var ctx, err_2, accepted;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.queue.length === 0) {\n                            return [2 /*return*/, []];\n                        }\n                        ctx = this.queue.pop();\n                        if (!ctx) {\n                            return [2 /*return*/, []];\n                        }\n                        ctx.attempts = this.queue.getAttempts(ctx);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.deliver(ctx)];\n                    case 2:\n                        ctx = _a.sent();\n                        this.emit('flush', ctx, true);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _a.sent();\n                        accepted = this.enqueuRetry(err_2, ctx);\n                        if (!accepted) {\n                            ctx.setFailedDelivery({ reason: err_2 });\n                            this.emit('flush', ctx, false);\n                        }\n                        return [2 /*return*/, []];\n                    case 4: return [2 /*return*/, [ctx]];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.isReady = function () {\n        // return this.plugins.every((p) => p.isLoaded())\n        // should we wait for every plugin to load?\n        return true;\n    };\n    CoreEventQueue.prototype.availableExtensions = function (denyList) {\n        var available = this.plugins.filter(function (p) {\n            var _a, _b, _c;\n            // Only filter out destination plugins or the Segment.io plugin\n            if (p.type !== 'destination' && p.name !== 'Segment.io') {\n                return true;\n            }\n            var alternativeNameMatch = undefined;\n            (_a = p.alternativeNames) === null || _a === void 0 ? void 0 : _a.forEach(function (name) {\n                if (denyList[name] !== undefined) {\n                    alternativeNameMatch = denyList[name];\n                }\n            });\n            // Explicit integration option takes precedence, `All: false` does not apply to Segment.io\n            return ((_c = (_b = denyList[p.name]) !== null && _b !== void 0 ? _b : alternativeNameMatch) !== null && _c !== void 0 ? _c : (p.name === 'Segment.io' ? true : denyList.All) !== false);\n        });\n        var _a = groupBy(available, 'type'), _b = _a.before, before = _b === void 0 ? [] : _b, _c = _a.enrichment, enrichment = _c === void 0 ? [] : _c, _d = _a.destination, destination = _d === void 0 ? [] : _d, _e = _a.after, after = _e === void 0 ? [] : _e;\n        return {\n            before: before,\n            enrichment: enrichment,\n            destinations: destination,\n            after: after,\n        };\n    };\n    CoreEventQueue.prototype.flushOne = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, before, enrichment, _i, before_1, beforeWare, temp, _b, enrichment_1, enrichmentWare, temp, _c, destinations, after, afterCalls;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        if (!this.isReady()) {\n                            throw new Error('Not ready');\n                        }\n                        if (ctx.attempts > 1) {\n                            this.emit('delivery_retry', ctx);\n                        }\n                        _a = this.availableExtensions(\n                        /* ctx.event.integrations ?? */ {}), before = _a.before, enrichment = _a.enrichment;\n                        _i = 0, before_1 = before;\n                        _d.label = 1;\n                    case 1:\n                        if (!(_i < before_1.length)) return [3 /*break*/, 4];\n                        beforeWare = before_1[_i];\n                        return [4 /*yield*/, ensure(ctx, beforeWare)];\n                    case 2:\n                        temp = _d.sent();\n                        if (temp instanceof CoreContext) {\n                            ctx = temp;\n                        }\n                        this.emit('message_enriched', ctx, beforeWare);\n                        _d.label = 3;\n                    case 3:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 4:\n                        _b = 0, enrichment_1 = enrichment;\n                        _d.label = 5;\n                    case 5:\n                        if (!(_b < enrichment_1.length)) return [3 /*break*/, 8];\n                        enrichmentWare = enrichment_1[_b];\n                        return [4 /*yield*/, attempt(ctx, enrichmentWare)];\n                    case 6:\n                        temp = _d.sent();\n                        if (temp instanceof CoreContext) {\n                            ctx = temp;\n                        }\n                        this.emit('message_enriched', ctx, enrichmentWare);\n                        _d.label = 7;\n                    case 7:\n                        _b++;\n                        return [3 /*break*/, 5];\n                    case 8:\n                        _c = this.availableExtensions(\n                        /* ctx.event.integrations ?? */ {}), destinations = _c.destinations, after = _c.after;\n                        return [4 /*yield*/, new Promise(function (resolve, reject) {\n                                setTimeout(function () {\n                                    var attempts = destinations.map(function (destination) {\n                                        return attempt(ctx, destination);\n                                    });\n                                    Promise.all(attempts).then(resolve).catch(reject);\n                                }, 0);\n                            })];\n                    case 9:\n                        _d.sent();\n                        ctx.stats.increment('message_delivered');\n                        this.emit('message_delivered', ctx);\n                        afterCalls = after.map(function (after) { return attempt(ctx, after); });\n                        return [4 /*yield*/, Promise.all(afterCalls)];\n                    case 10:\n                        _d.sent();\n                        return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    return CoreEventQueue;\n}(Emitter));\nexport { CoreEventQueue };\n//# sourceMappingURL=event-queue.js.map","import { isThenable } from '../utils/is-thenable';\nexport var createTaskGroup = function () {\n    var taskCompletionPromise;\n    var resolvePromise;\n    var count = 0;\n    return {\n        done: function () { return taskCompletionPromise; },\n        run: function (op) {\n            var returnValue = op();\n            if (isThenable(returnValue)) {\n                if (++count === 1) {\n                    taskCompletionPromise = new Promise(function (res) { return (resolvePromise = res); });\n                }\n                returnValue.finally(function () { return --count === 0 && resolvePromise(); });\n            }\n            return returnValue;\n        },\n    };\n};\n//# sourceMappingURL=task-group.js.map","import { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { Context } from '../context'\nimport { AnyBrowserPlugin } from '../plugin'\nimport { CoreEventQueue } from '@tronic/receiver-core'\nimport { isOffline } from '../connection'\n\nexport class EventQueue extends CoreEventQueue<Context, AnyBrowserPlugin> {\n  constructor(name: string)\n  constructor(priorityQueue: PriorityQueue<Context>)\n  constructor(nameOrQueue: string | PriorityQueue<Context>) {\n    super(\n      typeof nameOrQueue === 'string'\n        ? new PersistedPriorityQueue(4, nameOrQueue)\n        : nameOrQueue\n    )\n  }\n  async flush(): Promise<Context[]> {\n    if (isOffline()) return []\n    return super.flush()\n  }\n}\n","export default function bindAll<\n  ObjType extends { [key: string]: any },\n  KeyType extends keyof ObjType\n>(obj: ObjType): ObjType {\n  const proto = obj.constructor.prototype\n  for (const key of Object.getOwnPropertyNames(proto)) {\n    if (key !== 'constructor') {\n      const desc = Object.getOwnPropertyDescriptor(\n        obj.constructor.prototype,\n        key\n      )\n      if (!!desc && typeof desc.value === 'function') {\n        obj[key as KeyType] = obj[key].bind(obj)\n      }\n    }\n  }\n\n  return obj\n}\n","import { CookieOptions } from './cookieStorage'\n\nexport const StoreType = {\n  Cookie: 'cookie',\n  LocalStorage: 'localStorage',\n  Memory: 'memory',\n} as const\n\n/**\n * Known Storage Types\n *\n * Convenience settings for storage systems that AJS includes support for\n */\nexport type StoreType = typeof StoreType[keyof typeof StoreType]\n\nexport type StorageObject = Record<string, unknown>\n\n/**\n * Defines a Storage object for use in AJS Client.\n */\nexport interface Store<Data extends StorageObject = StorageObject> {\n  /**\n   * get value for the key from the stores. it will return the first value found in the stores\n   * @param key key for the value to be retrieved\n   * @returns value for the key or null if not found\n   */\n  get<K extends keyof Data>(key: K): Data[K] | null\n\n  /**\n   * it will set the value for the key in all the stores\n   * @param key key for the value to be stored\n   * @param value value to be stored\n   * @returns value that was stored\n   */\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void\n  /**\n   * remove the value for the key from all the stores\n   * @param key key for the value to be removed\n   * @param storeTypes optional array of store types to be used for removing the value\n   */\n  remove<K extends keyof Data>(key: K): void\n}\n\nexport interface StoreTypeWithSettings<T extends StoreType = StoreType> {\n  name: T\n  settings?: T extends 'cookie' ? CookieOptions : never\n}\n\nexport type InitializeStorageArgs = (StoreTypeWithSettings | StoreType)[]\n","import { Store, StorageObject } from './types'\n\n// not adding to private method because those method names do not get minified atm, and does not use 'this'\nconst _logStoreKeyError = (\n  store: Store,\n  action: 'set' | 'get' | 'remove',\n  key: string,\n  err: unknown\n) => {\n  console.warn(\n    `${store.constructor.name}: Can't ${action} key \"${key}\" | Err: ${err}`\n  )\n}\n\n/**\n * Uses multiple storages in a priority list to get/set values in the order they are specified.\n */\nexport class UniversalStorage<Data extends StorageObject = StorageObject> {\n  private stores: Store[]\n\n  constructor(stores: Store[]) {\n    this.stores = stores\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    let val: Data[K] | null = null\n\n    for (const store of this.stores) {\n      try {\n        val = store.get(key) as Data[K] | null\n        if (val !== undefined && val !== null) {\n          return val\n        }\n      } catch (e) {\n        _logStoreKeyError(store, 'get', key, e)\n      }\n    }\n    return null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.stores.forEach((store) => {\n      try {\n        store.set(key, value)\n      } catch (e) {\n        _logStoreKeyError(store, 'set', key, e)\n      }\n    })\n  }\n\n  clear<K extends keyof Data>(key: K): void {\n    this.stores.forEach((store) => {\n      try {\n        store.remove(key)\n      } catch (e) {\n        _logStoreKeyError(store, 'remove', key, e)\n      }\n    })\n  }\n\n  /*\n    This is to support few scenarios where:\n    - value exist in one of the stores ( as a result of other stores being cleared from browser ) and we want to resync them\n    - read values in AJS 1.0 format ( for customers after 1.0 --> 2.0 migration ) and then re-write them in AJS 2.0 format\n  */\n  getAndSync<K extends keyof Data>(key: K): Data[K] | null {\n    const val = this.get(key)\n\n    // legacy behavior, getAndSync can change the type of a value from number to string (AJS 1.0 stores numerical values as a number)\n    const coercedValue = (typeof val === 'number' ? val.toString() : val) as\n      | Data[K]\n      | null\n\n    this.set(key, coercedValue)\n\n    return coercedValue\n  }\n}\n","import { Store, StorageObject } from './types'\n\n/**\n * Data Storage using in memory object\n */\nexport class MemoryStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private cache: Record<string, unknown> = {}\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    return (this.cache[key] ?? null) as Data[K] | null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.cache[key] = value\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    delete this.cache[key]\n  }\n}\n","import { StoreType, StoreTypeWithSettings } from './types'\n\nexport type UniversalStorageSettings = { stores: StoreType[] }\n\n// This is setup this way to permit eventually a different set of settings for custom storage\nexport type StorageSettings = UniversalStorageSettings\n\nexport function isArrayOfStoreType(\n  s: StorageSettings\n): s is UniversalStorageSettings {\n  return (\n    s &&\n    s.stores &&\n    Array.isArray(s.stores) &&\n    s.stores.every((e) => Object.values(StoreType).includes(e))\n  )\n}\n\nexport function isStoreTypeWithSettings(\n  s: StoreTypeWithSettings | StoreType\n): s is StoreTypeWithSettings {\n  return typeof s === 'object' && s.name !== undefined\n}\n","/*! js-cookie v3.0.1 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (key, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    key = encodeURIComponent(key)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      key + '=' + converter.write(value, key) + stringifiedAttributes)\n  }\n\n  function get (key) {\n    if (typeof document === 'undefined' || (arguments.length && !key)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var foundKey = decodeURIComponent(parts[0]);\n        jar[foundKey] = converter.read(value, foundKey);\n\n        if (key === foundKey) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return key ? jar[key] : jar\n  }\n\n  return Object.create(\n    {\n      set: set,\n      get: get,\n      remove: function (key, attributes) {\n        set(\n          key,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport default api;\n","import cookie from 'js-cookie'\n\n/**\n * Levels returns all levels of the given url.\n *\n * @param {string} url\n * @return {Array}\n * @api public\n */\nfunction levels(url: URL): string[] {\n  const host = url.hostname\n  const parts = host.split('.')\n  const last = parts[parts.length - 1]\n  const levels: string[] = []\n\n  // Ip address.\n  if (parts.length === 4 && parseInt(last, 10) > 0) {\n    return levels\n  }\n\n  // Localhost.\n  if (parts.length <= 1) {\n    return levels\n  }\n\n  // Create levels.\n  for (let i = parts.length - 2; i >= 0; --i) {\n    levels.push(parts.slice(i).join('.'))\n  }\n\n  return levels\n}\n\nfunction parseUrl(url: string): URL | undefined {\n  try {\n    return new URL(url)\n  } catch {\n    return\n  }\n}\n\nexport function tld(url: string): string | undefined {\n  const parsedUrl = parseUrl(url)\n  if (!parsedUrl) return\n\n  const lvls = levels(parsedUrl)\n\n  // Lookup the real top level one.\n  for (let i = 0; i < lvls.length; ++i) {\n    const cname = '__tld__'\n    const domain = lvls[i]\n    const opts = { domain: '.' + domain }\n\n    try {\n      // cookie access throw an error if the library is ran inside a sandboxed environment (e.g. sandboxed iframe)\n      cookie.set(cname, '1', opts)\n      if (cookie.get(cname)) {\n        cookie.remove(cname, opts)\n        return domain\n      }\n    } catch (_) {\n      return\n    }\n  }\n}\n","import { Store, StorageObject } from './types'\nimport jar from 'js-cookie'\nimport { tld } from '../user/tld'\n\nconst ONE_YEAR = 365\n\nexport interface CookieOptions {\n  maxage?: number\n  domain?: string\n  path?: string\n  secure?: boolean\n  sameSite?: string\n}\n\n/**\n * Data storage using browser cookies\n */\nexport class CookieStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  static get defaults(): CookieOptions {\n    return {\n      maxage: ONE_YEAR,\n      domain: tld(window.location.href),\n      path: '/',\n      sameSite: 'Lax',\n    }\n  }\n\n  private options: Required<CookieOptions>\n\n  constructor(options: CookieOptions = CookieStorage.defaults) {\n    this.options = {\n      ...CookieStorage.defaults,\n      ...options,\n    } as Required<CookieOptions>\n  }\n\n  private opts(): jar.CookieAttributes {\n    return {\n      sameSite: this.options.sameSite as jar.CookieAttributes['sameSite'],\n      expires: this.options.maxage,\n      domain: this.options.domain,\n      path: this.options.path,\n      secure: this.options.secure,\n    }\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const value = jar.get(key)\n\n      if (value === undefined || value === null) {\n        return null\n      }\n\n      try {\n        return JSON.parse(value) ?? null\n      } catch (e) {\n        return (value ?? null) as unknown as Data[K] | null\n      }\n    } catch (e) {\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    if (typeof value === 'string') {\n      jar.set(key, value, this.opts())\n    } else if (value === null) {\n      jar.remove(key, this.opts())\n    } else {\n      jar.set(key, JSON.stringify(value), this.opts())\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    return jar.remove(key, this.opts())\n  }\n}\n","import { StorageObject, Store } from './types'\n\n/**\n * Data storage using browser's localStorage\n */\nexport class LocalStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private localStorageWarning(key: keyof Data, state: 'full' | 'unavailable') {\n    console.warn(`Unable to access ${key}, localStorage may be ${state}`)\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const val = localStorage.getItem(key)\n      if (val === null) {\n        return null\n      }\n      try {\n        return JSON.parse(val) ?? null\n      } catch (e) {\n        return (val ?? null) as unknown as Data[K] | null\n      }\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    try {\n      localStorage.setItem(key, JSON.stringify(value))\n    } catch {\n      this.localStorageWarning(key, 'full')\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    try {\n      return localStorage.removeItem(key)\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n    }\n  }\n}\n","import { CookieOptions, CookieStorage } from './cookieStorage'\nimport { LocalStorage } from './localStorage'\nimport { MemoryStorage } from './memoryStorage'\nimport { isStoreTypeWithSettings } from './settings'\nimport { StoreType, Store, InitializeStorageArgs } from './types'\n\nexport * from './types'\nexport * from './localStorage'\nexport * from './cookieStorage'\nexport * from './memoryStorage'\nexport * from './universalStorage'\nexport * from './settings'\n\n/**\n * Creates multiple storage systems from an array of StoreType and options\n * @param args StoreType and options\n * @returns Storage array\n */\nexport function initializeStorages(args: InitializeStorageArgs): Store[] {\n  const storages = args.map((s) => {\n    let type: StoreType\n    let settings\n\n    if (isStoreTypeWithSettings(s)) {\n      type = s.name\n      settings = s.settings\n    } else {\n      type = s\n    }\n\n    switch (type) {\n      case StoreType.Cookie:\n        return new CookieStorage(settings)\n      case StoreType.LocalStorage:\n        return new LocalStorage()\n      case StoreType.Memory:\n        return new MemoryStorage()\n      default:\n        throw new Error(`Unknown Store Type: ${s}`)\n    }\n  })\n  return storages\n}\n\n/**\n * Injects the CookieOptions into a the arguments for initializeStorage\n * @param storeTypes list of storeType\n * @param cookieOptions cookie Options\n * @returns arguments for initializeStorage\n */\nexport function applyCookieOptions(\n  storeTypes: StoreType[],\n  cookieOptions?: CookieOptions\n): InitializeStorageArgs {\n  return storeTypes.map((s) => {\n    if (cookieOptions && s === StoreType.Cookie) {\n      return {\n        name: s,\n        settings: cookieOptions,\n      }\n    }\n    return s\n  })\n}\n","import { v4 as uuid } from '@lukeed/uuid'\nimport autoBind from '../../lib/bind-all'\nimport { Traits } from '../events'\nimport {\n  CookieOptions,\n  UniversalStorage,\n  MemoryStorage,\n  StorageObject,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\n\nexport type ID = string | null | undefined\n\nexport interface UserOptions {\n  /**\n   * Disables storing any data about the user.\n   */\n  disable?: boolean\n  localStorageFallbackDisabled?: boolean\n  persist?: boolean\n\n  cookie?: {\n    key?: string\n    oldKey?: string\n  }\n\n  localStorage?: {\n    key: string\n  }\n\n  /**\n   * Store priority\n   * @example stores: [StoreType.Cookie, StoreType.Memory]\n   */\n  storage?: StorageSettings\n}\n\nconst defaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_user_id',\n    oldKey: 'ajs_user',\n  },\n  localStorage: {\n    key: 'ajs_user_traits',\n  },\n}\n\nexport class User {\n  static defaults = defaults\n\n  private idKey: string\n  private traitsKey: string\n  private anonKey: string\n  private cookieOptions?: CookieOptions\n\n  private legacyUserStore: UniversalStorage<{\n    [k: string]:\n      | {\n          id?: string\n          traits?: Traits\n        }\n      | string\n  }>\n  private traitsStore: UniversalStorage<{\n    [k: string]: Traits\n  }>\n\n  private identityStore: UniversalStorage<{\n    [k: string]: string\n  }>\n\n  options: UserOptions = {}\n\n  constructor(options: UserOptions = defaults, cookieOptions?: CookieOptions) {\n    this.options = { ...defaults, ...options }\n    this.cookieOptions = cookieOptions\n\n    this.idKey = options.cookie?.key ?? defaults.cookie.key\n    this.traitsKey = options.localStorage?.key ?? defaults.localStorage.key\n    this.anonKey = 'ajs_anonymous_id'\n\n    this.identityStore = this.createStorage(this.options, cookieOptions)\n\n    // using only cookies for legacy user store\n    this.legacyUserStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s === StoreType.Cookie\n    )\n\n    // using only localStorage / memory for traits store\n    this.traitsStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s !== StoreType.Cookie\n    )\n\n    const legacyUser = this.legacyUserStore.get(defaults.cookie.oldKey)\n    if (legacyUser && typeof legacyUser === 'object') {\n      legacyUser.id && this.id(legacyUser.id)\n      legacyUser.traits && this.traits(legacyUser.traits)\n    }\n    autoBind(this)\n  }\n\n  id = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    const prevId = this.identityStore.getAndSync(this.idKey)\n\n    if (id !== undefined) {\n      this.identityStore.set(this.idKey, id)\n\n      const changingIdentity = id !== prevId && prevId !== null && id !== null\n      if (changingIdentity) {\n        this.anonymousId(null)\n      }\n    }\n\n    const retId = this.identityStore.getAndSync(this.idKey)\n    if (retId) return retId\n\n    const retLeg = this.legacyUserStore.get(defaults.cookie.oldKey)\n    return retLeg ? (typeof retLeg === 'object' ? retLeg.id : retLeg) : null\n  }\n\n  private legacySIO(): [string, string] | null {\n    const val = this.legacyUserStore.get('_sio') as string\n    if (!val) {\n      return null\n    }\n    const [anon, user] = val.split('----')\n    return [anon, user]\n  }\n\n  anonymousId = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    if (id === undefined) {\n      const val =\n        this.identityStore.getAndSync(this.anonKey) ?? this.legacySIO()?.[0]\n\n      if (val) {\n        return val\n      }\n    }\n\n    if (id === null) {\n      this.identityStore.set(this.anonKey, null)\n      return this.identityStore.getAndSync(this.anonKey)\n    }\n\n    this.identityStore.set(this.anonKey, id ?? uuid())\n    return this.identityStore.getAndSync(this.anonKey)\n  }\n\n  traits = (traits?: Traits | null): Traits | undefined => {\n    if (this.options.disable) {\n      return\n    }\n\n    if (traits === null) {\n      traits = {}\n    }\n\n    if (traits) {\n      this.traitsStore.set(this.traitsKey, traits ?? {})\n    }\n\n    return this.traitsStore.get(this.traitsKey) ?? {}\n  }\n\n  identify(id?: ID, traits?: Traits): void {\n    if (this.options.disable) {\n      return\n    }\n\n    traits = traits ?? {}\n    const currentId = this.id()\n\n    if (currentId === null || currentId === id) {\n      traits = {\n        ...this.traits(),\n        ...traits,\n      }\n    }\n\n    if (id) {\n      this.id(id)\n    }\n\n    this.traits(traits)\n  }\n\n  logout(): void {\n    this.anonymousId(null)\n    this.id(null)\n    this.traits({})\n  }\n\n  reset(): void {\n    this.logout()\n    this.identityStore.clear(this.idKey)\n    this.identityStore.clear(this.anonKey)\n    this.traitsStore.clear(this.traitsKey)\n  }\n\n  load(): User {\n    return new User(this.options, this.cookieOptions)\n  }\n\n  save(): boolean {\n    return true\n  }\n\n  /**\n   * Creates the right storage system applying all the user options, cookie options and particular filters\n   * @param options UserOptions\n   * @param cookieOpts CookieOptions\n   * @param filterStores filter function to apply to any StoreTypes (skipped if options specify using a custom storage)\n   * @returns a Storage object\n   */\n  private createStorage<T extends StorageObject = StorageObject>(\n    options: UserOptions,\n    cookieOpts?: CookieOptions,\n    filterStores?: (value: StoreType) => boolean\n  ): UniversalStorage<T> {\n    let stores: StoreType[] = [\n      StoreType.LocalStorage,\n      StoreType.Cookie,\n      StoreType.Memory,\n    ]\n\n    // If disabled we won't have any storage functionality\n    if (options.disable) {\n      return new UniversalStorage<T>([])\n    }\n\n    // If persistance is disabled we will always fallback to Memory Storage\n    if (!options.persist) {\n      return new UniversalStorage<T>([new MemoryStorage<T>()])\n    }\n\n    if (options.storage !== undefined && options.storage !== null) {\n      if (isArrayOfStoreType(options.storage)) {\n        // If the user only specified order of stores we will still apply filters and transformations e.g. not using localStorage if localStorageFallbackDisabled\n        stores = options.storage.stores\n      }\n    }\n\n    // Disable LocalStorage\n    if (options.localStorageFallbackDisabled) {\n      stores = stores.filter((s) => s !== StoreType.LocalStorage)\n    }\n\n    // Apply Additional filters\n    if (filterStores) {\n      stores = stores.filter(filterStores)\n    }\n\n    return new UniversalStorage(\n      initializeStorages(applyCookieOptions(stores, cookieOpts))\n    )\n  }\n}\n\nconst groupDefaults: UserOptions = {\n  persist: true,\n  cookie: {\n    key: 'ajs_group_id',\n  },\n  localStorage: {\n    key: 'ajs_group_properties',\n  },\n}\n\nexport class Group extends User {\n  constructor(options: UserOptions = groupDefaults, cookie?: CookieOptions) {\n    super({ ...groupDefaults, ...options }, cookie)\n    autoBind(this)\n  }\n\n  anonymousId = (_id?: ID): ID => {\n    return undefined\n  }\n}\n","import { Receiver } from '../receiver'\nimport { Context } from '../context'\nimport { isThenable } from '../../lib/is-thenable'\nimport { ReceiverBrowserCore } from '../receiver/interfaces'\nimport { version } from '../../generated/version'\nimport { getGlobalReceiver } from '../../lib/global-receiver-helper'\nimport {\n  isBufferedPageContext,\n  BufferedPageContext,\n  getDefaultBufferedPageContext,\n  createPageContext,\n  PageContext,\n} from '../page'\n\n/**\n * The names of any ReceiverBrowser methods that also exist on Receiver\n */\nexport type PreInitMethodName =\n//  | 'screen'\n  | 'register'\n  | 'deregister'\n  | 'user'\n//  | 'trackSubmit'\n//  | 'trackClick'\n//  | 'trackLink'\n//  | 'trackForm'\n//  | 'pageview'\n  | 'identify'\n  | 'reset'\n//  | 'group'\n  | 'track'\n  | 'ready'\n//  | 'alias'\n  | 'debug'\n//  | 'page'\n  | 'once'\n  | 'off'\n  | 'on'\n  | 'addSourceMiddleware'\n  // | 'setAnonymousId'\n// | 'addDestinationMiddleware'\n\n// Union of all receiver methods that _do not_ return a Promise\ntype SyncPreInitMethodName = {\n  [MethodName in PreInitMethodName]: ReturnType<\n    Receiver[MethodName]\n  > extends Promise<any>\n    ? never\n    : MethodName\n}[PreInitMethodName]\n\nconst flushSyncReceiverCalls = (\n  name: SyncPreInitMethodName,\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.getCalls(name).forEach((c) => {\n    // While the underlying methods are synchronous, the callReceiverMethod returns a promise,\n    // which normalizes success and error states between async and non-async methods, with no perf penalty.\n    callReceiverMethod(receiver, c).catch(console.error)\n  })\n}\n\nexport const flushAddSourceMiddleware = async (\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n) => {\n  for (const c of buffer.getCalls('addSourceMiddleware')) {\n    await callReceiverMethod(receiver, c).catch(console.error)\n  }\n}\n\nexport const flushOn = flushSyncReceiverCalls.bind(this, 'on')\n\nexport const flushSetAnonymousID = flushSyncReceiverCalls.bind(\n  this,\n  'setAnonymousId'\n)\n\nexport const flushReceiverCallsInNewTask = (\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.toArray().forEach((m) => {\n    setTimeout(() => {\n      callReceiverMethod(receiver, m).catch(console.error)\n    }, 0)\n  })\n}\n\nexport const popPageContext = (args: unknown[]): PageContext | undefined => {\n  if (hasBufferedPageContextAsLastArg(args)) {\n    const ctx = args.pop() as BufferedPageContext\n    return createPageContext(ctx)\n  }\n}\n\nexport const hasBufferedPageContextAsLastArg = (\n  args: unknown[]\n): args is [...unknown[], BufferedPageContext] | [BufferedPageContext] => {\n  const lastArg = args[args.length - 1]\n  return isBufferedPageContext(lastArg)\n}\n\n/**\n *  Represents a buffered method call that occurred before initialization.\n */\nexport class PreInitMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> {\n  method: MethodName\n  args: PreInitMethodParams<MethodName>\n  called: boolean\n  resolve: (v: ReturnType<Receiver[MethodName]>) => void\n  reject: (reason: any) => void\n  constructor(\n    method: PreInitMethodCall<MethodName>['method'],\n    args: PreInitMethodParams<MethodName>,\n    resolve: PreInitMethodCall<MethodName>['resolve'] = () => {},\n    reject: PreInitMethodCall<MethodName>['reject'] = console.error\n  ) {\n    this.method = method\n    this.resolve = resolve\n    this.reject = reject\n    this.called = false\n    this.args = args\n  }\n}\n\nexport type PreInitMethodParams<MethodName extends PreInitMethodName> =\n  | [...Parameters<Receiver[MethodName]>, BufferedPageContext]\n  | Parameters<Receiver[MethodName]>\n\n/**\n * Infer return type; if return type is promise, unwrap it.\n */\ntype ReturnTypeUnwrap<Fn> = Fn extends (...args: any[]) => infer ReturnT\n  ? ReturnT extends PromiseLike<infer Unwrapped>\n    ? Unwrapped\n    : ReturnT\n  : never\n\ntype MethodCallMap = Partial<Record<PreInitMethodName, PreInitMethodCall[]>>\n\ntype SnippetWindowBufferedMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> = [MethodName, ...PreInitMethodParams<MethodName>]\n\n/**\n * A list of the method calls before initialization for snippet users\n * For example, [[\"track\", \"foo\", {bar: 123}], [\"page\"], [\"on\", \"ready\", function(){..}]\n */\ntype SnippetBuffer = SnippetWindowBufferedMethodCall[]\n\n/**\n *  Represents any and all the buffered method calls that occurred before initialization.\n */\nexport class PreInitMethodCallBuffer {\n  private _callMap: MethodCallMap = {}\n\n  constructor(...calls: PreInitMethodCall[]) {\n    this.push(...calls)\n  }\n\n  /**\n   * Pull any buffered method calls from the window object, and use them to hydrate the instance buffer.\n   */\n  private get calls() {\n    this._pushSnippetWindowBuffer()\n    return this._callMap\n  }\n\n  private set calls(calls: MethodCallMap) {\n    this._callMap = calls\n  }\n\n  getCalls<T extends PreInitMethodName>(methodName: T): PreInitMethodCall<T>[] {\n    return (this.calls[methodName] ?? []) as PreInitMethodCall<T>[]\n  }\n\n  push(...calls: PreInitMethodCall[]): void {\n    calls.forEach((call) => {\n      const eventsExpectingPageContext: PreInitMethodName[] = [\n        'track',\n        // 'screen',\n        // 'alias',\n        // 'group',\n        // 'page',\n        'identify',\n      ]\n      if (\n        eventsExpectingPageContext.includes(call.method) &&\n        !hasBufferedPageContextAsLastArg(call.args)\n      ) {\n        call.args = [...call.args, getDefaultBufferedPageContext()]\n      }\n\n      if (this.calls[call.method]) {\n        this.calls[call.method]!.push(call)\n      } else {\n        this.calls[call.method] = [call]\n      }\n    })\n  }\n\n  clear(): void {\n    // clear calls in the global snippet buffered array.\n    this._pushSnippetWindowBuffer()\n    // clear calls in this instance\n    this.calls = {}\n  }\n\n  toArray(): PreInitMethodCall[] {\n    return ([] as PreInitMethodCall[]).concat(...Object.values(this.calls))\n  }\n\n  /**\n   * Fetch the buffered method calls from the window object,\n   * normalize them, and use them to hydrate the buffer.\n   * This removes existing buffered calls from the window object.\n   */\n  private _pushSnippetWindowBuffer(): void {\n    const wa = getGlobalReceiver()\n    if (!Array.isArray(wa)) return undefined\n    const buffered: SnippetBuffer = wa.splice(0, wa.length)\n    const calls = buffered.map(\n      ([methodName, ...args]) => new PreInitMethodCall(methodName, args)\n    )\n    this.push(...calls)\n  }\n}\n\n/**\n *  Call method and mark as \"called\"\n *  This function should never throw an error\n */\nexport async function callReceiverMethod<T extends PreInitMethodName>(\n  receiver: Receiver,\n  call: PreInitMethodCall<T>\n): Promise<void> {\n  try {\n    if (call.called) {\n      return undefined\n    }\n    call.called = true\n\n    const result: ReturnType<Receiver[T]> = (\n      receiver[call.method] as Function\n    )(...call.args)\n\n    if (isThenable(result)) {\n      // do not defer for non-async methods\n      await result\n    }\n\n    call.resolve(result)\n  } catch (err) {\n    call.reject(err)\n  }\n}\n\nexport type ReceiverLoader = (\n  preInitBuffer: PreInitMethodCallBuffer\n) => Promise<[Receiver, Context]>\n\nexport class ReceiverBuffered\n  implements PromiseLike<[Receiver, Context]>, ReceiverBrowserCore\n{\n  instance?: Receiver\n  ctx?: Context\n  private _preInitBuffer: PreInitMethodCallBuffer\n  private _promise: Promise<[Receiver, Context]>\n  constructor(loader: ReceiverLoader) {\n    this._preInitBuffer = new PreInitMethodCallBuffer()\n    this._promise = loader(this._preInitBuffer)\n    this._promise\n      .then(([ajs, ctx]) => {\n        this.instance = ajs\n        this.ctx = ctx\n      })\n      .catch(() => {\n        // intentionally do nothing...\n        // this result of this promise will be caught by the 'catch' block on this class.\n      })\n  }\n\n  then<T1, T2 = never>(\n    ...args: [\n      onfulfilled:\n        | ((instance: [Receiver, Context]) => T1 | PromiseLike<T1>)\n        | null\n        | undefined,\n      onrejected?: (reason: unknown) => T2 | PromiseLike<T2>\n    ]\n  ) {\n    return this._promise.then(...args)\n  }\n\n  catch<TResult = never>(\n    ...args: [\n      onrejected?:\n        | ((reason: any) => TResult | PromiseLike<TResult>)\n        | undefined\n        | null\n    ]\n  ) {\n    return this._promise.catch(...args)\n  }\n\n  finally(...args: [onfinally?: (() => void) | undefined | null]) {\n    return this._promise.finally(...args)\n  }\n\n  // trackSubmit = this._createMethod('trackSubmit')\n  // trackClick = this._createMethod('trackClick')\n  // trackLink = this._createMethod('trackLink')\n  // pageView = this._createMethod('pageview')\n  identify = this._createMethod('identify')\n  reset = this._createMethod('reset')\n  // group = this._createMethod('group') as ReceiverBrowserCore['group']\n  track = this._createMethod('track')\n  ready = this._createMethod('ready')\n  // alias = this._createMethod('alias')\n  debug = this._createChainableMethod('debug')\n  // page = this._createMethod('page')\n  once = this._createChainableMethod('once')\n  off = this._createChainableMethod('off')\n  on = this._createChainableMethod('on')\n  addSourceMiddleware = this._createMethod('addSourceMiddleware')\n  // setAnonymousId = this._createMethod('setAnonymousId')\n  // addDestinationMiddleware = this._createMethod('addDestinationMiddleware')\n\n  // screen = this._createMethod('screen')\n  register = this._createMethod('register')\n  deregister = this._createMethod('deregister')\n  user = this._createMethod('user')\n  readonly VERSION = version\n\n  private _createMethod<T extends PreInitMethodName>(methodName: T) {\n    return (\n      ...args: Parameters<Receiver[T]>\n    ): Promise<ReturnTypeUnwrap<Receiver[T]>> => {\n      if (this.instance) {\n        const result = (this.instance[methodName] as Function)(...args)\n        return Promise.resolve(result)\n      }\n      return new Promise((resolve, reject) => {\n        this._preInitBuffer.push(\n          new PreInitMethodCall(methodName, args, resolve as any, reject)\n        )\n      })\n    }\n  }\n\n  /**\n   *  These are for methods that where determining when the method gets \"flushed\" is not important.\n   *  These methods will resolve when receiver is fully initialized, and return type (other than Receiver)will not be available.\n   */\n  private _createChainableMethod<T extends PreInitMethodName>(methodName: T) {\n    return (...args: Parameters<Receiver[T]>): ReceiverBuffered => {\n      if (this.instance) {\n        void (this.instance[methodName] as Function)(...args)\n        return this\n      } else {\n        this._preInitBuffer.push(new PreInitMethodCall(methodName, args))\n      }\n\n      return this\n    }\n  }\n}\n","/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport const isThenable = (value: unknown): boolean =>\n  typeof value === 'object' &&\n  value !== null &&\n  'then' in value &&\n  typeof (value as any).then === 'function'\n","import {\n  DispatchedEvent,\n  EventParams,\n  resolveArguments,\n  resolveUserArguments,\n  IdentifyParams,\n} from '../arguments-resolver'\nimport type { FormArgs, LinkArgs } from '../auto-track'\nimport { isOffline } from '../connection'\nimport { Context } from '../context'\nimport { dispatch, Emitter } from '@tronic/receiver-core'\nimport {\n  Callback,\n  EventFactory,\n  Integrations,\n  Plan,\n  EventProperties,\n  TronicEvent,\n} from '../events'\nimport type { Plugin } from '../plugin'\nimport { EventQueue } from '../queue/event-queue'\nimport { Group, ID, User, UserOptions } from '../user'\nimport autoBind from '../../lib/bind-all'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\n// import type { LegacyDestination } from '../../plugins/ajs-destination'\nimport type {\n  LegacyIntegration,\n  ClassicIntegrationSource,\n} from '../../plugins/ajs-destination/types'\nimport type {\n  DestinationMiddlewareFunction,\n  MiddlewareFunction,\n} from '../../plugins/middleware'\nimport { version } from '../../generated/version'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { getGlobal } from '../../lib/get-global'\nimport { ReceiverClassic, ReceiverCore } from './interfaces'\nimport { HighEntropyHint } from '../../lib/client-hints/interfaces'\nimport type { LegacySettings } from '../../browser'\nimport {\n  CookieOptions,\n  MemoryStorage,\n  UniversalStorage,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\nimport { PluginFactory } from '../../plugins/remote-loader'\nimport { setGlobalReceiver } from '../../lib/global-receiver-helper'\nimport { popPageContext } from '../buffer'\n\ntype LegacyDestination = any;\n\nconst deprecationWarning =\n  'This is being deprecated and will be not be available in future releases of Receiver JS'\n\n// reference any pre-existing \"receiver\" object so a user can restore the reference\nconst global: any = getGlobal()\nconst _receiver = global?.receiver\n\nfunction createDefaultQueue(\n  name: string,\n  retryQueue = false,\n  disablePersistance = false\n) {\n  const maxAttempts = retryQueue ? 4 : 1\n  const priorityQueue = disablePersistance\n    ? new PriorityQueue(maxAttempts, [])\n    : new PersistedPriorityQueue(maxAttempts, name)\n  return new EventQueue(priorityQueue)\n}\n\nexport interface ReceiverSettings {\n  writeKey: string\n  timeout?: number\n  plugins?: (Plugin | PluginFactory)[]\n  classicIntegrations?: ClassicIntegrationSource[]\n}\n\nexport interface InitOptions {\n  /**\n   * Disables storing any data on the client-side via cookies or localstorage.\n   * Defaults to `false`.\n   *\n   */\n  disableClientPersistence?: boolean\n  /**\n   * Disables automatically converting ISO string event properties into Dates.\n   * ISO string to Date conversions occur right before sending events to a classic device mode integration,\n   * after any destination middleware have been ran.\n   * Defaults to `false`.\n   */\n  disableAutoISOConversion?: boolean\n  initialPageview?: boolean\n  cookie?: CookieOptions\n  storage?: StorageSettings\n  user?: UserOptions\n  group?: UserOptions\n  integrations?: Integrations\n  plan?: Plan\n  retryQueue?: boolean\n  obfuscate?: boolean\n  /**\n   * This callback allows you to update/mutate CDN Settings.\n   * This is called directly after settings are fetched from the CDN.\n   */\n  updateCDNSettings?: (settings: LegacySettings) => LegacySettings\n  /**\n   * Disables or sets constraints on processing of query string parameters\n   */\n  useQueryString?:\n  | boolean\n  | {\n    aid?: RegExp\n    uid?: RegExp\n  }\n  /**\n   * Array of high entropy Client Hints to request. These may be rejected by the user agent - only required hints should be requested.\n   */\n  highEntropyValuesClientHints?: HighEntropyHint[]\n  /**\n   * When using the snippet, this is the key that points to the global receiver instance (e.g. window.receiver).\n   * default: receiver\n   */\n  globalReceiverKey?: string\n}\n\nexport class Receiver\n  extends Emitter\n  implements ReceiverCore { // , ReceiverClassic {\n  protected settings: ReceiverSettings\n  private _user: User\n  private _group: Group\n  private eventFactory: EventFactory\n  private _debug = false\n  private _universalStorage: UniversalStorage\n\n  initialized = false\n  integrations: Integrations\n  options: InitOptions\n  queue: EventQueue\n\n  constructor(\n    settings: ReceiverSettings,\n    options?: InitOptions,\n    queue?: EventQueue,\n    user?: User,\n    group?: Group\n  ) {\n    super()\n    const cookieOptions = options?.cookie\n    const disablePersistance = options?.disableClientPersistence ?? false\n    this.settings = settings\n    this.settings.timeout = this.settings.timeout ?? 300\n    this.queue =\n      queue ??\n      createDefaultQueue(\n        `${settings.writeKey}:event-queue`,\n        options?.retryQueue,\n        disablePersistance\n      )\n\n    const storageSetting = options?.storage\n    this._universalStorage = this.createStore(\n      disablePersistance,\n      storageSetting,\n      cookieOptions\n    )\n\n    this._user =\n      user ??\n      new User(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any User specific options override everything else\n          ...options?.user,\n        },\n        cookieOptions\n      ).load()\n    this._group =\n      group ??\n      new Group(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any group specific options override everything else\n          ...options?.group,\n        },\n        cookieOptions\n      ).load()\n    this.eventFactory = new EventFactory(this._user)\n    this.integrations = options?.integrations ?? {}\n    this.options = options ?? {}\n    autoBind(this)\n  }\n\n  user = (): User => {\n    return this._user\n  }\n\n  /**\n   * Creates the storage system based on the settings received\n   * @returns Storage\n   */\n  private createStore(\n    disablePersistance: boolean,\n    storageSetting: InitOptions['storage'],\n    cookieOptions?: CookieOptions | undefined\n  ): UniversalStorage {\n    // DisablePersistance option overrides all, no storage will be used outside of memory even if specified\n    if (disablePersistance) {\n      return new UniversalStorage([new MemoryStorage()])\n    } else {\n      if (storageSetting) {\n        if (isArrayOfStoreType(storageSetting)) {\n          // We will create the store with the priority for customer settings\n          return new UniversalStorage(\n            initializeStorages(\n              applyCookieOptions(storageSetting.stores, cookieOptions)\n            )\n          )\n        }\n      }\n    }\n    // We default to our multi storage with priority\n    return new UniversalStorage(\n      initializeStorages([\n        StoreType.LocalStorage,\n        {\n          name: StoreType.Cookie,\n          settings: cookieOptions,\n        },\n        StoreType.Memory,\n      ])\n    )\n  }\n\n  get storage(): UniversalStorage {\n    return this._universalStorage\n  }\n\n  async track(...args: EventParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [channelId, userId, name, data, opts, cb] = resolveArguments(...args)\n\n    const tronicEvent = this.eventFactory.track(\n      channelId,\n      userId,\n      name,\n      data as EventProperties,\n      // opts,\n      // this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(tronicEvent, cb).then((ctx) => {\n      this.emit('track', name, ctx.event.properties) // , ctx.event.options)\n      return ctx\n    })\n  }\n\n  async identify(...args: IdentifyParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [/*channelId,*/ id, _traits, options, callback] = resolveUserArguments(this._user)(\n      ...args\n    )\n\n    this._user.identify(id, _traits)\n    const tronicEvent = this.eventFactory.identify(\n      'channelId',\n      this._user.id(),\n      this._user.traits(),\n      // options,\n      // this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(tronicEvent, callback).then((ctx) => {\n      this.emit(\n        'identify',\n        ctx.event.userId,\n        ctx.event.traits,\n        // ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  async trackClick(...args: LinkArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackLink(...args: LinkArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackSubmit(...args: FormArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async trackForm(...args: FormArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async register(...plugins: Plugin[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const registrations = plugins.map((xt) =>\n      this.queue.register(ctx, xt, this)\n    )\n    await Promise.all(registrations)\n\n    return ctx\n  }\n\n  async deregister(...plugins: string[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const deregistrations = plugins.map((pl) => {\n      const plugin = this.queue.plugins.find((p) => p.name === pl)\n      if (plugin) {\n        return this.queue.deregister(ctx, plugin, this)\n      } else {\n        ctx.log('warn', `plugin ${pl} not found`)\n      }\n    })\n\n    await Promise.all(deregistrations)\n\n    return ctx\n  }\n\n  debug(toggle: boolean): Receiver {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug')\n    }\n    this._debug = toggle\n    return this\n  }\n\n  reset(): void {\n    this._user.reset()\n    this._group.reset()\n    this.emit('reset')\n  }\n\n  timeout(timeout: number): void {\n    this.settings.timeout = timeout\n  }\n\n  private async _dispatch(\n    event: TronicEvent,\n    callback?: Callback\n  ): Promise<DispatchedEvent> {\n    const ctx = new Context(event)\n    if (isOffline() && !this.options.retryQueue) {\n      return ctx\n    }\n    return dispatch(ctx, this.queue, this, {\n      callback,\n      debug: this._debug,\n      timeout: this.settings.timeout,\n    })\n  }\n\n  async addSourceMiddleware(fn: MiddlewareFunction): Promise<Receiver> {\n    await this.queue.criticalTasks.run(async () => {\n      const { sourceMiddlewarePlugin } = await import(\n        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware'\n      )\n\n      const integrations: Record<string, boolean> = {}\n      /*\n    this.queue.plugins.forEach((plugin) => {\n      if (plugin.type === 'destination') {\n        return (integrations[plugin.name] = true)\n      }\n    })\n       */\n      const plugin = sourceMiddlewarePlugin(fn) //, integrations)\n      await this.register(plugin)\n    })\n\n    return this\n  }\n\n  /* TODO: This does not have to return a promise? */\n  addDestinationMiddleware(\n    integrationName: string,\n    ...middlewares: DestinationMiddlewareFunction[]\n  ): Promise<Receiver> {\n    const legacyDestinations = this.queue.plugins.filter(\n      (xt) => xt.name.toLowerCase() === integrationName.toLowerCase()\n    ) as LegacyDestination[]\n\n    legacyDestinations.forEach((destination) => {\n      destination.addMiddleware(...middlewares)\n    })\n    return Promise.resolve(this)\n  }\n\n  setAnonymousId(id?: string): ID {\n    return this._user.anonymousId(id)\n  }\n\n  async queryString(query: string): Promise<Context[]> {\n    if (this.options.useQueryString === false) {\n      return []\n    }\n\n    const { queryString } = await import(\n      /* webpackChunkName: \"queryString\" */ '../query-string'\n    )\n    return queryString(this, query)\n  }\n\n  async ready(\n    callback: Function = (res: Promise<unknown>[]): Promise<unknown>[] => res\n  ): Promise<unknown> {\n    return Promise.all(\n      this.queue.plugins.map((i) => (i.ready ? i.ready() : Promise.resolve()))\n    ).then((res) => {\n      callback(res)\n      return res\n    })\n  }\n\n  get VERSION(): string {\n    return version\n  }\n\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  push(args: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const an = this as any\n    const method = args.shift()\n    if (method) {\n      if (!an[method]) return\n    }\n    an[method].apply(this, args)\n  }\n}\n","/**\n * Return a promise that can be externally resolved\n */\nexport const createDeferred = <T>() => {\n  let resolve!: (value: T | PromiseLike<T>) => void\n  let reject!: (reason: any) => void\n  const promise = new Promise<T>((_resolve, _reject) => {\n    resolve = _resolve\n    reject = _reject\n  })\n  return {\n    resolve,\n    reject,\n    promise,\n  }\n}\n","import { HighEntropyHint, NavigatorUAData, UADataValues } from './interfaces'\n\nexport async function clientHints(\n  hints?: HighEntropyHint[]\n): Promise<UADataValues | undefined> {\n  const userAgentData = (navigator as any).userAgentData as\n    | NavigatorUAData\n    | undefined\n\n  if (!userAgentData) return undefined\n\n  if (!hints) return userAgentData.toJSON()\n  return userAgentData\n    .getHighEntropyValues(hints)\n    .catch(() => userAgentData.toJSON())\n}\n","import jar from 'js-cookie'\nimport type { Context } from '../../core/context'\nimport type { Plugin } from '../../core/plugin'\nimport { version } from '../../generated/version'\nimport { TronicEvent } from '../../core/events'\nimport { Campaign, PluginType } from '@tronic/receiver-core'\nimport { getVersionType } from '../../lib/version-type'\nimport { tld } from '../../core/user/tld'\nimport { gracefulDecodeURIComponent } from '../../core/query-string/gracefulDecodeURIComponent'\nimport { CookieStorage, UniversalStorage } from '../../core/storage'\nimport { Receiver } from '../../core/receiver'\nimport { clientHints } from '../../lib/client-hints'\nimport { UADataValues } from '../../lib/client-hints/interfaces'\n\nlet cookieOptions: jar.CookieAttributes | undefined\nfunction getCookieOptions(): jar.CookieAttributes {\n  if (cookieOptions) {\n    return cookieOptions\n  }\n\n  const domain = tld(window.location.href)\n  cookieOptions = {\n    expires: 31536000000, // 1 year\n    secure: false,\n    path: '/',\n  }\n  if (domain) {\n    cookieOptions.domain = domain\n  }\n\n  return cookieOptions\n}\n\ntype Ad = { id: string; type: string }\n\nfunction ads(query: string): Ad | undefined {\n  const queryIds: Record<string, string> = {\n    btid: 'dataxu',\n    urid: 'millennial-media',\n  }\n\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n  const parts = query.split('&')\n\n  for (const part of parts) {\n    const [k, v] = part.split('=')\n    if (queryIds[k]) {\n      return {\n        id: v,\n        type: queryIds[k],\n      }\n    }\n  }\n}\n\nexport function utm(query: string): Campaign {\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n\n  return query.split('&').reduce((acc, str) => {\n    const [k, v = ''] = str.split('=')\n    if (k.includes('utm_') && k.length > 4) {\n      let utmParam = k.slice(4) as keyof Campaign\n      if (utmParam === 'campaign') {\n        utmParam = 'name'\n      }\n      acc[utmParam] = gracefulDecodeURIComponent(v)\n    }\n    return acc\n  }, {} as Campaign)\n}\n\nexport function ampId(): string | undefined {\n  const ampId = jar.get('_ga')\n  if (ampId && ampId.startsWith('amp')) {\n    return ampId\n  }\n}\n\nfunction referrerId(\n  query: string,\n  ctx: TronicEvent['context'],\n  disablePersistance: boolean\n): void {\n  const storage = new UniversalStorage<{\n    's:context.referrer': Ad\n  }>(disablePersistance ? [] : [new CookieStorage(getCookieOptions())])\n\n  const stored = storage.get('s:context.referrer')\n\n  const ad = ads(query) ?? stored\n\n  if (!ad) {\n    return\n  }\n\n  if (ctx) {\n    ctx.referrer = { ...ctx.referrer, ...ad }\n  }\n\n  storage.set('s:context.referrer', ad)\n}\n\n/**\n *\n * @param obj e.g. { foo: 'b', bar: 'd', baz: ['123', '456']}\n * @returns e.g. 'foo=b&bar=d&baz=123&baz=456'\n */\nconst objectToQueryString = (\n  obj: Record<string, string | string[]>\n): string => {\n  try {\n    const searchParams = new URLSearchParams()\n    Object.entries(obj).forEach(([k, v]) => {\n      if (Array.isArray(v)) {\n        v.forEach((value) => searchParams.append(k, value))\n      } else {\n        searchParams.append(k, v)\n      }\n    })\n    return searchParams.toString()\n  } catch {\n    return ''\n  }\n}\n\nclass EnvironmentEnrichmentPlugin implements Plugin {\n  private instance!: Receiver\n  private userAgentData: UADataValues | undefined\n\n  name = 'Page Enrichment'\n  type: PluginType = 'before'\n  version = '0.1.0'\n  isLoaded = () => true\n  load = async (_ctx: Context, instance: Receiver) => {\n    this.instance = instance\n    try {\n      this.userAgentData = await clientHints(\n        this.instance.options.highEntropyValuesClientHints\n      )\n    } catch (_) {\n      // if client hints API doesn't return anything leave undefined\n    }\n    return Promise.resolve()\n  }\n\n  private enrich = (ctx: Context): Context => {\n    // Note: Types are off - context should never be undefined here, since it is set as part of event creation.\n    const evtCtx = ctx.event.context!\n\n    const search = evtCtx.page!.search || ''\n\n    const query =\n      typeof search === 'object' ? objectToQueryString(search) : search\n\n    evtCtx.userAgent = navigator.userAgent\n    evtCtx.userAgentData = this.userAgentData\n\n    // @ts-ignore\n    const locale = navigator.userLanguage || navigator.language\n\n    if (typeof evtCtx.locale === 'undefined' && typeof locale !== 'undefined') {\n      evtCtx.locale = locale\n    }\n\n    evtCtx.library ??= {\n      name: 'receiver.js',\n      version: `${getVersionType() === 'web' ? 'next' : 'npm:next'}-${version}`,\n    }\n\n    if (query && !evtCtx.campaign) {\n      evtCtx.campaign = utm(query)\n    }\n\n    const amp = ampId()\n    if (amp) {\n      evtCtx.amp = { id: amp }\n    }\n\n    referrerId(\n      query,\n      evtCtx,\n      this.instance.options.disableClientPersistence ?? false\n    )\n\n    try {\n      evtCtx.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone\n    } catch (_) {\n      // If browser doesn't have support leave timezone undefined\n    }\n\n    return ctx\n  }\n\n  track = this.enrich\n  identify = this.enrich\n}\n\nexport const envEnrichment = new EnvironmentEnrichmentPlugin()\n","import type { Integrations } from '../../core/events/interfaces'\nimport { LegacySettings } from '../../browser'\nimport { JSONObject, JSONValue } from '../../core/events'\nimport { DestinationPlugin, Plugin } from '../../core/plugin'\nimport { loadScript } from '../../lib/load-script'\nimport { getCDN } from '../../lib/parse-cdn'\nimport {\n  applyDestinationMiddleware,\n  DestinationMiddlewareFunction,\n} from '../middleware'\nimport { Context, ContextCancelation } from '../../core/context'\nimport { Receiver } from '../../core/receiver'\n\nexport interface RemotePlugin {\n  /** The name of the remote plugin */\n  name: string\n  /** The creation name of the remote plugin */\n  creationName: string\n  /** The url of the javascript file to load */\n  url: string\n  /** The UMD/global name the plugin uses. Plugins are expected to exist here with the `PluginFactory` method signature */\n  libraryName: string\n  /** The settings related to this plugin. */\n  settings: JSONObject\n}\n\nexport class ActionDestination implements DestinationPlugin {\n  name: string // destination name\n  version = '1.0.0'\n  type: Plugin['type']\n\n  alternativeNames: string[] = []\n\n  middleware: DestinationMiddlewareFunction[] = []\n\n  action: Plugin\n\n  constructor(name: string, action: Plugin) {\n    this.action = action\n    this.name = name\n    this.type = action.type\n    this.alternativeNames.push(action.name)\n  }\n\n  addMiddleware(...fn: DestinationMiddlewareFunction[]): void {\n    if (this.type === 'destination') {\n      this.middleware.push(...fn)\n    }\n  }\n\n  private async transform(ctx: Context): Promise<Context> {\n    const modifiedEvent = await applyDestinationMiddleware(\n      this.name,\n      ctx.event,\n      this.middleware\n    )\n\n    if (modifiedEvent === null) {\n      ctx.cancel(\n        new ContextCancelation({\n          retry: false,\n          reason: 'dropped by destination middleware',\n        })\n      )\n    }\n\n    return new Context(modifiedEvent!)\n  }\n\n  private _createMethod(\n    methodName: 'track' | 'identify'\n  ) {\n    return async (ctx: Context): Promise<Context> => {\n      if (!this.action[methodName]) return ctx\n\n      let transformedContext: Context = ctx\n      // Transformations only allowed for destination plugins. Other plugin types support mutating events.\n      if (this.type === 'destination') {\n        transformedContext = await this.transform(ctx)\n      }\n\n      await this.action[methodName]!(transformedContext)\n\n      return ctx\n    }\n  }\n\n  identify = this._createMethod('identify')\n  track = this._createMethod('track')\n\n  /* --- PASSTHROUGH METHODS --- */\n  isLoaded(): boolean {\n    return this.action.isLoaded()\n  }\n\n  ready(): Promise<unknown> {\n    return this.action.ready ? this.action.ready() : Promise.resolve()\n  }\n\n  load(ctx: Context, receiver: Receiver): Promise<unknown> {\n    return this.action.load(ctx, receiver)\n  }\n\n  unload(ctx: Context, receiver: Receiver): Promise<unknown> | unknown {\n    return this.action.unload?.(ctx, receiver)\n  }\n}\n\nexport type PluginFactory = {\n  (settings: JSONValue): Plugin | Plugin[] | Promise<Plugin | Plugin[]>\n  pluginName: string\n}\n\nfunction validate(pluginLike: unknown): pluginLike is Plugin[] {\n  if (!Array.isArray(pluginLike)) {\n    throw new Error('Not a valid list of plugins')\n  }\n\n  const required = ['load', 'isLoaded', 'name', 'version', 'type']\n  pluginLike.forEach((plugin) => {\n    required.forEach((method) => {\n      if (plugin[method] === undefined) {\n        throw new Error(\n          `Plugin: ${\n            plugin.name ?? 'unknown'\n          } missing required function ${method}`\n        )\n      }\n    })\n  })\n\n  return true\n}\n\nfunction isPluginDisabled(\n  userIntegrations: Integrations,\n  remotePlugin: RemotePlugin\n) {\n  const creationNameEnabled = userIntegrations[remotePlugin.creationName]\n  const currentNameEnabled = userIntegrations[remotePlugin.name]\n\n  // Check that the plugin isn't explicitly enabled when All: false\n  if (\n    userIntegrations.All === false &&\n    !creationNameEnabled &&\n    !currentNameEnabled\n  ) {\n    return true\n  }\n\n  // Check that the plugin isn't explicitly disabled\n  if (creationNameEnabled === false || currentNameEnabled === false) {\n    return true\n  }\n\n  return false\n}\n\nasync function loadPluginFactory(\n  remotePlugin: RemotePlugin,\n  obfuscate?: boolean\n): Promise<void | PluginFactory> {\n  const defaultCdn = new RegExp('https://cdn.tronic.(com|build)')\n  const cdn = getCDN()\n\n  if (obfuscate) {\n    const urlSplit = remotePlugin.url.split('/')\n    const name = urlSplit[urlSplit.length - 2]\n    const obfuscatedURL = remotePlugin.url.replace(\n      name,\n      btoa(name).replace(/=/g, '')\n    )\n    try {\n      await loadScript(obfuscatedURL.replace(defaultCdn, cdn))\n    } catch (error) {\n      // Due to syncing concerns it is possible that the obfuscated action destination (or requested version) might not exist.\n      // We should use the unobfuscated version as a fallback.\n      await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n    }\n  } else {\n    await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n  }\n\n  // @ts-expect-error\n  if (typeof window[remotePlugin.libraryName] === 'function') {\n    // @ts-expect-error\n    return window[remotePlugin.libraryName] as PluginFactory\n  }\n}\n\nexport async function remoteLoader(\n  settings: LegacySettings,\n  userIntegrations: Integrations,\n  mergedIntegrations: Record<string, JSONObject>,\n  obfuscate?: boolean,\n  routingMiddleware?: DestinationMiddlewareFunction,\n  pluginSources?: PluginFactory[]\n): Promise<Plugin[]> {\n  const allPlugins: Plugin[] = []\n\n  const routingRules = settings.middlewareSettings?.routingRules ?? []\n\n  const pluginPromises = (settings.remotePlugins ?? []).map(\n    async (remotePlugin) => {\n      if (isPluginDisabled(userIntegrations, remotePlugin)) return\n\n      try {\n        const pluginFactory =\n          pluginSources?.find(\n            ({ pluginName }) => pluginName === remotePlugin.name\n          ) || (await loadPluginFactory(remotePlugin, obfuscate))\n\n        if (pluginFactory) {\n          const plugin = await pluginFactory({\n            ...remotePlugin.settings,\n            ...mergedIntegrations[remotePlugin.name],\n          })\n          const plugins = Array.isArray(plugin) ? plugin : [plugin]\n\n          validate(plugins)\n\n          const routing = routingRules.filter(\n            (rule) => rule.destinationName === remotePlugin.creationName\n          )\n\n          plugins.forEach((plugin) => {\n            const wrapper = new ActionDestination(\n              remotePlugin.creationName,\n              plugin\n            )\n\n            /** Make sure we only apply destination filters to actions of the \"destination\" type to avoid causing issues for hybrid destinations */\n            if (\n              routing.length &&\n              routingMiddleware &&\n              plugin.type === 'destination'\n            ) {\n              wrapper.addMiddleware(routingMiddleware)\n            }\n\n            allPlugins.push(wrapper)\n          })\n        }\n      } catch (error) {\n        console.warn('Failed to load Remote Plugin', error)\n      }\n    }\n  )\n\n  await Promise.all(pluginPromises)\n  return allPlugins.filter(Boolean)\n}\n","/**\n * Register event listener on document that fires when:\n * * tab change or tab close (in mobile or desktop)\n * * click back / forward button\n * * click any link or perform any other navigation action\n * * soft refresh / hard refresh\n *\n * adapted from https://stackoverflow.com/questions/3239834/window-onbeforeunload-not-working-on-the-ipad/52864508#52864508,\n */\nexport const onPageChange = (cb: (unloaded: boolean) => void) => {\n  let unloaded = false // prevents double firing if both are supported\n\n  window.addEventListener('pagehide', () => {\n    if (unloaded) return\n    unloaded = true\n    cb(unloaded)\n  })\n\n  // using document instead of window because of bug affecting browsers before safari 14 (detail in footnotes https://caniuse.com/?search=visibilitychange)\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState == 'hidden') {\n      if (unloaded) return\n      unloaded = true\n    } else {\n      unloaded = false\n    }\n    cb(unloaded)\n  })\n}\n","import { TronicEvent } from '../../core/events'\nimport { fetch } from '../../lib/fetch'\nimport { onPageChange } from '../../lib/on-page-change'\n\nexport type BatchingDispatchConfig = {\n  size?: number\n  timeout?: number\n}\n\nconst MAX_PAYLOAD_SIZE = 500\n\nfunction kilobytes(buffer: unknown): number {\n  const size = encodeURI(JSON.stringify(buffer)).split(/%..|./).length - 1\n  return size / 1024\n}\n\n/**\n * Checks if the payload is over or close to\n * the maximum payload size allowed by tracking\n * API.\n */\nfunction approachingTrackingAPILimit(buffer: unknown): boolean {\n  return kilobytes(buffer) >= MAX_PAYLOAD_SIZE - 50\n}\n\nfunction chunks(batch: object[]): Array<object[]> {\n  const result: object[][] = []\n  let index = 0\n\n  batch.forEach((item) => {\n    const size = kilobytes(result[index])\n    if (size >= 64) {\n      index++\n    }\n\n    if (result[index]) {\n      result[index].push(item)\n    } else {\n      result[index] = [item]\n    }\n  })\n\n  return result\n}\n\nexport default function batch(\n  apiHost: string,\n  config?: BatchingDispatchConfig\n) {\n  let buffer: object[] = []\n  let pageUnloaded = false\n\n  const limit = config?.size ?? 10\n  const timeout = config?.timeout ?? 5000\n\n  function sendBatch(batch: object[]) {\n    if (batch.length === 0) {\n      return\n    }\n\n    const writeKey = (batch[0] as TronicEvent)?.writeKey\n\n    // Remove sentAt from every event as batching only needs a single timestamp\n    const updatedBatch = batch.map((event) => {\n      const { sentAt, ...newEvent } = event as TronicEvent\n      return newEvent\n    })\n\n    return fetch(`https://${apiHost}/b`, {\n      keepalive: pageUnloaded,\n      headers: {\n        'Content-Type': 'text/plain',\n      },\n      method: 'post',\n      body: JSON.stringify({\n        writeKey,\n        batch: updatedBatch,\n        sentAt: new Date().toISOString(),\n      }),\n    })\n  }\n\n  async function flush(): Promise<unknown> {\n    if (buffer.length) {\n      const batch = buffer\n      buffer = []\n      return sendBatch(batch)\n    }\n  }\n\n  let schedule: NodeJS.Timeout | undefined\n\n  function scheduleFlush(): void {\n    if (schedule) {\n      return\n    }\n\n    schedule = setTimeout(() => {\n      schedule = undefined\n      flush().catch(console.error)\n    }, timeout)\n  }\n\n  onPageChange((unloaded) => {\n    pageUnloaded = unloaded\n\n    if (pageUnloaded && buffer.length) {\n      const reqs = chunks(buffer).map(sendBatch)\n      Promise.all(reqs).catch(console.error)\n    }\n  })\n\n  async function dispatch(_url: string, body: object): Promise<unknown> {\n    buffer.push(body)\n\n    const bufferOverflow =\n      buffer.length >= limit || approachingTrackingAPILimit(buffer)\n\n    return bufferOverflow || pageUnloaded ? flush() : scheduleFlush()\n  }\n\n  return {\n    dispatch,\n  }\n}\n","export const pWhile = async <T>(\n  condition: (value: T | undefined) => boolean,\n  action: () => T | PromiseLike<T>\n): Promise<void> => {\n  const loop = async (actionResult: T | undefined): Promise<void> => {\n    if (condition(actionResult)) {\n      return loop(await action())\n    }\n  }\n\n  return loop(undefined)\n}\n","import { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { attempt } from '@tronic/receiver-core'\nimport { pWhile } from '../../lib/p-while'\nimport { PriorityQueue } from '../../lib/priority-queue'\n\nasync function flushQueue(\n  xt: Plugin,\n  queue: PriorityQueue<Context>\n): Promise<PriorityQueue<Context>> {\n  const failedQueue: Context[] = []\n  if (isOffline()) {\n    return queue\n  }\n\n  await pWhile(\n    () => queue.length > 0 && !isOffline(),\n    async () => {\n      const ctx = queue.pop()\n      if (!ctx) {\n        return\n      }\n\n      const result = await attempt(ctx, xt)\n      const success = result instanceof Context\n      if (!success) {\n        failedQueue.push(ctx)\n      }\n    }\n  )\n  // re-add failed tasks\n  failedQueue.map((failed) => queue.pushWithBackoff(failed))\n  return queue\n}\n\nexport function scheduleFlush(\n  flushing: boolean,\n  buffer: PriorityQueue<Context>,\n  xt: Plugin,\n  scheduleFlush: Function\n): void {\n  if (flushing) {\n    return\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  setTimeout(async () => {\n    let isFlushing = true\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const newBuffer = await flushQueue(xt, buffer)\n    isFlushing = false\n\n    if (buffer.todo > 0) {\n      scheduleFlush(isFlushing, newBuffer, xt, scheduleFlush)\n    }\n  }, Math.random() * 5000)\n}\n","import { Facade } from '@segment/facade'\nimport { Receiver } from '../../core/receiver'\nimport { LegacySettings } from '../../browser'\nimport { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { toFacade } from '../../lib/to-facade'\nimport batch, { BatchingDispatchConfig } from './batched-dispatcher'\nimport standard, { StandardDispatcherConfig } from './fetch-dispatcher'\nimport { normalize } from './normalize'\nimport { scheduleFlush } from './schedule-flush'\nimport { TRONIC_API_HOST } from '../../core/constants'\n\ntype DeliveryStrategy =\n  | {\n      strategy?: 'standard'\n      config?: StandardDispatcherConfig\n    }\n  | {\n      strategy?: 'batching'\n      config?: BatchingDispatchConfig\n    }\n\nexport type TronicSettings = {\n  apiKey: string\n  apiHost?: string\n  protocol?: 'http' | 'https'\n\n  addBundledMetadata?: boolean\n  unbundledIntegrations?: string[]\n  bundledConfigIds?: string[]\n  unbundledConfigIds?: string[]\n\n  maybeBundledConfigIds?: Record<string, string[]>\n\n  deliveryStrategy?: DeliveryStrategy\n}\n\ntype JSON = ReturnType<Facade['json']>\n\nfunction onAlias(receiver: Receiver, json: JSON): JSON {\n  const user = receiver.user()\n  json.previousId =\n    json.previousId ?? json.from ?? user.id() ?? user.anonymousId()\n  json.userId = json.userId ?? json.to\n  delete json.from\n  delete json.to\n  return json\n}\n\nexport function tronic(\n  receiver: Receiver,\n  settings?: TronicSettings,\n  integrations?: LegacySettings['integrations']\n): Plugin {\n  // Attach `pagehide` before buffer is created so that inflight events are added\n  // to the buffer before the buffer persists events in its own `pagehide` handler.\n  window.addEventListener('pagehide', () => {\n    buffer.push(...Array.from(inflightEvents))\n    inflightEvents.clear()\n  })\n\n  const writeKey = settings?.apiKey ?? ''\n\n  const buffer = receiver.options.disableClientPersistence\n    ? new PriorityQueue<Context>(receiver.queue.queue.maxAttempts, [])\n    : new PersistedPriorityQueue(\n        receiver.queue.queue.maxAttempts,\n        `${writeKey}:dest-tronic`\n      )\n\n  const inflightEvents = new Set<Context>()\n  const flushing = false\n\n  const apiHost = settings?.apiHost ?? TRONIC_API_HOST\n  const protocol = 'http' // settings?.protocol ?? 'https'\n  const remote = `${protocol}://${apiHost}`\n\n  const deliveryStrategy = settings?.deliveryStrategy\n  const client =\n    deliveryStrategy?.strategy === 'batching'\n      ? batch(apiHost, deliveryStrategy.config)\n      : standard(deliveryStrategy?.config as StandardDispatcherConfig)\n\n  async function send(ctx: Context): Promise<Context> {\n    if (isOffline()) {\n      buffer.push(ctx)\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n      return ctx\n    }\n\n    inflightEvents.add(ctx)\n\n    const path = 'external/' + ctx.event.type; // ctx.event.type.charAt(0)\n\n    let _json = toFacade(ctx.event).json()\n\n    if (ctx.event.type === 'track') {\n      delete _json.type\n      delete _json.traits\n      delete _json.anonymousId\n      delete _json.sentAt\n      delete _json.context\n    }\n\n    /*\n    if (ctx.event.type === 'alias') {\n      json = onAlias(receiver, json)\n    }\n     */\n\n    const json = {\"userId\":\"2XWyaIZf7Tm2uQqa8fYH6GC0oYl\",\"event\":\"event0\",\"properties\":{\"test\":\"property\"},\"channelId\":\"2XWyaIasy88a5SJMoLKpkDuDt2O\",\"timestamp\":\"2023-10-31T18:28:57.818Z\"};\n\n    return client\n      .dispatch(\n        `${remote}/${path}`,\n        json, // normalize(receiver, json, settings, integrations)\n      )\n      .then(() => ctx)\n      .catch(() => {\n        buffer.pushWithBackoff(ctx)\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n        return ctx\n      })\n      .finally(() => {\n        inflightEvents.delete(ctx)\n      })\n  }\n\n  const tronic: Plugin = {\n    name: 'Tronic',\n    type: 'after',\n    version: '0.1.0',\n    isLoaded: (): boolean => true,\n    load: (): Promise<void> => Promise.resolve(),\n    track: send,\n    identify: send,\n  }\n\n  // Buffer may already have items if they were previously stored in localStorage.\n  // Start flushing them immediately.\n  if (buffer.todo) {\n    scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n  }\n\n  return tronic\n}\n","import { fetch } from '../../lib/fetch'\n\nexport type Dispatcher = (url: string, body: object) => Promise<unknown>\n\nexport type StandardDispatcherConfig = {\n  keepalive?: boolean\n}\n\nexport default function (config?: StandardDispatcherConfig): {\n  dispatch: Dispatcher\n} {\n  function dispatch(url: string, body: object): Promise<unknown> {\n    return fetch(url, {\n      keepalive: config?.keepalive,\n      headers: {\n        // 'Content-Type': 'text/plain',\n        'Content-Type': 'application/json',\n        'X-Api-Key': '5663b25b-f8c3-4ccb-8f1f-fe891d3d1e9a',\n      },\n      method: 'post',\n      body: JSON.stringify(body),\n    })\n  }\n\n  return {\n    dispatch,\n  }\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar ValidationError = /** @class */ (function (_super) {\n    __extends(ValidationError, _super);\n    function ValidationError(field, message) {\n        var _this = _super.call(this, \"\".concat(field, \" \").concat(message)) || this;\n        _this.field = field;\n        return _this;\n    }\n    return ValidationError;\n}(Error));\nexport { ValidationError };\n//# sourceMappingURL=errors.js.map","import { ValidationError } from './errors';\nimport { isString, isPlainObject, exists } from './helpers';\nvar stringError = 'is not a string';\nvar objError = 'is not an object';\nvar nilError = 'is nil';\nexport function assertUserIdentity(event) {\n    var USER_FIELD_NAME = '.userId/anonymousId/previousId/groupId';\n    var getAnyUserId = function (event) { var _a, _b, _c; return (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId; };\n    var id = getAnyUserId(event);\n    if (!exists(id)) {\n        throw new ValidationError(USER_FIELD_NAME, nilError);\n    }\n    else if (!isString(id)) {\n        throw new ValidationError(USER_FIELD_NAME, stringError);\n    }\n}\nexport function assertEventExists(event) {\n    if (!exists(event)) {\n        throw new ValidationError('Event', nilError);\n    }\n    if (typeof event !== 'object') {\n        throw new ValidationError('Event', objError);\n    }\n}\nexport function assertEventType(event) {\n    if (!isString(event.type)) {\n        throw new ValidationError('.type', stringError);\n    }\n}\nexport function assertTrackEventName(event) {\n    if (!isString(event.event)) {\n        throw new ValidationError('.event', stringError);\n    }\n}\nexport function assertTrackEventProperties(event) {\n    if (!isPlainObject(event.properties)) {\n        throw new ValidationError('.properties', objError);\n    }\n}\nexport function assertTraits(event) {\n    if (!isPlainObject(event.traits)) {\n        throw new ValidationError('.traits', objError);\n    }\n}\nexport function validateEvent(event) {\n    assertEventExists(event);\n    assertEventType(event);\n    if (event.type === 'track') {\n        assertTrackEventName(event);\n        assertTrackEventProperties(event);\n    }\n    if (['group', 'identify'].includes(event.type)) {\n        assertTraits(event);\n    }\n    assertUserIdentity(event);\n}\n//# sourceMappingURL=assertions.js.map","import type { Plugin } from '../../core/plugin'\nimport type { Context } from '../../core/context'\nimport {\n  assertUserIdentity,\n  isPlainObject,\n  ValidationError,\n  assertEventExists,\n  assertEventType,\n  assertTrackEventName,\n} from '@tronic/receiver-core'\n\nfunction validate(ctx: Context): Context {\n  const event = ctx.event\n  assertEventExists(event)\n  assertEventType(event)\n\n  if (event.type === 'track') {\n    assertTrackEventName(event)\n  }\n\n    /*\n  const props = event.properties ?? event.traits\n  if (event.type !== 'alias' && !isPlainObject(props)) {\n    throw new ValidationError('.properties', 'is not an object')\n  }\n     */\n\n  assertUserIdentity(event)\n  return ctx\n}\n\nexport const validation: Plugin = {\n  name: 'Event Validation',\n  type: 'before',\n  version: '1.0.0',\n\n  isLoaded: () => true,\n  load: () => Promise.resolve(),\n\n  track: validate,\n  identify: validate,\n}\n","import { getGlobal } from '../../lib/get-global'\nimport type { Receiver } from '../receiver'\n\nconst env = getGlobal()\n\n// The code below assumes the inspector extension will use Object.assign\n// to add the inspect interface on to this object reference (unless the\n// extension code ran first and has already set up the variable)\nconst inspectorHost: {\n  attach: (receiver: Receiver) => void\n} = ((env as any)['__TRONIC_INSPECTOR__'] ??= {})\n\nexport const attachInspector = (receiver: Receiver) =>\n  inspectorHost.attach?.(receiver as any)\n","import { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\n\nimport { fetch } from '../lib/fetch'\nimport { Receiver, ReceiverSettings, InitOptions } from '../core/receiver'\nimport { Context } from '../core/context'\nimport { Plugin } from '../core/plugin'\nimport { MetricsOptions } from '../core/stats/remote-metrics'\nimport { mergedOptions } from '../lib/merged-options'\nimport { createDeferred } from '../lib/create-deferred'\nimport { envEnrichment } from '../plugins/env-enrichment'\nimport {\n  PluginFactory,\n  remoteLoader,\n  RemotePlugin,\n} from '../plugins/remote-loader'\nimport type { RoutingRule } from '../plugins/routing-middleware'\nimport { tronic, TronicSettings } from '../plugins/tronic'\nimport { validation } from '../plugins/validation'\nimport {\n  ReceiverBuffered,\n  PreInitMethodCallBuffer,\n  flushReceiverCallsInNewTask,\n  flushAddSourceMiddleware,\n  flushSetAnonymousID,\n  flushOn,\n} from '../core/buffer'\nimport { ClassicIntegrationSource } from '../plugins/ajs-destination/types'\nimport { attachInspector } from '../core/inspector'\nimport { Stats } from '../core/stats'\nimport { setGlobalReceiverKey } from '../lib/global-receiver-helper'\n\nexport interface LegacyIntegrationConfiguration {\n  /* @deprecated - This does not indicate browser types anymore */\n  type?: string\n\n  versionSettings?: {\n    version?: string\n    override?: string\n    componentTypes?: Array<'browser' | 'android' | 'ios' | 'server'>\n  }\n\n  bundlingStatus?: string\n\n  /**\n   * Consent settings for the integration\n   */\n  consentSettings?: {\n    /**\n     * Consent categories for the integration\n     * @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n     */\n    categories: string[]\n  }\n\n  // Tronic.com specific\n  retryQueue?: boolean\n\n  // any extra unknown settings\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\n\nexport interface LegacySettings {\n  integrations: {\n    [name: string]: LegacyIntegrationConfiguration\n  }\n\n  middlewareSettings?: {\n    routingRules: RoutingRule[]\n  }\n\n  enabledMiddleware?: Record<string, boolean>\n  metrics?: MetricsOptions\n\n  remotePlugins?: RemotePlugin[]\n\n  /**\n   * Top level consent settings\n   */\n  consentSettings?: {\n    /**\n     * All unique consent categories.\n     * There can be categories in this array that are important for consent that are not included in any integration  (e.g. 2 cloud mode categories).\n     * @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n     */\n    allCategories: string[]\n  }\n}\n\nexport interface ReceiverBrowserSettings extends ReceiverSettings {\n  /**\n   * The settings for the Tronic Source.\n   * If provided, `ReceiverBrowser` will not fetch remote settings\n   * for the source.\n   */\n  cdnSettings?: LegacySettings & Record<string, unknown>\n  /**\n   * If provided, will override the default CDN.\n   */\n  cdnURL?: string\n}\n\nexport function loadLegacySettings(\n  writeKey: string,\n  cdnURL?: string\n): Promise<LegacySettings> {\n  const baseUrl = cdnURL ?? getCDN()\n\n  return fetch(`${baseUrl}/v1/projects/${writeKey}/settings`)\n    .then((res) => {\n      if (!res.ok) {\n        return res.text().then((errorResponseMessage) => {\n          throw new Error(errorResponseMessage)\n        })\n      }\n      return res.json()\n    })\n    .catch((err) => {\n      console.error(err.message)\n      throw err\n    })\n}\n\n/**\n * With AJS classic, we allow users to call setAnonymousId before the library initialization.\n * This is important because some of the destinations will use the anonymousId during the initialization,\n * and if we set anonId afterwards, that wouldnt impact the destination.\n *\n * Also Ensures events can be registered before library initialization.\n * This is important so users can register to 'initialize' and any events that may fire early during setup.\n */\nfunction flushPreBuffer(\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void {\n  flushSetAnonymousID(receiver, buffer)\n  flushOn(receiver, buffer)\n}\n\n/**\n * Finish flushing buffer and cleanup.\n */\nasync function flushFinalBuffer(\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): Promise<void> {\n  // Call popSnippetWindowBuffer before each flush task since there may be\n  // receiver calls during async function calls.\n  await flushAddSourceMiddleware(receiver, buffer)\n  flushReceiverCallsInNewTask(receiver, buffer)\n  // Clear buffer, just in case receiver is loaded twice; we don't want to fire events off again.\n  buffer.clear()\n}\n\nasync function registerPlugins(\n  writeKey: string,\n  legacySettings: LegacySettings,\n  receiver: Receiver,\n  opts: InitOptions,\n  options: InitOptions,\n  pluginLikes: (Plugin | PluginFactory)[] = [],\n  legacyIntegrationSources: ClassicIntegrationSource[]\n): Promise<Context> {\n  const plugins = pluginLikes?.filter(\n    (pluginLike) => typeof pluginLike === 'object'\n  ) as Plugin[]\n\n  const pluginSources = pluginLikes?.filter(\n    (pluginLike) =>\n      typeof pluginLike === 'function' &&\n      typeof pluginLike.pluginName === 'string'\n  ) as PluginFactory[]\n\n  const mergedSettings = mergedOptions(legacySettings, options)\n  const remotePlugins = await remoteLoader(\n    legacySettings,\n    receiver.integrations,\n    mergedSettings,\n    options.obfuscate,\n    undefined,\n    pluginSources\n  ).catch(() => [])\n\n  const toRegister = [\n    validation,\n    envEnrichment,\n    ...plugins,\n    ...remotePlugins,\n    await tronic(\n      receiver,\n      mergedSettings['Tronic'] as TronicSettings,\n      legacySettings.integrations\n    ),\n  ]\n\n  const ctx = await receiver.register(...toRegister)\n\n  if (\n    Object.entries(legacySettings.enabledMiddleware ?? {}).some(\n      ([, enabled]) => enabled\n    )\n  ) {\n    await import(\n      /* webpackChunkName: \"remoteMiddleware\" */ '../plugins/remote-middleware'\n    ).then(async ({ remoteMiddlewares }) => {\n      const middleware = await remoteMiddlewares(\n        ctx,\n        legacySettings,\n        options.obfuscate\n      )\n      const promises = middleware.map((mdw) =>\n        receiver.addSourceMiddleware(mdw)\n      )\n      return Promise.all(promises)\n    })\n  }\n\n  return ctx\n}\n\nasync function loadReceiver(\n  settings: ReceiverBrowserSettings,\n  options: InitOptions = {},\n  preInitBuffer: PreInitMethodCallBuffer\n): Promise<[Receiver, Context]> {\n  if (options.globalReceiverKey)\n    setGlobalReceiverKey(options.globalReceiverKey)\n  // this is an ugly side-effect, but it's for the benefits of the plugins that get their cdn via getCDN()\n  if (settings.cdnURL) setGlobalCDNUrl(settings.cdnURL)\n\n  let legacySettings = {\n    integrations: {},\n  } as LegacySettings/*\n    settings.cdnSettings ??\n    (await loadLegacySettings(settings.writeKey, settings.cdnURL))\n                           */\n\n  if (options.updateCDNSettings) {\n    legacySettings = options.updateCDNSettings(legacySettings)\n  }\n\n  const retryQueue: boolean =\n    legacySettings?.integrations?.['Segment.io']?.retryQueue ?? true\n\n  const opts: InitOptions = { retryQueue, ...options }\n  const receiver = new Receiver(settings, opts)\n\n  attachInspector(receiver)\n\n  const plugins = settings.plugins ?? []\n\n  const classicIntegrations = settings.classicIntegrations ?? []\n  Stats.initRemoteMetrics(legacySettings.metrics)\n\n  // needs to be flushed before plugins are registered\n  flushPreBuffer(receiver, preInitBuffer)\n\n  const ctx = await registerPlugins(\n    settings.writeKey,\n    legacySettings,\n    receiver,\n    opts,\n    options,\n    plugins,\n    classicIntegrations\n  )\n\n  const search = window.location.search ?? ''\n  const hash = window.location.hash ?? ''\n\n  const term = search.length ? search : hash.replace(/(?=#).*(?=\\?)/, '')\n\n  if (term.includes('ajs_')) {\n    await receiver.queryString(term).catch(console.error)\n  }\n\n  receiver.initialized = true\n  receiver.emit('initialize', settings, options)\n\n  /*\nif (options.initialPageview) {\n  receiver.page().catch(console.error)\n}\n   */\n\n  await flushFinalBuffer(receiver, preInitBuffer)\n\n  return [receiver, ctx]\n}\n\n/**\n * The public browser interface for Tronic Receiver\n *\n * @example\n * ```ts\n *  export const receiver = new ReceiverBrowser()\n *  receiver.load({ writeKey: 'foo' })\n * ```\n * @link https://github.com/tronic/tronic-receiver/#readme\n */\nexport class ReceiverBrowser extends ReceiverBuffered {\n  private _resolveLoadStart: (\n    settings: ReceiverBrowserSettings,\n    options: InitOptions\n  ) => void\n\n  constructor() {\n    const { promise: loadStart, resolve: resolveLoadStart } =\n      createDeferred<Parameters<ReceiverBrowser['load']>>()\n\n    super((buffer) =>\n      loadStart.then(([settings, options]) =>\n        loadReceiver(settings, options, buffer)\n      )\n    )\n\n    this._resolveLoadStart = (settings, options) =>\n      resolveLoadStart([settings, options])\n  }\n\n  /**\n   * Fully initialize an receiver instance, including:\n   *\n   * * Fetching settings from the Tronic CDN (by default).\n   * * Fetching all remote destinations configured by the user (if applicable).\n   * * Flushing buffered receiver events.\n   * * Loading all middleware.\n   *\n   * Note:  This method should only be called *once* in your application.\n   *\n   * @example\n   * ```ts\n   * export const receiver = new ReceiverBrowser()\n   * receiver.load({ writeKey: 'foo' })\n   * ```\n   */\n  load(\n    settings: ReceiverBrowserSettings,\n    options: InitOptions = {}\n  ): ReceiverBrowser {\n    this._resolveLoadStart(settings, options)\n    return this\n  }\n\n  /**\n   * Instantiates an object exposing Receiver methods.\n   *\n   * @example\n   * ```ts\n   * const ajs = ReceiverBrowser.load({ writeKey: '<YOUR_WRITE_KEY>' })\n   *\n   * ajs.track(\"foo\")\n   * ...\n   * ```\n   */\n  static load(\n    settings: ReceiverBrowserSettings,\n    options: InitOptions = {}\n  ): ReceiverBrowser {\n    return new ReceiverBrowser().load(settings, options)\n  }\n\n  static standalone(\n    writeKey: string,\n    options?: InitOptions\n  ): Promise<Receiver> {\n    return ReceiverBrowser.load({ writeKey }, options).then((res) => res[0])\n  }\n}\n","import { JSONObject, Options } from '../core/events/interfaces'\nimport { LegacySettings } from '../browser'\n\n/**\n * Merge legacy settings and initialized Integration option overrides.\n *\n * This will merge any options that were passed from initialization into\n * overrides for settings that are returned by the Tronic CDN.\n *\n * i.e. this allows for passing options directly into destinations from\n * the Receiver constructor.\n */\nexport function mergedOptions(\n  settings: LegacySettings,\n  options: Options\n): Record<string, JSONObject> {\n  const optionOverrides = Object.entries(options.integrations ?? {}).reduce(\n    (overrides, [integration, options]) => {\n      if (typeof options === 'object') {\n        return {\n          ...overrides,\n          [integration]: options,\n        }\n      }\n\n      return {\n        ...overrides,\n        [integration]: {},\n      }\n    },\n    {} as Record<string, JSONObject>\n  )\n\n  return Object.entries(settings.integrations).reduce(\n    (integrationSettings, [integration, settings]) => {\n      return {\n        ...integrationSettings,\n        [integration]: {\n          ...settings,\n          ...optionOverrides[integration],\n        },\n      }\n    },\n    {} as Record<string, JSONObject>\n  )\n}\n","import { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\nimport { setVersionType } from '../lib/version-type'\n\nif (process.env.ASSET_PATH) {\n  if (process.env.ASSET_PATH === '/dist/umd/') {\n    // @ts-ignore\n    __webpack_public_path__ = '/dist/umd/'\n  } else {\n    const cdn = getCDN()\n    setGlobalCDNUrl(cdn) // preserving original behavior -- TODO: neccessary?\n\n    // @ts-ignore\n    __webpack_public_path__ = cdn + '/tronic-receiver/bundles/'\n  }\n}\n\nsetVersionType('web')\n\nexport * from '.'\n"],"names":["root","factory","exports","module","define","amd","self","inProgress","dataWebpackPrefix","__importDefault","this","mod","__esModule","Object","defineProperty","value","obj_case_1","trait","a","b","traits","props","properties","default","proto","zip","country","street","state","city","region","Alias","inherits_1","facade_1","dictionary","opts","Facade","call","prototype","action","type","previousId","field","from","userId","to","clone","toString","temp","key","hasOwnProperty","Array","isArray","map","Delete","address_1","clone_1","is_enabled_1","new_date_1","isodate_traverse_1","obj","raw","traverse","timestamp","Date","f","transform","proxy","fields","split","shift","length","join","multi","path","one","json","ret","rawEvent","options","integration","context","enabled","integrations","allEnabled","providers","settings","active","anonymousId","sessionId","groupId","aliases","id","alias","library","name","version","device","indexOf","userAgent","timezone","channel","ip","Group","is_email_1","g","created","email","industry","employees","Identify","trim","str","i","companyCreated","companyName","firstName","lastName","space","substr","uid","username","description","age","date","birthday","getFullYear","avatar","position","website","websites","phone","phones","address","gender","__assign","assign","t","s","n","arguments","p","apply","Screen","Page","Track","enumerable","get","alias_1","group_1","identify_1","track_1","page_1","screen_1","delete_1","matcher","string","test","disabled","Salesforce","category","title","url","referrer","fullName","event","track","productId","promotionId","cartId","checkoutId","paymentId","couponId","wishlistId","reviewId","orderId","sku","tax","price","total","repeat","coupon","shipping","discount","shippingMethod","paymentMethod","plan","subtotal","revenue","products","filter","item","quantity","currency","query","match","val","replace","parseFloat","isNaN","cents","identify","isodate","input","strict","undefined","keys","forEach","traverseObject","arr","index","traverseArray","is","parse","iso","numericKeys","exec","offset","parseInt","substring","getTimezoneOffset","millis","UTC","create","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","milliseconds","seconds","toStr","isNumber","num","multiple","fn","normalize","isFunction","normalizer","defaultNormalize","finished","loop","normalizedKey","charAt","child","del","toLowerCase","find","isBrowser","window","isServer","gracefulDecodeURIComponent","encodedURIComponent","decodeURIComponent","_globalReceiverKey","getGlobalReceiver","setGlobalReceiverKey","findScript","src","slice","document","querySelectorAll","loadScript","attributes","found","status","getAttribute","Promise","resolve","reject","addEventListener","err","script","createElement","async","setAttribute","entries","k","v","onload","onerror","Error","tag","getElementsByTagName","parentElement","insertBefore","_globalCDN","receiverScriptRegex","setGlobalCDNUrl","cdn","globalReceiver","_cdn","getCDN","globalCdnUrl","cdnFromScriptTag","result","getNextIntegrationsURL","toFacade","evt","fcd","applyDestinationMiddleware","destination","middleware","applyMiddleware","returnedEvent","payload","next","modifiedEvent","md","sourceMiddlewarePlugin","ctx","nextCalled","retry","reason","isLoaded","load","pTimeout","promise","timeout","timeoutId","setTimeout","then","clearTimeout","catch","invokeCallback","callback","delay","timeoutInMs","cb","log","error","stats","increment","CoreLogger","_logs","level","message","extras","time","push","flush","logs","formatted","reduce","_a","_b","_c","line","JSON","stringify","toISOString","concat","Math","random","console","table","logEntry","ContextCancelation","CoreContext","logger","attempts","_id","system","isSame","other","cancel","updateEvent","failedDelivery","_failedDelivery","setFailedDelivery","toJSON","metrics","extendStatics","__extends","d","setPrototypeOf","__proto__","TypeError","String","__","CoreStats","metric","by","tags","now","gauge","m","serialize","counter","e","NullStats","_super","_args","_i","isString","exists","isPlainObject","BUFFER","IDX","HEX","v4","out","dset","x","l","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","definition","o","chunkId","all","promises","u","prop","done","needAttach","scripts","charset","nc","onScriptComplete","prev","doneFns","parentNode","removeChild","bind","target","head","appendChild","r","Symbol","toStringTag","installedChunks","j","installedChunkData","errorType","realSrc","request","webpackJsonpCallback","parentChunkLoadingFunction","data","chunkIds","moreModules","runtime","some","chunkLoadingGlobal","_version","getVersionType","XMLHttpRequest","ok","statusText","responseURL","text","responseText","blob","Blob","response","headers","has","open","method","getAllResponseHeaders","withCredentials","credentials","setRequestHeader","send","body","getGlobal","globalThis","global","fetch","args","resolveArguments","channelId","eventName","isOffline","navigator","onLine","TRONIC_API_HOST","logError","remoteMetrics","host","sampleRate","flushTimer","maxQueueSize","queue","includes","remoteMetric","versionType","formattedTags","acc","library_version","createRemoteMetric","series","initRemoteMetrics","RemoteMetrics","Stats","thisArg","_arguments","P","generator","fulfilled","step","rejected","y","_","label","sent","trys","ops","verb","iterator","op","pop","dispatch","emitter","startTime","dispatched","emit","isEmpty","dispatchSingle","startTimeInEpochMS","timeoutInMS","elapsedTime","max","debug","Emitter","callbacks","on","once","_this","off","without","createBufferedPageContext","canonicalUrl","search","__t","c","BUFFERED_PAGE_CONTEXT_KEYS","createPageContext","href","hashIdx","pathname","newPath","URL","_e","parseCanonicalPath","newUrl","searchParams","createCanonicalURL","getDefaultBufferedPageContext","querySelector","location","addPageContext","pageCtx","evtCtx","page","pageContextFromEventProps","user","baseEvent","optionsKeys","providedOptionsKeys","overrides","rest","newEvent","ON_REMOVE_FROM_FUTURE","PriorityQueue","maxAttempts","seen","future","items","accepted","operation","updateAttempts","sort","getAttempts","pushWithBackoff","attempt","params","minTimeout","factor","maxTimeout","Infinity","min","pow","backoff","Boolean","loc","getItem","setItem","removeItem","localStorage","warn","persisted","Context","stored","remove","mutex","onUnlock","lockKey","rawLock","lock","allowed","getTime","expired","itemsKey","seenKey","saved","lastSeen","todo","existing","merged","values","persistItems","memory","persistSeen","pack","ar","plugin","start","hook","newCtx","err_1","tryAsync","ensure","newContext","CoreEventQueue","priorityQueue","taskCompletionPromise","resolvePromise","count","criticalTasks","run","returnValue","res","finally","plugins","failedInitializations","flushing","scheduleFlush","register","instance","deregister","e_1","unload","willDeliver","subscribeToDelivery","onDeliver","flushed","delivered","deliver","enqueuRetry","flushOne","err_2","isReady","availableExtensions","denyList","grouper","results","available","alternativeNameMatch","alternativeNames","All","suggestedKey","Function","before","enrichment","_d","after","destinations","before_1","beforeWare","enrichment_1","enrichmentWare","afterCalls","nameOrQueue","PersistedPriorityQueue","bindAll","getOwnPropertyNames","desc","getOwnPropertyDescriptor","StoreType","Cookie","LocalStorage","Memory","_logStoreKeyError","store","stores","set","clear","getAndSync","coercedValue","cache","isArrayOfStoreType","every","source","api","init","converter","defaultAttributes","expires","toUTCString","encodeURIComponent","escape","stringifiedAttributes","attributeName","cookie","write","cookies","jar","parts","foundKey","read","withAttributes","withConverter","freeze","tld","parsedUrl","parseUrl","lvls","hostname","last","levels","cname","domain","CookieStorage","defaults","maxage","sameSite","secure","localStorageWarning","initializeStorages","isStoreTypeWithSettings","MemoryStorage","applyCookieOptions","storeTypes","cookieOptions","persist","oldKey","disable","prevId","identityStore","idKey","retId","retLeg","legacyUserStore","anonKey","legacySIO","traitsStore","traitsKey","createStorage","legacyUser","currentId","logout","reset","User","save","cookieOpts","filterStores","UniversalStorage","storage","localStorageFallbackDisabled","groupDefaults","flushSyncReceiverCalls","receiver","buffer","getCalls","callReceiverMethod","flushAddSourceMiddleware","flushOn","flushSetAnonymousID","flushReceiverCallsInNewTask","toArray","popPageContext","hasBufferedPageContextAsLastArg","bufferedPageCtx","isBufferedPageContext","called","_callMap","calls","_pushSnippetWindowBuffer","methodName","wa","splice","PreInitMethodCall","loader","_createMethod","ready","_createChainableMethod","addSourceMiddleware","VERSION","_preInitBuffer","PreInitMethodCallBuffer","_promise","ajs","group","_debug","initialized","_user","disablePersistance","disableClientPersistence","retryQueue","EventQueue","createDefaultQueue","writeKey","storageSetting","_universalStorage","createStore","_group","eventFactory","EventFactory","tronicEvent","_dispatch","orderStack","arg","current","_traits","trackClick","autotrack","link","trackLink","trackSubmit","form","trackForm","registrations","xt","deregistrations","pl","toggle","addDestinationMiddleware","integrationName","addMiddleware","middlewares","setAnonymousId","queryString","useQueryString","clientHints","hints","userAgentData","getHighEntropyValues","getCookieOptions","_ctx","highEntropyValuesClientHints","enrich","URLSearchParams","append","objectToQueryString","locale","userLanguage","language","campaign","startsWith","utmParam","utm","amp","ampId","ad","queryIds","btid","urid","ads","referrerId","Intl","DateTimeFormat","resolvedOptions","timeZone","envEnrichment","EnvironmentEnrichmentPlugin","transformedContext","loadPluginFactory","remotePlugin","obfuscate","defaultCdn","RegExp","urlSplit","obfuscatedURL","btoa","libraryName","remoteLoader","userIntegrations","mergedIntegrations","routingMiddleware","pluginSources","allPlugins","routingRules","middlewareSettings","pluginPromises","remotePlugins","creationNameEnabled","creationName","currentNameEnabled","isPluginDisabled","pluginFactory","pluginLike","required","validate","rule","destinationName","wrapper","ActionDestination","onPageChange","unloaded","visibilityState","MAX_PAYLOAD_SIZE","kilobytes","encodeURI","batch","apiHost","config","schedule","pageUnloaded","limit","size","sendBatch","updatedBatch","keepalive","sentAt","reqs","chunks","_url","bufferOverflow","approachingTrackingAPILimit","pWhile","condition","actionResult","flushQueue","failedQueue","failed","isFlushing","newBuffer","tronic","inflightEvents","apiKey","Set","remote","deliveryStrategy","client","strategy","add","_json","delete","ValidationError","stringError","objError","nilError","assertUserIdentity","USER_FIELD_NAME","getAnyUserId","assertEventExists","assertEventType","assertTrackEventName","validation","inspectorHost","loadLegacySettings","cdnURL","baseUrl","errorResponseMessage","flushFinalBuffer","registerPlugins","legacySettings","pluginLikes","legacyIntegrationSources","pluginName","mergedSettings","optionOverrides","integrationSettings","mergedOptions","toRegister","enabledMiddleware","remoteMiddlewares","mdw","loadReceiver","preInitBuffer","globalReceiverKey","updateCDNSettings","attach","attachInspector","Receiver","classicIntegrations","flushPreBuffer","hash","term","_resolve","_reject","loadStart","resolveLoadStart","_resolveLoadStart","ReceiverBrowser","standalone","ReceiverBuffered","setVersionType"],"sourceRoot":""}