{"version":3,"file":"index.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;ACVa;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,iCAAiC,mBAAO,CAAC,GAAU;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;AACf;;;;;;;;AC7Ba;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,aAAa;AACb,iCAAiC,mBAAO,CAAC,GAAU;AACnD,eAAe,mBAAO,CAAC,GAAU;AACjC;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzBa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;;;;;;;ACvBa;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,cAAc;AACd,iCAAiC,mBAAO,CAAC,GAAU;AACnD,eAAe,mBAAO,CAAC,GAAU;AACjC;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;;;;;;;;AChBa;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,cAAc;AACd,gCAAgC,mBAAO,CAAC,GAAW;AACnD,cAAc,mBAAO,CAAC,GAAS;AAC/B,mCAAmC,mBAAO,CAAC,GAAc;AACzD,iCAAiC,mBAAO,CAAC,GAAU;AACnD,iCAAiC,mBAAO,CAAC,GAAU;AACnD,yCAAyC,mBAAO,CAAC,GAA2B;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChMa;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,aAAa;AACb,iCAAiC,mBAAO,CAAC,GAAU;AACnD,iCAAiC,mBAAO,CAAC,GAAY;AACrD,iCAAiC,mBAAO,CAAC,GAAU;AACnD,eAAe,mBAAO,CAAC,GAAU;AACjC;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9Da;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,gBAAgB;AAChB,eAAe,mBAAO,CAAC,GAAU;AACjC,iCAAiC,mBAAO,CAAC,GAAU;AACnD,iCAAiC,mBAAO,CAAC,GAAU;AACnD,iCAAiC,mBAAO,CAAC,GAAY;AACrD,iCAAiC,mBAAO,CAAC,GAAU;AACnD,4BAA4B;AAC5B;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACjIa;AACb;AACA;AACA,iDAAiD,OAAO;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,cAAc,GAAG,cAAc,GAAG,YAAY,GAAG,aAAa,GAAG,gBAAgB,GAAG,aAAa,GAAG,aAAa,GAAG,cAAc;AAClI,eAAe,mBAAO,CAAC,GAAU;AACjC,0CAAyC,EAAE,qCAAqC,2BAA2B,EAAC;AAC5G,cAAc,mBAAO,CAAC,GAAS;AAC/B,yCAAwC,EAAE,qCAAqC,yBAAyB,EAAC;AACzG,cAAc,mBAAO,CAAC,GAAS;AAC/B,yCAAwC,EAAE,qCAAqC,yBAAyB,EAAC;AACzG,iBAAiB,mBAAO,CAAC,GAAY;AACrC,4CAA2C,EAAE,qCAAqC,+BAA+B,EAAC;AAClH,cAAc,mBAAO,CAAC,GAAS;AAC/B,yCAAwC,EAAE,qCAAqC,yBAAyB,EAAC;AACzG,aAAa,mBAAO,CAAC,GAAQ;AAC7B,wCAAuC,EAAE,qCAAqC,uBAAuB,EAAC;AACtG,eAAe,mBAAO,CAAC,GAAU;AACjC,0CAAyC,EAAE,qCAAqC,2BAA2B,EAAC;AAC5G,eAAe,mBAAO,CAAC,GAAU;AACjC,0CAAyC,EAAE,qCAAqC,2BAA2B,EAAC;AAC5G,kBAAe,uBAAuB,sBAAsB;AAC5D;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;;;;;;;;ACrCa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D;AACA;AACA;AACA;AACA,kBAAe;AACf;;;;;;;;ACPa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;AACf;;;;;;;;ACTa;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,YAAY;AACZ,iCAAiC,mBAAO,CAAC,GAAU;AACnD,eAAe,mBAAO,CAAC,GAAU;AACjC,cAAc,mBAAO,CAAC,GAAS;AAC/B,iCAAiC,mBAAO,CAAC,GAAY;AACrD;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC5Ea;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,cAAc;AACd,iCAAiC,mBAAO,CAAC,GAAU;AACnD,aAAa,mBAAO,CAAC,GAAQ;AAC7B,cAAc,mBAAO,CAAC,GAAS;AAC/B;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC5Ba;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,aAAa;AACb,iCAAiC,mBAAO,CAAC,GAAU;AACnD,eAAe,mBAAO,CAAC,GAAU;AACjC,iBAAiB,mBAAO,CAAC,GAAY;AACrC,iCAAiC,mBAAO,CAAC,GAAY;AACrD,iCAAiC,mBAAO,CAAC,GAAU;AACnD;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,uBAAuB;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrLa;;AAEb,cAAc,mBAAO,CAAC,GAAkB;;AAExC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,YAAY;AACZ;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,YAAY;AACZ;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;;;;;;;ACvDa;;AAEb;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,EAAE,UAAU,EAAE,UAAU,EAAE,kBAAkB,EAAE,OAAO,EAAE,UAAU,EAAE,aAAa,GAAG,uBAAuB,EAAE,UAAU,EAAE;;AAE5I;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;;AAEA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,YAAY;AACZ;;AAEA,UAAU;AACV;AACA;AACA;AACA,sBAAsB,EAAE,IAAI,EAAE,IAAI,EAAE;AACpC;AACA;AACA;AACA;;;;;;;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC1Ba;;AAEb,cAAc,mBAAO,CAAC,GAAkB;AACxC,mBAAmB,mBAAO,CAAC,GAAgB;AAC3C,cAAc,mBAAO,CAAC,EAAW;;AAEjC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,oBAAoB;AAC/B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;;;;;;;;;ACnDa;;AAEb;AACA;AACA;;AAEA,kBAAkB,GAAG;;AAErB;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA,aAAa;AACb;AACA;AACA;;;;;;;;;AC3Ba;;AAEb;AACA;AACA;;AAEA,kBAAkB,GAAG;;AAErB;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA,aAAa;AACb;AACA;AACA;;;;;;;;;AC1BA,4BAA4B;;;AAG5B;AACA;AACA;;AAEA;AACA,mBAAmB;;;AAGnB;AACA;AACA;;AAEA,sBAAsB;AACtB;AACA;AACA;;;AAGA;AACA;AACA;;AAEA,kBAAkB;AAClB;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,uBAAuB,KAAK;AAC5B,qBAAqB;AACrB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU,uBAAuB;AACjC;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA,SAAS,kBAAkB,OAAO,OAAO;AACzC;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,aAAa,SAAS,iBAAiB;AACvC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,GAAG;AACd,YAAY,SAAS;AACrB;;AAEA;AACA;AACA;;;;;;;;ACvJA;AACA,QAAQ,IAA2B;AACnC;AACA;AACA,MAAM,KAAK,aAcN;AACL,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;;AAEf,oBAAoB,QAAQ;AAC5B;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;;AAEf,oBAAoB,QAAQ;AAC5B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,QAAQ;AAC7B;AACA;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC;AACA;AACA;AACA;AACA;AACA,wBAAwB,QAAQ;AAChC;AACA;AACA;;AAEA;AACA;AACA,8CAA8C,IAAI;AAClD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,QAAQ;AAC7B;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAoB,YAAY;AAChC;AACA;;AAEA;AACA;AACA;AACA,wBAAwB,QAAQ;AAChC;AACA;AACA;;AAEA;AACA;AACA,8CAA8C,IAAI;AAClD;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,oBAAoB,OAAO;AAC3B;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAoB,cAAc;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,SAAS;AACT;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,YAAY;AAChC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,oBAAoB,gBAAgB;AACpC;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA,gBAAgB,UAAU;AAC1B;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA,gBAAgB,UAAU;AAC1B;AACA;AACA;AACA;;AAEA;AACA;;AAEA,qBAAqB,aAAa;AAClC;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA,gBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,YAAY;AAChC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,UAAU;AAC1B;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA,gBAAgB,UAAU;AAC1B;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe,QAAQ;AACvB,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wBAAwB,QAAQ;AAChC;AACA;AACA;;AAEA;AACA;AACA;AACA,8CAA8C,IAAI;AAClD;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB,eAAe,SAAS;AACxB;AACA,gBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe,SAAS;AACxB,eAAe,SAAS;AACxB;AACA,gBAAgB,QAAQ;AACxB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe,aAAa;AAC5B;AACA,gBAAg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L;AACA;AACA;AACA;AACA;AACA,+CAA+C,UAAU,iEAAiE;AAC1H;AACA;AACA;AACA;AACA;AACA,2CAA2C,iBAAiB;AAC5D,aAAa,IAAI;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,CAAC;AACqB;AACtB;;;;ACpE0C;AACd;AACW;AACF;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAC6B;AAC9B;AACA;AACA,6BAA6B,KAAK,WAAI;AACtC,gCAAgC,YAAY,0BAAS;AACrD,iCAAiC,aAAa,UAAU;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,0BAA0B;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,yBAAI;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACsB;AACvB;;;;;;;;;;;;ACrFA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,eAAe,gBAAgB,sCAAsC,kBAAkB;AACvF,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA,CAAC;AACD,gBAAgB,SAAI,IAAI,SAAI;AAC5B;AACA,iDAAiD,OAAO;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,wDAAwD,4BAA4B,QAAQ,wBAAwB,KAAK;AACzH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,CAAC;AACoB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,uBAAuB;AAChD;AACA;AACA;AACA;AACA;AACA,yBAAyB,uBAAuB;AAChD;AACA;AACA;AACA;AACA;AACA,yBAAyB,uBAAuB;AAChD;AACA;AACA;AACA;AACA;AACA,yBAAyB,uBAAuB;AAChD;AACA;AACA;AACA;AACA;AACA,CAAC;AACoB;AACrB;;;;;;;;;;;;;;;ACrHO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACA;;;;;;;;;;;ACfA;AACA;;AAEO;AACP;;AAEA;AACA;AACA;AACA;AACA;;AAEA,QAAQ,QAAQ;AAChB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;ACvBO;AACP;AACA;AACA;AACA;AACA;AACA,4HAA4H;AAC5H;AACA;;;;;;;UCRA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;;;;WCzBA;WACA;WACA;WACA,eAAe,4BAA4B;WAC3C,eAAe;WACf,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,EAAE;WACF;;;;;WCRA;WACA;WACA;WACA,cAAc,sCAAsC,0BAA0B,yDAAyD;WACvI;;;;;WCJA,8CAA8C;;;;;WCA9C;WACA;WACA;WACA;WACA,uBAAuB,4BAA4B;WACnD;WACA;WACA;WACA,iBAAiB,oBAAoB;WACrC;WACA,mGAAmG,YAAY;WAC/G;WACA;W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AQ;IACjB,CAAC;IACH,mBAAC;AAAD,CAAC;;;;ACnIM;AACP;AACA;AACA;AACA;AACA;;ACLA,IAAI,sBAAS,IAAI,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,eAAe,gBAAgB,sCAAsC,kBAAkB;AACvF,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA,CAAC;AACoC;AACD;AACpC;AACA;AACA;AACO;AACP;AACA,IAAI,sBAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,uBAAuB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,uDAAuD,qDAAqD;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,OAAO,GAAG,sBAAsB;AACtD;AACA;AACA;AACA,8DAA8D,0BAA0B;AACxF;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,0BAA0B;AAC7E,oDAAoD,0BAA0B;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA,CAAC,CAAC,OAAO;AACgB;AACzB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtGiC;AAC8B;AACb;AAElD,IAAI,GAAG,GAEoE;IACzE,OAAO,gBAAI,CAAC;IACZ,OAAO,gBAAI,CAAC;IACZ,UAAU,gBAAI,CAAC;CAChB;AAED,IAAI;IACF,GAAG,GAAG,SAAS,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,GAAG;CACrE;AAAC,OAAO,GAAG,EAAE;IACZ,OAAO,CAAC,IAAI,CAAC,+BAA+B,EAAE,GAAG,CAAC;CACnD;AAED,SAAS,SAAS,CAAC,GAAW;IAC5B,IAAM,KAAK,GAAG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EAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AAC4C;AACc;AACG;AACxB;AACgB;AACR;AAC7C;AACA,IAAI,mBAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,eAAe;AAC7C;AACA;AACA;AACA;AACA,uBAAuB,qBAAqB;AAC5C;AACA,SAAS;AACT;AACA;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAA0E,gCAAgC;AAC1G;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,aAAa;AACb,SAAS;AACT;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,aAAa;AACjE;AACA;AACA;AACA,qBAAqB;AACrB,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,yCAAyC,iCAAkB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,eAAe;AACnE;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT,iBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,mBAAS;AACxB;AACA,mBAAmB,qBAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;AACA;AACA,6CAA6C,MAAM;AACnD;AACA;AACA,4CAA4C,0BAAW;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,OAAO;AACpD;AACA;AACA,4CAA4C,0BAAW;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","sources":["webpack://@tronic/receiver-browser/webpack/universalModuleDefinition","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/address.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/alias.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/clone.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/delete.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/facade.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/group.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/identify.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/index.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/is-email.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/is-enabled.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/page.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/screen.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/track.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/isodate-traverse/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/isodate/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/inherits/inherits_browser.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/milliseconds.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/seconds.js","webpack://@tronic/receiver-browser/../../node_modules/obj-case/index.js","webpack://@tronic/receiver-browser/../../node_modules/spark-md5/spark-md5.js","webpack://@tronic/receiver-browser/./src/core/query-string/gracefulDecodeURIComponent.ts","webpack://@tronic/receiver-browser/./src/lib/to-facade.ts","webpack://@tronic/receiver-browser/./src/plugins/middleware/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/callback/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/logger/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/context/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/stats/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/validation/helpers.js","webpack://@tronic/receiver-browser/../../node_modules/@lukeed/uuid/dist/index.mjs","webpack://@tronic/receiver-browser/../../node_modules/dset/dist/index.mjs","webpack://@tronic/receiver-browser/webpack/bootstrap","webpack://@tronic/receiver-browser/webpack/runtime/compat get default export","webpack://@tronic/receiver-browser/webpack/runtime/define property getters","webpack://@tronic/receiver-browser/webpack/runtime/ensure chunk","webpack://@tronic/receiver-browser/webpack/runtime/get javascript chunk filename","webpack://@tronic/receiver-browser/webpack/runtime/hasOwnProperty shorthand","webpack://@tronic/receiver-browser/webpack/runtime/load script","webpack://@tronic/receiver-browser/webpack/runtime/make namespace object","webpack://@tronic/receiver-browser/webpack/runtime/publicPath","webpack://@tronic/receiver-browser/webpack/runtime/jsonp chunk loading","webpack://@tronic/receiver-browser/./src/lib/global-receiver-helper.ts","webpack://@tronic/receiver-browser/./src/lib/parse-cdn.ts","webpack://@tronic/receiver-browser/./src/lib/version-type.ts","webpack://@tronic/receiver-browser/./src/core/arguments-resolver/index.ts","webpack://@tronic/receiver-browser/./src/core/environment/index.ts","webpack://@tronic/receiver-browser/./src/core/connection/index.ts","webpack://@tronic/receiver-browser/../../node_modules/unfetch/dist/unfetch.module.js","webpack://@tronic/receiver-browser/./src/lib/get-global.ts","webpack://@tronic/receiver-browser/./src/lib/fetch.ts","webpack://@tronic/receiver-browser/./src/generated/version.ts","webpack://@tronic/receiver-browser/./src/core/constants/index.ts","webpack://@tronic/receiver-browser/./src/core/stats/remote-metrics.ts","webpack://@tronic/receiver-browser/./src/core/stats/index.ts","webpack://@tronic/receiver-browser/./src/core/context/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/receiver/dispatch.js","webpack://@tronic/receiver-browser/../core/dist/esm/emitter/index.js","webpack://@tronic/receiver-browser/./src/core/page/get-page-context.ts","webpack://@tronic/receiver-browser/./src/core/page/add-page-context.ts","webpack://@tronic/receiver-browser/./src/core/events/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/priority-queue/backoff.js","webpack://@tronic/receiver-browser/../core/dist/esm/priority-queue/index.js","webpack://@tronic/receiver-browser/./src/lib/priority-queue/persisted.ts","webpack://@tronic/receiver-browser/../core/dist/esm/utils/group-by.js","webpack://@tronic/receiver-browser/../core/dist/esm/utils/is-thenable.js","webpack://@tronic/receiver-browser/../core/dist/esm/task/task-group.js","webpack://@tronic/receiver-browser/../core/dist/esm/queue/delivery.js","webpack://@tronic/receiver-browser/../core/dist/esm/queue/event-queue.js","webpack://@tronic/receiver-browser/./src/core/queue/event-queue.ts","webpack://@tronic/receiver-browser/./src/lib/bind-all.ts","webpack://@tronic/receiver-browser/./src/core/storage/types.ts","webpack://@tronic/receiver-browser/./src/core/storage/universalStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/memoryStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/settings.ts","webpack://@tronic/receiver-browser/../../node_modules/js-cookie/dist/js.cookie.mjs","webpack://@tronic/receiver-browser/./src/core/user/tld.ts","webpack://@tronic/receiver-browser/./src/core/storage/cookieStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/localStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/index.ts","webpack://@tronic/receiver-browser/./src/core/user/index.ts","webpack://@tronic/receiver-browser/./src/lib/is-thenable.ts","webpack://@tronic/receiver-browser/./src/core/buffer/index.ts","webpack://@tronic/receiver-browser/./src/core/receiver/index.ts","webpack://@tronic/receiver-browser/./src/lib/create-deferred.ts","webpack://@tronic/receiver-browser/./src/lib/client-hints/index.ts","webpack://@tronic/receiver-browser/./src/plugins/env-enrichment/index.ts","webpack://@tronic/receiver-browser/./src/lib/load-script.ts","webpack://@tronic/receiver-browser/./src/plugins/remote-loader/index.ts","webpack://@tronic/receiver-browser/./src/lib/on-page-change.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/batched-dispatcher.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/fetch-dispatcher.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/normalize.ts","webpack://@tronic/receiver-browser/./src/lib/p-while.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/schedule-flush.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/validation/errors.js","webpack://@tronic/receiver-browser/../core/dist/esm/validation/assertions.js","webpack://@tronic/receiver-browser/./src/plugins/validation/index.ts","webpack://@tronic/receiver-browser/./src/core/inspector/index.ts","webpack://@tronic/receiver-browser/./src/browser/index.ts","webpack://@tronic/receiver-browser/./src/browser/browser-umd.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TronicReceiver\"] = factory();\n\telse\n\t\troot[\"TronicReceiver\"] = factory();\n})(self, function() {\nreturn ","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nfunction trait(a, b) {\n    return function () {\n        var traits = this.traits();\n        var props = this.properties ? this.properties() : {};\n        return (obj_case_1.default(traits, \"address.\" + a) ||\n            obj_case_1.default(traits, a) ||\n            (b ? obj_case_1.default(traits, \"address.\" + b) : null) ||\n            (b ? obj_case_1.default(traits, b) : null) ||\n            obj_case_1.default(props, \"address.\" + a) ||\n            obj_case_1.default(props, a) ||\n            (b ? obj_case_1.default(props, \"address.\" + b) : null) ||\n            (b ? obj_case_1.default(props, b) : null));\n    };\n}\nfunction default_1(proto) {\n    proto.zip = trait(\"postalCode\", \"zip\");\n    proto.country = trait(\"country\");\n    proto.street = trait(\"street\");\n    proto.state = trait(\"state\");\n    proto.city = trait(\"city\");\n    proto.region = trait(\"region\");\n}\nexports.default = default_1;\n//# sourceMappingURL=address.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Alias = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nfunction Alias(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Alias = Alias;\ninherits_1.default(Alias, facade_1.Facade);\nAlias.prototype.action = function () {\n    return \"alias\";\n};\nAlias.prototype.type = Alias.prototype.action;\nAlias.prototype.previousId = function () {\n    return this.field(\"previousId\") || this.field(\"from\");\n};\nAlias.prototype.from = Alias.prototype.previousId;\nAlias.prototype.userId = function () {\n    return this.field(\"userId\") || this.field(\"to\");\n};\nAlias.prototype.to = Alias.prototype.userId;\n//# sourceMappingURL=alias.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.clone = void 0;\nfunction clone(properties) {\n    if (typeof properties !== 'object')\n        return properties;\n    if (Object.prototype.toString.call(properties) === '[object Object]') {\n        var temp = {};\n        for (var key in properties) {\n            if (Object.prototype.hasOwnProperty.call(properties, key)) {\n                temp[key] = clone(properties[key]);\n            }\n        }\n        return temp;\n    }\n    else if (Array.isArray(properties)) {\n        return properties.map(clone);\n    }\n    else {\n        return properties;\n    }\n}\nexports.clone = clone;\n//# sourceMappingURL=clone.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delete = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nfunction Delete(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Delete = Delete;\ninherits_1.default(Delete, facade_1.Facade);\nDelete.prototype.type = function () {\n    return \"delete\";\n};\n//# sourceMappingURL=delete.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Facade = void 0;\nvar address_1 = __importDefault(require(\"./address\"));\nvar clone_1 = require(\"./clone\");\nvar is_enabled_1 = __importDefault(require(\"./is-enabled\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nvar isodate_traverse_1 = __importDefault(require(\"@segment/isodate-traverse\"));\nfunction Facade(obj, opts) {\n    opts = opts || {};\n    this.raw = clone_1.clone(obj);\n    if (!(\"clone\" in opts))\n        opts.clone = true;\n    if (opts.clone)\n        obj = clone_1.clone(obj);\n    if (!(\"traverse\" in opts))\n        opts.traverse = true;\n    if (!(\"timestamp\" in obj))\n        obj.timestamp = new Date();\n    else\n        obj.timestamp = new_date_1.default(obj.timestamp);\n    if (opts.traverse)\n        isodate_traverse_1.default(obj);\n    this.opts = opts;\n    this.obj = obj;\n}\nexports.Facade = Facade;\nvar f = Facade.prototype;\nf.proxy = function (field) {\n    var fields = field.split(\".\");\n    field = fields.shift();\n    var obj = this[field] || this.obj[field];\n    if (!obj)\n        return obj;\n    if (typeof obj === \"function\")\n        obj = obj.call(this) || {};\n    if (fields.length === 0)\n        return this.opts.clone ? transform(obj) : obj;\n    obj = obj_case_1.default(obj, fields.join(\".\"));\n    return this.opts.clone ? transform(obj) : obj;\n};\nf.field = function (field) {\n    var obj = this.obj[field];\n    return this.opts.clone ? transform(obj) : obj;\n};\nFacade.proxy = function (field) {\n    return function () {\n        return this.proxy(field);\n    };\n};\nFacade.field = function (field) {\n    return function () {\n        return this.field(field);\n    };\n};\nFacade.multi = function (path) {\n    return function () {\n        var multi = this.proxy(path + \"s\");\n        if (Array.isArray(multi))\n            return multi;\n        var one = this.proxy(path);\n        if (one)\n            one = [this.opts.clone ? clone_1.clone(one) : one];\n        return one || [];\n    };\n};\nFacade.one = function (path) {\n    return function () {\n        var one = this.proxy(path);\n        if (one)\n            return one;\n        var multi = this.proxy(path + \"s\");\n        if (Array.isArray(multi))\n            return multi[0];\n    };\n};\nf.json = function () {\n    var ret = this.opts.clone ? clone_1.clone(this.obj) : this.obj;\n    if (this.type)\n        ret.type = this.type();\n    return ret;\n};\nf.rawEvent = function () {\n    return this.raw;\n};\nf.options = function (integration) {\n    var obj = this.obj.options || this.obj.context || {};\n    var options = this.opts.clone ? clone_1.clone(obj) : obj;\n    if (!integration)\n        return options;\n    if (!this.enabled(integration))\n        return;\n    var integrations = this.integrations();\n    var value = integrations[integration] || obj_case_1.default(integrations, integration);\n    if (typeof value !== \"object\")\n        value = obj_case_1.default(this.options(), integration);\n    return typeof value === \"object\" ? value : {};\n};\nf.context = f.options;\nf.enabled = function (integration) {\n    var allEnabled = this.proxy(\"options.providers.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = this.proxy(\"options.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = this.proxy(\"integrations.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = true;\n    var enabled = allEnabled && is_enabled_1.default(integration);\n    var options = this.integrations();\n    if (options.providers && options.providers.hasOwnProperty(integration)) {\n        enabled = options.providers[integration];\n    }\n    if (options.hasOwnProperty(integration)) {\n        var settings = options[integration];\n        if (typeof settings === \"boolean\") {\n            enabled = settings;\n        }\n        else {\n            enabled = true;\n        }\n    }\n    return !!enabled;\n};\nf.integrations = function () {\n    return (this.obj.integrations || this.proxy(\"options.providers\") || this.options());\n};\nf.active = function () {\n    var active = this.proxy(\"options.active\");\n    if (active === null || active === undefined)\n        active = true;\n    return active;\n};\nf.anonymousId = function () {\n    return this.field(\"anonymousId\") || this.field(\"sessionId\");\n};\nf.sessionId = f.anonymousId;\nf.groupId = Facade.proxy(\"options.groupId\");\nf.traits = function (aliases) {\n    var ret = this.proxy(\"options.traits\") || {};\n    var id = this.userId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"options.traits.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\nf.library = function () {\n    var library = this.proxy(\"options.library\");\n    if (!library)\n        return { name: \"unknown\", version: null };\n    if (typeof library === \"string\")\n        return { name: library, version: null };\n    return library;\n};\nf.device = function () {\n    var device = this.proxy(\"context.device\");\n    if (typeof device !== \"object\" || device === null) {\n        device = {};\n    }\n    var library = this.library().name;\n    if (device.type)\n        return device;\n    if (library.indexOf(\"ios\") > -1)\n        device.type = \"ios\";\n    if (library.indexOf(\"android\") > -1)\n        device.type = \"android\";\n    return device;\n};\nf.userAgent = Facade.proxy(\"context.userAgent\");\nf.timezone = Facade.proxy(\"context.timezone\");\nf.timestamp = Facade.field(\"timestamp\");\nf.channel = Facade.field(\"channel\");\nf.ip = Facade.proxy(\"context.ip\");\nf.userId = Facade.field(\"userId\");\naddress_1.default(f);\nfunction transform(obj) {\n    return clone_1.clone(obj);\n}\n//# sourceMappingURL=facade.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Group = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar facade_1 = require(\"./facade\");\nfunction Group(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Group = Group;\ninherits_1.default(Group, facade_1.Facade);\nvar g = Group.prototype;\ng.action = function () {\n    return \"group\";\n};\ng.type = g.action;\ng.groupId = facade_1.Facade.field(\"groupId\");\ng.created = function () {\n    var created = this.proxy(\"traits.createdAt\") ||\n        this.proxy(\"traits.created\") ||\n        this.proxy(\"properties.createdAt\") ||\n        this.proxy(\"properties.created\");\n    if (created)\n        return new_date_1.default(created);\n};\ng.email = function () {\n    var email = this.proxy(\"traits.email\");\n    if (email)\n        return email;\n    var groupId = this.groupId();\n    if (is_email_1.default(groupId))\n        return groupId;\n};\ng.traits = function (aliases) {\n    var ret = this.properties();\n    var id = this.groupId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"traits.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\ng.name = facade_1.Facade.proxy(\"traits.name\");\ng.industry = facade_1.Facade.proxy(\"traits.industry\");\ng.employees = facade_1.Facade.proxy(\"traits.employees\");\ng.properties = function () {\n    return this.field(\"traits\") || this.field(\"properties\") || {};\n};\n//# sourceMappingURL=group.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Identify = void 0;\nvar facade_1 = require(\"./facade\");\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar trim = function (str) { return str.trim(); };\nfunction Identify(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Identify = Identify;\ninherits_1.default(Identify, facade_1.Facade);\nvar i = Identify.prototype;\ni.action = function () {\n    return \"identify\";\n};\ni.type = i.action;\ni.traits = function (aliases) {\n    var ret = this.field(\"traits\") || {};\n    var id = this.userId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        var value = this[alias] == null ? this.proxy(\"traits.\" + alias) : this[alias]();\n        if (value == null)\n            continue;\n        ret[aliases[alias]] = value;\n        if (alias !== aliases[alias])\n            delete ret[alias];\n    }\n    return ret;\n};\ni.email = function () {\n    var email = this.proxy(\"traits.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\ni.created = function () {\n    var created = this.proxy(\"traits.created\") || this.proxy(\"traits.createdAt\");\n    if (created)\n        return new_date_1.default(created);\n};\ni.companyCreated = function () {\n    var created = this.proxy(\"traits.company.created\") ||\n        this.proxy(\"traits.company.createdAt\");\n    if (created) {\n        return new_date_1.default(created);\n    }\n};\ni.companyName = function () {\n    return this.proxy(\"traits.company.name\");\n};\ni.name = function () {\n    var name = this.proxy(\"traits.name\");\n    if (typeof name === \"string\") {\n        return trim(name);\n    }\n    var firstName = this.firstName();\n    var lastName = this.lastName();\n    if (firstName && lastName) {\n        return trim(firstName + \" \" + lastName);\n    }\n};\ni.firstName = function () {\n    var firstName = this.proxy(\"traits.firstName\");\n    if (typeof firstName === \"string\") {\n        return trim(firstName);\n    }\n    var name = this.proxy(\"traits.name\");\n    if (typeof name === \"string\") {\n        return trim(name).split(\" \")[0];\n    }\n};\ni.lastName = function () {\n    var lastName = this.proxy(\"traits.lastName\");\n    if (typeof lastName === \"string\") {\n        return trim(lastName);\n    }\n    var name = this.proxy(\"traits.name\");\n    if (typeof name !== \"string\") {\n        return;\n    }\n    var space = trim(name).indexOf(\" \");\n    if (space === -1) {\n        return;\n    }\n    return trim(name.substr(space + 1));\n};\ni.uid = function () {\n    return this.userId() || this.username() || this.email();\n};\ni.description = function () {\n    return this.proxy(\"traits.description\") || this.proxy(\"traits.background\");\n};\ni.age = function () {\n    var date = this.birthday();\n    var age = obj_case_1.default(this.traits(), \"age\");\n    if (age != null)\n        return age;\n    if (!(date instanceof Date))\n        return;\n    var now = new Date();\n    return now.getFullYear() - date.getFullYear();\n};\ni.avatar = function () {\n    var traits = this.traits();\n    return (obj_case_1.default(traits, \"avatar\") || obj_case_1.default(traits, \"photoUrl\") || obj_case_1.default(traits, \"avatarUrl\"));\n};\ni.position = function () {\n    var traits = this.traits();\n    return obj_case_1.default(traits, \"position\") || obj_case_1.default(traits, \"jobTitle\");\n};\ni.username = facade_1.Facade.proxy(\"traits.username\");\ni.website = facade_1.Facade.one(\"traits.website\");\ni.websites = facade_1.Facade.multi(\"traits.website\");\ni.phone = facade_1.Facade.one(\"traits.phone\");\ni.phones = facade_1.Facade.multi(\"traits.phone\");\ni.address = facade_1.Facade.proxy(\"traits.address\");\ni.gender = facade_1.Facade.proxy(\"traits.gender\");\ni.birthday = facade_1.Facade.proxy(\"traits.birthday\");\n//# sourceMappingURL=identify.js.map","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delete = exports.Screen = exports.Page = exports.Track = exports.Identify = exports.Group = exports.Alias = exports.Facade = void 0;\nvar facade_1 = require(\"./facade\");\nObject.defineProperty(exports, \"Facade\", { enumerable: true, get: function () { return facade_1.Facade; } });\nvar alias_1 = require(\"./alias\");\nObject.defineProperty(exports, \"Alias\", { enumerable: true, get: function () { return alias_1.Alias; } });\nvar group_1 = require(\"./group\");\nObject.defineProperty(exports, \"Group\", { enumerable: true, get: function () { return group_1.Group; } });\nvar identify_1 = require(\"./identify\");\nObject.defineProperty(exports, \"Identify\", { enumerable: true, get: function () { return identify_1.Identify; } });\nvar track_1 = require(\"./track\");\nObject.defineProperty(exports, \"Track\", { enumerable: true, get: function () { return track_1.Track; } });\nvar page_1 = require(\"./page\");\nObject.defineProperty(exports, \"Page\", { enumerable: true, get: function () { return page_1.Page; } });\nvar screen_1 = require(\"./screen\");\nObject.defineProperty(exports, \"Screen\", { enumerable: true, get: function () { return screen_1.Screen; } });\nvar delete_1 = require(\"./delete\");\nObject.defineProperty(exports, \"Delete\", { enumerable: true, get: function () { return delete_1.Delete; } });\nexports.default = __assign(__assign({}, facade_1.Facade), { Alias: alias_1.Alias,\n    Group: group_1.Group,\n    Identify: identify_1.Identify,\n    Track: track_1.Track,\n    Page: page_1.Page,\n    Screen: screen_1.Screen,\n    Delete: delete_1.Delete });\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar matcher = /.+\\@.+\\..+/;\nfunction isEmail(string) {\n    return matcher.test(string);\n}\nexports.default = isEmail;\n//# sourceMappingURL=is-email.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar disabled = {\n    Salesforce: true,\n};\nfunction default_1(integration) {\n    return !disabled[integration];\n}\nexports.default = default_1;\n//# sourceMappingURL=is-enabled.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Page = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nvar track_1 = require(\"./track\");\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nfunction Page(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Page = Page;\ninherits_1.default(Page, facade_1.Facade);\nvar p = Page.prototype;\np.action = function () {\n    return \"page\";\n};\np.type = p.action;\np.category = facade_1.Facade.field(\"category\");\np.name = facade_1.Facade.field(\"name\");\np.title = facade_1.Facade.proxy(\"properties.title\");\np.path = facade_1.Facade.proxy(\"properties.path\");\np.url = facade_1.Facade.proxy(\"properties.url\");\np.referrer = function () {\n    return (this.proxy(\"context.referrer.url\") ||\n        this.proxy(\"context.page.referrer\") ||\n        this.proxy(\"properties.referrer\"));\n};\np.properties = function (aliases) {\n    var props = this.field(\"properties\") || {};\n    var category = this.category();\n    var name = this.name();\n    aliases = aliases || {};\n    if (category)\n        props.category = category;\n    if (name)\n        props.name = name;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"properties.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            props[aliases[alias]] = value;\n            if (alias !== aliases[alias])\n                delete props[alias];\n        }\n    }\n    return props;\n};\np.email = function () {\n    var email = this.proxy(\"context.traits.email\") || this.proxy(\"properties.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\np.fullName = function () {\n    var category = this.category();\n    var name = this.name();\n    return name && category ? category + \" \" + name : name;\n};\np.event = function (name) {\n    return name ? \"Viewed \" + name + \" Page\" : \"Loaded a Page\";\n};\np.track = function (name) {\n    var json = this.json();\n    json.event = this.event(name);\n    json.timestamp = this.timestamp();\n    json.properties = this.properties();\n    return new track_1.Track(json, this.opts);\n};\n//# sourceMappingURL=page.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Screen = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar page_1 = require(\"./page\");\nvar track_1 = require(\"./track\");\nfunction Screen(dictionary, opts) {\n    page_1.Page.call(this, dictionary, opts);\n}\nexports.Screen = Screen;\ninherits_1.default(Screen, page_1.Page);\nScreen.prototype.action = function () {\n    return \"screen\";\n};\nScreen.prototype.type = Screen.prototype.action;\nScreen.prototype.event = function (name) {\n    return name ? \"Viewed \" + name + \" Screen\" : \"Loaded a Screen\";\n};\nScreen.prototype.track = function (name) {\n    var json = this.json();\n    json.event = this.event(name);\n    json.timestamp = this.timestamp();\n    json.properties = this.properties();\n    return new track_1.Track(json, this.opts);\n};\n//# sourceMappingURL=screen.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Track = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nvar identify_1 = require(\"./identify\");\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nfunction Track(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Track = Track;\ninherits_1.default(Track, facade_1.Facade);\nvar t = Track.prototype;\nt.action = function () {\n    return \"track\";\n};\nt.type = t.action;\nt.event = facade_1.Facade.field(\"event\");\nt.value = facade_1.Facade.proxy(\"properties.value\");\nt.category = facade_1.Facade.proxy(\"properties.category\");\nt.id = facade_1.Facade.proxy(\"properties.id\");\nt.productId = function () {\n    return (this.proxy(\"properties.product_id\") || this.proxy(\"properties.productId\"));\n};\nt.promotionId = function () {\n    return (this.proxy(\"properties.promotion_id\") ||\n        this.proxy(\"properties.promotionId\"));\n};\nt.cartId = function () {\n    return this.proxy(\"properties.cart_id\") || this.proxy(\"properties.cartId\");\n};\nt.checkoutId = function () {\n    return (this.proxy(\"properties.checkout_id\") || this.proxy(\"properties.checkoutId\"));\n};\nt.paymentId = function () {\n    return (this.proxy(\"properties.payment_id\") || this.proxy(\"properties.paymentId\"));\n};\nt.couponId = function () {\n    return (this.proxy(\"properties.coupon_id\") || this.proxy(\"properties.couponId\"));\n};\nt.wishlistId = function () {\n    return (this.proxy(\"properties.wishlist_id\") || this.proxy(\"properties.wishlistId\"));\n};\nt.reviewId = function () {\n    return (this.proxy(\"properties.review_id\") || this.proxy(\"properties.reviewId\"));\n};\nt.orderId = function () {\n    return (this.proxy(\"properties.id\") ||\n        this.proxy(\"properties.order_id\") ||\n        this.proxy(\"properties.orderId\"));\n};\nt.sku = facade_1.Facade.proxy(\"properties.sku\");\nt.tax = facade_1.Facade.proxy(\"properties.tax\");\nt.name = facade_1.Facade.proxy(\"properties.name\");\nt.price = facade_1.Facade.proxy(\"properties.price\");\nt.total = facade_1.Facade.proxy(\"properties.total\");\nt.repeat = facade_1.Facade.proxy(\"properties.repeat\");\nt.coupon = facade_1.Facade.proxy(\"properties.coupon\");\nt.shipping = facade_1.Facade.proxy(\"properties.shipping\");\nt.discount = facade_1.Facade.proxy(\"properties.discount\");\nt.shippingMethod = function () {\n    return (this.proxy(\"properties.shipping_method\") ||\n        this.proxy(\"properties.shippingMethod\"));\n};\nt.paymentMethod = function () {\n    return (this.proxy(\"properties.payment_method\") ||\n        this.proxy(\"properties.paymentMethod\"));\n};\nt.description = facade_1.Facade.proxy(\"properties.description\");\nt.plan = facade_1.Facade.proxy(\"properties.plan\");\nt.subtotal = function () {\n    var subtotal = obj_case_1.default(this.properties(), \"subtotal\");\n    var total = this.total() || this.revenue();\n    if (subtotal)\n        return subtotal;\n    if (!total)\n        return 0;\n    if (this.total()) {\n        var n = this.tax();\n        if (n)\n            total -= n;\n        n = this.shipping();\n        if (n)\n            total -= n;\n        n = this.discount();\n        if (n)\n            total += n;\n    }\n    return total;\n};\nt.products = function () {\n    var props = this.properties();\n    var products = obj_case_1.default(props, \"products\");\n    if (Array.isArray(products)) {\n        return products.filter(function (item) { return item !== null; });\n    }\n    return [];\n};\nt.quantity = function () {\n    var props = this.obj.properties || {};\n    return props.quantity || 1;\n};\nt.currency = function () {\n    var props = this.obj.properties || {};\n    return props.currency || \"USD\";\n};\nt.referrer = function () {\n    return (this.proxy(\"context.referrer.url\") ||\n        this.proxy(\"context.page.referrer\") ||\n        this.proxy(\"properties.referrer\"));\n};\nt.query = facade_1.Facade.proxy(\"options.query\");\nt.properties = function (aliases) {\n    var ret = this.field(\"properties\") || {};\n    aliases = aliases || {};\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"properties.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\nt.username = function () {\n    return (this.proxy(\"traits.username\") ||\n        this.proxy(\"properties.username\") ||\n        this.userId() ||\n        this.sessionId());\n};\nt.email = function () {\n    var email = this.proxy(\"traits.email\") ||\n        this.proxy(\"properties.email\") ||\n        this.proxy(\"options.traits.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\nt.revenue = function () {\n    var revenue = this.proxy(\"properties.revenue\");\n    var event = this.event();\n    var orderCompletedRegExp = /^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i;\n    if (!revenue && event && event.match(orderCompletedRegExp)) {\n        revenue = this.proxy(\"properties.total\");\n    }\n    return currency(revenue);\n};\nt.cents = function () {\n    var revenue = this.revenue();\n    return typeof revenue !== \"number\" ? this.value() || 0 : revenue * 100;\n};\nt.identify = function () {\n    var json = this.json();\n    json.traits = this.traits();\n    return new identify_1.Identify(json, this.opts);\n};\nfunction currency(val) {\n    if (!val)\n        return;\n    if (typeof val === \"number\") {\n        return val;\n    }\n    if (typeof val !== \"string\") {\n        return;\n    }\n    val = val.replace(/\\$/g, \"\");\n    val = parseFloat(val);\n    if (!isNaN(val)) {\n        return val;\n    }\n}\n//# sourceMappingURL=track.js.map","'use strict';\n\nvar isodate = require('@segment/isodate');\n\n/**\n * Expose `traverse`.\n */\nmodule.exports = traverse;\n\n/**\n * Recursively traverse an object or array, and convert\n * all ISO date strings parse into Date objects.\n *\n * @param {Object} input - object, array, or string to convert\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Object}\n */\nfunction traverse(input, strict) {\n  if (strict === undefined) strict = true;\n  if (input && typeof input === 'object') {\n    return traverseObject(input, strict);\n  } else if (Array.isArray(input)) {\n    return traverseArray(input, strict);\n  } else if (isodate.is(input, strict)) {\n    return isodate.parse(input);\n  }\n  return input;\n}\n\n/**\n * Object traverser helper function.\n *\n * @param {Object} obj - object to traverse\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Object}\n */\nfunction traverseObject(obj, strict) {\n  Object.keys(obj).forEach(function(key) {\n    obj[key] = traverse(obj[key], strict);\n  });\n  return obj;\n}\n\n/**\n * Array traverser helper function\n *\n * @param {Array} arr - array to traverse\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Array}\n */\nfunction traverseArray(arr, strict) {\n  arr.forEach(function(value, index) {\n    arr[index] = traverse(value, strict);\n  });\n  return arr;\n}\n","'use strict';\n\n/**\n * Matcher, slightly modified from:\n *\n * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js\n */\n\nvar matcher = /^(\\d{4})(?:-?(\\d{2})(?:-?(\\d{2}))?)?(?:([ T])(\\d{2}):?(\\d{2})(?::?(\\d{2})(?:[,\\.](\\d{1,}))?)?(?:(Z)|([+\\-])(\\d{2})(?::?(\\d{2}))?)?)?$/;\n\n/**\n * Convert an ISO date string to a date. Fallback to native `Date.parse`.\n *\n * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js\n *\n * @param {String} iso\n * @return {Date}\n */\n\nexports.parse = function(iso) {\n  var numericKeys = [1, 5, 6, 7, 11, 12];\n  var arr = matcher.exec(iso);\n  var offset = 0;\n\n  // fallback to native parsing\n  if (!arr) {\n    return new Date(iso);\n  }\n\n  /* eslint-disable no-cond-assign */\n  // remove undefined values\n  for (var i = 0, val; val = numericKeys[i]; i++) {\n    arr[val] = parseInt(arr[val], 10) || 0;\n  }\n  /* eslint-enable no-cond-assign */\n\n  // allow undefined days and months\n  arr[2] = parseInt(arr[2], 10) || 1;\n  arr[3] = parseInt(arr[3], 10) || 1;\n\n  // month is 0-11\n  arr[2]--;\n\n  // allow abitrary sub-second precision\n  arr[8] = arr[8] ? (arr[8] + '00').substring(0, 3) : 0;\n\n  // apply timezone if one exists\n  if (arr[4] === ' ') {\n    offset = new Date().getTimezoneOffset();\n  } else if (arr[9] !== 'Z' && arr[10]) {\n    offset = arr[11] * 60 + arr[12];\n    if (arr[10] === '+') {\n      offset = 0 - offset;\n    }\n  }\n\n  var millis = Date.UTC(arr[1], arr[2], arr[3], arr[5], arr[6] + offset, arr[7], arr[8]);\n  return new Date(millis);\n};\n\n\n/**\n * Checks whether a `string` is an ISO date string. `strict` mode requires that\n * the date string at least have a year, month and date.\n *\n * @param {String} string\n * @param {Boolean} strict\n * @return {Boolean}\n */\n\nexports.is = function(string, strict) {\n  if (typeof string !== 'string') {\n    return false;\n  }\n  if (strict && (/^\\d{4}-\\d{2}-\\d{2}/).test(string) === false) {\n    return false;\n  }\n  return matcher.test(string);\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","\"use strict\";\n\nvar isodate = require(\"@segment/isodate\");\nvar milliseconds = require(\"./milliseconds\");\nvar seconds = require(\"./seconds\");\n\nvar objProto = Object.prototype;\nvar toStr = objProto.toString;\n\nfunction isDate(value) {\n  return toStr.call(value) === \"[object Date]\";\n}\n\nfunction isNumber(value) {\n  return toStr.call(value) === \"[object Number]\";\n}\n\n/**\n * Returns a new Javascript Date object, allowing a variety of extra input types\n * over the native Date constructor.\n *\n * @param {Date|string|number} val\n */\nmodule.exports = function newDate(val) {\n  if (isDate(val)) return val;\n  if (isNumber(val)) return new Date(toMs(val));\n\n  // date strings\n  if (isodate.is(val)) {\n    return isodate.parse(val);\n  }\n  if (milliseconds.is(val)) {\n    return milliseconds.parse(val);\n  }\n  if (seconds.is(val)) {\n    return seconds.parse(val);\n  }\n\n  // fallback to Date.parse\n  return new Date(val);\n};\n\n/**\n * If the number passed val is seconds from the epoch, turn it into milliseconds.\n * Milliseconds would be greater than 31557600000 (December 31, 1970).\n *\n * @param {number} num\n */\nfunction toMs(num) {\n  if (num < 31557600000) return num * 1000;\n  return num;\n}\n","\"use strict\";\n\n/**\n * Matcher.\n */\n\nvar matcher = /\\d{13}/;\n\n/**\n * Check whether a string is a millisecond date string.\n *\n * @param {string} string\n * @return {boolean}\n */\nexports.is = function (string) {\n  return matcher.test(string);\n};\n\n/**\n * Convert a millisecond string to a date.\n *\n * @param {string} millis\n * @return {Date}\n */\nexports.parse = function (millis) {\n  millis = parseInt(millis, 10);\n  return new Date(millis);\n};\n","\"use strict\";\n\n/**\n * Matcher.\n */\n\nvar matcher = /\\d{10}/;\n\n/**\n * Check whether a string is a second date string.\n *\n * @param {string} string\n * @return {Boolean}\n */\nexports.is = function (string) {\n  return matcher.test(string);\n};\n\n/**\n * Convert a second string to a date.\n *\n * @param {string} seconds\n * @return {Date}\n */\nexports.parse = function (seconds) {\n  var millis = parseInt(seconds, 10) * 1000;\n  return new Date(millis);\n};\n","\nvar identity = function(_){ return _; };\n\n\n/**\n * Module exports, export\n */\n\nmodule.exports = multiple(find);\nmodule.exports.find = module.exports;\n\n\n/**\n * Export the replacement function, return the modified object\n */\n\nmodule.exports.replace = function (obj, key, val, options) {\n  multiple(replace).call(this, obj, key, val, options);\n  return obj;\n};\n\n\n/**\n * Export the delete function, return the modified object\n */\n\nmodule.exports.del = function (obj, key, options) {\n  multiple(del).call(this, obj, key, null, options);\n  return obj;\n};\n\n\n/**\n * Compose applying the function to a nested key\n */\n\nfunction multiple (fn) {\n  return function (obj, path, val, options) {\n    var normalize = options && isFunction(options.normalizer) ? options.normalizer : defaultNormalize;\n    path = normalize(path);\n\n    var key;\n    var finished = false;\n\n    while (!finished) loop();\n\n    function loop() {\n      for (key in obj) {\n        var normalizedKey = normalize(key);\n        if (0 === path.indexOf(normalizedKey)) {\n          var temp = path.substr(normalizedKey.length);\n          if (temp.charAt(0) === '.' || temp.length === 0) {\n            path = temp.substr(1);\n            var child = obj[key];\n\n            // we're at the end and there is nothing.\n            if (null == child) {\n              finished = true;\n              return;\n            }\n\n            // we're at the end and there is something.\n            if (!path.length) {\n              finished = true;\n              return;\n            }\n\n            // step into child\n            obj = child;\n\n            // but we're done here\n            return;\n          }\n        }\n      }\n\n      key = undefined;\n      // if we found no matching properties\n      // on the current object, there's no match.\n      finished = true;\n    }\n\n    if (!key) return;\n    if (null == obj) return obj;\n\n    // the `obj` and `key` is one above the leaf object and key, so\n    // start object: { a: { 'b.c': 10 } }\n    // end object: { 'b.c': 10 }\n    // end key: 'b.c'\n    // this way, you can do `obj[key]` and get `10`.\n    return fn(obj, key, val);\n  };\n}\n\n\n/**\n * Find an object by its key\n *\n * find({ first_name : 'Calvin' }, 'firstName')\n */\n\nfunction find (obj, key) {\n  if (obj.hasOwnProperty(key)) return obj[key];\n}\n\n\n/**\n * Delete a value for a given key\n *\n * del({ a : 'b', x : 'y' }, 'X' }) -> { a : 'b' }\n */\n\nfunction del (obj, key) {\n  if (obj.hasOwnProperty(key)) delete obj[key];\n  return obj;\n}\n\n\n/**\n * Replace an objects existing value with a new one\n *\n * replace({ a : 'b' }, 'a', 'c') -> { a : 'c' }\n */\n\nfunction replace (obj, key, val) {\n  if (obj.hasOwnProperty(key)) obj[key] = val;\n  return obj;\n}\n\n/**\n * Normalize a `dot.separated.path`.\n *\n * A.HELL(!*&#(!)O_WOR   LD.bar => ahelloworldbar\n *\n * @param {String} path\n * @return {String}\n */\n\nfunction defaultNormalize(path) {\n  return path.replace(/[^a-zA-Z0-9\\.]+/g, '').toLowerCase();\n}\n\n/**\n * Check if a value is a function.\n *\n * @param {*} val\n * @return {boolean} Returns `true` if `val` is a function, otherwise `false`.\n */\n\nfunction isFunction(val) {\n  return typeof val === 'function';\n}\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash.slice()\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} [raw] True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","/**\n * Tries to gets the unencoded version of an encoded component of a\n * Uniform Resource Identifier (URI). If input string is malformed,\n * returns it back as-is.\n *\n * Note: All occurences of the `+` character become ` ` (spaces).\n **/\nexport function gracefulDecodeURIComponent(\n  encodedURIComponent: string\n): string {\n  try {\n    return decodeURIComponent(encodedURIComponent.replace(/\\+/g, ' '))\n  } catch {\n    return encodedURIComponent\n  }\n}\n","import {\n  Facade,\n  Identify,\n  Options,\n  Track,\n} from '@segment/facade'\nimport { TronicEvent } from '../core/events'\n\nexport type TronicFacade = Facade<TronicEvent> & {\n  obj: TronicEvent\n}\n\nexport function toFacade(evt: TronicEvent, options?: Options): TronicFacade {\n  let fcd = new Facade(evt, options)\n\n  if (evt.type === 'track') {\n    fcd = new Track(evt, options)\n  }\n\n  if (evt.type === 'identify') {\n    fcd = new Identify(evt, options)\n  }\n\n  /*\n  if (evt.type === 'page') {\n    fcd = new Page(evt, options)\n  }\n\n  if (evt.type === 'alias') {\n    fcd = new Alias(evt, options)\n  }\n\n  if (evt.type === 'group') {\n    fcd = new Group(evt, options)\n  }\n\n  if (evt.type === 'screen') {\n    fcd = new Screen(evt, options)\n  }\n   */\n\n  Object.defineProperty(fcd, 'obj', {\n    value: evt,\n    writable: true,\n  })\n\n  return fcd as TronicFacade\n}\n","import { Context, ContextCancelation } from '../../core/context'\nimport { TronicEvent } from '../../core/events'\nimport { Plugin } from '../../core/plugin'\nimport { TronicFacade, toFacade } from '../../lib/to-facade'\n\nexport interface MiddlewareParams {\n  payload: TronicFacade\n\n  // integrations?: TronicEvent['integrations']\n  next: (payload: MiddlewareParams['payload'] | null) => void\n}\n\nexport interface DestinationMiddlewareParams {\n  payload: TronicFacade\n  // integration: string\n  next: (payload: MiddlewareParams['payload'] | null) => void\n}\n\nexport type MiddlewareFunction = (\n  middleware: MiddlewareParams\n) => void | Promise<void>\n\nexport type DestinationMiddlewareFunction = (\n  middleware: DestinationMiddlewareParams\n) => void | Promise<void>\n\nexport async function applyDestinationMiddleware(\n  destination: string,\n  evt: TronicEvent,\n  middleware: DestinationMiddlewareFunction[]\n): Promise<TronicEvent | null> {\n  // Clone the event so mutations are localized to a single destination.\n  let modifiedEvent = toFacade(evt, {\n    clone: true,\n    traverse: false,\n  }).rawEvent() as TronicEvent\n  async function applyMiddleware(\n    event: TronicEvent,\n    fn: DestinationMiddlewareFunction\n  ): Promise<TronicEvent | null> {\n    let nextCalled = false\n    let returnedEvent: TronicEvent | null = null\n\n    await fn({\n      payload: toFacade(event, {\n        clone: true,\n        traverse: false,\n      }),\n      // integration: destination,\n      next(evt) {\n        nextCalled = true\n\n        if (evt === null) {\n          returnedEvent = null\n        }\n\n        if (evt) {\n          returnedEvent = evt.obj\n        }\n      },\n    })\n\n    if (!nextCalled && returnedEvent !== null) {\n      returnedEvent = returnedEvent as TronicEvent\n        /*\n      returnedEvent.integrations = {\n        ...event.integrations,\n        [destination]: false,\n      }\n         */\n    }\n\n    return returnedEvent\n  }\n\n  for (const md of middleware) {\n    const result = await applyMiddleware(modifiedEvent, md)\n    if (result === null) {\n      return null\n    }\n    modifiedEvent = result\n  }\n\n  return modifiedEvent\n}\n\nexport function sourceMiddlewarePlugin(\n  fn: MiddlewareFunction,\n  // integrations: TronicEvent['integrations']\n): Plugin {\n  async function apply(ctx: Context): Promise<Context> {\n    let nextCalled = false\n\n    await fn({\n      payload: toFacade(ctx.event, {\n        clone: true,\n        traverse: false,\n      }),\n      // integrations: integrations ?? {},\n      next(evt) {\n        nextCalled = true\n        if (evt) {\n          ctx.event = evt.obj\n        }\n      },\n    })\n\n    if (!nextCalled) {\n      throw new ContextCancelation({\n        retry: false,\n        type: 'middleware_cancellation',\n        reason: 'Middleware `next` function skipped',\n      })\n    }\n\n    return ctx\n  }\n\n  return {\n    name: `Source Middleware ${fn.name}`,\n    type: 'before',\n    version: '0.1.0',\n\n    isLoaded: (): boolean => true,\n    load: (ctx): Promise<Context> => Promise.resolve(ctx),\n\n    track: apply,\n    identify: apply,\n  }\n}\n","export function pTimeout(promise, timeout) {\n    return new Promise(function (resolve, reject) {\n        var timeoutId = setTimeout(function () {\n            reject(Error('Promise timed out'));\n        }, timeout);\n        promise\n            .then(function (val) {\n            clearTimeout(timeoutId);\n            return resolve(val);\n        })\n            .catch(reject);\n    });\n}\nexport function sleep(timeoutInMs) {\n    return new Promise(function (resolve) { return setTimeout(resolve, timeoutInMs); });\n}\n/**\n * @param ctx\n * @param callback - the function to invoke\n * @param delay - aka \"timeout\". The amount of time in ms to wait before invoking the callback.\n */\nexport function invokeCallback(ctx, callback, delay) {\n    var cb = function () {\n        try {\n            return Promise.resolve(callback(ctx));\n        }\n        catch (err) {\n            return Promise.reject(err);\n        }\n    };\n    return (sleep(delay)\n        // pTimeout ensures that the callback can't cause the context to hang\n        .then(function () { return pTimeout(cb(), 1000); })\n        .catch(function (err) {\n        ctx === null || ctx === void 0 ? void 0 : ctx.log('warn', 'Callback Error', { error: err });\n        ctx === null || ctx === void 0 ? void 0 : ctx.stats.increment('callback_error');\n    })\n        .then(function () { return ctx; }));\n}\n//# sourceMappingURL=index.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar CoreLogger = /** @class */ (function () {\n    function CoreLogger() {\n        this._logs = [];\n    }\n    CoreLogger.prototype.log = function (level, message, extras) {\n        var time = new Date();\n        this._logs.push({\n            level: level,\n            message: message,\n            time: time,\n            extras: extras,\n        });\n    };\n    Object.defineProperty(CoreLogger.prototype, \"logs\", {\n        get: function () {\n            return this._logs;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CoreLogger.prototype.flush = function () {\n        if (this.logs.length > 1) {\n            var formatted = this._logs.reduce(function (logs, log) {\n                var _a;\n                var _b, _c;\n                var line = __assign(__assign({}, log), { json: JSON.stringify(log.extras, null, ' '), extras: log.extras });\n                delete line['time'];\n                var key = (_c = (_b = log.time) === null || _b === void 0 ? void 0 : _b.toISOString()) !== null && _c !== void 0 ? _c : '';\n                if (logs[key]) {\n                    key = \"\".concat(key, \"-\").concat(Math.random());\n                }\n                return __assign(__assign({}, logs), (_a = {}, _a[key] = line, _a));\n            }, {});\n            // ie doesn't like console.table\n            if (console.table) {\n                console.table(formatted);\n            }\n            else {\n                console.log(formatted);\n            }\n        }\n        else {\n            this.logs.forEach(function (logEntry) {\n                var level = logEntry.level, message = logEntry.message, extras = logEntry.extras;\n                if (level === 'info' || level === 'debug') {\n                    console.log(message, extras !== null && extras !== void 0 ? extras : '');\n                }\n                else {\n                    console[level](message, extras !== null && extras !== void 0 ? extras : '');\n                }\n            });\n        }\n        this._logs = [];\n    };\n    return CoreLogger;\n}());\nexport { CoreLogger };\n//# sourceMappingURL=index.js.map","import { v4 as uuid } from '@lukeed/uuid';\nimport { dset } from 'dset';\nimport { CoreLogger } from '../logger';\nimport { NullStats } from '../stats';\nvar ContextCancelation = /** @class */ (function () {\n    function ContextCancelation(options) {\n        var _a, _b, _c;\n        this.retry = (_a = options.retry) !== null && _a !== void 0 ? _a : true;\n        this.type = (_b = options.type) !== null && _b !== void 0 ? _b : 'plugin Error';\n        this.reason = (_c = options.reason) !== null && _c !== void 0 ? _c : '';\n    }\n    return ContextCancelation;\n}());\nexport { ContextCancelation };\nvar CoreContext = /** @class */ (function () {\n    function CoreContext(event, id, stats, logger) {\n        if (id === void 0) { id = uuid(); }\n        if (stats === void 0) { stats = new NullStats(); }\n        if (logger === void 0) { logger = new CoreLogger(); }\n        this.attempts = 0;\n        this.event = event;\n        this._id = id;\n        this.logger = logger;\n        this.stats = stats;\n    }\n    CoreContext.system = function () {\n        // This should be overridden by the subclass to return an instance of the subclass.\n    };\n    CoreContext.prototype.isSame = function (other) {\n        return other.id === this.id;\n    };\n    CoreContext.prototype.cancel = function (error) {\n        if (error) {\n            throw error;\n        }\n        throw new ContextCancelation({ reason: 'Context Cancel' });\n    };\n    CoreContext.prototype.log = function (level, message, extras) {\n        this.logger.log(level, message, extras);\n    };\n    Object.defineProperty(CoreContext.prototype, \"id\", {\n        get: function () {\n            return this._id;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CoreContext.prototype.updateEvent = function (path, val) {\n        // Don't allow integrations that are set to false to be overwritten with integration settings.\n        /*\n        if (path.split('.')[0] === 'integrations') {\n          const integrationName = path.split('.')[1]\n    \n          if (this.event.integrations?.[integrationName] === false) {\n            return this.event\n          }\n        }\n          */\n        dset(this.event, path, val);\n        return this.event;\n    };\n    CoreContext.prototype.failedDelivery = function () {\n        return this._failedDelivery;\n    };\n    CoreContext.prototype.setFailedDelivery = function (options) {\n        this._failedDelivery = options;\n    };\n    CoreContext.prototype.logs = function () {\n        return this.logger.logs;\n    };\n    CoreContext.prototype.flush = function () {\n        this.logger.flush();\n        this.stats.flush();\n    };\n    CoreContext.prototype.toJSON = function () {\n        return {\n            id: this._id,\n            event: this.event,\n            logs: this.logger.logs,\n            metrics: this.stats.metrics,\n        };\n    };\n    return CoreContext;\n}());\nexport { CoreContext };\n//# sourceMappingURL=index.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar compactMetricType = function (type) {\n    var enums = {\n        gauge: 'g',\n        counter: 'c',\n    };\n    return enums[type];\n};\nvar CoreStats = /** @class */ (function () {\n    function CoreStats() {\n        this.metrics = [];\n    }\n    CoreStats.prototype.increment = function (metric, by, tags) {\n        if (by === void 0) { by = 1; }\n        this.metrics.push({\n            metric: metric,\n            value: by,\n            tags: tags !== null && tags !== void 0 ? tags : [],\n            type: 'counter',\n            timestamp: Date.now(),\n        });\n    };\n    CoreStats.prototype.gauge = function (metric, value, tags) {\n        this.metrics.push({\n            metric: metric,\n            value: value,\n            tags: tags !== null && tags !== void 0 ? tags : [],\n            type: 'gauge',\n            timestamp: Date.now(),\n        });\n    };\n    CoreStats.prototype.flush = function () {\n        var formatted = this.metrics.map(function (m) { return (__assign(__assign({}, m), { tags: m.tags.join(',') })); });\n        // ie doesn't like console.table\n        if (console.table) {\n            console.table(formatted);\n        }\n        else {\n            console.log(formatted);\n        }\n        this.metrics = [];\n    };\n    /**\n     * compact keys for smaller payload\n     */\n    CoreStats.prototype.serialize = function () {\n        return this.metrics.map(function (m) {\n            return {\n                m: m.metric,\n                v: m.value,\n                t: m.tags,\n                k: compactMetricType(m.type),\n                e: m.timestamp,\n            };\n        });\n    };\n    return CoreStats;\n}());\nexport { CoreStats };\nvar NullStats = /** @class */ (function (_super) {\n    __extends(NullStats, _super);\n    function NullStats() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NullStats.prototype.gauge = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.increment = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.flush = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.serialize = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n        return [];\n    };\n    return NullStats;\n}(CoreStats));\nexport { NullStats };\n//# sourceMappingURL=index.js.map","export function isString(obj) {\n    return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n    return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n    return typeof obj === 'function';\n}\nexport function exists(val) {\n    return val !== undefined && val !== null;\n}\nexport function isPlainObject(obj) {\n    return (Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object');\n}\n//# sourceMappingURL=helpers.js.map","var IDX=256, HEX=[], BUFFER;\nwhile (IDX--) HEX[IDX] = (IDX + 256).toString(16).substring(1);\n\nexport function v4() {\n\tvar i=0, num, out='';\n\n\tif (!BUFFER || ((IDX + 16) > 256)) {\n\t\tBUFFER = Array(i=256);\n\t\twhile (i--) BUFFER[i] = 256 * Math.random() | 0;\n\t\ti = IDX = 0;\n\t}\n\n\tfor (; i < 16; i++) {\n\t\tnum = BUFFER[IDX + i];\n\t\tif (i==6) out += HEX[num & 15 | 64];\n\t\telse if (i==8) out += HEX[num & 63 | 128];\n\t\telse out += HEX[num];\n\n\t\tif (i & 1 && i > 1 && i < 11) out += '-';\n\t}\n\n\tIDX++;\n\treturn out;\n}\n","export function dset(obj, keys, val) {\n\tkeys.split && (keys=keys.split('.'));\n\tvar i=0, l=keys.length, t=obj, x, k;\n\twhile (i < l) {\n\t\tk = keys[i++];\n\t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n\t\tt = t[k] = (i === l) ? val : (typeof(x=t[k])===typeof(keys)) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + {\"96\":\"queryString\",\"119\":\"auto-track\"}[chunkId] + \".bundle.\" + {\"96\":\"35511edd91b384c499b3\",\"119\":\"551b24328bb3e8c917f0\"}[chunkId] + \".js\";\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var inProgress = {};\nvar dataWebpackPrefix = \"@tronic/receiver-browser:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = function(url, done, key, chunkId) {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function(prev, event) {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach(function(fn) { return fn(event); });\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t826: 0\n};\n\n__webpack_require__.f.j = function(chunkId, promises) {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise(function(resolve, reject) { installedChunkData = installedChunks[chunkId] = [resolve, reject]; });\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = function(event) {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_tronic_receiver_browser\"] = self[\"webpackChunk_tronic_receiver_browser\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { ReceiverSnippet } from '../browser/standalone-interface'\n\n/**\n * Stores the global window receiver key\n */\nlet _globalReceiverKey = 'receiver'\n\n/**\n * Gets the global receiver/buffer\n * @param key name of the window property where the buffer is stored (default: receiver)\n * @returns ReceiverSnippet\n */\nexport function getGlobalReceiver(): ReceiverSnippet | undefined {\n  return (window as any)[_globalReceiverKey]\n}\n\n/**\n * Replaces the global window key for the receiver/buffer object\n * @param key key name\n */\nexport function setGlobalReceiverKey(key: string) {\n  _globalReceiverKey = key\n}\n\n/**\n * Sets the global receiver object\n * @param receiver receiver snippet\n */\nexport function setGlobalReceiver(receiver: ReceiverSnippet): void {\n  ;(window as any)[_globalReceiverKey] = receiver\n}\n","import { getGlobalReceiver } from './global-receiver-helper'\nimport { embeddedWriteKey } from './embedded-write-key'\n\nconst receiverScriptRegex =\n  /(https:\\/\\/.*)\\/receiver\\.js\\/v1\\/(?:.*?)\\/(?:platform|receiver.*)?/\nconst getCDNUrlFromScriptTag = (): string | undefined => {\n  let cdn: string | undefined\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  scripts.forEach((s) => {\n    const src = s.getAttribute('src') ?? ''\n    const result = receiverScriptRegex.exec(src)\n\n    if (result && result[1]) {\n      cdn = result[1]\n    }\n  })\n  return cdn\n}\n\nlet _globalCDN: string | undefined // set globalCDN as in-memory singleton\nconst getGlobalCDNUrl = (): string | undefined => {\n  const result = _globalCDN ?? getGlobalReceiver()?._cdn\n  return result\n}\n\nexport const setGlobalCDNUrl = (cdn: string) => {\n  const globalReceiver = getGlobalReceiver()\n  if (globalReceiver) {\n    globalReceiver._cdn = cdn\n  }\n  _globalCDN = cdn\n}\n\nexport const getCDN = (): string => {\n  const globalCdnUrl = getGlobalCDNUrl()\n\n  if (globalCdnUrl) return globalCdnUrl\n\n  const cdnFromScriptTag = getCDNUrlFromScriptTag()\n\n  if (cdnFromScriptTag) {\n    return cdnFromScriptTag\n  } else {\n    // it's possible that the CDN is not found in the page because:\n    // - the script is loaded through a proxy\n    // - the script is removed after execution\n    // in this case, we fall back to the default Tronic CDN\n    return `https://cdn.tronic.com`\n  }\n}\n\nexport const getNextIntegrationsURL = () => {\n  const cdn = getCDN()\n  return `${cdn}/next-integrations`\n}\n\n/**\n * Replaces the CDN URL in the script tag with the one from Receiver.js 1.0\n *\n * @returns the path to Receiver JS 1.0\n **/\nexport function getLegacyAJSPath(): string {\n  const writeKey = embeddedWriteKey() ?? getGlobalReceiver()?._writeKey\n\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  let path: string | undefined = undefined\n\n  for (const s of scripts) {\n    const src = s.getAttribute('src') ?? ''\n    const result = receiverScriptRegex.exec(src)\n\n    if (result && result[1]) {\n      path = src\n      break\n    }\n  }\n\n  if (path) {\n    return path.replace('receiver.min.js', 'receiver.classic.js')\n  }\n\n  return `https://cdn.tronic.com/receiver.js/v1/${writeKey}/receiver.classic.js`\n}\n","// Default value will be updated to 'web' in `bundle-umd.ts` for web build.\nlet _version: 'web' | 'npm' = 'npm'\n\nexport function setVersionType(version: typeof _version) {\n  _version = version\n}\n\nexport function getVersionType(): typeof _version {\n  return _version\n}\n","import {\n  isFunction,\n  isPlainObject,\n  isString,\n  isNumber,\n} from '@tronic/receiver-core'\nimport { Context } from '../context'\nimport {\n  Callback,\n  JSONObject,\n  Options,\n  EventProperties,\n  TronicEvent,\n  Traits,\n  UserTraits,\n} from '../events'\nimport { ID, User } from '../user'\n\n/**\n * Helper for the track method\n */\nexport function resolveArguments(\n  eventOrEventName: string | TronicEvent,\n  channelId?: string,\n  properties?: EventProperties | Callback,\n  options?: Options | Callback,\n  callback?: Callback\n): [string, string | undefined, EventProperties | Callback, Options, Callback | undefined] {\n  const args = [eventOrEventName, channelId, properties, options, callback]\n\n  const name = isPlainObject(eventOrEventName) ? eventOrEventName.event : eventOrEventName\n  if (!name || !isString(name)) {\n    throw new Error('Event missing')\n  }\n\n  const data = isPlainObject(eventOrEventName)\n    ? eventOrEventName.properties ?? {}\n    : isPlainObject(properties)\n      ? properties\n      : {}\n\n  let opts: Options = {}\n  if (!isFunction(options)) {\n    opts = options ?? {}\n  }\n\n  if (isPlainObject(eventOrEventName) && !isFunction(properties)) {\n    opts = properties ?? {}\n  }\n\n  const cb = args.find(isFunction) as Callback | undefined\n  return [name, channelId, data, opts, cb]\n}\n\n/**\n * Helper for group, identify methods\n */\nexport const resolveUserArguments = <T extends Traits, U extends User>(\n  user: U\n): ResolveUser<T> => {\n  return (...args): ReturnType<ResolveUser<T>> => {\n\n    /*\n    const values: {\n      id?: ID\n      traits?: T | null\n      options?: Options\n      callback?: Callback\n      } = {}\n     */\n\n    const x = args[1]\n\n    return [\n      args[0],\n      (args[1] ?? user.id()) as ID,\n      (args[2] ?? {}) as T ,\n      args[3] ?? {},\n      args[4],\n    ];\n\n    /*\n        const values: {\n          channelId?: string\n          id?: ID\n          traits?: T | null\n          options?: Options\n          callback?: Callback\n        } = {}\n        // It's a stack so it's reversed so that we go through each of the expected arguments\n        const orderStack: Array<keyof typeof values> = [\n          'callback',\n          'options',\n          'traits',\n          'id',\n          'channelId',\n        ]\n\n        // Read each argument and eval the possible values here\n        for (const arg of args) {\n          let current = orderStack.pop()\n          if (current === 'id') {\n            if (isString(arg) || isNumber(arg)) {\n              values.id = arg.toString()\n              continue\n            }\n            if (arg === null || arg === undefined) {\n              continue\n            }\n            // First argument should always be the id, if it is not a valid value we can skip it\n            current = orderStack.pop()\n          }\n\n          // Traits and Options\n          if (\n            (current === 'traits' || current === 'options') &&\n            (arg === null || arg === undefined || isPlainObject(arg))\n          ) {\n            values[current] = arg as T\n          }\n\n          // Callback\n          if (isFunction(arg)) {\n            values.callback = arg as Callback\n            break // This is always the last argument\n          }\n        }\n\n        return [\n          values.channelId,\n          values.id ?? user.id(),\n          (values.traits ?? {}) as T,\n          values.options ?? {},\n          values.callback,\n        ]\n          */\n    // return args;\n  }\n}\n\ntype ResolveUser<T extends Record<string, string>> = (\n  channelId: string,\n  id?: ID | object,\n  traits?: T | Callback | null,\n  options?: Options | Callback,\n  callback?: Callback\n) => [string, ID, T, Options | undefined, Callback | undefined]\n\nexport type IdentifyParams = Parameters<ResolveUser<UserTraits>>\nexport type EventParams = Parameters<typeof resolveArguments>\n\nexport type DispatchedEvent = Context\n","export function isBrowser(): boolean {\n  return typeof window !== 'undefined'\n}\n\nexport function isServer(): boolean {\n  return !isBrowser()\n}\n","import { isBrowser } from '../environment'\n\nexport function isOnline(): boolean {\n  if (isBrowser()) {\n    return window.navigator.onLine\n  }\n\n  return true\n}\n\nexport function isOffline(): boolean {\n  return !isOnline()\n}\n","export default function(e,n){return n=n||{},new Promise(function(t,r){var s=new XMLHttpRequest,o=[],u=[],i={},a=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(s.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:a,headers:{keys:function(){return o},entries:function(){return u},get:function(e){return i[e.toLowerCase()]},has:function(e){return e.toLowerCase()in i}}}};for(var l in s.open(n.method||\"get\",e,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm,function(e,n,t){o.push(n=n.toLowerCase()),u.push([n,t]),i[n]=i[n]?i[n]+\",\"+t:t}),t(a())},s.onerror=r,s.withCredentials=\"include\"==n.credentials,n.headers)s.setRequestHeader(l,n.headers[l]);s.send(n.body||null)})}\n//# sourceMappingURL=unfetch.module.js.map\n","// This an imperfect polyfill for globalThis\nexport const getGlobal = () => {\n  if (typeof globalThis !== 'undefined') {\n    return globalThis\n  }\n  if (typeof self !== 'undefined') {\n    return self\n  }\n  if (typeof window !== 'undefined') {\n    return window\n  }\n  if (typeof global !== 'undefined') {\n    return global\n  }\n  return null\n}\n","import unfetch from 'unfetch'\nimport { getGlobal } from './get-global'\n\n/**\n * Wrapper around native `fetch` containing `unfetch` fallback.\n */\n// @ts-ignore\nexport const fetch: typeof global.fetch = (...args) => {\n  const global = getGlobal()\n  // @ts-ignore\n  return ((global && global.fetch) || unfetch)(...args)\n}\n","// This file is generated.\nexport const version = '0.0.1'\n","export const TRONIC_API_HOST = 'prod-api.tronic.app'\n","import { fetch } from '../../lib/fetch'\nimport { version } from '../../generated/version'\nimport { getVersionType } from '../../lib/version-type'\nimport { TRONIC_API_HOST } from '../constants'\n\nexport interface MetricsOptions {\n  host?: string\n  sampleRate?: number\n  flushTimer?: number\n  maxQueueSize?: number\n}\n\n/**\n * Type expected by the tronic metrics API endpoint\n */\ntype RemoteMetric = {\n  type: 'Counter'\n  metric: string\n  value: 1\n  tags: {\n    library: string\n    library_version: string\n    [key: string]: string\n  }\n}\n\nconst createRemoteMetric = (\n  metric: string,\n  tags: string[],\n  versionType: 'web' | 'npm'\n): RemoteMetric => {\n  const formattedTags = tags.reduce((acc, t) => {\n    const [k, v] = t.split(':')\n    acc[k] = v\n    return acc\n  }, {} as Record<string, string>)\n\n  return {\n    type: 'Counter',\n    metric,\n    value: 1,\n    tags: {\n      ...formattedTags,\n      library: 'receiver.js',\n      library_version:\n        versionType === 'web' ? `next-${version}` : `npm:next-${version}`,\n    },\n  }\n}\n\nfunction logError(err: unknown): void {\n  console.error('Error sending tronic performance metrics', err)\n}\n\nexport class RemoteMetrics {\n  private host: string\n  private flushTimer: number\n  private maxQueueSize: number\n\n  sampleRate: number\n  queue: RemoteMetric[]\n\n  constructor(options?: MetricsOptions) {\n    this.host = options?.host ?? TRONIC_API_HOST\n    this.sampleRate = options?.sampleRate ?? 1\n    this.flushTimer = options?.flushTimer ?? 30 * 1000 /* 30s */\n    this.maxQueueSize = options?.maxQueueSize ?? 20\n\n    this.queue = []\n\n    if (this.sampleRate > 0) {\n      let flushing = false\n\n      const run = (): void => {\n        if (flushing) {\n          return\n        }\n\n        flushing = true\n        this.flush().catch(logError)\n\n        flushing = false\n\n        setTimeout(run, this.flushTimer)\n      }\n      run()\n    }\n  }\n\n  increment(metric: string, tags: string[]): void {\n    // All metrics are part of an allow list in Tracking API\n    if (!metric.includes('receiver_js.')) {\n      return\n    }\n\n    // /m doesn't like empty tags\n    if (tags.length === 0) {\n      return\n    }\n\n    if (Math.random() > this.sampleRate) {\n      return\n    }\n\n    if (this.queue.length >= this.maxQueueSize) {\n      return\n    }\n\n    const remoteMetric = createRemoteMetric(metric, tags, getVersionType())\n    this.queue.push(remoteMetric)\n\n    if (metric.includes('error')) {\n      this.flush().catch(logError)\n    }\n  }\n\n  async flush(): Promise<void> {\n    if (this.queue.length <= 0) {\n      return\n    }\n\n    await this.send().catch((error) => {\n      logError(error)\n      this.sampleRate = 0\n    })\n  }\n\n  private async send(): Promise<Response> {\n    const payload = { series: this.queue }\n    this.queue = []\n\n    const headers = { 'Content-Type': 'text/plain' }\n    const url = `https://${this.host}/m`\n\n    return fetch(url, {\n      headers,\n      body: JSON.stringify(payload),\n      method: 'POST',\n    })\n  }\n}\n","import { CoreStats } from '@tronic/receiver-core'\nimport { MetricsOptions, RemoteMetrics } from './remote-metrics'\n\nlet remoteMetrics: RemoteMetrics | undefined\n\nexport class Stats extends CoreStats {\n  static initRemoteMetrics(options?: MetricsOptions) {\n    remoteMetrics = new RemoteMetrics(options)\n  }\n\n  override increment(metric: string, by?: number, tags?: string[]): void {\n    super.increment(metric, by, tags)\n    remoteMetrics?.increment(metric, tags ?? [])\n  }\n}\n","import {\n  CoreContext,\n  ContextCancelation,\n  ContextFailedDelivery,\n  SerializedContext,\n  CancelationOptions,\n} from '@tronic/receiver-core'\nimport { TronicEvent } from '../events/interfaces'\nimport { Stats } from '../stats'\n\nexport class Context extends CoreContext<TronicEvent> {\n  static override system() {\n    return new this({ type: 'track', event: 'system', channelId: '' })\n  }\n  constructor(event: TronicEvent, id?: string) {\n    super(event, id, new Stats())\n  }\n}\n\nexport { ContextCancelation }\nexport type { ContextFailedDelivery, SerializedContext, CancelationOptions }\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { invokeCallback } from '../callback';\n/* The amount of time in ms to wait before invoking the callback. */\nexport var getDelay = function (startTimeInEpochMS, timeoutInMS) {\n    var elapsedTime = Date.now() - startTimeInEpochMS;\n    // increasing the timeout increases the delay by almost the same amount -- this is weird legacy behavior.\n    return Math.max((timeoutInMS !== null && timeoutInMS !== void 0 ? timeoutInMS : 300) - elapsedTime, 0);\n};\n/**\n * Push an event into the dispatch queue and invoke any callbacks.\n *\n * @param event - Event to enqueue.\n * @param queue - Queue to dispatch against.\n * @param emitter - This is typically an instance of \"Receiver\" -- used for metrics / progress information.\n * @param options\n */\nexport function dispatch(ctx, queue, emitter, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var startTime, dispatched;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    emitter.emit('dispatch_start', ctx);\n                    startTime = Date.now();\n                    if (!queue.isEmpty()) return [3 /*break*/, 2];\n                    return [4 /*yield*/, queue.dispatchSingle(ctx)];\n                case 1:\n                    dispatched = _a.sent();\n                    return [3 /*break*/, 4];\n                case 2: return [4 /*yield*/, queue.dispatch(ctx)];\n                case 3:\n                    dispatched = _a.sent();\n                    _a.label = 4;\n                case 4:\n                    if (!(options === null || options === void 0 ? void 0 : options.callback)) return [3 /*break*/, 6];\n                    return [4 /*yield*/, invokeCallback(dispatched, options.callback, getDelay(startTime, options.timeout))];\n                case 5:\n                    dispatched = _a.sent();\n                    _a.label = 6;\n                case 6:\n                    if (options === null || options === void 0 ? void 0 : options.debug) {\n                        dispatched.flush();\n                    }\n                    return [2 /*return*/, dispatched];\n            }\n        });\n    });\n}\n//# sourceMappingURL=dispatch.js.map","/**\n * Event Emitter that takes the expected contract as a generic\n * @example\n * ```ts\n *  type Contract = {\n *    delivery_success: [DeliverySuccessResponse, Metrics],\n *    delivery_failure: [DeliveryError]\n * }\n *  new Emitter<Contract>()\n *  .on('delivery_success', (res, metrics) => ...)\n *  .on('delivery_failure', (err) => ...)\n * ```\n */\nvar Emitter = /** @class */ (function () {\n    function Emitter() {\n        this.callbacks = {};\n    }\n    Emitter.prototype.on = function (event, callback) {\n        if (!this.callbacks[event]) {\n            this.callbacks[event] = [callback];\n        }\n        else {\n            this.callbacks[event].push(callback);\n        }\n        return this;\n    };\n    Emitter.prototype.once = function (event, callback) {\n        var _this = this;\n        var on = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            _this.off(event, on);\n            callback.apply(_this, args);\n        };\n        this.on(event, on);\n        return this;\n    };\n    Emitter.prototype.off = function (event, callback) {\n        var _a;\n        var fns = (_a = this.callbacks[event]) !== null && _a !== void 0 ? _a : [];\n        var without = fns.filter(function (fn) { return fn !== callback; });\n        this.callbacks[event] = without;\n        return this;\n    };\n    Emitter.prototype.emit = function (event) {\n        var _this = this;\n        var _a;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var callbacks = (_a = this.callbacks[event]) !== null && _a !== void 0 ? _a : [];\n        callbacks.forEach(function (callback) {\n            callback.apply(_this, args);\n        });\n        return this;\n    };\n    return Emitter;\n}());\nexport { Emitter };\n//# sourceMappingURL=index.js.map","import { isPlainObject } from '@tronic/receiver-core'\n\n/**\n * Final Page Context object expected in the Event context\n */\nexport interface PageContext {\n  path: string\n  referrer: string\n  search: string\n  title: string\n  url: string\n}\n\ntype CanonicalUrl = string | undefined\n\nexport const BufferedPageContextDiscriminant = 'bpc' as const\n/**\n * Page Context expected to be built by the snippet.\n * Note: The key names are super short because we want to keep the strings in the html snippet short to save bytes.\n */\nexport interface BufferedPageContext {\n  __t: typeof BufferedPageContextDiscriminant // for extra uniqeness\n  c: CanonicalUrl\n  p: PageContext['path']\n  u: PageContext['url']\n  s: PageContext['search']\n  t: PageContext['title']\n  r: PageContext['referrer']\n}\n\n/**\n * `BufferedPageContext` object builder\n */\nexport const createBufferedPageContext = (\n  url: string,\n  canonicalUrl: CanonicalUrl,\n  search: string,\n  path: string,\n  title: string,\n  referrer: string\n): BufferedPageContext => ({\n  __t: BufferedPageContextDiscriminant,\n  c: canonicalUrl,\n  p: path,\n  u: url,\n  s: search,\n  t: title,\n  r: referrer,\n})\n\n// my clever/dubious way of making sure this type guard does not get out sync with the type definition\nconst BUFFERED_PAGE_CONTEXT_KEYS = Object.keys(\n  createBufferedPageContext('', '', '', '', '', '')\n) as (keyof BufferedPageContext)[]\n\nexport function isBufferedPageContext(\n  bufferedPageCtx: unknown\n): bufferedPageCtx is BufferedPageContext {\n  if (!isPlainObject(bufferedPageCtx)) return false\n  if (bufferedPageCtx.__t !== BufferedPageContextDiscriminant) return false\n\n  // ensure obj has all the keys we expect, and none we don't.\n  for (const k in bufferedPageCtx) {\n    if (!BUFFERED_PAGE_CONTEXT_KEYS.includes(k as keyof BufferedPageContext)) {\n      return false\n    }\n  }\n  return true\n}\n\n//  Legacy logic: we are we appending search parameters to the canonical URL -- I guess the canonical URL is  \"not canonical enough\" (lol)\nconst createCanonicalURL = (canonicalUrl: string, searchParams: string) => {\n  return canonicalUrl.indexOf('?') > -1\n    ? canonicalUrl\n    : canonicalUrl + searchParams\n}\n\n/**\n * Strips hash from URL.\n */\nconst removeHash = (href: string) => {\n  const hashIdx = href.indexOf('#')\n  return hashIdx === -1 ? href : href.slice(0, hashIdx)\n}\n\nconst parseCanonicalPath = (canonicalUrl: string): string => {\n  try {\n    return new URL(canonicalUrl).pathname\n  } catch (_e) {\n    // this is classic behavior -- we assume that if the canonical URL is invalid, it's a raw path.\n    return canonicalUrl[0] === '/' ? canonicalUrl : '/' + canonicalUrl\n  }\n}\n\n/**\n * Create a `PageContext` from a `BufferedPageContext`.\n * `BufferedPageContext` keys are minified to save bytes in the snippet.\n */\nexport const createPageContext = ({\n  c: canonicalUrl,\n  p: pathname,\n  s: search,\n  u: url,\n  r: referrer,\n  t: title,\n}: BufferedPageContext): PageContext => {\n  const newPath = canonicalUrl ? parseCanonicalPath(canonicalUrl) : pathname\n  const newUrl = canonicalUrl\n    ? createCanonicalURL(canonicalUrl, search)\n    : removeHash(url)\n  return {\n    path: newPath,\n    referrer,\n    search,\n    title,\n    url: newUrl,\n  }\n}\n\n/**\n * Get page properties from the browser window/document.\n */\nexport const getDefaultBufferedPageContext = (): BufferedPageContext => {\n  const c = document.querySelector(\"link[rel='canonical']\")\n  return createBufferedPageContext(\n    location.href,\n    (c && c.getAttribute('href')) || undefined,\n    location.search,\n    location.pathname,\n    document.title,\n    document.referrer\n  )\n}\n\n/**\n * Get page properties from the browser window/document.\n */\nexport const getDefaultPageContext = (): PageContext =>\n  createPageContext(getDefaultBufferedPageContext())\n","import { pick } from '../../lib/pick'\nimport { EventProperties, TronicEvent } from '../events'\nimport { getDefaultPageContext } from './get-page-context'\n\n/**\n * Augments a Tronic event with information about the current page.\n * Page information like URL changes frequently, so this is meant to be captured as close to the event call as possible.\n * Things like `userAgent` do not change, so they can be added later in the flow.\n * We prefer not to add this information to this function, as it increases the main bundle size.\n */\nexport const addPageContext = (\n  event: TronicEvent,\n  pageCtx = getDefaultPageContext()\n): void => {\n  const evtCtx = event.context! // Context should be set earlier in the flow\n  let pageContextFromEventProps: Pick<EventProperties, string> | undefined\n  /*\n  if (event.type === 'page') {\n    pageContextFromEventProps =\n      event.properties && pick(event.properties, Object.keys(pageCtx))\n\n    event.properties = {\n      ...pageCtx,\n      ...event.properties,\n      ...(event.name ? { name: event.name } : {}),\n    }\n  }\n   */\n  evtCtx.page = {\n    ...pageCtx,\n    ...pageContextFromEventProps,\n    ...evtCtx.page,\n  }\n}\n","import { v4 as uuid } from '@lukeed/uuid'\nimport { dset } from 'dset'\nimport { ID, User } from '../user'\nimport {\n  Options,\n  EventProperties,\n  Traits,\n  TronicEvent,\n} from './interfaces'\nimport md5 from 'spark-md5'\nimport { addPageContext, PageContext } from '../page'\n\nexport * from './interfaces'\n\nexport class EventFactory {\n  constructor(public user: User) {}\n\n  track(\n    eventName: string,\n    channelId?: string,\n    properties?: EventProperties,\n    options?: Options,\n    pageCtx?: PageContext\n  ): TronicEvent {\n    const event = this.normalize(\n      {\n        ...this.baseEvent(),\n        type: 'track' as const,\n        event: eventName,\n        properties: properties ?? {}, // TODO: why is this not a shallow copy like everywhere else?\n        options: { ...options },\n      },\n      pageCtx\n    )\n    if (channelId) {\n      event.channelId = channelId;\n    }\n    return event;\n  }\n\n  identify(\n    userId: ID,\n    channelId?: string,\n    traits?: Traits,\n    options?: Options,\n    pageCtx?: PageContext\n  ): TronicEvent {\n    const event = this.normalize(\n      {\n        ...this.baseEvent(),\n        type: 'identify' as const,\n        userId,\n        traits,\n        options: { ...options },\n      },\n      pageCtx\n    )\n    if (channelId) {\n      event.channelId = channelId;\n    }\n    return event;\n  }\n\n  private baseEvent(): Partial<TronicEvent> {\n    const base: Partial<TronicEvent> = {\n      options: {},\n    }\n\n    const user = this.user\n\n    if (user.id()) {\n      base.userId = user.id()\n    }\n\n    if (user.anonymousId()) {\n      base.anonymousId = user.anonymousId()\n    }\n\n    return base\n  }\n\n  /**\n   * Builds the context part of an event based on \"foreign\" keys that\n   * are provided in the `Options` parameter for an Event\n   */\n  private context(event: TronicEvent): [object, object] {\n    const optionsKeys = ['anonymousId', 'timestamp', 'userId']\n\n    const options: Record<string, any> = event.options ?? {}\n\n    const providedOptionsKeys = Object.keys(options)\n\n    const context = event.options?.context ?? {}\n    const overrides: Record<string, any> = {}\n\n    providedOptionsKeys.forEach((key) => {\n      if (key === 'context') {\n        return\n      }\n\n      if (optionsKeys.includes(key)) {\n        dset(overrides, key, options[key])\n      } else {\n        dset(context, key, options[key])\n      }\n    })\n\n    return [context, overrides]\n  }\n\n  public normalize(event: TronicEvent, pageCtx?: PageContext): TronicEvent {\n\n    // set anonymousId globally if we encounter an override\n\n    event.options?.anonymousId &&\n      this.user.anonymousId(event.options.anonymousId)\n\n    const [context, overrides] = this.context(event)\n    const { options, ...rest } = event\n\n    const newEvent: TronicEvent = {\n      timestamp: new Date(),\n      ...rest,\n      context,\n      ...overrides,\n      messageId: 'tjs-' + md5.hash(JSON.stringify(event) + uuid()),\n    }\n    addPageContext(newEvent, pageCtx)\n\n    return newEvent\n  }\n}\n","export function backoff(params) {\n    var random = Math.random() + 1;\n    var _a = params.minTimeout, minTimeout = _a === void 0 ? 500 : _a, _b = params.factor, factor = _b === void 0 ? 2 : _b, attempt = params.attempt, _c = params.maxTimeout, maxTimeout = _c === void 0 ? Infinity : _c;\n    return Math.min(random * minTimeout * Math.pow(factor, attempt), maxTimeout);\n}\n//# sourceMappingURL=backoff.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Emitter } from '../emitter';\nimport { backoff } from './backoff';\n/**\n * @internal\n */\nexport var ON_REMOVE_FROM_FUTURE = 'onRemoveFromFuture';\nvar PriorityQueue = /** @class */ (function (_super) {\n    __extends(PriorityQueue, _super);\n    function PriorityQueue(maxAttempts, queue, seen) {\n        var _this = _super.call(this) || this;\n        _this.future = [];\n        _this.maxAttempts = maxAttempts;\n        _this.queue = queue;\n        _this.seen = seen !== null && seen !== void 0 ? seen : {};\n        return _this;\n    }\n    PriorityQueue.prototype.push = function () {\n        var _this = this;\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var accepted = items.map(function (operation) {\n            var attempts = _this.updateAttempts(operation);\n            if (attempts > _this.maxAttempts || _this.includes(operation)) {\n                return false;\n            }\n            _this.queue.push(operation);\n            return true;\n        });\n        this.queue = this.queue.sort(function (a, b) { return _this.getAttempts(a) - _this.getAttempts(b); });\n        return accepted;\n    };\n    PriorityQueue.prototype.pushWithBackoff = function (item) {\n        var _this = this;\n        if (this.getAttempts(item) === 0) {\n            return this.push(item)[0];\n        }\n        var attempt = this.updateAttempts(item);\n        if (attempt > this.maxAttempts || this.includes(item)) {\n            return false;\n        }\n        var timeout = backoff({ attempt: attempt - 1 });\n        setTimeout(function () {\n            _this.queue.push(item);\n            // remove from future list\n            _this.future = _this.future.filter(function (f) { return f.id !== item.id; });\n            // Lets listeners know that a 'future' message is now available in the queue\n            _this.emit(ON_REMOVE_FROM_FUTURE);\n        }, timeout);\n        this.future.push(item);\n        return true;\n    };\n    PriorityQueue.prototype.getAttempts = function (item) {\n        var _a;\n        return (_a = this.seen[item.id]) !== null && _a !== void 0 ? _a : 0;\n    };\n    PriorityQueue.prototype.updateAttempts = function (item) {\n        this.seen[item.id] = this.getAttempts(item) + 1;\n        return this.getAttempts(item);\n    };\n    PriorityQueue.prototype.includes = function (item) {\n        return (this.queue.includes(item) ||\n            this.future.includes(item) ||\n            Boolean(this.queue.find(function (i) { return i.id === item.id; })) ||\n            Boolean(this.future.find(function (i) { return i.id === item.id; })));\n    };\n    PriorityQueue.prototype.pop = function () {\n        return this.queue.shift();\n    };\n    Object.defineProperty(PriorityQueue.prototype, \"length\", {\n        get: function () {\n            return this.queue.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PriorityQueue.prototype, \"todo\", {\n        get: function () {\n            return this.queue.length + this.future.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return PriorityQueue;\n}(Emitter));\nexport { PriorityQueue };\n//# sourceMappingURL=index.js.map","import { PriorityQueue } from '.'\nimport { Context, SerializedContext } from '../../core/context'\nimport { isBrowser } from '../../core/environment'\n\nlet loc:\n  | Storage\n  | { getItem: () => void; setItem: () => void; removeItem: () => void } = {\n  getItem() {},\n  setItem() {},\n  removeItem() {},\n}\n\ntry {\n  loc = isBrowser() && window.localStorage ? window.localStorage : loc\n} catch (err) {\n  console.warn('Unable to access localStorage', err)\n}\n\nfunction persisted(key: string): Context[] {\n  const items = loc.getItem(key)\n  return (items ? JSON.parse(items) : []).map(\n    (p: SerializedContext) => new Context(p.event, p.id)\n  )\n}\n\nfunction persistItems(key: string, items: Context[]): void {\n  const existing = persisted(key)\n  const all = [...items, ...existing]\n\n  const merged = all.reduce((acc, item) => {\n    return {\n      ...acc,\n      [item.id]: item,\n    }\n  }, {} as Record<string, Context>)\n\n  loc.setItem(key, JSON.stringify(Object.values(merged)))\n}\n\nfunction seen(key: string): Record<string, number> {\n  const stored = loc.getItem(key)\n  return stored ? JSON.parse(stored) : {}\n}\n\nfunction persistSeen(key: string, memory: Record<string, number>): void {\n  const stored = seen(key)\n\n  loc.setItem(\n    key,\n    JSON.stringify({\n      ...stored,\n      ...memory,\n    })\n  )\n}\n\nfunction remove(key: string): void {\n  loc.removeItem(key)\n}\n\nconst now = (): number => new Date().getTime()\n\nfunction mutex(key: string, onUnlock: Function, attempt = 0): void {\n  const lockTimeout = 50\n  const lockKey = `persisted-queue:v1:${key}:lock`\n\n  const expired = (lock: number): boolean => new Date().getTime() > lock\n  const rawLock = loc.getItem(lockKey)\n  const lock = rawLock ? (JSON.parse(rawLock) as number) : null\n\n  const allowed = lock === null || expired(lock)\n  if (allowed) {\n    loc.setItem(lockKey, JSON.stringify(now() + lockTimeout))\n    onUnlock()\n    loc.removeItem(lockKey)\n    return\n  }\n\n  if (!allowed && attempt < 3) {\n    setTimeout(() => {\n      mutex(key, onUnlock, attempt + 1)\n    }, lockTimeout)\n  } else {\n    console.error('Unable to retrieve lock')\n  }\n}\n\nexport class PersistedPriorityQueue extends PriorityQueue<Context> {\n  constructor(maxAttempts: number, key: string) {\n    super(maxAttempts, [])\n\n    const itemsKey = `persisted-queue:v1:${key}:items`\n    const seenKey = `persisted-queue:v1:${key}:seen`\n\n    let saved: Context[] = []\n    let lastSeen: Record<string, number> = {}\n\n    mutex(key, () => {\n      try {\n        saved = persisted(itemsKey)\n        lastSeen = seen(seenKey)\n        remove(itemsKey)\n        remove(seenKey)\n\n        this.queue = [...saved, ...this.queue]\n        this.seen = { ...lastSeen, ...this.seen }\n      } catch (err) {\n        console.error(err)\n      }\n    })\n\n    window.addEventListener('pagehide', () => {\n      // we deliberately want to use the less powerful 'pagehide' API to only persist on events where the receiver instance gets destroyed, and not on tab away.\n      if (this.todo > 0) {\n        const items = [...this.queue, ...this.future]\n        try {\n          mutex(key, () => {\n            persistItems(itemsKey, items)\n            persistSeen(seenKey, this.seen)\n          })\n        } catch (err) {\n          console.error(err)\n        }\n      }\n    })\n  }\n}\n","var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nexport function groupBy(collection, grouper) {\n    var results = {};\n    collection.forEach(function (item) {\n        var _a;\n        var key = undefined;\n        if (typeof grouper === 'string') {\n            var suggestedKey = item[grouper];\n            key =\n                typeof suggestedKey !== 'string'\n                    ? JSON.stringify(suggestedKey)\n                    : suggestedKey;\n        }\n        else if (grouper instanceof Function) {\n            key = grouper(item);\n        }\n        if (key === undefined) {\n            return;\n        }\n        results[key] = __spreadArray(__spreadArray([], ((_a = results[key]) !== null && _a !== void 0 ? _a : []), true), [item], false);\n    });\n    return results;\n}\n//# sourceMappingURL=group-by.js.map","/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport var isThenable = function (value) {\n    return typeof value === 'object' &&\n        value !== null &&\n        'then' in value &&\n        typeof value.then === 'function';\n};\n//# sourceMappingURL=is-thenable.js.map","import { isThenable } from '../utils/is-thenable';\nexport var createTaskGroup = function () {\n    var taskCompletionPromise;\n    var resolvePromise;\n    var count = 0;\n    return {\n        done: function () { return taskCompletionPromise; },\n        run: function (op) {\n            var returnValue = op();\n            if (isThenable(returnValue)) {\n                if (++count === 1) {\n                    taskCompletionPromise = new Promise(function (res) { return (resolvePromise = res); });\n                }\n                returnValue.finally(function () { return --count === 0 && resolvePromise(); });\n            }\n            return returnValue;\n        },\n    };\n};\n//# sourceMappingURL=task-group.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { CoreContext, ContextCancelation } from '../context';\nfunction tryAsync(fn) {\n    return __awaiter(this, void 0, void 0, function () {\n        var err_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 2, , 3]);\n                    return [4 /*yield*/, fn()];\n                case 1: return [2 /*return*/, _a.sent()];\n                case 2:\n                    err_1 = _a.sent();\n                    return [2 /*return*/, Promise.reject(err_1)];\n                case 3: return [2 /*return*/];\n            }\n        });\n    });\n}\nexport function attempt(ctx, plugin) {\n    ctx.log('debug', 'plugin', { plugin: plugin.name });\n    var start = new Date().getTime();\n    var hook = plugin[ctx.event.type];\n    if (hook === undefined) {\n        return Promise.resolve(ctx);\n    }\n    var newCtx = tryAsync(function () { return hook.apply(plugin, [ctx]); })\n        .then(function (ctx) {\n        var done = new Date().getTime() - start;\n        ctx.stats.gauge('plugin_time', done, [\"plugin:\".concat(plugin.name)]);\n        return ctx;\n    })\n        .catch(function (err) {\n        if (err instanceof ContextCancelation &&\n            err.type === 'middleware_cancellation') {\n            throw err;\n        }\n        if (err instanceof ContextCancelation) {\n            ctx.log('warn', err.type, {\n                plugin: plugin.name,\n                error: err,\n            });\n            return err;\n        }\n        ctx.log('error', 'plugin Error', {\n            plugin: plugin.name,\n            error: err,\n        });\n        ctx.stats.increment('plugin_error', 1, [\"plugin:\".concat(plugin.name)]);\n        return err;\n    });\n    return newCtx;\n}\nexport function ensure(ctx, plugin) {\n    return attempt(ctx, plugin).then(function (newContext) {\n        if (newContext instanceof CoreContext) {\n            return newContext;\n        }\n        ctx.log('debug', 'Context canceled');\n        ctx.stats.increment('context_canceled');\n        ctx.cancel(newContext);\n    });\n}\n//# sourceMappingURL=delivery.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { groupBy } from '../utils/group-by';\nimport { ON_REMOVE_FROM_FUTURE } from '../priority-queue';\nimport { CoreContext, ContextCancelation } from '../context';\nimport { Emitter } from '../emitter';\nimport { createTaskGroup } from '../task/task-group';\nimport { attempt, ensure } from './delivery';\nvar CoreEventQueue = /** @class */ (function (_super) {\n    __extends(CoreEventQueue, _super);\n    function CoreEventQueue(priorityQueue) {\n        var _this = _super.call(this) || this;\n        /**\n         * All event deliveries get suspended until all the tasks in this task group are complete.\n         * For example: a middleware that augments the event object should be loaded safely as a\n         * critical task, this way, event queue will wait for it to be ready before sending events.\n         *\n         * This applies to all the events already in the queue, and the upcoming ones\n         */\n        _this.criticalTasks = createTaskGroup();\n        _this.plugins = [];\n        _this.failedInitializations = [];\n        _this.flushing = false;\n        _this.queue = priorityQueue;\n        _this.queue.on(ON_REMOVE_FROM_FUTURE, function () {\n            _this.scheduleFlush(0);\n        });\n        return _this;\n    }\n    CoreEventQueue.prototype.register = function (ctx, plugin, instance) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.resolve(plugin.load(ctx, instance))\n                            .then(function () {\n                            _this.plugins.push(plugin);\n                        })\n                            .catch(function (err) {\n                            if (plugin.type === 'destination') {\n                                _this.failedInitializations.push(plugin.name);\n                                console.warn(plugin.name, err);\n                                ctx.log('warn', 'Failed to load destination', {\n                                    plugin: plugin.name,\n                                    error: err,\n                                });\n                                return;\n                            }\n                            throw err;\n                        })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.deregister = function (ctx, plugin, instance) {\n        return __awaiter(this, void 0, void 0, function () {\n            var e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        if (!plugin.unload) return [3 /*break*/, 2];\n                        return [4 /*yield*/, Promise.resolve(plugin.unload(ctx, instance))];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        this.plugins = this.plugins.filter(function (p) { return p.name !== plugin.name; });\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        ctx.log('warn', 'Failed to unload destination', {\n                            plugin: plugin.name,\n                            error: e_1,\n                        });\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.dispatch = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var willDeliver;\n            return __generator(this, function (_a) {\n                ctx.log('debug', 'Dispatching');\n                ctx.stats.increment('message_dispatched');\n                this.queue.push(ctx);\n                willDeliver = this.subscribeToDelivery(ctx);\n                this.scheduleFlush(0);\n                return [2 /*return*/, willDeliver];\n            });\n        });\n    };\n    CoreEventQueue.prototype.subscribeToDelivery = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve) {\n                        var onDeliver = function (flushed, delivered) {\n                            if (flushed.isSame(ctx)) {\n                                _this.off('flush', onDeliver);\n                                if (delivered) {\n                                    resolve(flushed);\n                                }\n                                else {\n                                    resolve(flushed);\n                                }\n                            }\n                        };\n                        _this.on('flush', onDeliver);\n                    })];\n            });\n        });\n    };\n    CoreEventQueue.prototype.dispatchSingle = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                ctx.log('debug', 'Dispatching');\n                ctx.stats.increment('message_dispatched');\n                this.queue.updateAttempts(ctx);\n                ctx.attempts = 1;\n                return [2 /*return*/, this.deliver(ctx).catch(function (err) {\n                        var accepted = _this.enqueuRetry(err, ctx);\n                        if (!accepted) {\n                            ctx.setFailedDelivery({ reason: err });\n                            return ctx;\n                        }\n                        return _this.subscribeToDelivery(ctx);\n                    })];\n            });\n        });\n    };\n    CoreEventQueue.prototype.isEmpty = function () {\n        return this.queue.length === 0;\n    };\n    CoreEventQueue.prototype.scheduleFlush = function (timeout) {\n        var _this = this;\n        if (timeout === void 0) { timeout = 500; }\n        if (this.flushing) {\n            return;\n        }\n        this.flushing = true;\n        setTimeout(function () {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            _this.flush().then(function () {\n                setTimeout(function () {\n                    _this.flushing = false;\n                    if (_this.queue.length) {\n                        _this.scheduleFlush(0);\n                    }\n                }, 0);\n            });\n        }, timeout);\n    };\n    CoreEventQueue.prototype.deliver = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var start, done, err_1, error;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.criticalTasks.done()];\n                    case 1:\n                        _a.sent();\n                        start = Date.now();\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 5]);\n                        return [4 /*yield*/, this.flushOne(ctx)];\n                    case 3:\n                        ctx = _a.sent();\n                        done = Date.now() - start;\n                        this.emit('delivery_success', ctx);\n                        ctx.stats.gauge('delivered', done);\n                        ctx.log('debug', 'Delivered', ctx.event);\n                        return [2 /*return*/, ctx];\n                    case 4:\n                        err_1 = _a.sent();\n                        error = err_1;\n                        ctx.log('error', 'Failed to deliver', error);\n                        this.emit('delivery_failure', ctx, error);\n                        ctx.stats.increment('delivery_failed');\n                        throw err_1;\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.enqueuRetry = function (err, ctx) {\n        var retriable = !(err instanceof ContextCancelation) || err.retry;\n        if (!retriable) {\n            return false;\n        }\n        return this.queue.pushWithBackoff(ctx);\n    };\n    CoreEventQueue.prototype.flush = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var ctx, err_2, accepted;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.queue.length === 0) {\n                            return [2 /*return*/, []];\n                        }\n                        ctx = this.queue.pop();\n                        if (!ctx) {\n                            return [2 /*return*/, []];\n                        }\n                        ctx.attempts = this.queue.getAttempts(ctx);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.deliver(ctx)];\n                    case 2:\n                        ctx = _a.sent();\n                        this.emit('flush', ctx, true);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _a.sent();\n                        accepted = this.enqueuRetry(err_2, ctx);\n                        if (!accepted) {\n                            ctx.setFailedDelivery({ reason: err_2 });\n                            this.emit('flush', ctx, false);\n                        }\n                        return [2 /*return*/, []];\n                    case 4: return [2 /*return*/, [ctx]];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.isReady = function () {\n        // return this.plugins.every((p) => p.isLoaded())\n        // should we wait for every plugin to load?\n        return true;\n    };\n    CoreEventQueue.prototype.availableExtensions = function (denyList) {\n        var available = this.plugins.filter(function (p) {\n            var _a, _b, _c;\n            // Only filter out destination plugins or the Tronic plugin\n            if (p.type !== 'destination' && p.name !== 'Tronic') {\n                return true;\n            }\n            var alternativeNameMatch = undefined;\n            (_a = p.alternativeNames) === null || _a === void 0 ? void 0 : _a.forEach(function (name) {\n                if (denyList[name] !== undefined) {\n                    alternativeNameMatch = denyList[name];\n                }\n            });\n            // Explicit integration option takes precedence, `All: false` does not apply to Tronic\n            return ((_c = (_b = denyList[p.name]) !== null && _b !== void 0 ? _b : alternativeNameMatch) !== null && _c !== void 0 ? _c : (p.name === 'Tronic' ? true : denyList.All) !== false);\n        });\n        var _a = groupBy(available, 'type'), _b = _a.before, before = _b === void 0 ? [] : _b, _c = _a.enrichment, enrichment = _c === void 0 ? [] : _c, _d = _a.destination, destination = _d === void 0 ? [] : _d, _e = _a.after, after = _e === void 0 ? [] : _e;\n        return {\n            before: before,\n            enrichment: enrichment,\n            destinations: destination,\n            after: after,\n        };\n    };\n    CoreEventQueue.prototype.flushOne = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, before, enrichment, _i, before_1, beforeWare, temp, _b, enrichment_1, enrichmentWare, temp, _c, destinations, after, afterCalls;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        if (!this.isReady()) {\n                            throw new Error('Not ready');\n                        }\n                        if (ctx.attempts > 1) {\n                            this.emit('delivery_retry', ctx);\n                        }\n                        _a = this.availableExtensions(\n                        /* ctx.event.integrations ?? */ {}), before = _a.before, enrichment = _a.enrichment;\n                        _i = 0, before_1 = before;\n                        _d.label = 1;\n                    case 1:\n                        if (!(_i < before_1.length)) return [3 /*break*/, 4];\n                        beforeWare = before_1[_i];\n                        return [4 /*yield*/, ensure(ctx, beforeWare)];\n                    case 2:\n                        temp = _d.sent();\n                        if (temp instanceof CoreContext) {\n                            ctx = temp;\n                        }\n                        this.emit('message_enriched', ctx, beforeWare);\n                        _d.label = 3;\n                    case 3:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 4:\n                        _b = 0, enrichment_1 = enrichment;\n                        _d.label = 5;\n                    case 5:\n                        if (!(_b < enrichment_1.length)) return [3 /*break*/, 8];\n                        enrichmentWare = enrichment_1[_b];\n                        return [4 /*yield*/, attempt(ctx, enrichmentWare)];\n                    case 6:\n                        temp = _d.sent();\n                        if (temp instanceof CoreContext) {\n                            ctx = temp;\n                        }\n                        this.emit('message_enriched', ctx, enrichmentWare);\n                        _d.label = 7;\n                    case 7:\n                        _b++;\n                        return [3 /*break*/, 5];\n                    case 8:\n                        _c = this.availableExtensions(\n                        /* ctx.event.integrations ?? */ {}), destinations = _c.destinations, after = _c.after;\n                        return [4 /*yield*/, new Promise(function (resolve, reject) {\n                                setTimeout(function () {\n                                    var attempts = destinations.map(function (destination) {\n                                        return attempt(ctx, destination);\n                                    });\n                                    Promise.all(attempts).then(resolve).catch(reject);\n                                }, 0);\n                            })];\n                    case 9:\n                        _d.sent();\n                        ctx.stats.increment('message_delivered');\n                        this.emit('message_delivered', ctx);\n                        afterCalls = after.map(function (after) { return attempt(ctx, after); });\n                        return [4 /*yield*/, Promise.all(afterCalls)];\n                    case 10:\n                        _d.sent();\n                        return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    return CoreEventQueue;\n}(Emitter));\nexport { CoreEventQueue };\n//# sourceMappingURL=event-queue.js.map","import { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { Context } from '../context'\nimport { AnyBrowserPlugin } from '../plugin'\nimport { CoreEventQueue } from '@tronic/receiver-core'\nimport { isOffline } from '../connection'\n\nexport class EventQueue extends CoreEventQueue<Context, AnyBrowserPlugin> {\n  constructor(name: string)\n  constructor(priorityQueue: PriorityQueue<Context>)\n  constructor(nameOrQueue: string | PriorityQueue<Context>) {\n    super(\n      typeof nameOrQueue === 'string'\n        ? new PersistedPriorityQueue(4, nameOrQueue)\n        : nameOrQueue\n    )\n  }\n  async flush(): Promise<Context[]> {\n    if (isOffline()) return []\n    return super.flush()\n  }\n}\n","export default function bindAll<\n  ObjType extends { [key: string]: any },\n  KeyType extends keyof ObjType\n>(obj: ObjType): ObjType {\n  const proto = obj.constructor.prototype\n  for (const key of Object.getOwnPropertyNames(proto)) {\n    if (key !== 'constructor') {\n      const desc = Object.getOwnPropertyDescriptor(\n        obj.constructor.prototype,\n        key\n      )\n      if (!!desc && typeof desc.value === 'function') {\n        obj[key as KeyType] = obj[key].bind(obj)\n      }\n    }\n  }\n\n  return obj\n}\n","import { CookieOptions } from './cookieStorage'\n\nexport const StoreType = {\n  Cookie: 'cookie',\n  LocalStorage: 'localStorage',\n  Memory: 'memory',\n} as const\n\n/**\n * Known Storage Types\n *\n * Convenience settings for storage systems that AJS includes support for\n */\nexport type StoreType = typeof StoreType[keyof typeof StoreType]\n\nexport type StorageObject = Record<string, unknown>\n\n/**\n * Defines a Storage object for use in AJS Client.\n */\nexport interface Store<Data extends StorageObject = StorageObject> {\n  /**\n   * get value for the key from the stores. it will return the first value found in the stores\n   * @param key key for the value to be retrieved\n   * @returns value for the key or null if not found\n   */\n  get<K extends keyof Data>(key: K): Data[K] | null\n\n  /**\n   * it will set the value for the key in all the stores\n   * @param key key for the value to be stored\n   * @param value value to be stored\n   * @returns value that was stored\n   */\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void\n  /**\n   * remove the value for the key from all the stores\n   * @param key key for the value to be removed\n   * @param storeTypes optional array of store types to be used for removing the value\n   */\n  remove<K extends keyof Data>(key: K): void\n}\n\nexport interface StoreTypeWithSettings<T extends StoreType = StoreType> {\n  name: T\n  settings?: T extends 'cookie' ? CookieOptions : never\n}\n\nexport type InitializeStorageArgs = (StoreTypeWithSettings | StoreType)[]\n","import { Store, StorageObject } from './types'\n\n// not adding to private method because those method names do not get minified atm, and does not use 'this'\nconst _logStoreKeyError = (\n  store: Store,\n  action: 'set' | 'get' | 'remove',\n  key: string,\n  err: unknown\n) => {\n  console.warn(\n    `${store.constructor.name}: Can't ${action} key \"${key}\" | Err: ${err}`\n  )\n}\n\n/**\n * Uses multiple storages in a priority list to get/set values in the order they are specified.\n */\nexport class UniversalStorage<Data extends StorageObject = StorageObject> {\n  private stores: Store[]\n\n  constructor(stores: Store[]) {\n    this.stores = stores\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    let val: Data[K] | null = null\n\n    for (const store of this.stores) {\n      try {\n        val = store.get(key) as Data[K] | null\n        if (val !== undefined && val !== null) {\n          return val\n        }\n      } catch (e) {\n        _logStoreKeyError(store, 'get', key, e)\n      }\n    }\n    return null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.stores.forEach((store) => {\n      try {\n        store.set(key, value)\n      } catch (e) {\n        _logStoreKeyError(store, 'set', key, e)\n      }\n    })\n  }\n\n  clear<K extends keyof Data>(key: K): void {\n    this.stores.forEach((store) => {\n      try {\n        store.remove(key)\n      } catch (e) {\n        _logStoreKeyError(store, 'remove', key, e)\n      }\n    })\n  }\n\n  /*\n    This is to support few scenarios where:\n    - value exist in one of the stores ( as a result of other stores being cleared from browser ) and we want to resync them\n    - read values in AJS 1.0 format ( for customers after 1.0 --> 2.0 migration ) and then re-write them in AJS 2.0 format\n  */\n  getAndSync<K extends keyof Data>(key: K): Data[K] | null {\n    const val = this.get(key)\n\n    // legacy behavior, getAndSync can change the type of a value from number to string (AJS 1.0 stores numerical values as a number)\n    const coercedValue = (typeof val === 'number' ? val.toString() : val) as\n      | Data[K]\n      | null\n\n    this.set(key, coercedValue)\n\n    return coercedValue\n  }\n}\n","import { Store, StorageObject } from './types'\n\n/**\n * Data Storage using in memory object\n */\nexport class MemoryStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private cache: Record<string, unknown> = {}\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    return (this.cache[key] ?? null) as Data[K] | null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.cache[key] = value\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    delete this.cache[key]\n  }\n}\n","import { StoreType, StoreTypeWithSettings } from './types'\n\nexport type UniversalStorageSettings = { stores: StoreType[] }\n\n// This is setup this way to permit eventually a different set of settings for custom storage\nexport type StorageSettings = UniversalStorageSettings\n\nexport function isArrayOfStoreType(\n  s: StorageSettings\n): s is UniversalStorageSettings {\n  return (\n    s &&\n    s.stores &&\n    Array.isArray(s.stores) &&\n    s.stores.every((e) => Object.values(StoreType).includes(e))\n  )\n}\n\nexport function isStoreTypeWithSettings(\n  s: StoreTypeWithSettings | StoreType\n): s is StoreTypeWithSettings {\n  return typeof s === 'object' && s.name !== undefined\n}\n","/*! js-cookie v3.0.1 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (key, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    key = encodeURIComponent(key)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      key + '=' + converter.write(value, key) + stringifiedAttributes)\n  }\n\n  function get (key) {\n    if (typeof document === 'undefined' || (arguments.length && !key)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var foundKey = decodeURIComponent(parts[0]);\n        jar[foundKey] = converter.read(value, foundKey);\n\n        if (key === foundKey) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return key ? jar[key] : jar\n  }\n\n  return Object.create(\n    {\n      set: set,\n      get: get,\n      remove: function (key, attributes) {\n        set(\n          key,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport default api;\n","import cookie from 'js-cookie'\n\n/**\n * Levels returns all levels of the given url.\n *\n * @param {string} url\n * @return {Array}\n * @api public\n */\nfunction levels(url: URL): string[] {\n  const host = url.hostname\n  const parts = host.split('.')\n  const last = parts[parts.length - 1]\n  const levels: string[] = []\n\n  // Ip address.\n  if (parts.length === 4 && parseInt(last, 10) > 0) {\n    return levels\n  }\n\n  // Localhost.\n  if (parts.length <= 1) {\n    return levels\n  }\n\n  // Create levels.\n  for (let i = parts.length - 2; i >= 0; --i) {\n    levels.push(parts.slice(i).join('.'))\n  }\n\n  return levels\n}\n\nfunction parseUrl(url: string): URL | undefined {\n  try {\n    return new URL(url)\n  } catch {\n    return\n  }\n}\n\nexport function tld(url: string): string | undefined {\n  const parsedUrl = parseUrl(url)\n  if (!parsedUrl) return\n\n  const lvls = levels(parsedUrl)\n\n  // Lookup the real top level one.\n  for (let i = 0; i < lvls.length; ++i) {\n    const cname = '__tld__'\n    const domain = lvls[i]\n    const opts = { domain: '.' + domain }\n\n    try {\n      // cookie access throw an error if the library is ran inside a sandboxed environment (e.g. sandboxed iframe)\n      cookie.set(cname, '1', opts)\n      if (cookie.get(cname)) {\n        cookie.remove(cname, opts)\n        return domain\n      }\n    } catch (_) {\n      return\n    }\n  }\n}\n","import { Store, StorageObject } from './types'\nimport jar from 'js-cookie'\nimport { tld } from '../user/tld'\n\nconst ONE_YEAR = 365\n\nexport interface CookieOptions {\n  maxage?: number\n  domain?: string\n  path?: string\n  secure?: boolean\n  sameSite?: string\n}\n\n/**\n * Data storage using browser cookies\n */\nexport class CookieStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  static get defaults(): CookieOptions {\n    return {\n      maxage: ONE_YEAR,\n      domain: tld(window.location.href),\n      path: '/',\n      sameSite: 'Lax',\n    }\n  }\n\n  private options: Required<CookieOptions>\n\n  constructor(options: CookieOptions = CookieStorage.defaults) {\n    this.options = {\n      ...CookieStorage.defaults,\n      ...options,\n    } as Required<CookieOptions>\n  }\n\n  private opts(): jar.CookieAttributes {\n    return {\n      sameSite: this.options.sameSite as jar.CookieAttributes['sameSite'],\n      expires: this.options.maxage,\n      domain: this.options.domain,\n      path: this.options.path,\n      secure: this.options.secure,\n    }\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const value = jar.get(key)\n\n      if (value === undefined || value === null) {\n        return null\n      }\n\n      try {\n        return JSON.parse(value) ?? null\n      } catch (e) {\n        return (value ?? null) as unknown as Data[K] | null\n      }\n    } catch (e) {\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    if (typeof value === 'string') {\n      jar.set(key, value, this.opts())\n    } else if (value === null) {\n      jar.remove(key, this.opts())\n    } else {\n      jar.set(key, JSON.stringify(value), this.opts())\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    return jar.remove(key, this.opts())\n  }\n}\n","import { StorageObject, Store } from './types'\n\n/**\n * Data storage using browser's localStorage\n */\nexport class LocalStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private localStorageWarning(key: keyof Data, state: 'full' | 'unavailable') {\n    console.warn(`Unable to access ${key}, localStorage may be ${state}`)\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const val = localStorage.getItem(key)\n      if (val === null) {\n        return null\n      }\n      try {\n        return JSON.parse(val) ?? null\n      } catch (e) {\n        return (val ?? null) as unknown as Data[K] | null\n      }\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    try {\n      localStorage.setItem(key, JSON.stringify(value))\n    } catch {\n      this.localStorageWarning(key, 'full')\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    try {\n      return localStorage.removeItem(key)\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n    }\n  }\n}\n","import { CookieOptions, CookieStorage } from './cookieStorage'\nimport { LocalStorage } from './localStorage'\nimport { MemoryStorage } from './memoryStorage'\nimport { isStoreTypeWithSettings } from './settings'\nimport { StoreType, Store, InitializeStorageArgs } from './types'\n\nexport * from './types'\nexport * from './localStorage'\nexport * from './cookieStorage'\nexport * from './memoryStorage'\nexport * from './universalStorage'\nexport * from './settings'\n\n/**\n * Creates multiple storage systems from an array of StoreType and options\n * @param args StoreType and options\n * @returns Storage array\n */\nexport function initializeStorages(args: InitializeStorageArgs): Store[] {\n  const storages = args.map((s) => {\n    let type: StoreType\n    let settings\n\n    if (isStoreTypeWithSettings(s)) {\n      type = s.name\n      settings = s.settings\n    } else {\n      type = s\n    }\n\n    switch (type) {\n      case StoreType.Cookie:\n        return new CookieStorage(settings)\n      case StoreType.LocalStorage:\n        return new LocalStorage()\n      case StoreType.Memory:\n        return new MemoryStorage()\n      default:\n        throw new Error(`Unknown Store Type: ${s}`)\n    }\n  })\n  return storages\n}\n\n/**\n * Injects the CookieOptions into a the arguments for initializeStorage\n * @param storeTypes list of storeType\n * @param cookieOptions cookie Options\n * @returns arguments for initializeStorage\n */\nexport function applyCookieOptions(\n  storeTypes: StoreType[],\n  cookieOptions?: CookieOptions\n): InitializeStorageArgs {\n  return storeTypes.map((s) => {\n    if (cookieOptions && s === StoreType.Cookie) {\n      return {\n        name: s,\n        settings: cookieOptions,\n      }\n    }\n    return s\n  })\n}\n","import { v4 as uuid } from '@lukeed/uuid'\nimport autoBind from '../../lib/bind-all'\nimport { Traits } from '../events'\nimport {\n  CookieOptions,\n  UniversalStorage,\n  MemoryStorage,\n  StorageObject,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\n\nexport type ID = string | null | undefined\n\nexport interface UserOptions {\n  /**\n   * Disables storing any data about the user.\n   */\n  disable?: boolean\n  localStorageFallbackDisabled?: boolean\n  persist?: boolean\n\n  cookie?: {\n    key?: string\n    oldKey?: string\n  }\n\n  localStorage?: {\n    key: string\n  }\n\n  /**\n   * Store priority\n   * @example stores: [StoreType.Cookie, StoreType.Memory]\n   */\n  storage?: StorageSettings\n}\n\nconst defaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_user_id',\n    oldKey: 'ajs_user',\n  },\n  localStorage: {\n    key: 'ajs_user_traits',\n  },\n}\n\nexport class User {\n  static defaults = defaults\n\n  private idKey: string\n  private traitsKey: string\n  private anonKey: string\n  private cookieOptions?: CookieOptions\n\n  private legacyUserStore: UniversalStorage<{\n    [k: string]:\n      | {\n          id?: string\n          traits?: Traits\n        }\n      | string\n  }>\n  private traitsStore: UniversalStorage<{\n    [k: string]: Traits\n  }>\n\n  private identityStore: UniversalStorage<{\n    [k: string]: string\n  }>\n\n  options: UserOptions = {}\n\n  constructor(options: UserOptions = defaults, cookieOptions?: CookieOptions) {\n    this.options = { ...defaults, ...options }\n    this.cookieOptions = cookieOptions\n\n    this.idKey = options.cookie?.key ?? defaults.cookie.key\n    this.traitsKey = options.localStorage?.key ?? defaults.localStorage.key\n    this.anonKey = 'ajs_anonymous_id'\n\n    this.identityStore = this.createStorage(this.options, cookieOptions)\n\n    // using only cookies for legacy user store\n    this.legacyUserStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s === StoreType.Cookie\n    )\n\n    // using only localStorage / memory for traits store\n    this.traitsStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s !== StoreType.Cookie\n    )\n\n    const legacyUser = this.legacyUserStore.get(defaults.cookie.oldKey)\n    if (legacyUser && typeof legacyUser === 'object') {\n      legacyUser.id && this.id(legacyUser.id)\n      legacyUser.traits && this.traits(legacyUser.traits)\n    }\n    autoBind(this)\n  }\n\n  id = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    const prevId = this.identityStore.getAndSync(this.idKey)\n\n    if (id !== undefined) {\n      this.identityStore.set(this.idKey, id)\n\n      const changingIdentity = id !== prevId && prevId !== null && id !== null\n      if (changingIdentity) {\n        this.anonymousId(null)\n      }\n    }\n\n    const retId = this.identityStore.getAndSync(this.idKey)\n    if (retId) return retId\n\n    const retLeg = this.legacyUserStore.get(defaults.cookie.oldKey)\n    return retLeg ? (typeof retLeg === 'object' ? retLeg.id : retLeg) : null\n  }\n\n  private legacySIO(): [string, string] | null {\n    const val = this.legacyUserStore.get('_sio') as string\n    if (!val) {\n      return null\n    }\n    const [anon, user] = val.split('----')\n    return [anon, user]\n  }\n\n  anonymousId = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    if (id === undefined) {\n      const val =\n        this.identityStore.getAndSync(this.anonKey) ?? this.legacySIO()?.[0]\n\n      if (val) {\n        return val\n      }\n    }\n\n    if (id === null) {\n      this.identityStore.set(this.anonKey, null)\n      return this.identityStore.getAndSync(this.anonKey)\n    }\n\n    this.identityStore.set(this.anonKey, id ?? uuid())\n    return this.identityStore.getAndSync(this.anonKey)\n  }\n\n  traits = (traits?: Traits | null): Traits | undefined => {\n    if (this.options.disable) {\n      return\n    }\n\n    if (traits === null) {\n      traits = {}\n    }\n\n    if (traits) {\n      this.traitsStore.set(this.traitsKey, traits ?? {})\n    }\n\n    return this.traitsStore.get(this.traitsKey) ?? {}\n  }\n\n  identify(id?: ID, traits?: Traits): void {\n    if (this.options.disable) {\n      return\n    }\n\n    traits = traits ?? {}\n    const currentId = this.id()\n\n    if (currentId === null || currentId === id) {\n      traits = {\n        ...this.traits(),\n        ...traits,\n      }\n    }\n\n    if (id) {\n      this.id(id)\n    }\n\n    this.traits(traits)\n  }\n\n  logout(): void {\n    this.anonymousId(null)\n    this.id(null)\n    this.traits({})\n  }\n\n  reset(): void {\n    this.logout()\n    this.identityStore.clear(this.idKey)\n    this.identityStore.clear(this.anonKey)\n    this.traitsStore.clear(this.traitsKey)\n  }\n\n  load(): User {\n    return new User(this.options, this.cookieOptions)\n  }\n\n  save(): boolean {\n    return true\n  }\n\n  /**\n   * Creates the right storage system applying all the user options, cookie options and particular filters\n   * @param options UserOptions\n   * @param cookieOpts CookieOptions\n   * @param filterStores filter function to apply to any StoreTypes (skipped if options specify using a custom storage)\n   * @returns a Storage object\n   */\n  private createStorage<T extends StorageObject = StorageObject>(\n    options: UserOptions,\n    cookieOpts?: CookieOptions,\n    filterStores?: (value: StoreType) => boolean\n  ): UniversalStorage<T> {\n    let stores: StoreType[] = [\n      StoreType.LocalStorage,\n      StoreType.Cookie,\n      StoreType.Memory,\n    ]\n\n    // If disabled we won't have any storage functionality\n    if (options.disable) {\n      return new UniversalStorage<T>([])\n    }\n\n    // If persistance is disabled we will always fallback to Memory Storage\n    if (!options.persist) {\n      return new UniversalStorage<T>([new MemoryStorage<T>()])\n    }\n\n    if (options.storage !== undefined && options.storage !== null) {\n      if (isArrayOfStoreType(options.storage)) {\n        // If the user only specified order of stores we will still apply filters and transformations e.g. not using localStorage if localStorageFallbackDisabled\n        stores = options.storage.stores\n      }\n    }\n\n    // Disable LocalStorage\n    if (options.localStorageFallbackDisabled) {\n      stores = stores.filter((s) => s !== StoreType.LocalStorage)\n    }\n\n    // Apply Additional filters\n    if (filterStores) {\n      stores = stores.filter(filterStores)\n    }\n\n    return new UniversalStorage(\n      initializeStorages(applyCookieOptions(stores, cookieOpts))\n    )\n  }\n}\n\nconst groupDefaults: UserOptions = {\n  persist: true,\n  cookie: {\n    key: 'ajs_group_id',\n  },\n  localStorage: {\n    key: 'ajs_group_properties',\n  },\n}\n\nexport class Group extends User {\n  constructor(options: UserOptions = groupDefaults, cookie?: CookieOptions) {\n    super({ ...groupDefaults, ...options }, cookie)\n    autoBind(this)\n  }\n\n  anonymousId = (_id?: ID): ID => {\n    return undefined\n  }\n}\n","/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport const isThenable = (value: unknown): boolean =>\n  typeof value === 'object' &&\n  value !== null &&\n  'then' in value &&\n  typeof (value as any).then === 'function'\n","import { Receiver } from '../receiver'\nimport { Context } from '../context'\nimport { isThenable } from '../../lib/is-thenable'\nimport { ReceiverBrowserCore } from '../receiver/interfaces'\nimport { version } from '../../generated/version'\nimport { getGlobalReceiver } from '../../lib/global-receiver-helper'\nimport {\n  isBufferedPageContext,\n  BufferedPageContext,\n  getDefaultBufferedPageContext,\n  createPageContext,\n  PageContext,\n} from '../page'\n\n/**\n * The names of any ReceiverBrowser methods that also exist on Receiver\n */\nexport type PreInitMethodName =\n  //  | 'screen'\n  | 'register'\n  | 'deregister'\n  | 'user'\n  //  | 'trackSubmit'\n  //  | 'trackClick'\n  //  | 'trackLink'\n  //  | 'trackForm'\n  //  | 'pageview'\n  | 'identify'\n  | 'reset'\n  //  | 'group'\n  | 'track'\n  | 'ready'\n  //  | 'alias'\n  | 'debug'\n  //  | 'page'\n  | 'once'\n  | 'off'\n  | 'on'\n  | 'addSourceMiddleware'\n// | 'setAnonymousId'\n// | 'addDestinationMiddleware'\n\n// Union of all receiver methods that _do not_ return a Promise\ntype SyncPreInitMethodName = {\n  [MethodName in PreInitMethodName]: ReturnType<\n    Receiver[MethodName]\n  > extends Promise<any>\n  ? never\n  : MethodName\n}[PreInitMethodName]\n\nconst flushSyncReceiverCalls = (\n  name: SyncPreInitMethodName,\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.getCalls(name).forEach((c) => {\n    // While the underlying methods are synchronous, the callReceiverMethod returns a promise,\n    // which normalizes success and error states between async and non-async methods, with no perf penalty.\n    callReceiverMethod(receiver, c).catch(console.error)\n  })\n}\n\nexport const flushAddSourceMiddleware = async (\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n) => {\n  for (const c of buffer.getCalls('addSourceMiddleware')) {\n    await callReceiverMethod(receiver, c).catch(console.error)\n  }\n}\n\nexport const flushOn = flushSyncReceiverCalls.bind(this, 'on')\n\n/*\nexport const flushSetAnonymousID = flushSyncReceiverCalls.bind(\n  this,\n  'setAnonymousId'\n)\n */\n\nexport const flushReceiverCallsInNewTask = (\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.toArray().forEach((m) => {\n    setTimeout(() => {\n      callReceiverMethod(receiver, m).catch(console.error)\n    }, 0)\n  })\n}\n\nexport const popPageContext = (args: unknown[]): PageContext | undefined => {\n  if (hasBufferedPageContextAsLastArg(args)) {\n    const ctx = args.pop() as BufferedPageContext\n    return createPageContext(ctx)\n  }\n}\n\nexport const hasBufferedPageContextAsLastArg = (\n  args: unknown[]\n): args is [...unknown[], BufferedPageContext] | [BufferedPageContext] => {\n  const lastArg = args[args.length - 1]\n  return isBufferedPageContext(lastArg)\n}\n\n/**\n *  Represents a buffered method call that occurred before initialization.\n */\nexport class PreInitMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> {\n  method: MethodName\n  args: PreInitMethodParams<MethodName>\n  called: boolean\n  resolve: (v: ReturnType<Receiver[MethodName]>) => void\n  reject: (reason: any) => void\n  constructor(\n    method: PreInitMethodCall<MethodName>['method'],\n    args: PreInitMethodParams<MethodName>,\n    resolve: PreInitMethodCall<MethodName>['resolve'] = () => {},\n    reject: PreInitMethodCall<MethodName>['reject'] = console.error\n  ) {\n    this.method = method\n    this.resolve = resolve\n    this.reject = reject\n    this.called = false\n    this.args = args\n  }\n}\n\nexport type PreInitMethodParams<MethodName extends PreInitMethodName> =\n  | [...Parameters<Receiver[MethodName]>, BufferedPageContext]\n  | Parameters<Receiver[MethodName]>\n\n/**\n * Infer return type; if return type is promise, unwrap it.\n */\ntype ReturnTypeUnwrap<Fn> = Fn extends (...args: any[]) => infer ReturnT\n  ? ReturnT extends PromiseLike<infer Unwrapped>\n  ? Unwrapped\n  : ReturnT\n  : never\n\ntype MethodCallMap = Partial<Record<PreInitMethodName, PreInitMethodCall[]>>\n\ntype SnippetWindowBufferedMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> = [MethodName, ...PreInitMethodParams<MethodName>]\n\n/**\n * A list of the method calls before initialization for snippet users\n * For example, [[\"track\", \"foo\", {bar: 123}], [\"page\"], [\"on\", \"ready\", function(){..}]\n */\ntype SnippetBuffer = SnippetWindowBufferedMethodCall[]\n\n/**\n *  Represents any and all the buffered method calls that occurred before initialization.\n */\nexport class PreInitMethodCallBuffer {\n  private _callMap: MethodCallMap = {}\n\n  constructor(...calls: PreInitMethodCall[]) {\n    this.push(...calls)\n  }\n\n  /**\n   * Pull any buffered method calls from the window object, and use them to hydrate the instance buffer.\n   */\n  private get calls() {\n    this._pushSnippetWindowBuffer()\n    return this._callMap\n  }\n\n  private set calls(calls: MethodCallMap) {\n    this._callMap = calls\n  }\n\n  getCalls<T extends PreInitMethodName>(methodName: T): PreInitMethodCall<T>[] {\n    return (this.calls[methodName] ?? []) as PreInitMethodCall<T>[]\n  }\n\n  push(...calls: PreInitMethodCall[]): void {\n    calls.forEach((call) => {\n      const eventsExpectingPageContext: PreInitMethodName[] = [\n        'track',\n        // 'screen',\n        // 'alias',\n        // 'group',\n        // 'page',\n        'identify',\n      ]\n      if (\n        eventsExpectingPageContext.includes(call.method) &&\n        !hasBufferedPageContextAsLastArg(call.args)\n      ) {\n        call.args = [...call.args, getDefaultBufferedPageContext()]\n      }\n\n      if (this.calls[call.method]) {\n        this.calls[call.method]!.push(call)\n      } else {\n        this.calls[call.method] = [call]\n      }\n    })\n  }\n\n  clear(): void {\n    // clear calls in the global snippet buffered array.\n    this._pushSnippetWindowBuffer()\n    // clear calls in this instance\n    this.calls = {}\n  }\n\n  toArray(): PreInitMethodCall[] {\n    return ([] as PreInitMethodCall[]).concat(...Object.values(this.calls))\n  }\n\n  /**\n   * Fetch the buffered method calls from the window object,\n   * normalize them, and use them to hydrate the buffer.\n   * This removes existing buffered calls from the window object.\n   */\n  private _pushSnippetWindowBuffer(): void {\n    const wa = getGlobalReceiver()\n    if (!Array.isArray(wa)) return undefined\n    const buffered: SnippetBuffer = wa.splice(0, wa.length)\n    const calls = buffered.map(\n      ([methodName, ...args]) => new PreInitMethodCall(methodName, args)\n    )\n    this.push(...calls)\n  }\n}\n\n/**\n *  Call method and mark as \"called\"\n *  This function should never throw an error\n */\nexport async function callReceiverMethod<T extends PreInitMethodName>(\n  receiver: Receiver,\n  call: PreInitMethodCall<T>\n): Promise<void> {\n  try {\n    if (call.called) {\n      return undefined\n    }\n    call.called = true\n\n    const result: ReturnType<Receiver[T]> = (\n      receiver[call.method] as Function\n    )(...call.args)\n\n    if (isThenable(result)) {\n      // do not defer for non-async methods\n      await result\n    }\n\n    call.resolve(result)\n  } catch (err) {\n    call.reject(err)\n  }\n}\n\nexport type ReceiverLoader = (\n  preInitBuffer: PreInitMethodCallBuffer\n) => Promise<[Receiver, Context]>\n\nexport class ReceiverBuffered\n  implements PromiseLike<[Receiver, Context]>, ReceiverBrowserCore {\n  instance?: Receiver\n  ctx?: Context\n  private _preInitBuffer: PreInitMethodCallBuffer\n  private _promise: Promise<[Receiver, Context]>\n  constructor(loader: ReceiverLoader) {\n    this._preInitBuffer = new PreInitMethodCallBuffer()\n    this._promise = loader(this._preInitBuffer)\n    this._promise\n      .then(([ajs, ctx]) => {\n        this.instance = ajs\n        this.ctx = ctx\n      })\n      .catch(() => {\n        // intentionally do nothing...\n        // this result of this promise will be caught by the 'catch' block on this class.\n      })\n  }\n\n  then<T1, T2 = never>(\n    ...args: [\n      onfulfilled:\n      | ((instance: [Receiver, Context]) => T1 | PromiseLike<T1>)\n      | null\n      | undefined,\n      onrejected?: (reason: unknown) => T2 | PromiseLike<T2>\n    ]\n  ) {\n    return this._promise.then(...args)\n  }\n\n  catch<TResult = never>(\n    ...args: [\n      onrejected?:\n      | ((reason: any) => TResult | PromiseLike<TResult>)\n      | undefined\n      | null\n    ]\n  ) {\n    return this._promise.catch(...args)\n  }\n\n  finally(...args: [onfinally?: (() => void) | undefined | null]) {\n    return this._promise.finally(...args)\n  }\n\n  // trackSubmit = this._createMethod('trackSubmit')\n  // trackClick = this._createMethod('trackClick')\n  // trackLink = this._createMethod('trackLink')\n  // pageView = this._createMethod('pageview')\n  identify = this._createMethod('identify')\n  reset = this._createMethod('reset')\n  // group = this._createMethod('group') as ReceiverBrowserCore['group']\n  track = this._createMethod('track')\n  ready = this._createMethod('ready')\n  // alias = this._createMethod('alias')\n  debug = this._createChainableMethod('debug')\n  // page = this._createMethod('page')\n  once = this._createChainableMethod('once')\n  off = this._createChainableMethod('off')\n  on = this._createChainableMethod('on')\n  addSourceMiddleware = this._createMethod('addSourceMiddleware')\n  // setAnonymousId = this._createMethod('setAnonymousId')\n  // addDestinationMiddleware = this._createMethod('addDestinationMiddleware')\n\n  // screen = this._createMethod('screen')\n  register = this._createMethod('register')\n  deregister = this._createMethod('deregister')\n  user = this._createMethod('user')\n  readonly VERSION = version\n\n  private _createMethod<T extends PreInitMethodName>(methodName: T) {\n    return (\n      ...args: Parameters<Receiver[T]>\n    ): Promise<ReturnTypeUnwrap<Receiver[T]>> => {\n      if (this.instance) {\n        const result = (this.instance[methodName] as Function)(...args)\n        return Promise.resolve(result)\n      }\n      return new Promise((resolve, reject) => {\n        this._preInitBuffer.push(\n          new PreInitMethodCall(methodName, args, resolve as any, reject)\n        )\n      })\n    }\n  }\n\n  /**\n   *  These are for methods that where determining when the method gets \"flushed\" is not important.\n   *  These methods will resolve when receiver is fully initialized, and return type (other than Receiver)will not be available.\n   */\n  private _createChainableMethod<T extends PreInitMethodName>(methodName: T) {\n    return (...args: Parameters<Receiver[T]>): ReceiverBuffered => {\n      if (this.instance) {\n        void (this.instance[methodName] as Function)(...args)\n        return this\n      } else {\n        this._preInitBuffer.push(new PreInitMethodCall(methodName, args))\n      }\n\n      return this\n    }\n  }\n}\n","import {\n  DispatchedEvent,\n  EventParams,\n  resolveArguments,\n  resolveUserArguments,\n  IdentifyParams,\n} from '../arguments-resolver'\nimport type { FormArgs, LinkArgs } from '../auto-track'\nimport { isOffline } from '../connection'\nimport { Context } from '../context'\nimport { dispatch, Emitter } from '@tronic/receiver-core'\nimport {\n  Callback,\n  EventFactory,\n  // Integrations,\n  Plan,\n  EventProperties,\n  TronicEvent,\n} from '../events'\nimport type { Plugin } from '../plugin'\nimport { EventQueue } from '../queue/event-queue'\nimport { Group, ID, User, UserOptions } from '../user'\nimport autoBind from '../../lib/bind-all'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport type {\n  DestinationMiddlewareFunction,\n  MiddlewareFunction,\n} from '../../plugins/middleware'\nimport { version } from '../../generated/version'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { getGlobal } from '../../lib/get-global'\nimport { ReceiverCore } from './interfaces'\nimport { HighEntropyHint } from '../../lib/client-hints/interfaces'\n// import type { ExternalSettings } from '../../browser'\nimport {\n  CookieOptions,\n  MemoryStorage,\n  UniversalStorage,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\nimport { PluginFactory } from '../../plugins/remote-loader'\n// import { setGlobalReceiver } from '../../lib/global-receiver-helper'\nimport { popPageContext } from '../buffer'\nimport { MetricsOptions } from 'core/stats/remote-metrics'\n\ntype LegacyDestination = any;\n\nconst deprecationWarning =\n  'This is being deprecated and will be not be available in future releases of Receiver JS'\n\n// reference any pre-existing \"receiver\" object so a user can restore the reference\nconst global: any = getGlobal()\nconst _receiver = global?.receiver\n\nfunction createDefaultQueue(\n  name: string,\n  retryQueue = false,\n  disablePersistance = false\n) {\n  const maxAttempts = retryQueue ? 4 : 1\n  const priorityQueue = disablePersistance\n    ? new PriorityQueue(maxAttempts, [])\n    : new PersistedPriorityQueue(maxAttempts, name)\n  return new EventQueue(priorityQueue)\n}\n\n/*\nexport interface ReceiverSettings {\n  writeKey: string\n  timeout?: number\n  plugins?: (Plugin | PluginFactory)[]\n}\n*/\n\nexport interface InitOptions {\n\n  // export interface ReceiverSettings {\n  writeKey?: string\n  timeout?: number\n  plugins?: (Plugin | PluginFactory)[]\n  pluginSettings?: Record<string, any>\n\n  // export interface ExternalSettings {\n  metrics?: MetricsOptions\n\n  remotePlugins?: any[] // RemotePlugin[]\n\n  // Top level consent settings\n  consentSettings?: {\n\n    // All unique consent categories.\n    // There can be categories in this array that are important for consent that are not included in any integration  (e.g. 2 cloud mode categories).\n    // @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n\n    allCategories: string[]\n  }\n\n  // The settings for the Tronic Source.\n  // If provided, `ReceiverBrowser` will not fetch remote settings\n  // for the source.\n\n  cdnSettings?: /* ExternalSettings & */ Record<string, unknown>\n    // If provided, will override the default CDN.\n\n  cdnURL?: string\n\n  // Disables storing any data on the client-side via cookies or localstorage.\n  // Defaults to `false`.\n  disableClientPersistence?: boolean\n\n  // Disables automatically converting ISO string event properties into Dates.\n  // ISO string to Date conversions occur right before sending events to a classic device mode integration,\n  // after any destination middleware have been ran.\n  // Defaults to `false`.\n  disableAutoISOConversion?: boolean\n  initialPageview?: boolean\n  cookie?: CookieOptions\n  storage?: StorageSettings\n  user?: UserOptions\n  group?: UserOptions\n\n  plan?: Plan\n  retryQueue?: boolean\n  obfuscate?: boolean\n\n  // This callback allows you to update/mutate CDN Settings.\n  // This is called directly after settings are fetched from the CDN.\n  // updateCDNSettings?: (settings: ExternalSettings) => ExternalSettings\n\n  // Disables or sets constraints on processing of query string parameters\n  useQueryString?:\n  | boolean\n  | {\n    aid?: RegExp\n    uid?: RegExp\n  }\n  // Array of high entropy Client Hints to request. These may be rejected by the user agent - only required hints should be requested.\n  highEntropyValuesClientHints?: HighEntropyHint[]\n  // When using the snippet, this is the key that points to the global receiver instance (e.g. window.receiver).\n  // default: receiver\n  globalReceiverKey?: string\n}\n\nexport class Receiver\n  extends Emitter\n  implements ReceiverCore {\n  // protected settings: ReceiverSettings\n  private _user: User\n  private _group: Group\n  private eventFactory: EventFactory\n  private _debug = false\n  private _universalStorage: UniversalStorage\n\n  initialized = false\n  options: InitOptions\n  queue: EventQueue\n\n  constructor(\n    // settings: ReceiverSettings,\n    options: InitOptions,\n    queue?: EventQueue,\n    user?: User,\n    group?: Group\n  ) {\n    super()\n    const cookieOptions = options?.cookie\n    const disablePersistance = options?.disableClientPersistence ?? false\n    // this.settings = settings\n    // this.settings.timeout = this.settings.timeout ?? 300\n    this.queue =\n      queue ??\n      createDefaultQueue(\n        `${options.writeKey}:event-queue`,\n        options?.retryQueue,\n        disablePersistance\n      )\n\n    const storageSetting = options?.storage\n    this._universalStorage = this.createStore(\n      disablePersistance,\n      storageSetting,\n      cookieOptions\n    )\n\n    this._user =\n      user ??\n      new User(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any User specific options override everything else\n          ...options?.user,\n        },\n        cookieOptions\n      ).load()\n    this._group =\n      group ??\n      new Group(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any group specific options override everything else\n          ...options?.group,\n        },\n        cookieOptions\n      ).load()\n    this.eventFactory = new EventFactory(this._user)\n    // this.integrations = options?.integrations ?? {}\n    this.options = options; // ?? {}\n    autoBind(this)\n  }\n\n  user = (): User => {\n    return this._user\n  }\n\n  // Creates the storage system based on the settings received\n  private createStore(\n    disablePersistance: boolean,\n    storageSetting: InitOptions['storage'],\n    cookieOptions?: CookieOptions | undefined\n  ): UniversalStorage {\n    // DisablePersistance option overrides all, no storage will be used outside of memory even if specified\n    if (disablePersistance) {\n      return new UniversalStorage([new MemoryStorage()])\n    } else {\n      if (storageSetting) {\n        if (isArrayOfStoreType(storageSetting)) {\n          // We will create the store with the priority for customer settings\n          return new UniversalStorage(\n            initializeStorages(\n              applyCookieOptions(storageSetting.stores, cookieOptions)\n            )\n          )\n        }\n      }\n    }\n    // We default to our multi storage with priority\n    return new UniversalStorage(\n      initializeStorages([\n        StoreType.LocalStorage,\n        {\n          name: StoreType.Cookie,\n          settings: cookieOptions,\n        },\n        StoreType.Memory,\n      ])\n    )\n  }\n\n  get storage(): UniversalStorage {\n    return this._universalStorage\n  }\n\n  async track(...args: EventParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [name, channelId, data, opts, cb] = resolveArguments(...args)\n\n    const tronicEvent: any = this.eventFactory.track(\n      name,\n      channelId,\n      data as EventProperties,\n      opts,\n      pageCtx\n    )\n\n    return this._dispatch(tronicEvent, cb).then((ctx) => {\n      this.emit('track', name, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async identify(...args: IdentifyParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [channelId, id, _traits, options, callback] = resolveUserArguments(this._user)(\n      ...args\n    )\n\n    this._user.identify(id, _traits)\n\n    const tronicEvent = this.eventFactory.identify(\n      this._user.id(),\n      channelId,\n      this._user.traits(),\n      options,\n      pageCtx\n    )\n\n    return this._dispatch(tronicEvent, callback).then((ctx) => {\n      this.emit(\n        'identify',\n        ctx.event.userId,\n        ctx.event.traits,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  async trackClick(...args: LinkArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackLink(...args: LinkArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackSubmit(...args: FormArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async trackForm(...args: FormArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async register(...plugins: Plugin[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const registrations = plugins.map((xt) =>\n      this.queue.register(ctx, xt, this)\n    )\n    await Promise.all(registrations)\n\n    return ctx\n  }\n\n  async deregister(...plugins: string[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const deregistrations = plugins.map((pl) => {\n      const plugin = this.queue.plugins.find((p) => p.name === pl)\n      if (plugin) {\n        return this.queue.deregister(ctx, plugin, this)\n      } else {\n        ctx.log('warn', `plugin ${pl} not found`)\n      }\n    })\n\n    await Promise.all(deregistrations)\n\n    return ctx\n  }\n\n  debug(toggle: boolean): Receiver {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug')\n    }\n    this._debug = toggle\n    return this\n  }\n\n  reset(): void {\n    this._user.reset()\n    this._group.reset()\n    this.emit('reset')\n  }\n\n  timeout(timeout: number): void {\n    this.options.timeout = timeout\n  }\n\n  private async _dispatch(\n    event: TronicEvent,\n    callback?: Callback\n  ): Promise<DispatchedEvent> {\n    const ctx = new Context(event)\n    if (isOffline() && !this.options.retryQueue) {\n      return ctx\n    }\n    return dispatch(ctx, this.queue, this, {\n      callback,\n      debug: this._debug,\n      timeout: this.options.timeout,\n    })\n  }\n\n  async addSourceMiddleware(fn: MiddlewareFunction): Promise<Receiver> {\n    await this.queue.criticalTasks.run(async () => {\n      const { sourceMiddlewarePlugin } = await import(\n        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware'\n      )\n\n      /*\n      const integrations: Record<string, boolean> = {}\n    this.queue.plugins.forEach((plugin) => {\n      if (plugin.type === 'destination') {\n        return (integrations[plugin.name] = true)\n      }\n    })\n       */\n      const plugin = sourceMiddlewarePlugin(fn) //, integrations)\n      await this.register(plugin)\n    })\n\n    return this\n  }\n\n  // TODO: This does not have to return a promise?\n  addDestinationMiddleware(\n    integrationName: string,\n    ...middlewares: DestinationMiddlewareFunction[]\n  ): Promise<Receiver> {\n    const legacyDestinations = this.queue.plugins.filter(\n      (xt) => xt.name.toLowerCase() === integrationName.toLowerCase()\n    ) as LegacyDestination[]\n\n    legacyDestinations.forEach((destination) => {\n      destination.addMiddleware(...middlewares)\n    })\n    return Promise.resolve(this)\n  }\n\n  setAnonymousId(id?: string): ID {\n    return this._user.anonymousId(id)\n  }\n\n  async queryString(query: string): Promise<Context[]> {\n    if (this.options.useQueryString === false) {\n      return []\n    }\n\n    const { queryString } = await import(\n      /* webpackChunkName: \"queryString\" */ '../query-string'\n    )\n    return queryString(this, query)\n  }\n\n  async ready(\n    callback: Function = (res: Promise<unknown>[]): Promise<unknown>[] => res\n  ): Promise<unknown> {\n    return Promise.all(\n      this.queue.plugins.map((i) => (i.ready ? i.ready() : Promise.resolve()))\n    ).then((res) => {\n      callback(res)\n      return res\n    })\n  }\n\n  get VERSION(): string {\n    return version\n  }\n\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  push(args: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const an = this as any\n    const method = args.shift()\n    if (method) {\n      if (!an[method]) return\n    }\n    an[method].apply(this, args)\n  }\n}\n","/**\n * Return a promise that can be externally resolved\n */\nexport const createDeferred = <T>() => {\n  let resolve!: (value: T | PromiseLike<T>) => void\n  let reject!: (reason: any) => void\n  const promise = new Promise<T>((_resolve, _reject) => {\n    resolve = _resolve\n    reject = _reject\n  })\n  return {\n    resolve,\n    reject,\n    promise,\n  }\n}\n","import { HighEntropyHint, NavigatorUAData, UADataValues } from './interfaces'\n\nexport async function clientHints(\n  hints?: HighEntropyHint[]\n): Promise<UADataValues | undefined> {\n  const userAgentData = (navigator as any).userAgentData as\n    | NavigatorUAData\n    | undefined\n\n  if (!userAgentData) return undefined\n\n  if (!hints) return userAgentData.toJSON()\n  return userAgentData\n    .getHighEntropyValues(hints)\n    .catch(() => userAgentData.toJSON())\n}\n","import jar from 'js-cookie'\nimport type { Context } from '../../core/context'\nimport type { Plugin } from '../../core/plugin'\nimport { version } from '../../generated/version'\nimport { TronicEvent } from '../../core/events'\nimport { Campaign, PluginType } from '@tronic/receiver-core'\nimport { getVersionType } from '../../lib/version-type'\nimport { tld } from '../../core/user/tld'\nimport { gracefulDecodeURIComponent } from '../../core/query-string/gracefulDecodeURIComponent'\nimport { CookieStorage, UniversalStorage } from '../../core/storage'\nimport { Receiver } from '../../core/receiver'\nimport { clientHints } from '../../lib/client-hints'\nimport { UADataValues } from '../../lib/client-hints/interfaces'\n\nlet cookieOptions: jar.CookieAttributes | undefined\nfunction getCookieOptions(): jar.CookieAttributes {\n  if (cookieOptions) {\n    return cookieOptions\n  }\n\n  const domain = tld(window.location.href)\n  cookieOptions = {\n    expires: 31536000000, // 1 year\n    secure: false,\n    path: '/',\n  }\n  if (domain) {\n    cookieOptions.domain = domain\n  }\n\n  return cookieOptions\n}\n\ntype Ad = { id: string; type: string }\n\nfunction ads(query: string): Ad | undefined {\n  const queryIds: Record<string, string> = {\n    btid: 'dataxu',\n    urid: 'millennial-media',\n  }\n\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n  const parts = query.split('&')\n\n  for (const part of parts) {\n    const [k, v] = part.split('=')\n    if (queryIds[k]) {\n      return {\n        id: v,\n        type: queryIds[k],\n      }\n    }\n  }\n}\n\nexport function utm(query: string): Campaign {\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n\n  return query.split('&').reduce((acc, str) => {\n    const [k, v = ''] = str.split('=')\n    if (k.includes('utm_') && k.length > 4) {\n      let utmParam = k.slice(4) as keyof Campaign\n      if (utmParam === 'campaign') {\n        utmParam = 'name'\n      }\n      acc[utmParam] = gracefulDecodeURIComponent(v)\n    }\n    return acc\n  }, {} as Campaign)\n}\n\nexport function ampId(): string | undefined {\n  const ampId = jar.get('_ga')\n  if (ampId && ampId.startsWith('amp')) {\n    return ampId\n  }\n}\n\nfunction referrerId(\n  query: string,\n  ctx: TronicEvent['context'],\n  disablePersistance: boolean\n): void {\n  const storage = new UniversalStorage<{\n    's:context.referrer': Ad\n  }>(disablePersistance ? [] : [new CookieStorage(getCookieOptions())])\n\n  const stored = storage.get('s:context.referrer')\n\n  const ad = ads(query) ?? stored\n\n  if (!ad) {\n    return\n  }\n\n  if (ctx) {\n    ctx.referrer = { ...ctx.referrer, ...ad }\n  }\n\n  storage.set('s:context.referrer', ad)\n}\n\n/**\n *\n * @param obj e.g. { foo: 'b', bar: 'd', baz: ['123', '456']}\n * @returns e.g. 'foo=b&bar=d&baz=123&baz=456'\n */\nconst objectToQueryString = (\n  obj: Record<string, string | string[]>\n): string => {\n  try {\n    const searchParams = new URLSearchParams()\n    Object.entries(obj).forEach(([k, v]) => {\n      if (Array.isArray(v)) {\n        v.forEach((value) => searchParams.append(k, value))\n      } else {\n        searchParams.append(k, v)\n      }\n    })\n    return searchParams.toString()\n  } catch {\n    return ''\n  }\n}\n\nclass EnvironmentEnrichmentPlugin implements Plugin {\n  private instance!: Receiver\n  private userAgentData: UADataValues | undefined\n\n  name = 'Page Enrichment'\n  type: PluginType = 'before'\n  version = '0.1.0'\n  isLoaded = () => true\n  load = async (_ctx: Context, instance: Receiver) => {\n    this.instance = instance\n    try {\n      this.userAgentData = await clientHints(\n        this.instance.options.highEntropyValuesClientHints\n      )\n    } catch (_) {\n      // if client hints API doesn't return anything leave undefined\n    }\n    return Promise.resolve()\n  }\n\n  private enrich = (ctx: Context): Context => {\n    // Note: Types are off - context should never be undefined here, since it is set as part of event creation.\n    const evtCtx = ctx.event.context!\n\n    const search = evtCtx.page!.search || ''\n\n    const query =\n      typeof search === 'object' ? objectToQueryString(search) : search\n\n    evtCtx.userAgent = navigator.userAgent\n    evtCtx.userAgentData = this.userAgentData\n\n    // @ts-ignore\n    const locale = navigator.userLanguage || navigator.language\n\n    if (typeof evtCtx.locale === 'undefined' && typeof locale !== 'undefined') {\n      evtCtx.locale = locale\n    }\n\n    evtCtx.library ??= {\n      name: 'receiver.js',\n      version: `${getVersionType() === 'web' ? 'next' : 'npm:next'}-${version}`,\n    }\n\n    if (query && !evtCtx.campaign) {\n      evtCtx.campaign = utm(query)\n    }\n\n    const amp = ampId()\n    if (amp) {\n      evtCtx.amp = { id: amp }\n    }\n\n    referrerId(\n      query,\n      evtCtx,\n      this.instance.options.disableClientPersistence ?? false\n    )\n\n    try {\n      evtCtx.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone\n    } catch (_) {\n      // If browser doesn't have support leave timezone undefined\n    }\n\n    return ctx\n  }\n\n  track = this.enrich\n  identify = this.enrich\n}\n\nexport const envEnrichment = new EnvironmentEnrichmentPlugin()\n","function findScript(src: string): HTMLScriptElement | undefined {\n  const scripts = Array.prototype.slice.call(\n    window.document.querySelectorAll('script')\n  )\n  return scripts.find((s) => s.src === src)\n}\n\nexport function loadScript(\n  src: string,\n  attributes?: Record<string, string>\n): Promise<HTMLScriptElement> {\n  const found = findScript(src)\n\n  if (found !== undefined) {\n    const status = found?.getAttribute('status')\n\n    if (status === 'loaded') {\n      return Promise.resolve(found)\n    }\n\n    if (status === 'loading') {\n      return new Promise((resolve, reject) => {\n        found.addEventListener('load', () => resolve(found))\n        found.addEventListener('error', (err) => reject(err))\n      })\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    const script = window.document.createElement('script')\n\n    script.type = 'text/javascript'\n    script.src = src\n    script.async = true\n\n    script.setAttribute('status', 'loading')\n    for (const [k, v] of Object.entries(attributes ?? {})) {\n      script.setAttribute(k, v)\n    }\n\n    script.onload = (): void => {\n      script.onerror = script.onload = null\n      script.setAttribute('status', 'loaded')\n      resolve(script)\n    }\n\n    script.onerror = (): void => {\n      script.onerror = script.onload = null\n      script.setAttribute('status', 'error')\n      reject(new Error(`Failed to load ${src}`))\n    }\n\n    const tag = window.document.getElementsByTagName('script')[0]\n    tag.parentElement?.insertBefore(script, tag)\n  })\n}\n\nexport function unloadScript(src: string): Promise<void> {\n  const found = findScript(src)\n\n  if (found !== undefined) {\n    found.remove()\n  }\n\n  return Promise.resolve()\n}\n","// import { ExternalSettings } from '../../browser'\nimport { JSONObject, JSONValue } from '../../core/events'\nimport { DestinationPlugin, Plugin } from '../../core/plugin'\nimport { loadScript } from '../../lib/load-script'\nimport { getCDN } from '../../lib/parse-cdn'\nimport {\n  applyDestinationMiddleware,\n  DestinationMiddlewareFunction,\n} from '../middleware'\nimport { Context, ContextCancelation } from '../../core/context'\nimport { InitOptions, Receiver } from '../../core/receiver'\n\nexport interface RemotePluginConfig {\n  // The name of the remote plugin\n  name: string\n  // The creation name of the remote plugin\n  creationName: string\n  // The url of the javascript file to load\n  url: string\n  // The UMD/global name the plugin uses. Plugins are expected to exist here with the `PluginFactory` method signature\n  libraryName: string\n  // The settings related to this plugin.\n  settings: JSONObject\n}\n\nexport class RemoteDestinationPlugin implements DestinationPlugin {\n  name: string // destination name\n  version = '1.0.0'\n  type: Plugin['type']\n\n  alternativeNames: string[] = []\n\n  middleware: DestinationMiddlewareFunction[] = []\n\n  action: Plugin\n\n  constructor(name: string, action: Plugin) {\n    this.action = action\n    this.name = name\n    this.type = action.type\n    this.alternativeNames.push(action.name)\n  }\n\n  addMiddleware(...fn: DestinationMiddlewareFunction[]): void {\n    if (this.type === 'destination') {\n      this.middleware.push(...fn)\n    }\n  }\n\n  private async transform(ctx: Context): Promise<Context> {\n    const modifiedEvent = await applyDestinationMiddleware(\n      this.name,\n      ctx.event,\n      this.middleware\n    )\n\n    if (modifiedEvent === null) {\n      ctx.cancel(\n        new ContextCancelation({\n          retry: false,\n          reason: 'dropped by destination middleware',\n        })\n      )\n    }\n\n    return new Context(modifiedEvent!)\n  }\n\n  private _createMethod(\n    methodName: 'track' | 'identify'\n  ) {\n    return async (ctx: Context): Promise<Context> => {\n      if (!this.action[methodName]) return ctx\n\n      let transformedContext: Context = ctx\n      // Transformations only allowed for destination plugins. Other plugin types support mutating events.\n      if (this.type === 'destination') {\n        transformedContext = await this.transform(ctx)\n      }\n\n      await this.action[methodName]!(transformedContext)\n\n      return ctx\n    }\n  }\n\n  identify = this._createMethod('identify')\n  track = this._createMethod('track')\n\n  // --- PASSTHROUGH METHODS ---\n  isLoaded(): boolean {\n    return this.action.isLoaded()\n  }\n\n  ready(): Promise<unknown> {\n    return this.action.ready ? this.action.ready() : Promise.resolve()\n  }\n\n  load(ctx: Context, receiver: Receiver): Promise<unknown> {\n    return this.action.load(ctx, receiver)\n  }\n\n  unload(ctx: Context, receiver: Receiver): Promise<unknown> | unknown {\n    return this.action.unload?.(ctx, receiver)\n  }\n}\n\nexport type PluginFactory = {\n  (settings: JSONValue): Plugin | Plugin[] | Promise<Plugin | Plugin[]>\n  pluginName: string\n}\n\nfunction validate(pluginLike: unknown): pluginLike is Plugin[] {\n  if (!Array.isArray(pluginLike)) {\n    throw new Error('Not a valid list of plugins')\n  }\n\n  const required = ['load', 'isLoaded', 'name', 'version', 'type']\n  pluginLike.forEach((plugin) => {\n    required.forEach((method) => {\n      if (plugin[method] === undefined) {\n        throw new Error(\n          `Plugin: ${\n            plugin.name ?? 'unknown'\n          } missing required function ${method}`\n        )\n      }\n    })\n  })\n\n  return true\n}\n\nfunction isPluginDisabled(\n  // userIntegrations: Integrations,\n  // remotePlugin: RemotePluginConfig\n) {\n  /*\n  const creationNameEnabled = userIntegrations[remotePlugin.creationName]\n  const currentNameEnabled = userIntegrations[remotePlugin.name]\n\n  // Check that the plugin isn't explicitly enabled when All: false\n  if (\n    userIntegrations.All === false &&\n    !creationNameEnabled &&\n    !currentNameEnabled\n  ) {\n    return true\n  }\n\n  // Check that the plugin isn't explicitly disabled\n  if (creationNameEnabled === false || currentNameEnabled === false) {\n    return true\n  }\n   */\n  return false\n}\n\nasync function loadPluginFactory(\n  remotePlugin: RemotePluginConfig,\n  obfuscate?: boolean\n): Promise<void | PluginFactory> {\n  const defaultCdn = new RegExp('https://cdn.tronic.(com|build)')\n  const cdn = getCDN()\n\n  if (obfuscate) {\n    const urlSplit = remotePlugin.url.split('/')\n    const name = urlSplit[urlSplit.length - 2]\n    const obfuscatedURL = remotePlugin.url.replace(\n      name,\n      btoa(name).replace(/=/g, '')\n    )\n    try {\n      await loadScript(obfuscatedURL.replace(defaultCdn, cdn))\n    } catch (error) {\n      // Due to syncing concerns it is possible that the obfuscated action destination (or requested version) might not exist.\n      // We should use the unobfuscated version as a fallback.\n      await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n    }\n  } else {\n    await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n  }\n\n  // @ts-expect-error\n  if (typeof window[remotePlugin.libraryName] === 'function') {\n    // @ts-expect-error\n    return window[remotePlugin.libraryName] as PluginFactory\n  }\n}\n\nexport async function remoteLoader(\n  // settings: ExternalSettings,\n  // obfuscate?: boolean,\n  options: InitOptions,\n  pluginSources?: PluginFactory[]\n): Promise<Plugin[]> {\n  const allPlugins: Plugin[] = []\n\n  const pluginPromises = (options.remotePlugins ?? []).map(\n    async (remotePlugin) => {\n      if (isPluginDisabled(/* userIntegrations, remotePlugin */)) return\n\n      try {\n        const pluginFactory =\n          pluginSources?.find(\n            ({ pluginName }) => pluginName === remotePlugin.name\n          ) || (await loadPluginFactory(remotePlugin, options.obfuscate))\n\n        if (pluginFactory) {\n          const plugin = await pluginFactory({\n            ...remotePlugin.settings,\n          })\n          const plugins = Array.isArray(plugin) ? plugin : [plugin]\n\n          validate(plugins)\n\n          plugins.forEach((plugin) => {\n            const wrapper = new RemoteDestinationPlugin(\n              remotePlugin.creationName,\n              plugin\n            )\n\n            allPlugins.push(wrapper)\n          })\n        }\n      } catch (error) {\n        console.warn('Failed to load Remote Plugin', error)\n      }\n    }\n  )\n\n  await Promise.all(pluginPromises)\n  return allPlugins.filter(Boolean)\n}\n","/**\n * Register event listener on document that fires when:\n * * tab change or tab close (in mobile or desktop)\n * * click back / forward button\n * * click any link or perform any other navigation action\n * * soft refresh / hard refresh\n *\n * adapted from https://stackoverflow.com/questions/3239834/window-onbeforeunload-not-working-on-the-ipad/52864508#52864508,\n */\nexport const onPageChange = (cb: (unloaded: boolean) => void) => {\n  let unloaded = false // prevents double firing if both are supported\n\n  window.addEventListener('pagehide', () => {\n    if (unloaded) return\n    unloaded = true\n    cb(unloaded)\n  })\n\n  // using document instead of window because of bug affecting browsers before safari 14 (detail in footnotes https://caniuse.com/?search=visibilitychange)\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState == 'hidden') {\n      if (unloaded) return\n      unloaded = true\n    } else {\n      unloaded = false\n    }\n    cb(unloaded)\n  })\n}\n","import { TronicEvent } from '../../core/events'\nimport { fetch } from '../../lib/fetch'\nimport { onPageChange } from '../../lib/on-page-change'\n\nexport type BatchingDispatchConfig = {\n  size?: number\n  timeout?: number\n}\n\nconst MAX_PAYLOAD_SIZE = 500\n\nfunction kilobytes(buffer: unknown): number {\n  const size = encodeURI(JSON.stringify(buffer)).split(/%..|./).length - 1\n  return size / 1024\n}\n\n/**\n * Checks if the payload is over or close to\n * the maximum payload size allowed by tracking\n * API.\n */\nfunction approachingTrackingAPILimit(buffer: unknown): boolean {\n  return kilobytes(buffer) >= MAX_PAYLOAD_SIZE - 50\n}\n\nfunction chunks(batch: object[]): Array<object[]> {\n  const result: object[][] = []\n  let index = 0\n\n  batch.forEach((item) => {\n    const size = kilobytes(result[index])\n    if (size >= 64) {\n      index++\n    }\n\n    if (result[index]) {\n      result[index].push(item)\n    } else {\n      result[index] = [item]\n    }\n  })\n\n  return result\n}\n\nexport default function batch(\n  apiHost: string,\n  config?: BatchingDispatchConfig\n) {\n  let buffer: object[] = []\n  let pageUnloaded = false\n\n  const limit = config?.size ?? 10\n  const timeout = config?.timeout ?? 5000\n\n  function sendBatch(batch: object[]) {\n    if (batch.length === 0) {\n      return\n    }\n\n    const writeKey = (batch[0] as TronicEvent)?.writeKey\n\n    // Remove sentAt from every event as batching only needs a single timestamp\n    const updatedBatch = batch.map((event) => {\n      const { sentAt, ...newEvent } = event as TronicEvent\n      return newEvent\n    })\n\n    return fetch(`https://${apiHost}/b`, {\n      keepalive: pageUnloaded,\n      headers: {\n        'Content-Type': 'text/plain',\n      },\n      method: 'post',\n      body: JSON.stringify({\n        writeKey,\n        batch: updatedBatch,\n        sentAt: new Date().toISOString(),\n      }),\n    })\n  }\n\n  async function flush(): Promise<unknown> {\n    if (buffer.length) {\n      const batch = buffer\n      buffer = []\n      return sendBatch(batch)\n    }\n  }\n\n  let schedule: NodeJS.Timeout | undefined\n\n  function scheduleFlush(): void {\n    if (schedule) {\n      return\n    }\n\n    schedule = setTimeout(() => {\n      schedule = undefined\n      flush().catch(console.error)\n    }, timeout)\n  }\n\n  onPageChange((unloaded) => {\n    pageUnloaded = unloaded\n\n    if (pageUnloaded && buffer.length) {\n      const reqs = chunks(buffer).map(sendBatch)\n      Promise.all(reqs).catch(console.error)\n    }\n  })\n\n  async function dispatch(_url: string, body: object): Promise<unknown> {\n    buffer.push(body)\n\n    const bufferOverflow =\n      buffer.length >= limit || approachingTrackingAPILimit(buffer)\n\n    return bufferOverflow || pageUnloaded ? flush() : scheduleFlush()\n  }\n\n  return {\n    dispatch,\n  }\n}\n","import { fetch } from '../../lib/fetch'\n\nexport type Dispatcher = (url: string, body: object) => Promise<unknown>\n\nexport type StandardDispatcherConfig = {\n  keepalive?: boolean\n}\n\nexport default function (writeKey: string, config?: StandardDispatcherConfig): {\n  dispatch: Dispatcher\n} {\n  function dispatch(url: string, body: object): Promise<unknown> {\n    return fetch(url, {\n      keepalive: config?.keepalive,\n      headers: {\n        // 'Content-Type': 'text/plain',\n        'Content-Type': 'application/json',\n        'X-Api-Key': writeKey,\n      },\n      method: 'post',\n      body: JSON.stringify(body),\n    })\n  }\n\n  return {\n    dispatch,\n  }\n}\n","import { Receiver } from '../../core/receiver'\nimport { TronicFacade } from '../../lib/to-facade'\nimport { TronicSettings } from './index'\n\nexport function normalize(\n  receiver: Receiver,\n  json: ReturnType<TronicFacade['json']>,\n  settings?: TronicSettings,\n): object {\n  const user = receiver.user()\n\n  delete json.options\n\n  // json.writeKey = settings?.apiKey\n\n  json.userId = json.userId || user.id()\n  json.anonymousId = json.anonymousId || user.anonymousId()\n\n  // json.sentAt = new Date()\n\n    /*\n  const failed = receiver.queue.failedInitializations || []\n  if (failed.length > 0) {\n    json._metadata = { failedInitializations: failed }\n  }\n     */\n  return json\n}\n","export const pWhile = async <T>(\n  condition: (value: T | undefined) => boolean,\n  action: () => T | PromiseLike<T>\n): Promise<void> => {\n  const loop = async (actionResult: T | undefined): Promise<void> => {\n    if (condition(actionResult)) {\n      return loop(await action())\n    }\n  }\n\n  return loop(undefined)\n}\n","import { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { attempt } from '@tronic/receiver-core'\nimport { pWhile } from '../../lib/p-while'\nimport { PriorityQueue } from '../../lib/priority-queue'\n\nasync function flushQueue(\n  xt: Plugin,\n  queue: PriorityQueue<Context>\n): Promise<PriorityQueue<Context>> {\n  const failedQueue: Context[] = []\n  if (isOffline()) {\n    return queue\n  }\n\n  await pWhile(\n    () => queue.length > 0 && !isOffline(),\n    async () => {\n      const ctx = queue.pop()\n      if (!ctx) {\n        return\n      }\n\n      const result = await attempt(ctx, xt)\n      const success = result instanceof Context\n      if (!success) {\n        failedQueue.push(ctx)\n      }\n    }\n  )\n  // re-add failed tasks\n  failedQueue.map((failed) => queue.pushWithBackoff(failed))\n  return queue\n}\n\nexport function scheduleFlush(\n  flushing: boolean,\n  buffer: PriorityQueue<Context>,\n  xt: Plugin,\n  scheduleFlush: Function\n): void {\n  if (flushing) {\n    return\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  setTimeout(async () => {\n    let isFlushing = true\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const newBuffer = await flushQueue(xt, buffer)\n    isFlushing = false\n\n    if (buffer.todo > 0) {\n      scheduleFlush(isFlushing, newBuffer, xt, scheduleFlush)\n    }\n  }, Math.random() * 5000)\n}\n","import { Facade } from '@segment/facade'\nimport { Receiver } from '../../core/receiver'\nimport { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { toFacade } from '../../lib/to-facade'\nimport batch, { BatchingDispatchConfig } from './batched-dispatcher'\nimport standard, { StandardDispatcherConfig } from './fetch-dispatcher'\nimport { normalize } from './normalize'\nimport { scheduleFlush } from './schedule-flush'\nimport { TRONIC_API_HOST } from '../../core/constants'\n\ntype DeliveryStrategy =\n  | {\n      strategy?: 'standard'\n      config?: StandardDispatcherConfig\n    }\n  | {\n      strategy?: 'batching'\n      config?: BatchingDispatchConfig\n    }\n\nexport type TronicSettings = {\n  apiKey: string\n  apiHost?: string\n  protocol?: 'http' | 'https'\n\n  deliveryStrategy?: DeliveryStrategy\n}\n\n/*\ntype JSON = ReturnType<Facade['json']>\nfunction onAlias(receiver: Receiver, json: JSON): JSON {\n  const user = receiver.user()\n  json.previousId =\n    json.previousId ?? json.from ?? user.id() ?? user.anonymousId()\n  json.userId = json.userId ?? json.to\n  delete json.from\n  delete json.to\n  return json\n}\n  */\n\nexport function tronic(\n  receiver: Receiver,\n  settings?: TronicSettings,\n): Plugin {\n  // Attach `pagehide` before buffer is created so that inflight events are added\n  // to the buffer before the buffer persists events in its own `pagehide` handler.\n  window.addEventListener('pagehide', () => {\n    buffer.push(...Array.from(inflightEvents))\n    inflightEvents.clear()\n  })\n\n  const writeKey = settings?.apiKey ?? ''\n\n  const buffer = receiver.options.disableClientPersistence\n    ? new PriorityQueue<Context>(receiver.queue.queue.maxAttempts, [])\n    : new PersistedPriorityQueue(\n        receiver.queue.queue.maxAttempts,\n        `${writeKey}:dest-tronic`\n      )\n\n  const inflightEvents = new Set<Context>()\n  const flushing = false\n\n  const apiHost = settings?.apiHost ?? TRONIC_API_HOST\n  const protocol = settings?.protocol ?? 'https'\n  const remote = `${protocol}://${apiHost}`\n\n  const deliveryStrategy = settings?.deliveryStrategy\n  const client =\n    deliveryStrategy?.strategy === 'batching'\n      ? batch(apiHost, deliveryStrategy.config)\n      : standard(writeKey, deliveryStrategy?.config as StandardDispatcherConfig)\n\n  async function send(ctx: Context): Promise<Context> {\n    if (isOffline()) {\n      buffer.push(ctx)\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n      return ctx\n    }\n\n    inflightEvents.add(ctx)\n\n    const path = 'external/' + ctx.event.type; // ctx.event.type.charAt(0)\n\n    let json = toFacade(ctx.event).json()\n\n    if (ctx.event.type === 'track') {\n      delete json.type\n      delete json.messageId\n      delete json.traits\n      delete json.writeKey\n      delete json.sentAt\n    }\n\n    /*\n    if (ctx.event.type === 'alias') {\n      json = onAlias(receiver, json)\n    }\n     */\n\n    return client\n      .dispatch(\n        `${remote}/${path}`,\n        normalize(receiver, json, settings)\n      )\n      .then(() => ctx)\n      .catch(() => {\n        buffer.pushWithBackoff(ctx)\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n        return ctx\n      })\n      .finally(() => {\n        inflightEvents.delete(ctx)\n      })\n  }\n\n  const tronic: Plugin = {\n    name: 'Tronic',\n    type: 'after',\n    version: '0.1.0',\n    isLoaded: (): boolean => true,\n    load: (): Promise<void> => Promise.resolve(),\n    track: send,\n    identify: send,\n  }\n\n  // Buffer may already have items if they were previously stored in localStorage.\n  // Start flushing them immediately.\n  if (buffer.todo) {\n    scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n  }\n\n  return tronic\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar ValidationError = /** @class */ (function (_super) {\n    __extends(ValidationError, _super);\n    function ValidationError(field, message) {\n        var _this = _super.call(this, \"\".concat(field, \" \").concat(message)) || this;\n        _this.field = field;\n        return _this;\n    }\n    return ValidationError;\n}(Error));\nexport { ValidationError };\n//# sourceMappingURL=errors.js.map","import { ValidationError } from './errors';\nimport { isString, isPlainObject, exists } from './helpers';\nvar stringError = 'is not a string';\nvar objError = 'is not an object';\nvar nilError = 'is nil';\nexport function assertUserIdentity(event) {\n    var USER_FIELD_NAME = '.userId/anonymousId/previousId/groupId';\n    var getAnyUserId = function (event) { var _a, _b, _c; return (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId; };\n    var id = getAnyUserId(event);\n    if (!exists(id)) {\n        throw new ValidationError(USER_FIELD_NAME, nilError);\n    }\n    else if (!isString(id)) {\n        throw new ValidationError(USER_FIELD_NAME, stringError);\n    }\n}\nexport function assertEventExists(event) {\n    if (!exists(event)) {\n        throw new ValidationError('Event', nilError);\n    }\n    if (typeof event !== 'object') {\n        throw new ValidationError('Event', objError);\n    }\n}\nexport function assertEventType(event) {\n    if (!isString(event.type)) {\n        throw new ValidationError('.type', stringError);\n    }\n}\nexport function assertTrackEventName(event) {\n    if (!isString(event.event)) {\n        throw new ValidationError('.event', stringError);\n    }\n}\nexport function assertTrackEventProperties(event) {\n    if (!isPlainObject(event.properties)) {\n        throw new ValidationError('.properties', objError);\n    }\n}\nexport function assertTraits(event) {\n    if (!isPlainObject(event.traits)) {\n        throw new ValidationError('.traits', objError);\n    }\n}\nexport function validateEvent(event) {\n    assertEventExists(event);\n    assertEventType(event);\n    if (event.type === 'track') {\n        assertTrackEventName(event);\n        assertTrackEventProperties(event);\n    }\n    if (['group', 'identify'].includes(event.type)) {\n        assertTraits(event);\n    }\n    assertUserIdentity(event);\n}\n//# sourceMappingURL=assertions.js.map","import type { Plugin } from '../../core/plugin'\nimport type { Context } from '../../core/context'\nimport {\n  assertUserIdentity,\n  isPlainObject,\n  ValidationError,\n  assertEventExists,\n  assertEventType,\n  assertTrackEventName,\n} from '@tronic/receiver-core'\n\nfunction validate(ctx: Context): Context {\n  const event = ctx.event\n  assertEventExists(event)\n  assertEventType(event)\n\n  if (event.type === 'track') {\n    assertTrackEventName(event)\n  }\n\n    /*\n  const props = event.properties ?? event.traits\n  if (event.type !== 'alias' && !isPlainObject(props)) {\n    throw new ValidationError('.properties', 'is not an object')\n  }\n     */\n\n  assertUserIdentity(event)\n  return ctx\n}\n\nexport const validation: Plugin = {\n  name: 'Event Validation',\n  type: 'before',\n  version: '1.0.0',\n\n  isLoaded: () => true,\n  load: () => Promise.resolve(),\n\n  track: validate,\n  identify: validate,\n}\n","import { getGlobal } from '../../lib/get-global'\nimport type { Receiver } from '../receiver'\n\nconst env = getGlobal()\n\n// The code below assumes the inspector extension will use Object.assign\n// to add the inspect interface on to this object reference (unless the\n// extension code ran first and has already set up the variable)\nconst inspectorHost: {\n  attach: (receiver: Receiver) => void\n} = ((env as any)['__TRONIC_INSPECTOR__'] ??= {})\n\nexport const attachInspector = (receiver: Receiver) =>\n  inspectorHost.attach?.(receiver as any)\n","import { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\n\n// import { fetch } from '../lib/fetch'\nimport { Receiver, /* ReceiverSettings, */ InitOptions } from '../core/receiver'\nimport { Context } from '../core/context'\nimport { Plugin } from '../core/plugin'\n// import { MetricsOptions } from '../core/stats/remote-metrics'\n// import { mergedOptions } from '../lib/merged-options'\nimport { createDeferred } from '../lib/create-deferred'\nimport { envEnrichment } from '../plugins/env-enrichment'\nimport {\n  PluginFactory,\n  remoteLoader,\n  // RemotePlugin,\n} from '../plugins/remote-loader'\nimport { tronic, TronicSettings } from '../plugins/tronic'\nimport { validation } from '../plugins/validation'\nimport {\n  ReceiverBuffered,\n  PreInitMethodCallBuffer,\n  flushReceiverCallsInNewTask,\n  flushAddSourceMiddleware,\n  // flushSetAnonymousID,\n  flushOn,\n} from '../core/buffer'\nimport { attachInspector } from '../core/inspector'\nimport { Stats } from '../core/stats'\nimport { setGlobalReceiverKey } from '../lib/global-receiver-helper'\n\n/*\nexport interface LegacyIntegrationConfiguration {\n// @deprecated - This does not indicate browser types anymore\n  type?: string\n\n  versionSettings?: {\n    version?: string\n    override?: string\n    componentTypes?: Array<'browser' | 'android' | 'ios' | 'server'>\n  }\n\n  bundlingStatus?: string\n\n // Consent settings for the integration\n  consentSettings?: {\n  // Consent categories for the integration\n  // @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n    categories: string[]\n  }\n\n  // Tronic.com specific\n  // retryQueue?: boolean\n\n  // any extra unknown settings\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\n*/\n\n/*\nexport interface ExternalSettings {\n\n  metrics?: MetricsOptions\n\n  remotePlugins?: RemotePlugin[]\n\n  // Top level consent settings\n  consentSettings?: {\n\n     // All unique consent categories.\n     // There can be categories in this array that are important for consent that are not included in any integration  (e.g. 2 cloud mode categories).\n     // @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n\n    allCategories: string[]\n  }\n}\n\nexport interface ReceiverBrowserSettings extends ReceiverSettings {\n\n  // The settings for the Tronic Source.\n  // If provided, `ReceiverBrowser` will not fetch remote settings\n  // for the source.\n\n  cdnSettings?: ExternalSettings & Record<string, unknown>\n    // If provided, will override the default CDN.\n\n  cdnURL?: string\n}\n  */\n\n/*\nexport function fetchSettings(\n  writeKey: string,\n  cdnURL?: string\n): Promise<ExternalSettings> {\n  const baseUrl = cdnURL ?? getCDN()\n\n  return fetch(`${baseUrl}/v1/projects/${writeKey}/settings`)\n    .then((res) => {\n      if (!res.ok) {\n        return res.text().then((errorResponseMessage) => {\n          throw new Error(errorResponseMessage)\n        })\n      }\n      return res.json()\n    })\n    .catch((err) => {\n      console.error(err.message)\n      throw err\n    })\n}\n */\n\n// With AJS classic, we allow users to call setAnonymousId before the library initialization.\n// This is important because some of the destinations will use the anonymousId during the initialization,\n// and if we set anonId afterwards, that wouldn’t impact the destination.\n//\n// Also Ensures events can be registered before library initialization.\n// This is important so users can register to 'initialize' and any events that may fire early during setup.\nfunction flushPreBuffer(\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void {\n  // flushSetAnonymousID(receiver, buffer)\n  flushOn(receiver, buffer)\n}\n\n// Finish flushing buffer and cleanup.\nasync function flushFinalBuffer(\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): Promise<void> {\n  // Call popSnippetWindowBuffer before each flush task since there may be\n  // receiver calls during async function calls.\n  await flushAddSourceMiddleware(receiver, buffer)\n  flushReceiverCallsInNewTask(receiver, buffer)\n  // Clear buffer, just in case receiver is loaded twice; we don't want to fire events off again.\n  buffer.clear()\n}\n\nasync function registerPlugins(\n  receiver: Receiver,\n  // writeKey: string,\n  // externalSettings: ExternalSettings,\n  options: InitOptions,\n  pluginLikes: (Plugin | PluginFactory)[] = [],\n): Promise<Context> {\n\n  const plugins = pluginLikes?.filter(\n    (pluginLike) => typeof pluginLike === 'object'\n  ) as Plugin[]\n\n  const pluginSources = pluginLikes?.filter(\n    (pluginLike) =>\n      typeof pluginLike === 'function' &&\n      typeof pluginLike.pluginName === 'string'\n  ) as PluginFactory[]\n\n  // const mergedSettings = mergedOptions(externalSettings, options)\n\n  const remotePlugins = await remoteLoader(\n    options, // externalSettings,\n    // { All: true }, // receiver.integrations,\n    // mergedSettings,\n    // options.obfuscate,\n    pluginSources\n  ).catch(() => [])\n\n  const toRegister = [\n    validation,\n    envEnrichment,\n    ...plugins,\n    ...remotePlugins,\n    await tronic(\n      receiver,\n      // mergedSettings['Tronic'] as TronicSettings,\n      options.pluginSettings?.['Tronic'] as TronicSettings,\n    ),\n  ]\n\n  const ctx = await receiver.register(...toRegister)\n\n  /*\nif (\n  Object.entries(externalSettings.enabledMiddleware ?? {}).some(\n    ([, enabled]) => enabled\n  )\n) {\n  await import(\n  //// webpackChunkName: \"remoteMiddleware\" //// '../plugins/remote-middleware'\n  ).then(async ({ remoteMiddlewares }) => {\n    const middleware = await remoteMiddlewares(\n      ctx,\n      externalSettings,\n      options.obfuscate\n    )\n    const promises = middleware.map((mdw) =>\n      receiver.addSourceMiddleware(mdw)\n    )\n    return Promise.all(promises)\n  })\n}\n*/\n\n  return ctx\n}\n\nasync function loadReceiver(\n  // settings: ReceiverBrowserSettings,\n  options: InitOptions,\n  preInitBuffer: PreInitMethodCallBuffer\n): Promise<[Receiver, Context]> {\n\n  if (options.globalReceiverKey) {\n    setGlobalReceiverKey(options.globalReceiverKey)\n  }\n\n  // this is an ugly side-effect, but it's for the benefits of the plugins that get their cdn via getCDN()\n  if (options.cdnURL) {\n    setGlobalCDNUrl(options.cdnURL)\n  }\n\n  /*\nlet externalOptions = options.cdnOptions ?? (await fetchOptions(options.writeKey, options.cdnURL))\n\nif (options.updateCDNOptions) {\n  externalOptions = options.updateCDNOptions(externalOptions)\n}\n   */\n\n  // const retryQueue: boolean =\n  // externalOptions?.integrations?.['Tronic']?.retryQueue ?? true\n\n  // const opts: InitOptions = { retryQueue, ...options }\n  const receiver = new Receiver(options)\n\n  attachInspector(receiver)\n\n  const plugins = options.plugins ?? []\n\n  Stats.initRemoteMetrics(options.metrics)\n\n  // needs to be flushed before plugins are registered\n  flushPreBuffer(receiver, preInitBuffer)\n\n  const ctx = await registerPlugins(\n    receiver,\n    options,\n    plugins,\n  )\n\n  const search = window.location.search ?? ''\n  const hash = window.location.hash ?? ''\n\n  const term = search.length ? search : hash.replace(/(?=#).*(?=\\?)/, '')\n\n  if (term.includes('ajs_')) {\n    await receiver.queryString(term).catch(console.error)\n  }\n\n  receiver.initialized = true\n  receiver.emit('initialize', options)\n\n  /*\nif (options.initialPageview) {\n  receiver.page().catch(console.error)\n}\n   */\n\n  await flushFinalBuffer(receiver, preInitBuffer)\n\n  return [receiver, ctx]\n}\n\nexport class ReceiverBrowser extends ReceiverBuffered {\n  private _resolveLoadStart: (\n    // settings: ReceiverBrowserSettings,\n    options: InitOptions\n  ) => void\n\n  constructor() {\n    const { promise: loadStart, resolve: resolveLoadStart } =\n      createDeferred<Parameters<ReceiverBrowser['load']>>()\n\n    super((buffer) =>\n      loadStart.then(([options]) =>\n        loadReceiver(options, buffer)\n      )\n    )\n\n    this._resolveLoadStart = (options) =>\n      resolveLoadStart([options])\n  }\n\n  //\n  // Fully initialize an receiver instance, including:\n  // Fetching settings from the Tronic CDN (by default).\n  // Fetching all remote destinations configured by the user (if applicable).\n  // Flushing buffered receiver events.\n  // Loading all middleware.\n  //\n  // Note:️  This method should only be called *once* in your application.\n  load(\n    options: InitOptions,\n  ): ReceiverBrowser {\n    this._resolveLoadStart(options)\n    return this\n  }\n\n  // Instantiates an object exposing Receiver methods.\n\n  static load(\n    options: InitOptions,\n  ): ReceiverBrowser {\n    return new ReceiverBrowser().load(options)\n  }\n\n  static standalone(\n    writeKey: string,\n    options?: InitOptions\n  ): Promise<Receiver> {\n    return ReceiverBrowser.load({ ...options, writeKey }).then((res) => res[0])\n  }\n\n}\n","import { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\nimport { setVersionType } from '../lib/version-type'\n\nif (process.env.ASSET_PATH) {\n  if (process.env.ASSET_PATH === '/dist/umd/') {\n    // @ts-ignore\n    __webpack_public_path__ = '/dist/umd/'\n  } else {\n    const cdn = getCDN()\n    setGlobalCDNUrl(cdn) // preserving original behavior -- TODO: neccessary?\n\n    // @ts-ignore\n    __webpack_public_path__ = cdn + '/tronic-receiver/bundles/'\n  }\n}\n\nsetVersionType('web')\n\nexport * from '.'\n"],"names":[],"sourceRoot":""}