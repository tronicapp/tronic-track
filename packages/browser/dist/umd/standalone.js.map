{"version":3,"file":"standalone.js","mappings":"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","sources":["webpack://@tronic/receiver-browser/webpack/runtime/load script","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/address.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/alias.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/clone.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/delete.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/facade.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/group.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/identify.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/index.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/is-email.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/is-enabled.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/page.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/screen.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/facade/dist/track.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/isodate-traverse/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/@segment/isodate/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/inherits/inherits_browser.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/index.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/milliseconds.js","webpack://@tronic/receiver-browser/../../node_modules/new-date/lib/seconds.js","webpack://@tronic/receiver-browser/../../node_modules/obj-case/index.js","webpack://@tronic/receiver-browser/./src/core/environment/index.ts","webpack://@tronic/receiver-browser/./src/core/query-string/gracefulDecodeURIComponent.ts","webpack://@tronic/receiver-browser/./src/lib/embedded-write-key.ts","webpack://@tronic/receiver-browser/./src/lib/global-receiver-helper.ts","webpack://@tronic/receiver-browser/./src/lib/load-script.ts","webpack://@tronic/receiver-browser/./src/lib/parse-cdn.ts","webpack://@tronic/receiver-browser/./src/lib/to-facade.ts","webpack://@tronic/receiver-browser/./src/plugins/middleware/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/callback/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/logger/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/context/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/stats/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/validation/helpers.js","webpack://@tronic/receiver-browser/../../node_modules/@lukeed/uuid/dist/index.mjs","webpack://@tronic/receiver-browser/../../node_modules/dset/dist/index.mjs","webpack://@tronic/receiver-browser/webpack/bootstrap","webpack://@tronic/receiver-browser/webpack/runtime/compat get default export","webpack://@tronic/receiver-browser/webpack/runtime/define property getters","webpack://@tronic/receiver-browser/webpack/runtime/ensure chunk","webpack://@tronic/receiver-browser/webpack/runtime/get javascript chunk filename","webpack://@tronic/receiver-browser/webpack/runtime/hasOwnProperty shorthand","webpack://@tronic/receiver-browser/webpack/runtime/make namespace object","webpack://@tronic/receiver-browser/webpack/runtime/publicPath","webpack://@tronic/receiver-browser/webpack/runtime/jsonp chunk loading","webpack://@tronic/receiver-browser/./src/lib/version-type.ts","webpack://@tronic/receiver-browser/./src/core/arguments-resolver/index.ts","webpack://@tronic/receiver-browser/./src/core/connection/index.ts","webpack://@tronic/receiver-browser/../../node_modules/unfetch/dist/unfetch.module.js","webpack://@tronic/receiver-browser/./src/lib/get-global.ts","webpack://@tronic/receiver-browser/./src/lib/fetch.ts","webpack://@tronic/receiver-browser/./src/generated/version.ts","webpack://@tronic/receiver-browser/./src/core/constants/index.ts","webpack://@tronic/receiver-browser/./src/core/stats/remote-metrics.ts","webpack://@tronic/receiver-browser/./src/core/stats/index.ts","webpack://@tronic/receiver-browser/./src/core/context/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/receiver/dispatch.js","webpack://@tronic/receiver-browser/../core/dist/esm/emitter/index.js","webpack://@tronic/receiver-browser/./src/core/page/get-page-context.ts","webpack://@tronic/receiver-browser/./src/core/page/add-page-context.ts","webpack://@tronic/receiver-browser/./src/core/events/index.ts","webpack://@tronic/receiver-browser/../core/dist/esm/priority-queue/index.js","webpack://@tronic/receiver-browser/../core/dist/esm/priority-queue/backoff.js","webpack://@tronic/receiver-browser/./src/lib/priority-queue/persisted.ts","webpack://@tronic/receiver-browser/../core/dist/esm/utils/group-by.js","webpack://@tronic/receiver-browser/../core/dist/esm/utils/is-thenable.js","webpack://@tronic/receiver-browser/../core/dist/esm/queue/delivery.js","webpack://@tronic/receiver-browser/../core/dist/esm/queue/event-queue.js","webpack://@tronic/receiver-browser/../core/dist/esm/task/task-group.js","webpack://@tronic/receiver-browser/./src/core/queue/event-queue.ts","webpack://@tronic/receiver-browser/./src/lib/bind-all.ts","webpack://@tronic/receiver-browser/./src/core/storage/types.ts","webpack://@tronic/receiver-browser/./src/core/storage/universalStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/memoryStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/settings.ts","webpack://@tronic/receiver-browser/../../node_modules/js-cookie/dist/js.cookie.mjs","webpack://@tronic/receiver-browser/./src/core/user/tld.ts","webpack://@tronic/receiver-browser/./src/core/storage/cookieStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/localStorage.ts","webpack://@tronic/receiver-browser/./src/core/storage/index.ts","webpack://@tronic/receiver-browser/./src/core/user/index.ts","webpack://@tronic/receiver-browser/./src/core/buffer/index.ts","webpack://@tronic/receiver-browser/./src/lib/is-thenable.ts","webpack://@tronic/receiver-browser/./src/core/receiver/index.ts","webpack://@tronic/receiver-browser/./src/lib/create-deferred.ts","webpack://@tronic/receiver-browser/./src/lib/client-hints/index.ts","webpack://@tronic/receiver-browser/./src/plugins/env-enrichment/index.ts","webpack://@tronic/receiver-browser/./src/plugins/remote-loader/index.ts","webpack://@tronic/receiver-browser/./src/lib/on-page-change.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/batched-dispatcher.ts","webpack://@tronic/receiver-browser/./src/lib/p-while.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/schedule-flush.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/index.ts","webpack://@tronic/receiver-browser/./src/plugins/tronic/fetch-dispatcher.ts","webpack://@tronic/receiver-browser/../core/dist/esm/validation/errors.js","webpack://@tronic/receiver-browser/../core/dist/esm/validation/assertions.js","webpack://@tronic/receiver-browser/./src/plugins/validation/index.ts","webpack://@tronic/receiver-browser/./src/core/inspector/index.ts","webpack://@tronic/receiver-browser/./src/browser/index.ts","webpack://@tronic/receiver-browser/./src/lib/merged-options.ts","webpack://@tronic/receiver-browser/./src/browser/standalone-receiver.ts","webpack://@tronic/receiver-browser/./src/browser/standalone.ts","webpack://@tronic/receiver-browser/./src/lib/csp-detection.ts","webpack://@tronic/receiver-browser/./src/lib/browser-polyfill.ts"],"sourcesContent":["var inProgress = {};\nvar dataWebpackPrefix = \"@tronic/receiver-browser:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = function(url, done, key, chunkId) {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function(prev, event) {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach(function(fn) { return fn(event); });\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nfunction trait(a, b) {\n    return function () {\n        var traits = this.traits();\n        var props = this.properties ? this.properties() : {};\n        return (obj_case_1.default(traits, \"address.\" + a) ||\n            obj_case_1.default(traits, a) ||\n            (b ? obj_case_1.default(traits, \"address.\" + b) : null) ||\n            (b ? obj_case_1.default(traits, b) : null) ||\n            obj_case_1.default(props, \"address.\" + a) ||\n            obj_case_1.default(props, a) ||\n            (b ? obj_case_1.default(props, \"address.\" + b) : null) ||\n            (b ? obj_case_1.default(props, b) : null));\n    };\n}\nfunction default_1(proto) {\n    proto.zip = trait(\"postalCode\", \"zip\");\n    proto.country = trait(\"country\");\n    proto.street = trait(\"street\");\n    proto.state = trait(\"state\");\n    proto.city = trait(\"city\");\n    proto.region = trait(\"region\");\n}\nexports.default = default_1;\n//# sourceMappingURL=address.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Alias = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nfunction Alias(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Alias = Alias;\ninherits_1.default(Alias, facade_1.Facade);\nAlias.prototype.action = function () {\n    return \"alias\";\n};\nAlias.prototype.type = Alias.prototype.action;\nAlias.prototype.previousId = function () {\n    return this.field(\"previousId\") || this.field(\"from\");\n};\nAlias.prototype.from = Alias.prototype.previousId;\nAlias.prototype.userId = function () {\n    return this.field(\"userId\") || this.field(\"to\");\n};\nAlias.prototype.to = Alias.prototype.userId;\n//# sourceMappingURL=alias.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.clone = void 0;\nfunction clone(properties) {\n    if (typeof properties !== 'object')\n        return properties;\n    if (Object.prototype.toString.call(properties) === '[object Object]') {\n        var temp = {};\n        for (var key in properties) {\n            if (Object.prototype.hasOwnProperty.call(properties, key)) {\n                temp[key] = clone(properties[key]);\n            }\n        }\n        return temp;\n    }\n    else if (Array.isArray(properties)) {\n        return properties.map(clone);\n    }\n    else {\n        return properties;\n    }\n}\nexports.clone = clone;\n//# sourceMappingURL=clone.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delete = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nfunction Delete(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Delete = Delete;\ninherits_1.default(Delete, facade_1.Facade);\nDelete.prototype.type = function () {\n    return \"delete\";\n};\n//# sourceMappingURL=delete.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Facade = void 0;\nvar address_1 = __importDefault(require(\"./address\"));\nvar clone_1 = require(\"./clone\");\nvar is_enabled_1 = __importDefault(require(\"./is-enabled\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nvar isodate_traverse_1 = __importDefault(require(\"@segment/isodate-traverse\"));\nfunction Facade(obj, opts) {\n    opts = opts || {};\n    this.raw = clone_1.clone(obj);\n    if (!(\"clone\" in opts))\n        opts.clone = true;\n    if (opts.clone)\n        obj = clone_1.clone(obj);\n    if (!(\"traverse\" in opts))\n        opts.traverse = true;\n    if (!(\"timestamp\" in obj))\n        obj.timestamp = new Date();\n    else\n        obj.timestamp = new_date_1.default(obj.timestamp);\n    if (opts.traverse)\n        isodate_traverse_1.default(obj);\n    this.opts = opts;\n    this.obj = obj;\n}\nexports.Facade = Facade;\nvar f = Facade.prototype;\nf.proxy = function (field) {\n    var fields = field.split(\".\");\n    field = fields.shift();\n    var obj = this[field] || this.obj[field];\n    if (!obj)\n        return obj;\n    if (typeof obj === \"function\")\n        obj = obj.call(this) || {};\n    if (fields.length === 0)\n        return this.opts.clone ? transform(obj) : obj;\n    obj = obj_case_1.default(obj, fields.join(\".\"));\n    return this.opts.clone ? transform(obj) : obj;\n};\nf.field = function (field) {\n    var obj = this.obj[field];\n    return this.opts.clone ? transform(obj) : obj;\n};\nFacade.proxy = function (field) {\n    return function () {\n        return this.proxy(field);\n    };\n};\nFacade.field = function (field) {\n    return function () {\n        return this.field(field);\n    };\n};\nFacade.multi = function (path) {\n    return function () {\n        var multi = this.proxy(path + \"s\");\n        if (Array.isArray(multi))\n            return multi;\n        var one = this.proxy(path);\n        if (one)\n            one = [this.opts.clone ? clone_1.clone(one) : one];\n        return one || [];\n    };\n};\nFacade.one = function (path) {\n    return function () {\n        var one = this.proxy(path);\n        if (one)\n            return one;\n        var multi = this.proxy(path + \"s\");\n        if (Array.isArray(multi))\n            return multi[0];\n    };\n};\nf.json = function () {\n    var ret = this.opts.clone ? clone_1.clone(this.obj) : this.obj;\n    if (this.type)\n        ret.type = this.type();\n    return ret;\n};\nf.rawEvent = function () {\n    return this.raw;\n};\nf.options = function (integration) {\n    var obj = this.obj.options || this.obj.context || {};\n    var options = this.opts.clone ? clone_1.clone(obj) : obj;\n    if (!integration)\n        return options;\n    if (!this.enabled(integration))\n        return;\n    var integrations = this.integrations();\n    var value = integrations[integration] || obj_case_1.default(integrations, integration);\n    if (typeof value !== \"object\")\n        value = obj_case_1.default(this.options(), integration);\n    return typeof value === \"object\" ? value : {};\n};\nf.context = f.options;\nf.enabled = function (integration) {\n    var allEnabled = this.proxy(\"options.providers.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = this.proxy(\"options.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = this.proxy(\"integrations.all\");\n    if (typeof allEnabled !== \"boolean\")\n        allEnabled = true;\n    var enabled = allEnabled && is_enabled_1.default(integration);\n    var options = this.integrations();\n    if (options.providers && options.providers.hasOwnProperty(integration)) {\n        enabled = options.providers[integration];\n    }\n    if (options.hasOwnProperty(integration)) {\n        var settings = options[integration];\n        if (typeof settings === \"boolean\") {\n            enabled = settings;\n        }\n        else {\n            enabled = true;\n        }\n    }\n    return !!enabled;\n};\nf.integrations = function () {\n    return (this.obj.integrations || this.proxy(\"options.providers\") || this.options());\n};\nf.active = function () {\n    var active = this.proxy(\"options.active\");\n    if (active === null || active === undefined)\n        active = true;\n    return active;\n};\nf.anonymousId = function () {\n    return this.field(\"anonymousId\") || this.field(\"sessionId\");\n};\nf.sessionId = f.anonymousId;\nf.groupId = Facade.proxy(\"options.groupId\");\nf.traits = function (aliases) {\n    var ret = this.proxy(\"options.traits\") || {};\n    var id = this.userId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"options.traits.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\nf.library = function () {\n    var library = this.proxy(\"options.library\");\n    if (!library)\n        return { name: \"unknown\", version: null };\n    if (typeof library === \"string\")\n        return { name: library, version: null };\n    return library;\n};\nf.device = function () {\n    var device = this.proxy(\"context.device\");\n    if (typeof device !== \"object\" || device === null) {\n        device = {};\n    }\n    var library = this.library().name;\n    if (device.type)\n        return device;\n    if (library.indexOf(\"ios\") > -1)\n        device.type = \"ios\";\n    if (library.indexOf(\"android\") > -1)\n        device.type = \"android\";\n    return device;\n};\nf.userAgent = Facade.proxy(\"context.userAgent\");\nf.timezone = Facade.proxy(\"context.timezone\");\nf.timestamp = Facade.field(\"timestamp\");\nf.channel = Facade.field(\"channel\");\nf.ip = Facade.proxy(\"context.ip\");\nf.userId = Facade.field(\"userId\");\naddress_1.default(f);\nfunction transform(obj) {\n    return clone_1.clone(obj);\n}\n//# sourceMappingURL=facade.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Group = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar facade_1 = require(\"./facade\");\nfunction Group(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Group = Group;\ninherits_1.default(Group, facade_1.Facade);\nvar g = Group.prototype;\ng.action = function () {\n    return \"group\";\n};\ng.type = g.action;\ng.groupId = facade_1.Facade.field(\"groupId\");\ng.created = function () {\n    var created = this.proxy(\"traits.createdAt\") ||\n        this.proxy(\"traits.created\") ||\n        this.proxy(\"properties.createdAt\") ||\n        this.proxy(\"properties.created\");\n    if (created)\n        return new_date_1.default(created);\n};\ng.email = function () {\n    var email = this.proxy(\"traits.email\");\n    if (email)\n        return email;\n    var groupId = this.groupId();\n    if (is_email_1.default(groupId))\n        return groupId;\n};\ng.traits = function (aliases) {\n    var ret = this.properties();\n    var id = this.groupId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"traits.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\ng.name = facade_1.Facade.proxy(\"traits.name\");\ng.industry = facade_1.Facade.proxy(\"traits.industry\");\ng.employees = facade_1.Facade.proxy(\"traits.employees\");\ng.properties = function () {\n    return this.field(\"traits\") || this.field(\"properties\") || {};\n};\n//# sourceMappingURL=group.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Identify = void 0;\nvar facade_1 = require(\"./facade\");\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar new_date_1 = __importDefault(require(\"new-date\"));\nvar trim = function (str) { return str.trim(); };\nfunction Identify(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Identify = Identify;\ninherits_1.default(Identify, facade_1.Facade);\nvar i = Identify.prototype;\ni.action = function () {\n    return \"identify\";\n};\ni.type = i.action;\ni.traits = function (aliases) {\n    var ret = this.field(\"traits\") || {};\n    var id = this.userId();\n    aliases = aliases || {};\n    if (id)\n        ret.id = id;\n    for (var alias in aliases) {\n        var value = this[alias] == null ? this.proxy(\"traits.\" + alias) : this[alias]();\n        if (value == null)\n            continue;\n        ret[aliases[alias]] = value;\n        if (alias !== aliases[alias])\n            delete ret[alias];\n    }\n    return ret;\n};\ni.email = function () {\n    var email = this.proxy(\"traits.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\ni.created = function () {\n    var created = this.proxy(\"traits.created\") || this.proxy(\"traits.createdAt\");\n    if (created)\n        return new_date_1.default(created);\n};\ni.companyCreated = function () {\n    var created = this.proxy(\"traits.company.created\") ||\n        this.proxy(\"traits.company.createdAt\");\n    if (created) {\n        return new_date_1.default(created);\n    }\n};\ni.companyName = function () {\n    return this.proxy(\"traits.company.name\");\n};\ni.name = function () {\n    var name = this.proxy(\"traits.name\");\n    if (typeof name === \"string\") {\n        return trim(name);\n    }\n    var firstName = this.firstName();\n    var lastName = this.lastName();\n    if (firstName && lastName) {\n        return trim(firstName + \" \" + lastName);\n    }\n};\ni.firstName = function () {\n    var firstName = this.proxy(\"traits.firstName\");\n    if (typeof firstName === \"string\") {\n        return trim(firstName);\n    }\n    var name = this.proxy(\"traits.name\");\n    if (typeof name === \"string\") {\n        return trim(name).split(\" \")[0];\n    }\n};\ni.lastName = function () {\n    var lastName = this.proxy(\"traits.lastName\");\n    if (typeof lastName === \"string\") {\n        return trim(lastName);\n    }\n    var name = this.proxy(\"traits.name\");\n    if (typeof name !== \"string\") {\n        return;\n    }\n    var space = trim(name).indexOf(\" \");\n    if (space === -1) {\n        return;\n    }\n    return trim(name.substr(space + 1));\n};\ni.uid = function () {\n    return this.userId() || this.username() || this.email();\n};\ni.description = function () {\n    return this.proxy(\"traits.description\") || this.proxy(\"traits.background\");\n};\ni.age = function () {\n    var date = this.birthday();\n    var age = obj_case_1.default(this.traits(), \"age\");\n    if (age != null)\n        return age;\n    if (!(date instanceof Date))\n        return;\n    var now = new Date();\n    return now.getFullYear() - date.getFullYear();\n};\ni.avatar = function () {\n    var traits = this.traits();\n    return (obj_case_1.default(traits, \"avatar\") || obj_case_1.default(traits, \"photoUrl\") || obj_case_1.default(traits, \"avatarUrl\"));\n};\ni.position = function () {\n    var traits = this.traits();\n    return obj_case_1.default(traits, \"position\") || obj_case_1.default(traits, \"jobTitle\");\n};\ni.username = facade_1.Facade.proxy(\"traits.username\");\ni.website = facade_1.Facade.one(\"traits.website\");\ni.websites = facade_1.Facade.multi(\"traits.website\");\ni.phone = facade_1.Facade.one(\"traits.phone\");\ni.phones = facade_1.Facade.multi(\"traits.phone\");\ni.address = facade_1.Facade.proxy(\"traits.address\");\ni.gender = facade_1.Facade.proxy(\"traits.gender\");\ni.birthday = facade_1.Facade.proxy(\"traits.birthday\");\n//# sourceMappingURL=identify.js.map","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delete = exports.Screen = exports.Page = exports.Track = exports.Identify = exports.Group = exports.Alias = exports.Facade = void 0;\nvar facade_1 = require(\"./facade\");\nObject.defineProperty(exports, \"Facade\", { enumerable: true, get: function () { return facade_1.Facade; } });\nvar alias_1 = require(\"./alias\");\nObject.defineProperty(exports, \"Alias\", { enumerable: true, get: function () { return alias_1.Alias; } });\nvar group_1 = require(\"./group\");\nObject.defineProperty(exports, \"Group\", { enumerable: true, get: function () { return group_1.Group; } });\nvar identify_1 = require(\"./identify\");\nObject.defineProperty(exports, \"Identify\", { enumerable: true, get: function () { return identify_1.Identify; } });\nvar track_1 = require(\"./track\");\nObject.defineProperty(exports, \"Track\", { enumerable: true, get: function () { return track_1.Track; } });\nvar page_1 = require(\"./page\");\nObject.defineProperty(exports, \"Page\", { enumerable: true, get: function () { return page_1.Page; } });\nvar screen_1 = require(\"./screen\");\nObject.defineProperty(exports, \"Screen\", { enumerable: true, get: function () { return screen_1.Screen; } });\nvar delete_1 = require(\"./delete\");\nObject.defineProperty(exports, \"Delete\", { enumerable: true, get: function () { return delete_1.Delete; } });\nexports.default = __assign(__assign({}, facade_1.Facade), { Alias: alias_1.Alias,\n    Group: group_1.Group,\n    Identify: identify_1.Identify,\n    Track: track_1.Track,\n    Page: page_1.Page,\n    Screen: screen_1.Screen,\n    Delete: delete_1.Delete });\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar matcher = /.+\\@.+\\..+/;\nfunction isEmail(string) {\n    return matcher.test(string);\n}\nexports.default = isEmail;\n//# sourceMappingURL=is-email.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar disabled = {\n    Salesforce: true,\n};\nfunction default_1(integration) {\n    return !disabled[integration];\n}\nexports.default = default_1;\n//# sourceMappingURL=is-enabled.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Page = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nvar track_1 = require(\"./track\");\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nfunction Page(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Page = Page;\ninherits_1.default(Page, facade_1.Facade);\nvar p = Page.prototype;\np.action = function () {\n    return \"page\";\n};\np.type = p.action;\np.category = facade_1.Facade.field(\"category\");\np.name = facade_1.Facade.field(\"name\");\np.title = facade_1.Facade.proxy(\"properties.title\");\np.path = facade_1.Facade.proxy(\"properties.path\");\np.url = facade_1.Facade.proxy(\"properties.url\");\np.referrer = function () {\n    return (this.proxy(\"context.referrer.url\") ||\n        this.proxy(\"context.page.referrer\") ||\n        this.proxy(\"properties.referrer\"));\n};\np.properties = function (aliases) {\n    var props = this.field(\"properties\") || {};\n    var category = this.category();\n    var name = this.name();\n    aliases = aliases || {};\n    if (category)\n        props.category = category;\n    if (name)\n        props.name = name;\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"properties.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            props[aliases[alias]] = value;\n            if (alias !== aliases[alias])\n                delete props[alias];\n        }\n    }\n    return props;\n};\np.email = function () {\n    var email = this.proxy(\"context.traits.email\") || this.proxy(\"properties.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\np.fullName = function () {\n    var category = this.category();\n    var name = this.name();\n    return name && category ? category + \" \" + name : name;\n};\np.event = function (name) {\n    return name ? \"Viewed \" + name + \" Page\" : \"Loaded a Page\";\n};\np.track = function (name) {\n    var json = this.json();\n    json.event = this.event(name);\n    json.timestamp = this.timestamp();\n    json.properties = this.properties();\n    return new track_1.Track(json, this.opts);\n};\n//# sourceMappingURL=page.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Screen = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar page_1 = require(\"./page\");\nvar track_1 = require(\"./track\");\nfunction Screen(dictionary, opts) {\n    page_1.Page.call(this, dictionary, opts);\n}\nexports.Screen = Screen;\ninherits_1.default(Screen, page_1.Page);\nScreen.prototype.action = function () {\n    return \"screen\";\n};\nScreen.prototype.type = Screen.prototype.action;\nScreen.prototype.event = function (name) {\n    return name ? \"Viewed \" + name + \" Screen\" : \"Loaded a Screen\";\n};\nScreen.prototype.track = function (name) {\n    var json = this.json();\n    json.event = this.event(name);\n    json.timestamp = this.timestamp();\n    json.properties = this.properties();\n    return new track_1.Track(json, this.opts);\n};\n//# sourceMappingURL=screen.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Track = void 0;\nvar inherits_1 = __importDefault(require(\"inherits\"));\nvar facade_1 = require(\"./facade\");\nvar identify_1 = require(\"./identify\");\nvar is_email_1 = __importDefault(require(\"./is-email\"));\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\nfunction Track(dictionary, opts) {\n    facade_1.Facade.call(this, dictionary, opts);\n}\nexports.Track = Track;\ninherits_1.default(Track, facade_1.Facade);\nvar t = Track.prototype;\nt.action = function () {\n    return \"track\";\n};\nt.type = t.action;\nt.event = facade_1.Facade.field(\"event\");\nt.value = facade_1.Facade.proxy(\"properties.value\");\nt.category = facade_1.Facade.proxy(\"properties.category\");\nt.id = facade_1.Facade.proxy(\"properties.id\");\nt.productId = function () {\n    return (this.proxy(\"properties.product_id\") || this.proxy(\"properties.productId\"));\n};\nt.promotionId = function () {\n    return (this.proxy(\"properties.promotion_id\") ||\n        this.proxy(\"properties.promotionId\"));\n};\nt.cartId = function () {\n    return this.proxy(\"properties.cart_id\") || this.proxy(\"properties.cartId\");\n};\nt.checkoutId = function () {\n    return (this.proxy(\"properties.checkout_id\") || this.proxy(\"properties.checkoutId\"));\n};\nt.paymentId = function () {\n    return (this.proxy(\"properties.payment_id\") || this.proxy(\"properties.paymentId\"));\n};\nt.couponId = function () {\n    return (this.proxy(\"properties.coupon_id\") || this.proxy(\"properties.couponId\"));\n};\nt.wishlistId = function () {\n    return (this.proxy(\"properties.wishlist_id\") || this.proxy(\"properties.wishlistId\"));\n};\nt.reviewId = function () {\n    return (this.proxy(\"properties.review_id\") || this.proxy(\"properties.reviewId\"));\n};\nt.orderId = function () {\n    return (this.proxy(\"properties.id\") ||\n        this.proxy(\"properties.order_id\") ||\n        this.proxy(\"properties.orderId\"));\n};\nt.sku = facade_1.Facade.proxy(\"properties.sku\");\nt.tax = facade_1.Facade.proxy(\"properties.tax\");\nt.name = facade_1.Facade.proxy(\"properties.name\");\nt.price = facade_1.Facade.proxy(\"properties.price\");\nt.total = facade_1.Facade.proxy(\"properties.total\");\nt.repeat = facade_1.Facade.proxy(\"properties.repeat\");\nt.coupon = facade_1.Facade.proxy(\"properties.coupon\");\nt.shipping = facade_1.Facade.proxy(\"properties.shipping\");\nt.discount = facade_1.Facade.proxy(\"properties.discount\");\nt.shippingMethod = function () {\n    return (this.proxy(\"properties.shipping_method\") ||\n        this.proxy(\"properties.shippingMethod\"));\n};\nt.paymentMethod = function () {\n    return (this.proxy(\"properties.payment_method\") ||\n        this.proxy(\"properties.paymentMethod\"));\n};\nt.description = facade_1.Facade.proxy(\"properties.description\");\nt.plan = facade_1.Facade.proxy(\"properties.plan\");\nt.subtotal = function () {\n    var subtotal = obj_case_1.default(this.properties(), \"subtotal\");\n    var total = this.total() || this.revenue();\n    if (subtotal)\n        return subtotal;\n    if (!total)\n        return 0;\n    if (this.total()) {\n        var n = this.tax();\n        if (n)\n            total -= n;\n        n = this.shipping();\n        if (n)\n            total -= n;\n        n = this.discount();\n        if (n)\n            total += n;\n    }\n    return total;\n};\nt.products = function () {\n    var props = this.properties();\n    var products = obj_case_1.default(props, \"products\");\n    if (Array.isArray(products)) {\n        return products.filter(function (item) { return item !== null; });\n    }\n    return [];\n};\nt.quantity = function () {\n    var props = this.obj.properties || {};\n    return props.quantity || 1;\n};\nt.currency = function () {\n    var props = this.obj.properties || {};\n    return props.currency || \"USD\";\n};\nt.referrer = function () {\n    return (this.proxy(\"context.referrer.url\") ||\n        this.proxy(\"context.page.referrer\") ||\n        this.proxy(\"properties.referrer\"));\n};\nt.query = facade_1.Facade.proxy(\"options.query\");\nt.properties = function (aliases) {\n    var ret = this.field(\"properties\") || {};\n    aliases = aliases || {};\n    for (var alias in aliases) {\n        if (Object.prototype.hasOwnProperty.call(aliases, alias)) {\n            var value = this[alias] == null\n                ? this.proxy(\"properties.\" + alias)\n                : this[alias]();\n            if (value == null)\n                continue;\n            ret[aliases[alias]] = value;\n            delete ret[alias];\n        }\n    }\n    return ret;\n};\nt.username = function () {\n    return (this.proxy(\"traits.username\") ||\n        this.proxy(\"properties.username\") ||\n        this.userId() ||\n        this.sessionId());\n};\nt.email = function () {\n    var email = this.proxy(\"traits.email\") ||\n        this.proxy(\"properties.email\") ||\n        this.proxy(\"options.traits.email\");\n    if (email)\n        return email;\n    var userId = this.userId();\n    if (is_email_1.default(userId))\n        return userId;\n};\nt.revenue = function () {\n    var revenue = this.proxy(\"properties.revenue\");\n    var event = this.event();\n    var orderCompletedRegExp = /^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i;\n    if (!revenue && event && event.match(orderCompletedRegExp)) {\n        revenue = this.proxy(\"properties.total\");\n    }\n    return currency(revenue);\n};\nt.cents = function () {\n    var revenue = this.revenue();\n    return typeof revenue !== \"number\" ? this.value() || 0 : revenue * 100;\n};\nt.identify = function () {\n    var json = this.json();\n    json.traits = this.traits();\n    return new identify_1.Identify(json, this.opts);\n};\nfunction currency(val) {\n    if (!val)\n        return;\n    if (typeof val === \"number\") {\n        return val;\n    }\n    if (typeof val !== \"string\") {\n        return;\n    }\n    val = val.replace(/\\$/g, \"\");\n    val = parseFloat(val);\n    if (!isNaN(val)) {\n        return val;\n    }\n}\n//# sourceMappingURL=track.js.map","'use strict';\n\nvar isodate = require('@segment/isodate');\n\n/**\n * Expose `traverse`.\n */\nmodule.exports = traverse;\n\n/**\n * Recursively traverse an object or array, and convert\n * all ISO date strings parse into Date objects.\n *\n * @param {Object} input - object, array, or string to convert\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Object}\n */\nfunction traverse(input, strict) {\n  if (strict === undefined) strict = true;\n  if (input && typeof input === 'object') {\n    return traverseObject(input, strict);\n  } else if (Array.isArray(input)) {\n    return traverseArray(input, strict);\n  } else if (isodate.is(input, strict)) {\n    return isodate.parse(input);\n  }\n  return input;\n}\n\n/**\n * Object traverser helper function.\n *\n * @param {Object} obj - object to traverse\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Object}\n */\nfunction traverseObject(obj, strict) {\n  Object.keys(obj).forEach(function(key) {\n    obj[key] = traverse(obj[key], strict);\n  });\n  return obj;\n}\n\n/**\n * Array traverser helper function\n *\n * @param {Array} arr - array to traverse\n * @param {Boolean} strict - only convert strings with year, month, and date\n * @return {Array}\n */\nfunction traverseArray(arr, strict) {\n  arr.forEach(function(value, index) {\n    arr[index] = traverse(value, strict);\n  });\n  return arr;\n}\n","'use strict';\n\n/**\n * Matcher, slightly modified from:\n *\n * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js\n */\n\nvar matcher = /^(\\d{4})(?:-?(\\d{2})(?:-?(\\d{2}))?)?(?:([ T])(\\d{2}):?(\\d{2})(?::?(\\d{2})(?:[,\\.](\\d{1,}))?)?(?:(Z)|([+\\-])(\\d{2})(?::?(\\d{2}))?)?)?$/;\n\n/**\n * Convert an ISO date string to a date. Fallback to native `Date.parse`.\n *\n * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js\n *\n * @param {String} iso\n * @return {Date}\n */\n\nexports.parse = function(iso) {\n  var numericKeys = [1, 5, 6, 7, 11, 12];\n  var arr = matcher.exec(iso);\n  var offset = 0;\n\n  // fallback to native parsing\n  if (!arr) {\n    return new Date(iso);\n  }\n\n  /* eslint-disable no-cond-assign */\n  // remove undefined values\n  for (var i = 0, val; val = numericKeys[i]; i++) {\n    arr[val] = parseInt(arr[val], 10) || 0;\n  }\n  /* eslint-enable no-cond-assign */\n\n  // allow undefined days and months\n  arr[2] = parseInt(arr[2], 10) || 1;\n  arr[3] = parseInt(arr[3], 10) || 1;\n\n  // month is 0-11\n  arr[2]--;\n\n  // allow abitrary sub-second precision\n  arr[8] = arr[8] ? (arr[8] + '00').substring(0, 3) : 0;\n\n  // apply timezone if one exists\n  if (arr[4] === ' ') {\n    offset = new Date().getTimezoneOffset();\n  } else if (arr[9] !== 'Z' && arr[10]) {\n    offset = arr[11] * 60 + arr[12];\n    if (arr[10] === '+') {\n      offset = 0 - offset;\n    }\n  }\n\n  var millis = Date.UTC(arr[1], arr[2], arr[3], arr[5], arr[6] + offset, arr[7], arr[8]);\n  return new Date(millis);\n};\n\n\n/**\n * Checks whether a `string` is an ISO date string. `strict` mode requires that\n * the date string at least have a year, month and date.\n *\n * @param {String} string\n * @param {Boolean} strict\n * @return {Boolean}\n */\n\nexports.is = function(string, strict) {\n  if (typeof string !== 'string') {\n    return false;\n  }\n  if (strict && (/^\\d{4}-\\d{2}-\\d{2}/).test(string) === false) {\n    return false;\n  }\n  return matcher.test(string);\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","\"use strict\";\n\nvar isodate = require(\"@segment/isodate\");\nvar milliseconds = require(\"./milliseconds\");\nvar seconds = require(\"./seconds\");\n\nvar objProto = Object.prototype;\nvar toStr = objProto.toString;\n\nfunction isDate(value) {\n  return toStr.call(value) === \"[object Date]\";\n}\n\nfunction isNumber(value) {\n  return toStr.call(value) === \"[object Number]\";\n}\n\n/**\n * Returns a new Javascript Date object, allowing a variety of extra input types\n * over the native Date constructor.\n *\n * @param {Date|string|number} val\n */\nmodule.exports = function newDate(val) {\n  if (isDate(val)) return val;\n  if (isNumber(val)) return new Date(toMs(val));\n\n  // date strings\n  if (isodate.is(val)) {\n    return isodate.parse(val);\n  }\n  if (milliseconds.is(val)) {\n    return milliseconds.parse(val);\n  }\n  if (seconds.is(val)) {\n    return seconds.parse(val);\n  }\n\n  // fallback to Date.parse\n  return new Date(val);\n};\n\n/**\n * If the number passed val is seconds from the epoch, turn it into milliseconds.\n * Milliseconds would be greater than 31557600000 (December 31, 1970).\n *\n * @param {number} num\n */\nfunction toMs(num) {\n  if (num < 31557600000) return num * 1000;\n  return num;\n}\n","\"use strict\";\n\n/**\n * Matcher.\n */\n\nvar matcher = /\\d{13}/;\n\n/**\n * Check whether a string is a millisecond date string.\n *\n * @param {string} string\n * @return {boolean}\n */\nexports.is = function (string) {\n  return matcher.test(string);\n};\n\n/**\n * Convert a millisecond string to a date.\n *\n * @param {string} millis\n * @return {Date}\n */\nexports.parse = function (millis) {\n  millis = parseInt(millis, 10);\n  return new Date(millis);\n};\n","\"use strict\";\n\n/**\n * Matcher.\n */\n\nvar matcher = /\\d{10}/;\n\n/**\n * Check whether a string is a second date string.\n *\n * @param {string} string\n * @return {Boolean}\n */\nexports.is = function (string) {\n  return matcher.test(string);\n};\n\n/**\n * Convert a second string to a date.\n *\n * @param {string} seconds\n * @return {Date}\n */\nexports.parse = function (seconds) {\n  var millis = parseInt(seconds, 10) * 1000;\n  return new Date(millis);\n};\n","\nvar identity = function(_){ return _; };\n\n\n/**\n * Module exports, export\n */\n\nmodule.exports = multiple(find);\nmodule.exports.find = module.exports;\n\n\n/**\n * Export the replacement function, return the modified object\n */\n\nmodule.exports.replace = function (obj, key, val, options) {\n  multiple(replace).call(this, obj, key, val, options);\n  return obj;\n};\n\n\n/**\n * Export the delete function, return the modified object\n */\n\nmodule.exports.del = function (obj, key, options) {\n  multiple(del).call(this, obj, key, null, options);\n  return obj;\n};\n\n\n/**\n * Compose applying the function to a nested key\n */\n\nfunction multiple (fn) {\n  return function (obj, path, val, options) {\n    var normalize = options && isFunction(options.normalizer) ? options.normalizer : defaultNormalize;\n    path = normalize(path);\n\n    var key;\n    var finished = false;\n\n    while (!finished) loop();\n\n    function loop() {\n      for (key in obj) {\n        var normalizedKey = normalize(key);\n        if (0 === path.indexOf(normalizedKey)) {\n          var temp = path.substr(normalizedKey.length);\n          if (temp.charAt(0) === '.' || temp.length === 0) {\n            path = temp.substr(1);\n            var child = obj[key];\n\n            // we're at the end and there is nothing.\n            if (null == child) {\n              finished = true;\n              return;\n            }\n\n            // we're at the end and there is something.\n            if (!path.length) {\n              finished = true;\n              return;\n            }\n\n            // step into child\n            obj = child;\n\n            // but we're done here\n            return;\n          }\n        }\n      }\n\n      key = undefined;\n      // if we found no matching properties\n      // on the current object, there's no match.\n      finished = true;\n    }\n\n    if (!key) return;\n    if (null == obj) return obj;\n\n    // the `obj` and `key` is one above the leaf object and key, so\n    // start object: { a: { 'b.c': 10 } }\n    // end object: { 'b.c': 10 }\n    // end key: 'b.c'\n    // this way, you can do `obj[key]` and get `10`.\n    return fn(obj, key, val);\n  };\n}\n\n\n/**\n * Find an object by its key\n *\n * find({ first_name : 'Calvin' }, 'firstName')\n */\n\nfunction find (obj, key) {\n  if (obj.hasOwnProperty(key)) return obj[key];\n}\n\n\n/**\n * Delete a value for a given key\n *\n * del({ a : 'b', x : 'y' }, 'X' }) -> { a : 'b' }\n */\n\nfunction del (obj, key) {\n  if (obj.hasOwnProperty(key)) delete obj[key];\n  return obj;\n}\n\n\n/**\n * Replace an objects existing value with a new one\n *\n * replace({ a : 'b' }, 'a', 'c') -> { a : 'c' }\n */\n\nfunction replace (obj, key, val) {\n  if (obj.hasOwnProperty(key)) obj[key] = val;\n  return obj;\n}\n\n/**\n * Normalize a `dot.separated.path`.\n *\n * A.HELL(!*&#(!)O_WOR   LD.bar => ahelloworldbar\n *\n * @param {String} path\n * @return {String}\n */\n\nfunction defaultNormalize(path) {\n  return path.replace(/[^a-zA-Z0-9\\.]+/g, '').toLowerCase();\n}\n\n/**\n * Check if a value is a function.\n *\n * @param {*} val\n * @return {boolean} Returns `true` if `val` is a function, otherwise `false`.\n */\n\nfunction isFunction(val) {\n  return typeof val === 'function';\n}\n","export function isBrowser(): boolean {\n  return typeof window !== 'undefined'\n}\n\nexport function isServer(): boolean {\n  return !isBrowser()\n}\n","/**\n * Tries to gets the unencoded version of an encoded component of a\n * Uniform Resource Identifier (URI). If input string is malformed,\n * returns it back as-is.\n *\n * Note: All occurences of the `+` character become ` ` (spaces).\n **/\nexport function gracefulDecodeURIComponent(\n  encodedURIComponent: string\n): string {\n  try {\n    return decodeURIComponent(encodedURIComponent.replace(/\\+/g, ' '))\n  } catch {\n    return encodedURIComponent\n  }\n}\n","declare global {\n  interface Window {\n    receiverWriteKey?: string\n  }\n}\n\n// This variable is used as an optional fallback for when customers\n// host or proxy their own receiver.js.\ntry {\n  window.receiverWriteKey = '__WRITE_KEY__'\n} catch (_) {\n  // @ eslint-disable-next-line\n}\n\nexport function embeddedWriteKey(): string | undefined {\n  if (window.receiverWriteKey === undefined) {\n    return undefined\n  }\n\n  // this is done so that we don't accidentally override every reference to __write_key__\n  return window.receiverWriteKey !== ['__', 'WRITE', '_', 'KEY', '__'].join('')\n    ? window.receiverWriteKey\n    : undefined\n}\n","import { ReceiverSnippet } from '../browser/standalone-interface'\n\n/**\n * Stores the global window receiver key\n */\nlet _globalReceiverKey = 'receiver'\n\n/**\n * Gets the global receiver/buffer\n * @param key name of the window property where the buffer is stored (default: receiver)\n * @returns ReceiverSnippet\n */\nexport function getGlobalReceiver(): ReceiverSnippet | undefined {\n  return (window as any)[_globalReceiverKey]\n}\n\n/**\n * Replaces the global window key for the receiver/buffer object\n * @param key key name\n */\nexport function setGlobalReceiverKey(key: string) {\n  _globalReceiverKey = key\n}\n\n/**\n * Sets the global receiver object\n * @param receiver receiver snippet\n */\nexport function setGlobalReceiver(receiver: ReceiverSnippet): void {\n  ;(window as any)[_globalReceiverKey] = receiver\n}\n","function findScript(src: string): HTMLScriptElement | undefined {\n  const scripts = Array.prototype.slice.call(\n    window.document.querySelectorAll('script')\n  )\n  return scripts.find((s) => s.src === src)\n}\n\nexport function loadScript(\n  src: string,\n  attributes?: Record<string, string>\n): Promise<HTMLScriptElement> {\n  const found = findScript(src)\n\n  if (found !== undefined) {\n    const status = found?.getAttribute('status')\n\n    if (status === 'loaded') {\n      return Promise.resolve(found)\n    }\n\n    if (status === 'loading') {\n      return new Promise((resolve, reject) => {\n        found.addEventListener('load', () => resolve(found))\n        found.addEventListener('error', (err) => reject(err))\n      })\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    const script = window.document.createElement('script')\n\n    script.type = 'text/javascript'\n    script.src = src\n    script.async = true\n\n    script.setAttribute('status', 'loading')\n    for (const [k, v] of Object.entries(attributes ?? {})) {\n      script.setAttribute(k, v)\n    }\n\n    script.onload = (): void => {\n      script.onerror = script.onload = null\n      script.setAttribute('status', 'loaded')\n      resolve(script)\n    }\n\n    script.onerror = (): void => {\n      script.onerror = script.onload = null\n      script.setAttribute('status', 'error')\n      reject(new Error(`Failed to load ${src}`))\n    }\n\n    const tag = window.document.getElementsByTagName('script')[0]\n    tag.parentElement?.insertBefore(script, tag)\n  })\n}\n\nexport function unloadScript(src: string): Promise<void> {\n  const found = findScript(src)\n\n  if (found !== undefined) {\n    found.remove()\n  }\n\n  return Promise.resolve()\n}\n","import { getGlobalReceiver } from './global-receiver-helper'\nimport { embeddedWriteKey } from './embedded-write-key'\n\nconst receiverScriptRegex =\n  /(https:\\/\\/.*)\\/receiver\\.js\\/v1\\/(?:.*?)\\/(?:platform|receiver.*)?/\nconst getCDNUrlFromScriptTag = (): string | undefined => {\n  let cdn: string | undefined\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  scripts.forEach((s) => {\n    const src = s.getAttribute('src') ?? ''\n    const result = receiverScriptRegex.exec(src)\n\n    if (result && result[1]) {\n      cdn = result[1]\n    }\n  })\n  return cdn\n}\n\nlet _globalCDN: string | undefined // set globalCDN as in-memory singleton\nconst getGlobalCDNUrl = (): string | undefined => {\n  const result = _globalCDN ?? getGlobalReceiver()?._cdn\n  return result\n}\n\nexport const setGlobalCDNUrl = (cdn: string) => {\n  const globalReceiver = getGlobalReceiver()\n  if (globalReceiver) {\n    globalReceiver._cdn = cdn\n  }\n  _globalCDN = cdn\n}\n\nexport const getCDN = (): string => {\n  const globalCdnUrl = getGlobalCDNUrl()\n\n  if (globalCdnUrl) return globalCdnUrl\n\n  const cdnFromScriptTag = getCDNUrlFromScriptTag()\n\n  if (cdnFromScriptTag) {\n    return cdnFromScriptTag\n  } else {\n    // it's possible that the CDN is not found in the page because:\n    // - the script is loaded through a proxy\n    // - the script is removed after execution\n    // in this case, we fall back to the default Tronic CDN\n    return `https://cdn.tronic.com`\n  }\n}\n\nexport const getNextIntegrationsURL = () => {\n  const cdn = getCDN()\n  return `${cdn}/next-integrations`\n}\n\n/**\n * Replaces the CDN URL in the script tag with the one from Receiver.js 1.0\n *\n * @returns the path to Receiver JS 1.0\n **/\nexport function getLegacyAJSPath(): string {\n  const writeKey = embeddedWriteKey() ?? getGlobalReceiver()?._writeKey\n\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  let path: string | undefined = undefined\n\n  for (const s of scripts) {\n    const src = s.getAttribute('src') ?? ''\n    const result = receiverScriptRegex.exec(src)\n\n    if (result && result[1]) {\n      path = src\n      break\n    }\n  }\n\n  if (path) {\n    return path.replace('receiver.min.js', 'receiver.classic.js')\n  }\n\n  return `https://cdn.tronic.com/receiver.js/v1/${writeKey}/receiver.classic.js`\n}\n","import {\n  Facade,\n  Identify,\n  Options,\n  Track,\n} from '@segment/facade'\nimport { TronicEvent } from '../core/events'\n\nexport type SegmentFacade = Facade<TronicEvent> & {\n  obj: TronicEvent\n}\n\nexport function toFacade(evt: TronicEvent, options?: Options): SegmentFacade {\n  let fcd = new Facade(evt, options)\n\n  if (evt.type === 'track') {\n    fcd = new Track(evt, options)\n  }\n\n  if (evt.type === 'identify') {\n    fcd = new Identify(evt, options)\n  }\n\n  /*\n  if (evt.type === 'page') {\n    fcd = new Page(evt, options)\n  }\n\n  if (evt.type === 'alias') {\n    fcd = new Alias(evt, options)\n  }\n\n  if (evt.type === 'group') {\n    fcd = new Group(evt, options)\n  }\n\n  if (evt.type === 'screen') {\n    fcd = new Screen(evt, options)\n  }\n   */\n\n  Object.defineProperty(fcd, 'obj', {\n    value: evt,\n    writable: true,\n  })\n\n  return fcd as SegmentFacade\n}\n","import { Context, ContextCancelation } from '../../core/context'\nimport { TronicEvent } from '../../core/events'\nimport { Plugin } from '../../core/plugin'\nimport { SegmentFacade, toFacade } from '../../lib/to-facade'\n\nexport interface MiddlewareParams {\n  payload: SegmentFacade\n\n  // integrations?: TronicEvent['integrations']\n  next: (payload: MiddlewareParams['payload'] | null) => void\n}\n\nexport interface DestinationMiddlewareParams {\n  payload: SegmentFacade\n  // integration: string\n  next: (payload: MiddlewareParams['payload'] | null) => void\n}\n\nexport type MiddlewareFunction = (\n  middleware: MiddlewareParams\n) => void | Promise<void>\n\nexport type DestinationMiddlewareFunction = (\n  middleware: DestinationMiddlewareParams\n) => void | Promise<void>\n\nexport async function applyDestinationMiddleware(\n  destination: string,\n  evt: TronicEvent,\n  middleware: DestinationMiddlewareFunction[]\n): Promise<TronicEvent | null> {\n  // Clone the event so mutations are localized to a single destination.\n  let modifiedEvent = toFacade(evt, {\n    clone: true,\n    traverse: false,\n  }).rawEvent() as TronicEvent\n  async function applyMiddleware(\n    event: TronicEvent,\n    fn: DestinationMiddlewareFunction\n  ): Promise<TronicEvent | null> {\n    let nextCalled = false\n    let returnedEvent: TronicEvent | null = null\n\n    await fn({\n      payload: toFacade(event, {\n        clone: true,\n        traverse: false,\n      }),\n      // integration: destination,\n      next(evt) {\n        nextCalled = true\n\n        if (evt === null) {\n          returnedEvent = null\n        }\n\n        if (evt) {\n          returnedEvent = evt.obj\n        }\n      },\n    })\n\n    if (!nextCalled && returnedEvent !== null) {\n      returnedEvent = returnedEvent as TronicEvent\n        /*\n      returnedEvent.integrations = {\n        ...event.integrations,\n        [destination]: false,\n      }\n         */\n    }\n\n    return returnedEvent\n  }\n\n  for (const md of middleware) {\n    const result = await applyMiddleware(modifiedEvent, md)\n    if (result === null) {\n      return null\n    }\n    modifiedEvent = result\n  }\n\n  return modifiedEvent\n}\n\nexport function sourceMiddlewarePlugin(\n  fn: MiddlewareFunction,\n  // integrations: TronicEvent['integrations']\n): Plugin {\n  async function apply(ctx: Context): Promise<Context> {\n    let nextCalled = false\n\n    await fn({\n      payload: toFacade(ctx.event, {\n        clone: true,\n        traverse: false,\n      }),\n      // integrations: integrations ?? {},\n      next(evt) {\n        nextCalled = true\n        if (evt) {\n          ctx.event = evt.obj\n        }\n      },\n    })\n\n    if (!nextCalled) {\n      throw new ContextCancelation({\n        retry: false,\n        type: 'middleware_cancellation',\n        reason: 'Middleware `next` function skipped',\n      })\n    }\n\n    return ctx\n  }\n\n  return {\n    name: `Source Middleware ${fn.name}`,\n    type: 'before',\n    version: '0.1.0',\n\n    isLoaded: (): boolean => true,\n    load: (ctx): Promise<Context> => Promise.resolve(ctx),\n\n    track: apply,\n    identify: apply,\n  }\n}\n","export function pTimeout(promise, timeout) {\n    return new Promise(function (resolve, reject) {\n        var timeoutId = setTimeout(function () {\n            reject(Error('Promise timed out'));\n        }, timeout);\n        promise\n            .then(function (val) {\n            clearTimeout(timeoutId);\n            return resolve(val);\n        })\n            .catch(reject);\n    });\n}\nexport function sleep(timeoutInMs) {\n    return new Promise(function (resolve) { return setTimeout(resolve, timeoutInMs); });\n}\n/**\n * @param ctx\n * @param callback - the function to invoke\n * @param delay - aka \"timeout\". The amount of time in ms to wait before invoking the callback.\n */\nexport function invokeCallback(ctx, callback, delay) {\n    var cb = function () {\n        try {\n            return Promise.resolve(callback(ctx));\n        }\n        catch (err) {\n            return Promise.reject(err);\n        }\n    };\n    return (sleep(delay)\n        // pTimeout ensures that the callback can't cause the context to hang\n        .then(function () { return pTimeout(cb(), 1000); })\n        .catch(function (err) {\n        ctx === null || ctx === void 0 ? void 0 : ctx.log('warn', 'Callback Error', { error: err });\n        ctx === null || ctx === void 0 ? void 0 : ctx.stats.increment('callback_error');\n    })\n        .then(function () { return ctx; }));\n}\n//# sourceMappingURL=index.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar CoreLogger = /** @class */ (function () {\n    function CoreLogger() {\n        this._logs = [];\n    }\n    CoreLogger.prototype.log = function (level, message, extras) {\n        var time = new Date();\n        this._logs.push({\n            level: level,\n            message: message,\n            time: time,\n            extras: extras,\n        });\n    };\n    Object.defineProperty(CoreLogger.prototype, \"logs\", {\n        get: function () {\n            return this._logs;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CoreLogger.prototype.flush = function () {\n        if (this.logs.length > 1) {\n            var formatted = this._logs.reduce(function (logs, log) {\n                var _a;\n                var _b, _c;\n                var line = __assign(__assign({}, log), { json: JSON.stringify(log.extras, null, ' '), extras: log.extras });\n                delete line['time'];\n                var key = (_c = (_b = log.time) === null || _b === void 0 ? void 0 : _b.toISOString()) !== null && _c !== void 0 ? _c : '';\n                if (logs[key]) {\n                    key = \"\".concat(key, \"-\").concat(Math.random());\n                }\n                return __assign(__assign({}, logs), (_a = {}, _a[key] = line, _a));\n            }, {});\n            // ie doesn't like console.table\n            if (console.table) {\n                console.table(formatted);\n            }\n            else {\n                console.log(formatted);\n            }\n        }\n        else {\n            this.logs.forEach(function (logEntry) {\n                var level = logEntry.level, message = logEntry.message, extras = logEntry.extras;\n                if (level === 'info' || level === 'debug') {\n                    console.log(message, extras !== null && extras !== void 0 ? extras : '');\n                }\n                else {\n                    console[level](message, extras !== null && extras !== void 0 ? extras : '');\n                }\n            });\n        }\n        this._logs = [];\n    };\n    return CoreLogger;\n}());\nexport { CoreLogger };\n//# sourceMappingURL=index.js.map","import { v4 as uuid } from '@lukeed/uuid';\nimport { dset } from 'dset';\nimport { CoreLogger } from '../logger';\nimport { NullStats } from '../stats';\nvar ContextCancelation = /** @class */ (function () {\n    function ContextCancelation(options) {\n        var _a, _b, _c;\n        this.retry = (_a = options.retry) !== null && _a !== void 0 ? _a : true;\n        this.type = (_b = options.type) !== null && _b !== void 0 ? _b : 'plugin Error';\n        this.reason = (_c = options.reason) !== null && _c !== void 0 ? _c : '';\n    }\n    return ContextCancelation;\n}());\nexport { ContextCancelation };\nvar CoreContext = /** @class */ (function () {\n    function CoreContext(event, id, stats, logger) {\n        if (id === void 0) { id = uuid(); }\n        if (stats === void 0) { stats = new NullStats(); }\n        if (logger === void 0) { logger = new CoreLogger(); }\n        this.attempts = 0;\n        this.event = event;\n        this._id = id;\n        this.logger = logger;\n        this.stats = stats;\n    }\n    CoreContext.system = function () {\n        // This should be overridden by the subclass to return an instance of the subclass.\n    };\n    CoreContext.prototype.isSame = function (other) {\n        return other.id === this.id;\n    };\n    CoreContext.prototype.cancel = function (error) {\n        if (error) {\n            throw error;\n        }\n        throw new ContextCancelation({ reason: 'Context Cancel' });\n    };\n    CoreContext.prototype.log = function (level, message, extras) {\n        this.logger.log(level, message, extras);\n    };\n    Object.defineProperty(CoreContext.prototype, \"id\", {\n        get: function () {\n            return this._id;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CoreContext.prototype.updateEvent = function (path, val) {\n        // Don't allow integrations that are set to false to be overwritten with integration settings.\n        /*\n        if (path.split('.')[0] === 'integrations') {\n          const integrationName = path.split('.')[1]\n    \n          if (this.event.integrations?.[integrationName] === false) {\n            return this.event\n          }\n        }\n          */\n        dset(this.event, path, val);\n        return this.event;\n    };\n    CoreContext.prototype.failedDelivery = function () {\n        return this._failedDelivery;\n    };\n    CoreContext.prototype.setFailedDelivery = function (options) {\n        this._failedDelivery = options;\n    };\n    CoreContext.prototype.logs = function () {\n        return this.logger.logs;\n    };\n    CoreContext.prototype.flush = function () {\n        this.logger.flush();\n        this.stats.flush();\n    };\n    CoreContext.prototype.toJSON = function () {\n        return {\n            id: this._id,\n            event: this.event,\n            logs: this.logger.logs,\n            metrics: this.stats.metrics,\n        };\n    };\n    return CoreContext;\n}());\nexport { CoreContext };\n//# sourceMappingURL=index.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar compactMetricType = function (type) {\n    var enums = {\n        gauge: 'g',\n        counter: 'c',\n    };\n    return enums[type];\n};\nvar CoreStats = /** @class */ (function () {\n    function CoreStats() {\n        this.metrics = [];\n    }\n    CoreStats.prototype.increment = function (metric, by, tags) {\n        if (by === void 0) { by = 1; }\n        this.metrics.push({\n            metric: metric,\n            value: by,\n            tags: tags !== null && tags !== void 0 ? tags : [],\n            type: 'counter',\n            timestamp: Date.now(),\n        });\n    };\n    CoreStats.prototype.gauge = function (metric, value, tags) {\n        this.metrics.push({\n            metric: metric,\n            value: value,\n            tags: tags !== null && tags !== void 0 ? tags : [],\n            type: 'gauge',\n            timestamp: Date.now(),\n        });\n    };\n    CoreStats.prototype.flush = function () {\n        var formatted = this.metrics.map(function (m) { return (__assign(__assign({}, m), { tags: m.tags.join(',') })); });\n        // ie doesn't like console.table\n        if (console.table) {\n            console.table(formatted);\n        }\n        else {\n            console.log(formatted);\n        }\n        this.metrics = [];\n    };\n    /**\n     * compact keys for smaller payload\n     */\n    CoreStats.prototype.serialize = function () {\n        return this.metrics.map(function (m) {\n            return {\n                m: m.metric,\n                v: m.value,\n                t: m.tags,\n                k: compactMetricType(m.type),\n                e: m.timestamp,\n            };\n        });\n    };\n    return CoreStats;\n}());\nexport { CoreStats };\nvar NullStats = /** @class */ (function (_super) {\n    __extends(NullStats, _super);\n    function NullStats() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NullStats.prototype.gauge = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.increment = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.flush = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n    };\n    NullStats.prototype.serialize = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n        return [];\n    };\n    return NullStats;\n}(CoreStats));\nexport { NullStats };\n//# sourceMappingURL=index.js.map","export function isString(obj) {\n    return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n    return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n    return typeof obj === 'function';\n}\nexport function exists(val) {\n    return val !== undefined && val !== null;\n}\nexport function isPlainObject(obj) {\n    return (Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object');\n}\n//# sourceMappingURL=helpers.js.map","var IDX=256, HEX=[], BUFFER;\nwhile (IDX--) HEX[IDX] = (IDX + 256).toString(16).substring(1);\n\nexport function v4() {\n\tvar i=0, num, out='';\n\n\tif (!BUFFER || ((IDX + 16) > 256)) {\n\t\tBUFFER = Array(i=256);\n\t\twhile (i--) BUFFER[i] = 256 * Math.random() | 0;\n\t\ti = IDX = 0;\n\t}\n\n\tfor (; i < 16; i++) {\n\t\tnum = BUFFER[IDX + i];\n\t\tif (i==6) out += HEX[num & 15 | 64];\n\t\telse if (i==8) out += HEX[num & 63 | 128];\n\t\telse out += HEX[num];\n\n\t\tif (i & 1 && i > 1 && i < 11) out += '-';\n\t}\n\n\tIDX++;\n\treturn out;\n}\n","export function dset(obj, keys, val) {\n\tkeys.split && (keys=keys.split('.'));\n\tvar i=0, l=keys.length, t=obj, x, k;\n\twhile (i < l) {\n\t\tk = keys[i++];\n\t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n\t\tt = t[k] = (i === l) ? val : (typeof(x=t[k])===typeof(keys)) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + {\"96\":\"queryString\",\"119\":\"auto-track\",\"214\":\"remoteMiddleware\"}[chunkId] + \".bundle.\" + {\"96\":\"5011b0847e2658d5273f\",\"119\":\"0cc89e91c3db4211d51b\",\"214\":\"e2d0030c368988b4e809\"}[chunkId] + \".js\";\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t610: 0\n};\n\n__webpack_require__.f.j = function(chunkId, promises) {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise(function(resolve, reject) { installedChunkData = installedChunks[chunkId] = [resolve, reject]; });\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = function(event) {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_tronic_receiver_browser\"] = self[\"webpackChunk_tronic_receiver_browser\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// Default value will be updated to 'web' in `bundle-umd.ts` for web build.\nlet _version: 'web' | 'npm' = 'npm'\n\nexport function setVersionType(version: typeof _version) {\n  _version = version\n}\n\nexport function getVersionType(): typeof _version {\n  return _version\n}\n","import {\n  isFunction,\n  isPlainObject,\n  isString,\n  isNumber,\n} from '@tronic/receiver-core'\nimport { Context } from '../context'\nimport {\n  Callback,\n  JSONObject,\n  Options,\n  EventProperties,\n  TronicEvent,\n  Traits,\n  UserTraits,\n} from '../events'\nimport { ID, User } from '../user'\n\n/**\n * Helper for the track method\n */\nexport function resolveArguments(\n  channelId: string,\n  userId: string,\n  eventName: string | TronicEvent,\n  properties?: EventProperties | Callback,\n  options?: Options | Callback,\n  callback?: Callback\n): [string, string, string, EventProperties | Callback, Options, Callback | undefined] {\n  const args = [channelId, userId, eventName, properties, options, callback]\n\n  if (!channelId || !isString(channelId)) {\n    throw new Error('ChannelId missing')\n  }\n\n  if (!userId || !isString(userId)) {\n    throw new Error('UserId missing')\n  }\n\n  const name = isPlainObject(eventName) ? eventName.event : eventName\n  if (!name || !isString(name)) {\n    throw new Error('Event missing')\n  }\n\n  const data = isPlainObject(eventName)\n    ? eventName.properties ?? {}\n    : isPlainObject(properties)\n    ? properties\n    : {}\n\n  let opts: Options = {}\n  if (!isFunction(options)) {\n    opts = options ?? {}\n  }\n\n  if (isPlainObject(eventName) && !isFunction(properties)) {\n    opts = properties ?? {}\n  }\n\n  const cb = args.find(isFunction) as Callback | undefined\n  return [channelId, userId, name, data, opts, cb]\n}\n\n/**\n * Helper for group, identify methods\n */\nexport const resolveUserArguments = <T extends Traits, U extends User>(\n  user: U\n): ResolveUser<T> => {\n  return (...args): ReturnType<ResolveUser<T>> => {\n    const values: {\n      // channelId?: string\n      id?: ID\n      traits?: T | null\n      options?: Options\n      callback?: Callback\n    } = {}\n    // It's a stack so it's reversed so that we go through each of the expected arguments\n    const orderStack: Array<keyof typeof values> = [\n      'callback',\n      'options',\n      'traits',\n      'id',\n      // 'channelId',\n    ]\n\n    // Read each argument and eval the possible values here\n    for (const arg of args) {\n      let current = orderStack.pop()\n      if (current === 'id') {\n        if (isString(arg) || isNumber(arg)) {\n          values.id = arg.toString()\n          continue\n        }\n        if (arg === null || arg === undefined) {\n          continue\n        }\n        // First argument should always be the id, if it is not a valid value we can skip it\n        current = orderStack.pop()\n      }\n\n      // Traits and Options\n      if (\n        (current === 'traits' || current === 'options') &&\n        (arg === null || arg === undefined || isPlainObject(arg))\n      ) {\n        values[current] = arg as T\n      }\n\n      // Callback\n      if (isFunction(arg)) {\n        values.callback = arg as Callback\n        break // This is always the last argument\n      }\n    }\n\n    return [\n      // values.channelId,\n      values.id ?? user.id(),\n      (values.traits ?? {}) as T,\n      values.options ?? {},\n      values.callback,\n    ]\n  }\n}\n\ntype ResolveUser<T extends Traits> = (\n  // channelId: string,\n  id?: ID | object,\n  traits?: T | Callback | null,\n  options?: Options | Callback,\n  callback?: Callback\n) => [ID, T, Options, Callback | undefined]\n\nexport type IdentifyParams = Parameters<ResolveUser<UserTraits>>\nexport type EventParams = Parameters<typeof resolveArguments>\n\nexport type DispatchedEvent = Context\n","import { isBrowser } from '../environment'\n\nexport function isOnline(): boolean {\n  if (isBrowser()) {\n    return window.navigator.onLine\n  }\n\n  return true\n}\n\nexport function isOffline(): boolean {\n  return !isOnline()\n}\n","export default function(e,n){return n=n||{},new Promise(function(t,r){var s=new XMLHttpRequest,o=[],u=[],i={},a=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(s.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:a,headers:{keys:function(){return o},entries:function(){return u},get:function(e){return i[e.toLowerCase()]},has:function(e){return e.toLowerCase()in i}}}};for(var l in s.open(n.method||\"get\",e,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm,function(e,n,t){o.push(n=n.toLowerCase()),u.push([n,t]),i[n]=i[n]?i[n]+\",\"+t:t}),t(a())},s.onerror=r,s.withCredentials=\"include\"==n.credentials,n.headers)s.setRequestHeader(l,n.headers[l]);s.send(n.body||null)})}\n//# sourceMappingURL=unfetch.module.js.map\n","// This an imperfect polyfill for globalThis\nexport const getGlobal = () => {\n  if (typeof globalThis !== 'undefined') {\n    return globalThis\n  }\n  if (typeof self !== 'undefined') {\n    return self\n  }\n  if (typeof window !== 'undefined') {\n    return window\n  }\n  if (typeof global !== 'undefined') {\n    return global\n  }\n  return null\n}\n","import unfetch from 'unfetch'\nimport { getGlobal } from './get-global'\n\n/**\n * Wrapper around native `fetch` containing `unfetch` fallback.\n */\n// @ts-ignore\nexport const fetch: typeof global.fetch = (...args) => {\n  const global = getGlobal()\n  // @ts-ignore\n  return ((global && global.fetch) || unfetch)(...args)\n}\n","// This file is generated.\nexport const version = '0.0.1'\n","export const TRONIC_API_HOST = 'localhost:3000'\n","import { fetch } from '../../lib/fetch'\nimport { version } from '../../generated/version'\nimport { getVersionType } from '../../lib/version-type'\nimport { TRONIC_API_HOST } from '../constants'\n\nexport interface MetricsOptions {\n  host?: string\n  sampleRate?: number\n  flushTimer?: number\n  maxQueueSize?: number\n}\n\n/**\n * Type expected by the tronic metrics API endpoint\n */\ntype RemoteMetric = {\n  type: 'Counter'\n  metric: string\n  value: 1\n  tags: {\n    library: string\n    library_version: string\n    [key: string]: string\n  }\n}\n\nconst createRemoteMetric = (\n  metric: string,\n  tags: string[],\n  versionType: 'web' | 'npm'\n): RemoteMetric => {\n  const formattedTags = tags.reduce((acc, t) => {\n    const [k, v] = t.split(':')\n    acc[k] = v\n    return acc\n  }, {} as Record<string, string>)\n\n  return {\n    type: 'Counter',\n    metric,\n    value: 1,\n    tags: {\n      ...formattedTags,\n      library: 'receiver.js',\n      library_version:\n        versionType === 'web' ? `next-${version}` : `npm:next-${version}`,\n    },\n  }\n}\n\nfunction logError(err: unknown): void {\n  console.error('Error sending tronic performance metrics', err)\n}\n\nexport class RemoteMetrics {\n  private host: string\n  private flushTimer: number\n  private maxQueueSize: number\n\n  sampleRate: number\n  queue: RemoteMetric[]\n\n  constructor(options?: MetricsOptions) {\n    this.host = options?.host ?? TRONIC_API_HOST\n    this.sampleRate = options?.sampleRate ?? 1\n    this.flushTimer = options?.flushTimer ?? 30 * 1000 /* 30s */\n    this.maxQueueSize = options?.maxQueueSize ?? 20\n\n    this.queue = []\n\n    if (this.sampleRate > 0) {\n      let flushing = false\n\n      const run = (): void => {\n        if (flushing) {\n          return\n        }\n\n        flushing = true\n        this.flush().catch(logError)\n\n        flushing = false\n\n        setTimeout(run, this.flushTimer)\n      }\n      run()\n    }\n  }\n\n  increment(metric: string, tags: string[]): void {\n    // All metrics are part of an allow list in Tracking API\n    if (!metric.includes('receiver_js.')) {\n      return\n    }\n\n    // /m doesn't like empty tags\n    if (tags.length === 0) {\n      return\n    }\n\n    if (Math.random() > this.sampleRate) {\n      return\n    }\n\n    if (this.queue.length >= this.maxQueueSize) {\n      return\n    }\n\n    const remoteMetric = createRemoteMetric(metric, tags, getVersionType())\n    this.queue.push(remoteMetric)\n\n    if (metric.includes('error')) {\n      this.flush().catch(logError)\n    }\n  }\n\n  async flush(): Promise<void> {\n    if (this.queue.length <= 0) {\n      return\n    }\n\n    await this.send().catch((error) => {\n      logError(error)\n      this.sampleRate = 0\n    })\n  }\n\n  private async send(): Promise<Response> {\n    const payload = { series: this.queue }\n    this.queue = []\n\n    const headers = { 'Content-Type': 'text/plain' }\n    const url = `https://${this.host}/m`\n\n    return fetch(url, {\n      headers,\n      body: JSON.stringify(payload),\n      method: 'POST',\n    })\n  }\n}\n","import { CoreStats } from '@tronic/receiver-core'\nimport { MetricsOptions, RemoteMetrics } from './remote-metrics'\n\nlet remoteMetrics: RemoteMetrics | undefined\n\nexport class Stats extends CoreStats {\n  static initRemoteMetrics(options?: MetricsOptions) {\n    remoteMetrics = new RemoteMetrics(options)\n  }\n\n  override increment(metric: string, by?: number, tags?: string[]): void {\n    super.increment(metric, by, tags)\n    remoteMetrics?.increment(metric, tags ?? [])\n  }\n}\n","import {\n  CoreContext,\n  ContextCancelation,\n  ContextFailedDelivery,\n  SerializedContext,\n  CancelationOptions,\n} from '@tronic/receiver-core'\nimport { TronicEvent } from '../events/interfaces'\nimport { Stats } from '../stats'\n\nexport class Context extends CoreContext<TronicEvent> {\n  static override system() {\n    return new this({ type: 'track', event: 'system', channelId: '' })\n  }\n  constructor(event: TronicEvent, id?: string) {\n    super(event, id, new Stats())\n  }\n}\n\nexport { ContextCancelation }\nexport type { ContextFailedDelivery, SerializedContext, CancelationOptions }\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { invokeCallback } from '../callback';\n/* The amount of time in ms to wait before invoking the callback. */\nexport var getDelay = function (startTimeInEpochMS, timeoutInMS) {\n    var elapsedTime = Date.now() - startTimeInEpochMS;\n    // increasing the timeout increases the delay by almost the same amount -- this is weird legacy behavior.\n    return Math.max((timeoutInMS !== null && timeoutInMS !== void 0 ? timeoutInMS : 300) - elapsedTime, 0);\n};\n/**\n * Push an event into the dispatch queue and invoke any callbacks.\n *\n * @param event - Event to enqueue.\n * @param queue - Queue to dispatch against.\n * @param emitter - This is typically an instance of \"Receiver\" -- used for metrics / progress information.\n * @param options\n */\nexport function dispatch(ctx, queue, emitter, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var startTime, dispatched;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    emitter.emit('dispatch_start', ctx);\n                    startTime = Date.now();\n                    if (!queue.isEmpty()) return [3 /*break*/, 2];\n                    return [4 /*yield*/, queue.dispatchSingle(ctx)];\n                case 1:\n                    dispatched = _a.sent();\n                    return [3 /*break*/, 4];\n                case 2: return [4 /*yield*/, queue.dispatch(ctx)];\n                case 3:\n                    dispatched = _a.sent();\n                    _a.label = 4;\n                case 4:\n                    if (!(options === null || options === void 0 ? void 0 : options.callback)) return [3 /*break*/, 6];\n                    return [4 /*yield*/, invokeCallback(dispatched, options.callback, getDelay(startTime, options.timeout))];\n                case 5:\n                    dispatched = _a.sent();\n                    _a.label = 6;\n                case 6:\n                    if (options === null || options === void 0 ? void 0 : options.debug) {\n                        dispatched.flush();\n                    }\n                    return [2 /*return*/, dispatched];\n            }\n        });\n    });\n}\n//# sourceMappingURL=dispatch.js.map","/**\n * Event Emitter that takes the expected contract as a generic\n * @example\n * ```ts\n *  type Contract = {\n *    delivery_success: [DeliverySuccessResponse, Metrics],\n *    delivery_failure: [DeliveryError]\n * }\n *  new Emitter<Contract>()\n *  .on('delivery_success', (res, metrics) => ...)\n *  .on('delivery_failure', (err) => ...)\n * ```\n */\nvar Emitter = /** @class */ (function () {\n    function Emitter() {\n        this.callbacks = {};\n    }\n    Emitter.prototype.on = function (event, callback) {\n        if (!this.callbacks[event]) {\n            this.callbacks[event] = [callback];\n        }\n        else {\n            this.callbacks[event].push(callback);\n        }\n        return this;\n    };\n    Emitter.prototype.once = function (event, callback) {\n        var _this = this;\n        var on = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            _this.off(event, on);\n            callback.apply(_this, args);\n        };\n        this.on(event, on);\n        return this;\n    };\n    Emitter.prototype.off = function (event, callback) {\n        var _a;\n        var fns = (_a = this.callbacks[event]) !== null && _a !== void 0 ? _a : [];\n        var without = fns.filter(function (fn) { return fn !== callback; });\n        this.callbacks[event] = without;\n        return this;\n    };\n    Emitter.prototype.emit = function (event) {\n        var _this = this;\n        var _a;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var callbacks = (_a = this.callbacks[event]) !== null && _a !== void 0 ? _a : [];\n        callbacks.forEach(function (callback) {\n            callback.apply(_this, args);\n        });\n        return this;\n    };\n    return Emitter;\n}());\nexport { Emitter };\n//# sourceMappingURL=index.js.map","import { isPlainObject } from '@tronic/receiver-core'\n\n/**\n * Final Page Context object expected in the Event context\n */\nexport interface PageContext {\n  path: string\n  referrer: string\n  search: string\n  title: string\n  url: string\n}\n\ntype CanonicalUrl = string | undefined\n\nexport const BufferedPageContextDiscriminant = 'bpc' as const\n/**\n * Page Context expected to be built by the snippet.\n * Note: The key names are super short because we want to keep the strings in the html snippet short to save bytes.\n */\nexport interface BufferedPageContext {\n  __t: typeof BufferedPageContextDiscriminant // for extra uniqeness\n  c: CanonicalUrl\n  p: PageContext['path']\n  u: PageContext['url']\n  s: PageContext['search']\n  t: PageContext['title']\n  r: PageContext['referrer']\n}\n\n/**\n * `BufferedPageContext` object builder\n */\nexport const createBufferedPageContext = (\n  url: string,\n  canonicalUrl: CanonicalUrl,\n  search: string,\n  path: string,\n  title: string,\n  referrer: string\n): BufferedPageContext => ({\n  __t: BufferedPageContextDiscriminant,\n  c: canonicalUrl,\n  p: path,\n  u: url,\n  s: search,\n  t: title,\n  r: referrer,\n})\n\n// my clever/dubious way of making sure this type guard does not get out sync with the type definition\nconst BUFFERED_PAGE_CONTEXT_KEYS = Object.keys(\n  createBufferedPageContext('', '', '', '', '', '')\n) as (keyof BufferedPageContext)[]\n\nexport function isBufferedPageContext(\n  bufferedPageCtx: unknown\n): bufferedPageCtx is BufferedPageContext {\n  if (!isPlainObject(bufferedPageCtx)) return false\n  if (bufferedPageCtx.__t !== BufferedPageContextDiscriminant) return false\n\n  // ensure obj has all the keys we expect, and none we don't.\n  for (const k in bufferedPageCtx) {\n    if (!BUFFERED_PAGE_CONTEXT_KEYS.includes(k as keyof BufferedPageContext)) {\n      return false\n    }\n  }\n  return true\n}\n\n//  Legacy logic: we are we appending search parameters to the canonical URL -- I guess the canonical URL is  \"not canonical enough\" (lol)\nconst createCanonicalURL = (canonicalUrl: string, searchParams: string) => {\n  return canonicalUrl.indexOf('?') > -1\n    ? canonicalUrl\n    : canonicalUrl + searchParams\n}\n\n/**\n * Strips hash from URL.\n */\nconst removeHash = (href: string) => {\n  const hashIdx = href.indexOf('#')\n  return hashIdx === -1 ? href : href.slice(0, hashIdx)\n}\n\nconst parseCanonicalPath = (canonicalUrl: string): string => {\n  try {\n    return new URL(canonicalUrl).pathname\n  } catch (_e) {\n    // this is classic behavior -- we assume that if the canonical URL is invalid, it's a raw path.\n    return canonicalUrl[0] === '/' ? canonicalUrl : '/' + canonicalUrl\n  }\n}\n\n/**\n * Create a `PageContext` from a `BufferedPageContext`.\n * `BufferedPageContext` keys are minified to save bytes in the snippet.\n */\nexport const createPageContext = ({\n  c: canonicalUrl,\n  p: pathname,\n  s: search,\n  u: url,\n  r: referrer,\n  t: title,\n}: BufferedPageContext): PageContext => {\n  const newPath = canonicalUrl ? parseCanonicalPath(canonicalUrl) : pathname\n  const newUrl = canonicalUrl\n    ? createCanonicalURL(canonicalUrl, search)\n    : removeHash(url)\n  return {\n    path: newPath,\n    referrer,\n    search,\n    title,\n    url: newUrl,\n  }\n}\n\n/**\n * Get page properties from the browser window/document.\n */\nexport const getDefaultBufferedPageContext = (): BufferedPageContext => {\n  const c = document.querySelector(\"link[rel='canonical']\")\n  return createBufferedPageContext(\n    location.href,\n    (c && c.getAttribute('href')) || undefined,\n    location.search,\n    location.pathname,\n    document.title,\n    document.referrer\n  )\n}\n\n/**\n * Get page properties from the browser window/document.\n */\nexport const getDefaultPageContext = (): PageContext =>\n  createPageContext(getDefaultBufferedPageContext())\n","import { pick } from '../../lib/pick'\nimport { EventProperties, TronicEvent } from '../events'\nimport { getDefaultPageContext } from './get-page-context'\n\n/**\n * Augments a Tronic event with information about the current page.\n * Page information like URL changes frequently, so this is meant to be captured as close to the event call as possible.\n * Things like `userAgent` do not change, so they can be added later in the flow.\n * We prefer not to add this information to this function, as it increases the main bundle size.\n */\nexport const addPageContext = (\n  event: TronicEvent,\n  pageCtx = getDefaultPageContext()\n): void => {\n  const evtCtx = event.context! // Context should be set earlier in the flow\n  let pageContextFromEventProps: Pick<EventProperties, string> | undefined\n  /*\n  if (event.type === 'page') {\n    pageContextFromEventProps =\n      event.properties && pick(event.properties, Object.keys(pageCtx))\n\n    event.properties = {\n      ...pageCtx,\n      ...event.properties,\n      ...(event.name ? { name: event.name } : {}),\n    }\n  }\n   */\n  evtCtx.page = {\n    ...pageCtx,\n    ...pageContextFromEventProps,\n    ...evtCtx.page,\n  }\n}\n","import { v4 as uuid } from '@lukeed/uuid'\nimport { dset } from 'dset'\nimport { ID, User } from '../user'\nimport {\n  // Options,\n  // Integrations,\n  EventProperties,\n  Traits,\n  TronicEvent,\n} from './interfaces'\nimport md5 from 'spark-md5'\nimport { addPageContext, PageContext } from '../page'\n\nexport * from './interfaces'\n\nexport class EventFactory {\n  constructor(public user: User) {}\n\n  track(\n    channelId: string,\n    userId: string,\n    event: string,\n    properties?: EventProperties,\n    // options?: Options,\n    // globalIntegrations?: Integrations,\n    pageCtx?: PageContext\n  ): TronicEvent {\n    return this.normalize(\n      {\n        ...this.baseEvent(),\n        channelId,\n        userId,\n        event,\n        type: 'track' as const,\n        properties,\n        // options: { ...options },\n        // integrations: { ...globalIntegrations },\n      },\n      pageCtx\n    )\n  }\n\n  identify(\n    channelId: string,\n    userId: ID,\n    traits?: Traits,\n    // options?: Options,\n    // globalIntegrations?: Integrations,\n    pageCtx?: PageContext\n  ): TronicEvent {\n    return this.normalize(\n      {\n        channelId,\n        ...this.baseEvent(),\n        type: 'identify' as const,\n        userId,\n        traits,\n        // options: { ...options },\n        // integrations: { ...globalIntegrations },\n      },\n      pageCtx\n    )\n  }\n\n  private baseEvent(): Partial<TronicEvent> {\n    const base: Partial<TronicEvent> = {\n      // integrations: {},\n      // options: {},\n    }\n\n      /*\n    const user = this.user\n\n    if (user.id()) {\n      base.userId = user.id()\n    }\n\n    if (user.anonymousId()) {\n      base.anonymousId = user.anonymousId()\n    }\n      */\n\n    return base\n  }\n\n  /**\n   * Builds the context part of an event based on \"foreign\" keys that\n   * are provided in the `Options` parameter for an Event\n   */\n  private context(event: TronicEvent): [object, object] {\n    const optionsKeys = ['integrations', 'anonymousId', 'timestamp', 'userId']\n\n    const options: Record<string, any> = /* event.options ?? */ {}\n    // delete options['integrations']\n\n    const providedOptionsKeys = Object.keys(options)\n\n    const context = /* event.options?.context ?? */ {}\n    const overrides: Record<string, any> = {}\n\n    providedOptionsKeys.forEach((key) => {\n      if (key === 'context') {\n        return\n      }\n\n      if (optionsKeys.includes(key)) {\n        dset(overrides, key, options[key])\n      } else {\n        dset(context, key, options[key])\n      }\n    })\n\n    return [context, overrides]\n  }\n\n  public normalize(event: TronicEvent, pageCtx?: PageContext): TronicEvent {\n    /*\n    // set anonymousId globally if we encounter an override\n\n    event.options?.anonymousId &&\n      this.user.anonymousId(event.options.anonymousId)\n\n    const integrationBooleans = Object.keys(event.integrations ?? {}).reduce(\n      (integrationNames, name) => {\n        return {\n          ...integrationNames,\n          [name]: Boolean(event.integrations?.[name]),\n        }\n      },\n      {} as Record<string, boolean>\n    )\n\n    // This is pretty trippy, but here's what's going on:\n    // - a) We don't pass initial integration options as part of the event, only if they're true or false\n    // - b) We do accept per integration overrides (like integrations.Amplitude.sessionId) at the event level\n    // Hence the need to convert base integration options to booleans, but maintain per event integration overrides\n    const allIntegrations = {\n      // Base config integrations object as booleans\n      ...integrationBooleans,\n\n      // Per event overrides, for things like amplitude sessionId, for example\n      ...event.options?.integrations,\n    }\n     */\n\n    const [context, overrides] = this.context(event)\n    const { /* options, */ ...rest } = event\n\n    const newEvent: TronicEvent = {\n      timestamp: new Date(),\n      ...rest,\n      context,\n      // integrations: allIntegrations,\n      ...overrides,\n      // messageId: 'ajs-next-' + md5.hash(JSON.stringify(event) + uuid()),\n    }\n    addPageContext(newEvent, pageCtx)\n\n    return newEvent\n  }\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Emitter } from '../emitter';\nimport { backoff } from './backoff';\n/**\n * @internal\n */\nexport var ON_REMOVE_FROM_FUTURE = 'onRemoveFromFuture';\nvar PriorityQueue = /** @class */ (function (_super) {\n    __extends(PriorityQueue, _super);\n    function PriorityQueue(maxAttempts, queue, seen) {\n        var _this = _super.call(this) || this;\n        _this.future = [];\n        _this.maxAttempts = maxAttempts;\n        _this.queue = queue;\n        _this.seen = seen !== null && seen !== void 0 ? seen : {};\n        return _this;\n    }\n    PriorityQueue.prototype.push = function () {\n        var _this = this;\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var accepted = items.map(function (operation) {\n            var attempts = _this.updateAttempts(operation);\n            if (attempts > _this.maxAttempts || _this.includes(operation)) {\n                return false;\n            }\n            _this.queue.push(operation);\n            return true;\n        });\n        this.queue = this.queue.sort(function (a, b) { return _this.getAttempts(a) - _this.getAttempts(b); });\n        return accepted;\n    };\n    PriorityQueue.prototype.pushWithBackoff = function (item) {\n        var _this = this;\n        if (this.getAttempts(item) === 0) {\n            return this.push(item)[0];\n        }\n        var attempt = this.updateAttempts(item);\n        if (attempt > this.maxAttempts || this.includes(item)) {\n            return false;\n        }\n        var timeout = backoff({ attempt: attempt - 1 });\n        setTimeout(function () {\n            _this.queue.push(item);\n            // remove from future list\n            _this.future = _this.future.filter(function (f) { return f.id !== item.id; });\n            // Lets listeners know that a 'future' message is now available in the queue\n            _this.emit(ON_REMOVE_FROM_FUTURE);\n        }, timeout);\n        this.future.push(item);\n        return true;\n    };\n    PriorityQueue.prototype.getAttempts = function (item) {\n        var _a;\n        return (_a = this.seen[item.id]) !== null && _a !== void 0 ? _a : 0;\n    };\n    PriorityQueue.prototype.updateAttempts = function (item) {\n        this.seen[item.id] = this.getAttempts(item) + 1;\n        return this.getAttempts(item);\n    };\n    PriorityQueue.prototype.includes = function (item) {\n        return (this.queue.includes(item) ||\n            this.future.includes(item) ||\n            Boolean(this.queue.find(function (i) { return i.id === item.id; })) ||\n            Boolean(this.future.find(function (i) { return i.id === item.id; })));\n    };\n    PriorityQueue.prototype.pop = function () {\n        return this.queue.shift();\n    };\n    Object.defineProperty(PriorityQueue.prototype, \"length\", {\n        get: function () {\n            return this.queue.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PriorityQueue.prototype, \"todo\", {\n        get: function () {\n            return this.queue.length + this.future.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return PriorityQueue;\n}(Emitter));\nexport { PriorityQueue };\n//# sourceMappingURL=index.js.map","export function backoff(params) {\n    var random = Math.random() + 1;\n    var _a = params.minTimeout, minTimeout = _a === void 0 ? 500 : _a, _b = params.factor, factor = _b === void 0 ? 2 : _b, attempt = params.attempt, _c = params.maxTimeout, maxTimeout = _c === void 0 ? Infinity : _c;\n    return Math.min(random * minTimeout * Math.pow(factor, attempt), maxTimeout);\n}\n//# sourceMappingURL=backoff.js.map","import { PriorityQueue } from '.'\nimport { Context, SerializedContext } from '../../core/context'\nimport { isBrowser } from '../../core/environment'\n\nlet loc:\n  | Storage\n  | { getItem: () => void; setItem: () => void; removeItem: () => void } = {\n  getItem() {},\n  setItem() {},\n  removeItem() {},\n}\n\ntry {\n  loc = isBrowser() && window.localStorage ? window.localStorage : loc\n} catch (err) {\n  console.warn('Unable to access localStorage', err)\n}\n\nfunction persisted(key: string): Context[] {\n  const items = loc.getItem(key)\n  return (items ? JSON.parse(items) : []).map(\n    (p: SerializedContext) => new Context(p.event, p.id)\n  )\n}\n\nfunction persistItems(key: string, items: Context[]): void {\n  const existing = persisted(key)\n  const all = [...items, ...existing]\n\n  const merged = all.reduce((acc, item) => {\n    return {\n      ...acc,\n      [item.id]: item,\n    }\n  }, {} as Record<string, Context>)\n\n  loc.setItem(key, JSON.stringify(Object.values(merged)))\n}\n\nfunction seen(key: string): Record<string, number> {\n  const stored = loc.getItem(key)\n  return stored ? JSON.parse(stored) : {}\n}\n\nfunction persistSeen(key: string, memory: Record<string, number>): void {\n  const stored = seen(key)\n\n  loc.setItem(\n    key,\n    JSON.stringify({\n      ...stored,\n      ...memory,\n    })\n  )\n}\n\nfunction remove(key: string): void {\n  loc.removeItem(key)\n}\n\nconst now = (): number => new Date().getTime()\n\nfunction mutex(key: string, onUnlock: Function, attempt = 0): void {\n  const lockTimeout = 50\n  const lockKey = `persisted-queue:v1:${key}:lock`\n\n  const expired = (lock: number): boolean => new Date().getTime() > lock\n  const rawLock = loc.getItem(lockKey)\n  const lock = rawLock ? (JSON.parse(rawLock) as number) : null\n\n  const allowed = lock === null || expired(lock)\n  if (allowed) {\n    loc.setItem(lockKey, JSON.stringify(now() + lockTimeout))\n    onUnlock()\n    loc.removeItem(lockKey)\n    return\n  }\n\n  if (!allowed && attempt < 3) {\n    setTimeout(() => {\n      mutex(key, onUnlock, attempt + 1)\n    }, lockTimeout)\n  } else {\n    console.error('Unable to retrieve lock')\n  }\n}\n\nexport class PersistedPriorityQueue extends PriorityQueue<Context> {\n  constructor(maxAttempts: number, key: string) {\n    super(maxAttempts, [])\n\n    const itemsKey = `persisted-queue:v1:${key}:items`\n    const seenKey = `persisted-queue:v1:${key}:seen`\n\n    let saved: Context[] = []\n    let lastSeen: Record<string, number> = {}\n\n    mutex(key, () => {\n      try {\n        saved = persisted(itemsKey)\n        lastSeen = seen(seenKey)\n        remove(itemsKey)\n        remove(seenKey)\n\n        this.queue = [...saved, ...this.queue]\n        this.seen = { ...lastSeen, ...this.seen }\n      } catch (err) {\n        console.error(err)\n      }\n    })\n\n    window.addEventListener('pagehide', () => {\n      // we deliberately want to use the less powerful 'pagehide' API to only persist on events where the receiver instance gets destroyed, and not on tab away.\n      if (this.todo > 0) {\n        const items = [...this.queue, ...this.future]\n        try {\n          mutex(key, () => {\n            persistItems(itemsKey, items)\n            persistSeen(seenKey, this.seen)\n          })\n        } catch (err) {\n          console.error(err)\n        }\n      }\n    })\n  }\n}\n","var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nexport function groupBy(collection, grouper) {\n    var results = {};\n    collection.forEach(function (item) {\n        var _a;\n        var key = undefined;\n        if (typeof grouper === 'string') {\n            var suggestedKey = item[grouper];\n            key =\n                typeof suggestedKey !== 'string'\n                    ? JSON.stringify(suggestedKey)\n                    : suggestedKey;\n        }\n        else if (grouper instanceof Function) {\n            key = grouper(item);\n        }\n        if (key === undefined) {\n            return;\n        }\n        results[key] = __spreadArray(__spreadArray([], ((_a = results[key]) !== null && _a !== void 0 ? _a : []), true), [item], false);\n    });\n    return results;\n}\n//# sourceMappingURL=group-by.js.map","/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport var isThenable = function (value) {\n    return typeof value === 'object' &&\n        value !== null &&\n        'then' in value &&\n        typeof value.then === 'function';\n};\n//# sourceMappingURL=is-thenable.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { CoreContext, ContextCancelation } from '../context';\nfunction tryAsync(fn) {\n    return __awaiter(this, void 0, void 0, function () {\n        var err_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 2, , 3]);\n                    return [4 /*yield*/, fn()];\n                case 1: return [2 /*return*/, _a.sent()];\n                case 2:\n                    err_1 = _a.sent();\n                    return [2 /*return*/, Promise.reject(err_1)];\n                case 3: return [2 /*return*/];\n            }\n        });\n    });\n}\nexport function attempt(ctx, plugin) {\n    ctx.log('debug', 'plugin', { plugin: plugin.name });\n    var start = new Date().getTime();\n    var hook = plugin[ctx.event.type];\n    if (hook === undefined) {\n        return Promise.resolve(ctx);\n    }\n    var newCtx = tryAsync(function () { return hook.apply(plugin, [ctx]); })\n        .then(function (ctx) {\n        var done = new Date().getTime() - start;\n        ctx.stats.gauge('plugin_time', done, [\"plugin:\".concat(plugin.name)]);\n        return ctx;\n    })\n        .catch(function (err) {\n        if (err instanceof ContextCancelation &&\n            err.type === 'middleware_cancellation') {\n            throw err;\n        }\n        if (err instanceof ContextCancelation) {\n            ctx.log('warn', err.type, {\n                plugin: plugin.name,\n                error: err,\n            });\n            return err;\n        }\n        ctx.log('error', 'plugin Error', {\n            plugin: plugin.name,\n            error: err,\n        });\n        ctx.stats.increment('plugin_error', 1, [\"plugin:\".concat(plugin.name)]);\n        return err;\n    });\n    return newCtx;\n}\nexport function ensure(ctx, plugin) {\n    return attempt(ctx, plugin).then(function (newContext) {\n        if (newContext instanceof CoreContext) {\n            return newContext;\n        }\n        ctx.log('debug', 'Context canceled');\n        ctx.stats.increment('context_canceled');\n        ctx.cancel(newContext);\n    });\n}\n//# sourceMappingURL=delivery.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { groupBy } from '../utils/group-by';\nimport { ON_REMOVE_FROM_FUTURE } from '../priority-queue';\nimport { CoreContext, ContextCancelation } from '../context';\nimport { Emitter } from '../emitter';\nimport { createTaskGroup } from '../task/task-group';\nimport { attempt, ensure } from './delivery';\nvar CoreEventQueue = /** @class */ (function (_super) {\n    __extends(CoreEventQueue, _super);\n    function CoreEventQueue(priorityQueue) {\n        var _this = _super.call(this) || this;\n        /**\n         * All event deliveries get suspended until all the tasks in this task group are complete.\n         * For example: a middleware that augments the event object should be loaded safely as a\n         * critical task, this way, event queue will wait for it to be ready before sending events.\n         *\n         * This applies to all the events already in the queue, and the upcoming ones\n         */\n        _this.criticalTasks = createTaskGroup();\n        _this.plugins = [];\n        _this.failedInitializations = [];\n        _this.flushing = false;\n        _this.queue = priorityQueue;\n        _this.queue.on(ON_REMOVE_FROM_FUTURE, function () {\n            _this.scheduleFlush(0);\n        });\n        return _this;\n    }\n    CoreEventQueue.prototype.register = function (ctx, plugin, instance) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.resolve(plugin.load(ctx, instance))\n                            .then(function () {\n                            _this.plugins.push(plugin);\n                        })\n                            .catch(function (err) {\n                            if (plugin.type === 'destination') {\n                                _this.failedInitializations.push(plugin.name);\n                                console.warn(plugin.name, err);\n                                ctx.log('warn', 'Failed to load destination', {\n                                    plugin: plugin.name,\n                                    error: err,\n                                });\n                                return;\n                            }\n                            throw err;\n                        })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.deregister = function (ctx, plugin, instance) {\n        return __awaiter(this, void 0, void 0, function () {\n            var e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        if (!plugin.unload) return [3 /*break*/, 2];\n                        return [4 /*yield*/, Promise.resolve(plugin.unload(ctx, instance))];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        this.plugins = this.plugins.filter(function (p) { return p.name !== plugin.name; });\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        ctx.log('warn', 'Failed to unload destination', {\n                            plugin: plugin.name,\n                            error: e_1,\n                        });\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.dispatch = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var willDeliver;\n            return __generator(this, function (_a) {\n                ctx.log('debug', 'Dispatching');\n                ctx.stats.increment('message_dispatched');\n                this.queue.push(ctx);\n                willDeliver = this.subscribeToDelivery(ctx);\n                this.scheduleFlush(0);\n                return [2 /*return*/, willDeliver];\n            });\n        });\n    };\n    CoreEventQueue.prototype.subscribeToDelivery = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve) {\n                        var onDeliver = function (flushed, delivered) {\n                            if (flushed.isSame(ctx)) {\n                                _this.off('flush', onDeliver);\n                                if (delivered) {\n                                    resolve(flushed);\n                                }\n                                else {\n                                    resolve(flushed);\n                                }\n                            }\n                        };\n                        _this.on('flush', onDeliver);\n                    })];\n            });\n        });\n    };\n    CoreEventQueue.prototype.dispatchSingle = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                ctx.log('debug', 'Dispatching');\n                ctx.stats.increment('message_dispatched');\n                this.queue.updateAttempts(ctx);\n                ctx.attempts = 1;\n                return [2 /*return*/, this.deliver(ctx).catch(function (err) {\n                        var accepted = _this.enqueuRetry(err, ctx);\n                        if (!accepted) {\n                            ctx.setFailedDelivery({ reason: err });\n                            return ctx;\n                        }\n                        return _this.subscribeToDelivery(ctx);\n                    })];\n            });\n        });\n    };\n    CoreEventQueue.prototype.isEmpty = function () {\n        return this.queue.length === 0;\n    };\n    CoreEventQueue.prototype.scheduleFlush = function (timeout) {\n        var _this = this;\n        if (timeout === void 0) { timeout = 500; }\n        if (this.flushing) {\n            return;\n        }\n        this.flushing = true;\n        setTimeout(function () {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            _this.flush().then(function () {\n                setTimeout(function () {\n                    _this.flushing = false;\n                    if (_this.queue.length) {\n                        _this.scheduleFlush(0);\n                    }\n                }, 0);\n            });\n        }, timeout);\n    };\n    CoreEventQueue.prototype.deliver = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var start, done, err_1, error;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.criticalTasks.done()];\n                    case 1:\n                        _a.sent();\n                        start = Date.now();\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 5]);\n                        return [4 /*yield*/, this.flushOne(ctx)];\n                    case 3:\n                        ctx = _a.sent();\n                        done = Date.now() - start;\n                        this.emit('delivery_success', ctx);\n                        ctx.stats.gauge('delivered', done);\n                        ctx.log('debug', 'Delivered', ctx.event);\n                        return [2 /*return*/, ctx];\n                    case 4:\n                        err_1 = _a.sent();\n                        error = err_1;\n                        ctx.log('error', 'Failed to deliver', error);\n                        this.emit('delivery_failure', ctx, error);\n                        ctx.stats.increment('delivery_failed');\n                        throw err_1;\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.enqueuRetry = function (err, ctx) {\n        var retriable = !(err instanceof ContextCancelation) || err.retry;\n        if (!retriable) {\n            return false;\n        }\n        return this.queue.pushWithBackoff(ctx);\n    };\n    CoreEventQueue.prototype.flush = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var ctx, err_2, accepted;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.queue.length === 0) {\n                            return [2 /*return*/, []];\n                        }\n                        ctx = this.queue.pop();\n                        if (!ctx) {\n                            return [2 /*return*/, []];\n                        }\n                        ctx.attempts = this.queue.getAttempts(ctx);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.deliver(ctx)];\n                    case 2:\n                        ctx = _a.sent();\n                        this.emit('flush', ctx, true);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _a.sent();\n                        accepted = this.enqueuRetry(err_2, ctx);\n                        if (!accepted) {\n                            ctx.setFailedDelivery({ reason: err_2 });\n                            this.emit('flush', ctx, false);\n                        }\n                        return [2 /*return*/, []];\n                    case 4: return [2 /*return*/, [ctx]];\n                }\n            });\n        });\n    };\n    CoreEventQueue.prototype.isReady = function () {\n        // return this.plugins.every((p) => p.isLoaded())\n        // should we wait for every plugin to load?\n        return true;\n    };\n    CoreEventQueue.prototype.availableExtensions = function (denyList) {\n        var available = this.plugins.filter(function (p) {\n            var _a, _b, _c;\n            // Only filter out destination plugins or the Segment.io plugin\n            if (p.type !== 'destination' && p.name !== 'Segment.io') {\n                return true;\n            }\n            var alternativeNameMatch = undefined;\n            (_a = p.alternativeNames) === null || _a === void 0 ? void 0 : _a.forEach(function (name) {\n                if (denyList[name] !== undefined) {\n                    alternativeNameMatch = denyList[name];\n                }\n            });\n            // Explicit integration option takes precedence, `All: false` does not apply to Segment.io\n            return ((_c = (_b = denyList[p.name]) !== null && _b !== void 0 ? _b : alternativeNameMatch) !== null && _c !== void 0 ? _c : (p.name === 'Segment.io' ? true : denyList.All) !== false);\n        });\n        var _a = groupBy(available, 'type'), _b = _a.before, before = _b === void 0 ? [] : _b, _c = _a.enrichment, enrichment = _c === void 0 ? [] : _c, _d = _a.destination, destination = _d === void 0 ? [] : _d, _e = _a.after, after = _e === void 0 ? [] : _e;\n        return {\n            before: before,\n            enrichment: enrichment,\n            destinations: destination,\n            after: after,\n        };\n    };\n    CoreEventQueue.prototype.flushOne = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, before, enrichment, _i, before_1, beforeWare, temp, _b, enrichment_1, enrichmentWare, temp, _c, destinations, after, afterCalls;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        if (!this.isReady()) {\n                            throw new Error('Not ready');\n                        }\n                        if (ctx.attempts > 1) {\n                            this.emit('delivery_retry', ctx);\n                        }\n                        _a = this.availableExtensions(\n                        /* ctx.event.integrations ?? */ {}), before = _a.before, enrichment = _a.enrichment;\n                        _i = 0, before_1 = before;\n                        _d.label = 1;\n                    case 1:\n                        if (!(_i < before_1.length)) return [3 /*break*/, 4];\n                        beforeWare = before_1[_i];\n                        return [4 /*yield*/, ensure(ctx, beforeWare)];\n                    case 2:\n                        temp = _d.sent();\n                        if (temp instanceof CoreContext) {\n                            ctx = temp;\n                        }\n                        this.emit('message_enriched', ctx, beforeWare);\n                        _d.label = 3;\n                    case 3:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 4:\n                        _b = 0, enrichment_1 = enrichment;\n                        _d.label = 5;\n                    case 5:\n                        if (!(_b < enrichment_1.length)) return [3 /*break*/, 8];\n                        enrichmentWare = enrichment_1[_b];\n                        return [4 /*yield*/, attempt(ctx, enrichmentWare)];\n                    case 6:\n                        temp = _d.sent();\n                        if (temp instanceof CoreContext) {\n                            ctx = temp;\n                        }\n                        this.emit('message_enriched', ctx, enrichmentWare);\n                        _d.label = 7;\n                    case 7:\n                        _b++;\n                        return [3 /*break*/, 5];\n                    case 8:\n                        _c = this.availableExtensions(\n                        /* ctx.event.integrations ?? */ {}), destinations = _c.destinations, after = _c.after;\n                        return [4 /*yield*/, new Promise(function (resolve, reject) {\n                                setTimeout(function () {\n                                    var attempts = destinations.map(function (destination) {\n                                        return attempt(ctx, destination);\n                                    });\n                                    Promise.all(attempts).then(resolve).catch(reject);\n                                }, 0);\n                            })];\n                    case 9:\n                        _d.sent();\n                        ctx.stats.increment('message_delivered');\n                        this.emit('message_delivered', ctx);\n                        afterCalls = after.map(function (after) { return attempt(ctx, after); });\n                        return [4 /*yield*/, Promise.all(afterCalls)];\n                    case 10:\n                        _d.sent();\n                        return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    return CoreEventQueue;\n}(Emitter));\nexport { CoreEventQueue };\n//# sourceMappingURL=event-queue.js.map","import { isThenable } from '../utils/is-thenable';\nexport var createTaskGroup = function () {\n    var taskCompletionPromise;\n    var resolvePromise;\n    var count = 0;\n    return {\n        done: function () { return taskCompletionPromise; },\n        run: function (op) {\n            var returnValue = op();\n            if (isThenable(returnValue)) {\n                if (++count === 1) {\n                    taskCompletionPromise = new Promise(function (res) { return (resolvePromise = res); });\n                }\n                returnValue.finally(function () { return --count === 0 && resolvePromise(); });\n            }\n            return returnValue;\n        },\n    };\n};\n//# sourceMappingURL=task-group.js.map","import { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { Context } from '../context'\nimport { AnyBrowserPlugin } from '../plugin'\nimport { CoreEventQueue } from '@tronic/receiver-core'\nimport { isOffline } from '../connection'\n\nexport class EventQueue extends CoreEventQueue<Context, AnyBrowserPlugin> {\n  constructor(name: string)\n  constructor(priorityQueue: PriorityQueue<Context>)\n  constructor(nameOrQueue: string | PriorityQueue<Context>) {\n    super(\n      typeof nameOrQueue === 'string'\n        ? new PersistedPriorityQueue(4, nameOrQueue)\n        : nameOrQueue\n    )\n  }\n  async flush(): Promise<Context[]> {\n    if (isOffline()) return []\n    return super.flush()\n  }\n}\n","export default function bindAll<\n  ObjType extends { [key: string]: any },\n  KeyType extends keyof ObjType\n>(obj: ObjType): ObjType {\n  const proto = obj.constructor.prototype\n  for (const key of Object.getOwnPropertyNames(proto)) {\n    if (key !== 'constructor') {\n      const desc = Object.getOwnPropertyDescriptor(\n        obj.constructor.prototype,\n        key\n      )\n      if (!!desc && typeof desc.value === 'function') {\n        obj[key as KeyType] = obj[key].bind(obj)\n      }\n    }\n  }\n\n  return obj\n}\n","import { CookieOptions } from './cookieStorage'\n\nexport const StoreType = {\n  Cookie: 'cookie',\n  LocalStorage: 'localStorage',\n  Memory: 'memory',\n} as const\n\n/**\n * Known Storage Types\n *\n * Convenience settings for storage systems that AJS includes support for\n */\nexport type StoreType = typeof StoreType[keyof typeof StoreType]\n\nexport type StorageObject = Record<string, unknown>\n\n/**\n * Defines a Storage object for use in AJS Client.\n */\nexport interface Store<Data extends StorageObject = StorageObject> {\n  /**\n   * get value for the key from the stores. it will return the first value found in the stores\n   * @param key key for the value to be retrieved\n   * @returns value for the key or null if not found\n   */\n  get<K extends keyof Data>(key: K): Data[K] | null\n\n  /**\n   * it will set the value for the key in all the stores\n   * @param key key for the value to be stored\n   * @param value value to be stored\n   * @returns value that was stored\n   */\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void\n  /**\n   * remove the value for the key from all the stores\n   * @param key key for the value to be removed\n   * @param storeTypes optional array of store types to be used for removing the value\n   */\n  remove<K extends keyof Data>(key: K): void\n}\n\nexport interface StoreTypeWithSettings<T extends StoreType = StoreType> {\n  name: T\n  settings?: T extends 'cookie' ? CookieOptions : never\n}\n\nexport type InitializeStorageArgs = (StoreTypeWithSettings | StoreType)[]\n","import { Store, StorageObject } from './types'\n\n// not adding to private method because those method names do not get minified atm, and does not use 'this'\nconst _logStoreKeyError = (\n  store: Store,\n  action: 'set' | 'get' | 'remove',\n  key: string,\n  err: unknown\n) => {\n  console.warn(\n    `${store.constructor.name}: Can't ${action} key \"${key}\" | Err: ${err}`\n  )\n}\n\n/**\n * Uses multiple storages in a priority list to get/set values in the order they are specified.\n */\nexport class UniversalStorage<Data extends StorageObject = StorageObject> {\n  private stores: Store[]\n\n  constructor(stores: Store[]) {\n    this.stores = stores\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    let val: Data[K] | null = null\n\n    for (const store of this.stores) {\n      try {\n        val = store.get(key) as Data[K] | null\n        if (val !== undefined && val !== null) {\n          return val\n        }\n      } catch (e) {\n        _logStoreKeyError(store, 'get', key, e)\n      }\n    }\n    return null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.stores.forEach((store) => {\n      try {\n        store.set(key, value)\n      } catch (e) {\n        _logStoreKeyError(store, 'set', key, e)\n      }\n    })\n  }\n\n  clear<K extends keyof Data>(key: K): void {\n    this.stores.forEach((store) => {\n      try {\n        store.remove(key)\n      } catch (e) {\n        _logStoreKeyError(store, 'remove', key, e)\n      }\n    })\n  }\n\n  /*\n    This is to support few scenarios where:\n    - value exist in one of the stores ( as a result of other stores being cleared from browser ) and we want to resync them\n    - read values in AJS 1.0 format ( for customers after 1.0 --> 2.0 migration ) and then re-write them in AJS 2.0 format\n  */\n  getAndSync<K extends keyof Data>(key: K): Data[K] | null {\n    const val = this.get(key)\n\n    // legacy behavior, getAndSync can change the type of a value from number to string (AJS 1.0 stores numerical values as a number)\n    const coercedValue = (typeof val === 'number' ? val.toString() : val) as\n      | Data[K]\n      | null\n\n    this.set(key, coercedValue)\n\n    return coercedValue\n  }\n}\n","import { Store, StorageObject } from './types'\n\n/**\n * Data Storage using in memory object\n */\nexport class MemoryStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private cache: Record<string, unknown> = {}\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    return (this.cache[key] ?? null) as Data[K] | null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.cache[key] = value\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    delete this.cache[key]\n  }\n}\n","import { StoreType, StoreTypeWithSettings } from './types'\n\nexport type UniversalStorageSettings = { stores: StoreType[] }\n\n// This is setup this way to permit eventually a different set of settings for custom storage\nexport type StorageSettings = UniversalStorageSettings\n\nexport function isArrayOfStoreType(\n  s: StorageSettings\n): s is UniversalStorageSettings {\n  return (\n    s &&\n    s.stores &&\n    Array.isArray(s.stores) &&\n    s.stores.every((e) => Object.values(StoreType).includes(e))\n  )\n}\n\nexport function isStoreTypeWithSettings(\n  s: StoreTypeWithSettings | StoreType\n): s is StoreTypeWithSettings {\n  return typeof s === 'object' && s.name !== undefined\n}\n","/*! js-cookie v3.0.1 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (key, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    key = encodeURIComponent(key)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      key + '=' + converter.write(value, key) + stringifiedAttributes)\n  }\n\n  function get (key) {\n    if (typeof document === 'undefined' || (arguments.length && !key)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var foundKey = decodeURIComponent(parts[0]);\n        jar[foundKey] = converter.read(value, foundKey);\n\n        if (key === foundKey) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return key ? jar[key] : jar\n  }\n\n  return Object.create(\n    {\n      set: set,\n      get: get,\n      remove: function (key, attributes) {\n        set(\n          key,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport default api;\n","import cookie from 'js-cookie'\n\n/**\n * Levels returns all levels of the given url.\n *\n * @param {string} url\n * @return {Array}\n * @api public\n */\nfunction levels(url: URL): string[] {\n  const host = url.hostname\n  const parts = host.split('.')\n  const last = parts[parts.length - 1]\n  const levels: string[] = []\n\n  // Ip address.\n  if (parts.length === 4 && parseInt(last, 10) > 0) {\n    return levels\n  }\n\n  // Localhost.\n  if (parts.length <= 1) {\n    return levels\n  }\n\n  // Create levels.\n  for (let i = parts.length - 2; i >= 0; --i) {\n    levels.push(parts.slice(i).join('.'))\n  }\n\n  return levels\n}\n\nfunction parseUrl(url: string): URL | undefined {\n  try {\n    return new URL(url)\n  } catch {\n    return\n  }\n}\n\nexport function tld(url: string): string | undefined {\n  const parsedUrl = parseUrl(url)\n  if (!parsedUrl) return\n\n  const lvls = levels(parsedUrl)\n\n  // Lookup the real top level one.\n  for (let i = 0; i < lvls.length; ++i) {\n    const cname = '__tld__'\n    const domain = lvls[i]\n    const opts = { domain: '.' + domain }\n\n    try {\n      // cookie access throw an error if the library is ran inside a sandboxed environment (e.g. sandboxed iframe)\n      cookie.set(cname, '1', opts)\n      if (cookie.get(cname)) {\n        cookie.remove(cname, opts)\n        return domain\n      }\n    } catch (_) {\n      return\n    }\n  }\n}\n","import { Store, StorageObject } from './types'\nimport jar from 'js-cookie'\nimport { tld } from '../user/tld'\n\nconst ONE_YEAR = 365\n\nexport interface CookieOptions {\n  maxage?: number\n  domain?: string\n  path?: string\n  secure?: boolean\n  sameSite?: string\n}\n\n/**\n * Data storage using browser cookies\n */\nexport class CookieStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  static get defaults(): CookieOptions {\n    return {\n      maxage: ONE_YEAR,\n      domain: tld(window.location.href),\n      path: '/',\n      sameSite: 'Lax',\n    }\n  }\n\n  private options: Required<CookieOptions>\n\n  constructor(options: CookieOptions = CookieStorage.defaults) {\n    this.options = {\n      ...CookieStorage.defaults,\n      ...options,\n    } as Required<CookieOptions>\n  }\n\n  private opts(): jar.CookieAttributes {\n    return {\n      sameSite: this.options.sameSite as jar.CookieAttributes['sameSite'],\n      expires: this.options.maxage,\n      domain: this.options.domain,\n      path: this.options.path,\n      secure: this.options.secure,\n    }\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const value = jar.get(key)\n\n      if (value === undefined || value === null) {\n        return null\n      }\n\n      try {\n        return JSON.parse(value) ?? null\n      } catch (e) {\n        return (value ?? null) as unknown as Data[K] | null\n      }\n    } catch (e) {\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    if (typeof value === 'string') {\n      jar.set(key, value, this.opts())\n    } else if (value === null) {\n      jar.remove(key, this.opts())\n    } else {\n      jar.set(key, JSON.stringify(value), this.opts())\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    return jar.remove(key, this.opts())\n  }\n}\n","import { StorageObject, Store } from './types'\n\n/**\n * Data storage using browser's localStorage\n */\nexport class LocalStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private localStorageWarning(key: keyof Data, state: 'full' | 'unavailable') {\n    console.warn(`Unable to access ${key}, localStorage may be ${state}`)\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const val = localStorage.getItem(key)\n      if (val === null) {\n        return null\n      }\n      try {\n        return JSON.parse(val) ?? null\n      } catch (e) {\n        return (val ?? null) as unknown as Data[K] | null\n      }\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    try {\n      localStorage.setItem(key, JSON.stringify(value))\n    } catch {\n      this.localStorageWarning(key, 'full')\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    try {\n      return localStorage.removeItem(key)\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n    }\n  }\n}\n","import { CookieOptions, CookieStorage } from './cookieStorage'\nimport { LocalStorage } from './localStorage'\nimport { MemoryStorage } from './memoryStorage'\nimport { isStoreTypeWithSettings } from './settings'\nimport { StoreType, Store, InitializeStorageArgs } from './types'\n\nexport * from './types'\nexport * from './localStorage'\nexport * from './cookieStorage'\nexport * from './memoryStorage'\nexport * from './universalStorage'\nexport * from './settings'\n\n/**\n * Creates multiple storage systems from an array of StoreType and options\n * @param args StoreType and options\n * @returns Storage array\n */\nexport function initializeStorages(args: InitializeStorageArgs): Store[] {\n  const storages = args.map((s) => {\n    let type: StoreType\n    let settings\n\n    if (isStoreTypeWithSettings(s)) {\n      type = s.name\n      settings = s.settings\n    } else {\n      type = s\n    }\n\n    switch (type) {\n      case StoreType.Cookie:\n        return new CookieStorage(settings)\n      case StoreType.LocalStorage:\n        return new LocalStorage()\n      case StoreType.Memory:\n        return new MemoryStorage()\n      default:\n        throw new Error(`Unknown Store Type: ${s}`)\n    }\n  })\n  return storages\n}\n\n/**\n * Injects the CookieOptions into a the arguments for initializeStorage\n * @param storeTypes list of storeType\n * @param cookieOptions cookie Options\n * @returns arguments for initializeStorage\n */\nexport function applyCookieOptions(\n  storeTypes: StoreType[],\n  cookieOptions?: CookieOptions\n): InitializeStorageArgs {\n  return storeTypes.map((s) => {\n    if (cookieOptions && s === StoreType.Cookie) {\n      return {\n        name: s,\n        settings: cookieOptions,\n      }\n    }\n    return s\n  })\n}\n","import { v4 as uuid } from '@lukeed/uuid'\nimport autoBind from '../../lib/bind-all'\nimport { Traits } from '../events'\nimport {\n  CookieOptions,\n  UniversalStorage,\n  MemoryStorage,\n  StorageObject,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\n\nexport type ID = string | null | undefined\n\nexport interface UserOptions {\n  /**\n   * Disables storing any data about the user.\n   */\n  disable?: boolean\n  localStorageFallbackDisabled?: boolean\n  persist?: boolean\n\n  cookie?: {\n    key?: string\n    oldKey?: string\n  }\n\n  localStorage?: {\n    key: string\n  }\n\n  /**\n   * Store priority\n   * @example stores: [StoreType.Cookie, StoreType.Memory]\n   */\n  storage?: StorageSettings\n}\n\nconst defaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_user_id',\n    oldKey: 'ajs_user',\n  },\n  localStorage: {\n    key: 'ajs_user_traits',\n  },\n}\n\nexport class User {\n  static defaults = defaults\n\n  private idKey: string\n  private traitsKey: string\n  private anonKey: string\n  private cookieOptions?: CookieOptions\n\n  private legacyUserStore: UniversalStorage<{\n    [k: string]:\n      | {\n          id?: string\n          traits?: Traits\n        }\n      | string\n  }>\n  private traitsStore: UniversalStorage<{\n    [k: string]: Traits\n  }>\n\n  private identityStore: UniversalStorage<{\n    [k: string]: string\n  }>\n\n  options: UserOptions = {}\n\n  constructor(options: UserOptions = defaults, cookieOptions?: CookieOptions) {\n    this.options = { ...defaults, ...options }\n    this.cookieOptions = cookieOptions\n\n    this.idKey = options.cookie?.key ?? defaults.cookie.key\n    this.traitsKey = options.localStorage?.key ?? defaults.localStorage.key\n    this.anonKey = 'ajs_anonymous_id'\n\n    this.identityStore = this.createStorage(this.options, cookieOptions)\n\n    // using only cookies for legacy user store\n    this.legacyUserStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s === StoreType.Cookie\n    )\n\n    // using only localStorage / memory for traits store\n    this.traitsStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s !== StoreType.Cookie\n    )\n\n    const legacyUser = this.legacyUserStore.get(defaults.cookie.oldKey)\n    if (legacyUser && typeof legacyUser === 'object') {\n      legacyUser.id && this.id(legacyUser.id)\n      legacyUser.traits && this.traits(legacyUser.traits)\n    }\n    autoBind(this)\n  }\n\n  id = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    const prevId = this.identityStore.getAndSync(this.idKey)\n\n    if (id !== undefined) {\n      this.identityStore.set(this.idKey, id)\n\n      const changingIdentity = id !== prevId && prevId !== null && id !== null\n      if (changingIdentity) {\n        this.anonymousId(null)\n      }\n    }\n\n    const retId = this.identityStore.getAndSync(this.idKey)\n    if (retId) return retId\n\n    const retLeg = this.legacyUserStore.get(defaults.cookie.oldKey)\n    return retLeg ? (typeof retLeg === 'object' ? retLeg.id : retLeg) : null\n  }\n\n  private legacySIO(): [string, string] | null {\n    const val = this.legacyUserStore.get('_sio') as string\n    if (!val) {\n      return null\n    }\n    const [anon, user] = val.split('----')\n    return [anon, user]\n  }\n\n  anonymousId = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    if (id === undefined) {\n      const val =\n        this.identityStore.getAndSync(this.anonKey) ?? this.legacySIO()?.[0]\n\n      if (val) {\n        return val\n      }\n    }\n\n    if (id === null) {\n      this.identityStore.set(this.anonKey, null)\n      return this.identityStore.getAndSync(this.anonKey)\n    }\n\n    this.identityStore.set(this.anonKey, id ?? uuid())\n    return this.identityStore.getAndSync(this.anonKey)\n  }\n\n  traits = (traits?: Traits | null): Traits | undefined => {\n    if (this.options.disable) {\n      return\n    }\n\n    if (traits === null) {\n      traits = {}\n    }\n\n    if (traits) {\n      this.traitsStore.set(this.traitsKey, traits ?? {})\n    }\n\n    return this.traitsStore.get(this.traitsKey) ?? {}\n  }\n\n  identify(id?: ID, traits?: Traits): void {\n    if (this.options.disable) {\n      return\n    }\n\n    traits = traits ?? {}\n    const currentId = this.id()\n\n    if (currentId === null || currentId === id) {\n      traits = {\n        ...this.traits(),\n        ...traits,\n      }\n    }\n\n    if (id) {\n      this.id(id)\n    }\n\n    this.traits(traits)\n  }\n\n  logout(): void {\n    this.anonymousId(null)\n    this.id(null)\n    this.traits({})\n  }\n\n  reset(): void {\n    this.logout()\n    this.identityStore.clear(this.idKey)\n    this.identityStore.clear(this.anonKey)\n    this.traitsStore.clear(this.traitsKey)\n  }\n\n  load(): User {\n    return new User(this.options, this.cookieOptions)\n  }\n\n  save(): boolean {\n    return true\n  }\n\n  /**\n   * Creates the right storage system applying all the user options, cookie options and particular filters\n   * @param options UserOptions\n   * @param cookieOpts CookieOptions\n   * @param filterStores filter function to apply to any StoreTypes (skipped if options specify using a custom storage)\n   * @returns a Storage object\n   */\n  private createStorage<T extends StorageObject = StorageObject>(\n    options: UserOptions,\n    cookieOpts?: CookieOptions,\n    filterStores?: (value: StoreType) => boolean\n  ): UniversalStorage<T> {\n    let stores: StoreType[] = [\n      StoreType.LocalStorage,\n      StoreType.Cookie,\n      StoreType.Memory,\n    ]\n\n    // If disabled we won't have any storage functionality\n    if (options.disable) {\n      return new UniversalStorage<T>([])\n    }\n\n    // If persistance is disabled we will always fallback to Memory Storage\n    if (!options.persist) {\n      return new UniversalStorage<T>([new MemoryStorage<T>()])\n    }\n\n    if (options.storage !== undefined && options.storage !== null) {\n      if (isArrayOfStoreType(options.storage)) {\n        // If the user only specified order of stores we will still apply filters and transformations e.g. not using localStorage if localStorageFallbackDisabled\n        stores = options.storage.stores\n      }\n    }\n\n    // Disable LocalStorage\n    if (options.localStorageFallbackDisabled) {\n      stores = stores.filter((s) => s !== StoreType.LocalStorage)\n    }\n\n    // Apply Additional filters\n    if (filterStores) {\n      stores = stores.filter(filterStores)\n    }\n\n    return new UniversalStorage(\n      initializeStorages(applyCookieOptions(stores, cookieOpts))\n    )\n  }\n}\n\nconst groupDefaults: UserOptions = {\n  persist: true,\n  cookie: {\n    key: 'ajs_group_id',\n  },\n  localStorage: {\n    key: 'ajs_group_properties',\n  },\n}\n\nexport class Group extends User {\n  constructor(options: UserOptions = groupDefaults, cookie?: CookieOptions) {\n    super({ ...groupDefaults, ...options }, cookie)\n    autoBind(this)\n  }\n\n  anonymousId = (_id?: ID): ID => {\n    return undefined\n  }\n}\n","import { Receiver } from '../receiver'\nimport { Context } from '../context'\nimport { isThenable } from '../../lib/is-thenable'\nimport { ReceiverBrowserCore } from '../receiver/interfaces'\nimport { version } from '../../generated/version'\nimport { getGlobalReceiver } from '../../lib/global-receiver-helper'\nimport {\n  isBufferedPageContext,\n  BufferedPageContext,\n  getDefaultBufferedPageContext,\n  createPageContext,\n  PageContext,\n} from '../page'\n\n/**\n * The names of any ReceiverBrowser methods that also exist on Receiver\n */\nexport type PreInitMethodName =\n  //  | 'screen'\n  | 'register'\n  | 'deregister'\n  | 'user'\n  //  | 'trackSubmit'\n  //  | 'trackClick'\n  //  | 'trackLink'\n  //  | 'trackForm'\n  //  | 'pageview'\n  | 'identify'\n  | 'reset'\n  //  | 'group'\n  | 'track'\n  | 'ready'\n  //  | 'alias'\n  | 'debug'\n  //  | 'page'\n  | 'once'\n  | 'off'\n  | 'on'\n  | 'addSourceMiddleware'\n// | 'setAnonymousId'\n// | 'addDestinationMiddleware'\n\n// Union of all receiver methods that _do not_ return a Promise\ntype SyncPreInitMethodName = {\n  [MethodName in PreInitMethodName]: ReturnType<\n    Receiver[MethodName]\n  > extends Promise<any>\n  ? never\n  : MethodName\n}[PreInitMethodName]\n\nconst flushSyncReceiverCalls = (\n  name: SyncPreInitMethodName,\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.getCalls(name).forEach((c) => {\n    // While the underlying methods are synchronous, the callReceiverMethod returns a promise,\n    // which normalizes success and error states between async and non-async methods, with no perf penalty.\n    callReceiverMethod(receiver, c).catch(console.error)\n  })\n}\n\nexport const flushAddSourceMiddleware = async (\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n) => {\n  for (const c of buffer.getCalls('addSourceMiddleware')) {\n    await callReceiverMethod(receiver, c).catch(console.error)\n  }\n}\n\nexport const flushOn = flushSyncReceiverCalls.bind(this, 'on')\n\n/*\nexport const flushSetAnonymousID = flushSyncReceiverCalls.bind(\n  this,\n  'setAnonymousId'\n)\n */\n\nexport const flushReceiverCallsInNewTask = (\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.toArray().forEach((m) => {\n    setTimeout(() => {\n      callReceiverMethod(receiver, m).catch(console.error)\n    }, 0)\n  })\n}\n\nexport const popPageContext = (args: unknown[]): PageContext | undefined => {\n  if (hasBufferedPageContextAsLastArg(args)) {\n    const ctx = args.pop() as BufferedPageContext\n    return createPageContext(ctx)\n  }\n}\n\nexport const hasBufferedPageContextAsLastArg = (\n  args: unknown[]\n): args is [...unknown[], BufferedPageContext] | [BufferedPageContext] => {\n  const lastArg = args[args.length - 1]\n  return isBufferedPageContext(lastArg)\n}\n\n/**\n *  Represents a buffered method call that occurred before initialization.\n */\nexport class PreInitMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> {\n  method: MethodName\n  args: PreInitMethodParams<MethodName>\n  called: boolean\n  resolve: (v: ReturnType<Receiver[MethodName]>) => void\n  reject: (reason: any) => void\n  constructor(\n    method: PreInitMethodCall<MethodName>['method'],\n    args: PreInitMethodParams<MethodName>,\n    resolve: PreInitMethodCall<MethodName>['resolve'] = () => {},\n    reject: PreInitMethodCall<MethodName>['reject'] = console.error\n  ) {\n    this.method = method\n    this.resolve = resolve\n    this.reject = reject\n    this.called = false\n    this.args = args\n  }\n}\n\nexport type PreInitMethodParams<MethodName extends PreInitMethodName> =\n  | [...Parameters<Receiver[MethodName]>, BufferedPageContext]\n  | Parameters<Receiver[MethodName]>\n\n/**\n * Infer return type; if return type is promise, unwrap it.\n */\ntype ReturnTypeUnwrap<Fn> = Fn extends (...args: any[]) => infer ReturnT\n  ? ReturnT extends PromiseLike<infer Unwrapped>\n  ? Unwrapped\n  : ReturnT\n  : never\n\ntype MethodCallMap = Partial<Record<PreInitMethodName, PreInitMethodCall[]>>\n\ntype SnippetWindowBufferedMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> = [MethodName, ...PreInitMethodParams<MethodName>]\n\n/**\n * A list of the method calls before initialization for snippet users\n * For example, [[\"track\", \"foo\", {bar: 123}], [\"page\"], [\"on\", \"ready\", function(){..}]\n */\ntype SnippetBuffer = SnippetWindowBufferedMethodCall[]\n\n/**\n *  Represents any and all the buffered method calls that occurred before initialization.\n */\nexport class PreInitMethodCallBuffer {\n  private _callMap: MethodCallMap = {}\n\n  constructor(...calls: PreInitMethodCall[]) {\n    this.push(...calls)\n  }\n\n  /**\n   * Pull any buffered method calls from the window object, and use them to hydrate the instance buffer.\n   */\n  private get calls() {\n    this._pushSnippetWindowBuffer()\n    return this._callMap\n  }\n\n  private set calls(calls: MethodCallMap) {\n    this._callMap = calls\n  }\n\n  getCalls<T extends PreInitMethodName>(methodName: T): PreInitMethodCall<T>[] {\n    return (this.calls[methodName] ?? []) as PreInitMethodCall<T>[]\n  }\n\n  push(...calls: PreInitMethodCall[]): void {\n    calls.forEach((call) => {\n      const eventsExpectingPageContext: PreInitMethodName[] = [\n        'track',\n        // 'screen',\n        // 'alias',\n        // 'group',\n        // 'page',\n        'identify',\n      ]\n      if (\n        eventsExpectingPageContext.includes(call.method) &&\n        !hasBufferedPageContextAsLastArg(call.args)\n      ) {\n        call.args = [...call.args, getDefaultBufferedPageContext()]\n      }\n\n      if (this.calls[call.method]) {\n        this.calls[call.method]!.push(call)\n      } else {\n        this.calls[call.method] = [call]\n      }\n    })\n  }\n\n  clear(): void {\n    // clear calls in the global snippet buffered array.\n    this._pushSnippetWindowBuffer()\n    // clear calls in this instance\n    this.calls = {}\n  }\n\n  toArray(): PreInitMethodCall[] {\n    return ([] as PreInitMethodCall[]).concat(...Object.values(this.calls))\n  }\n\n  /**\n   * Fetch the buffered method calls from the window object,\n   * normalize them, and use them to hydrate the buffer.\n   * This removes existing buffered calls from the window object.\n   */\n  private _pushSnippetWindowBuffer(): void {\n    const wa = getGlobalReceiver()\n    if (!Array.isArray(wa)) return undefined\n    const buffered: SnippetBuffer = wa.splice(0, wa.length)\n    const calls = buffered.map(\n      ([methodName, ...args]) => new PreInitMethodCall(methodName, args)\n    )\n    this.push(...calls)\n  }\n}\n\n/**\n *  Call method and mark as \"called\"\n *  This function should never throw an error\n */\nexport async function callReceiverMethod<T extends PreInitMethodName>(\n  receiver: Receiver,\n  call: PreInitMethodCall<T>\n): Promise<void> {\n  try {\n    if (call.called) {\n      return undefined\n    }\n    call.called = true\n\n    const result: ReturnType<Receiver[T]> = (\n      receiver[call.method] as Function\n    )(...call.args)\n\n    if (isThenable(result)) {\n      // do not defer for non-async methods\n      await result\n    }\n\n    call.resolve(result)\n  } catch (err) {\n    call.reject(err)\n  }\n}\n\nexport type ReceiverLoader = (\n  preInitBuffer: PreInitMethodCallBuffer\n) => Promise<[Receiver, Context]>\n\nexport class ReceiverBuffered\n  implements PromiseLike<[Receiver, Context]>, ReceiverBrowserCore {\n  instance?: Receiver\n  ctx?: Context\n  private _preInitBuffer: PreInitMethodCallBuffer\n  private _promise: Promise<[Receiver, Context]>\n  constructor(loader: ReceiverLoader) {\n    this._preInitBuffer = new PreInitMethodCallBuffer()\n    this._promise = loader(this._preInitBuffer)\n    this._promise\n      .then(([ajs, ctx]) => {\n        this.instance = ajs\n        this.ctx = ctx\n      })\n      .catch(() => {\n        // intentionally do nothing...\n        // this result of this promise will be caught by the 'catch' block on this class.\n      })\n  }\n\n  then<T1, T2 = never>(\n    ...args: [\n      onfulfilled:\n      | ((instance: [Receiver, Context]) => T1 | PromiseLike<T1>)\n      | null\n      | undefined,\n      onrejected?: (reason: unknown) => T2 | PromiseLike<T2>\n    ]\n  ) {\n    return this._promise.then(...args)\n  }\n\n  catch<TResult = never>(\n    ...args: [\n      onrejected?:\n      | ((reason: any) => TResult | PromiseLike<TResult>)\n      | undefined\n      | null\n    ]\n  ) {\n    return this._promise.catch(...args)\n  }\n\n  finally(...args: [onfinally?: (() => void) | undefined | null]) {\n    return this._promise.finally(...args)\n  }\n\n  // trackSubmit = this._createMethod('trackSubmit')\n  // trackClick = this._createMethod('trackClick')\n  // trackLink = this._createMethod('trackLink')\n  // pageView = this._createMethod('pageview')\n  identify = this._createMethod('identify')\n  reset = this._createMethod('reset')\n  // group = this._createMethod('group') as ReceiverBrowserCore['group']\n  track = this._createMethod('track')\n  ready = this._createMethod('ready')\n  // alias = this._createMethod('alias')\n  debug = this._createChainableMethod('debug')\n  // page = this._createMethod('page')\n  once = this._createChainableMethod('once')\n  off = this._createChainableMethod('off')\n  on = this._createChainableMethod('on')\n  addSourceMiddleware = this._createMethod('addSourceMiddleware')\n  // setAnonymousId = this._createMethod('setAnonymousId')\n  // addDestinationMiddleware = this._createMethod('addDestinationMiddleware')\n\n  // screen = this._createMethod('screen')\n  register = this._createMethod('register')\n  deregister = this._createMethod('deregister')\n  user = this._createMethod('user')\n  readonly VERSION = version\n\n  private _createMethod<T extends PreInitMethodName>(methodName: T) {\n    return (\n      ...args: Parameters<Receiver[T]>\n    ): Promise<ReturnTypeUnwrap<Receiver[T]>> => {\n      if (this.instance) {\n        const result = (this.instance[methodName] as Function)(...args)\n        return Promise.resolve(result)\n      }\n      return new Promise((resolve, reject) => {\n        this._preInitBuffer.push(\n          new PreInitMethodCall(methodName, args, resolve as any, reject)\n        )\n      })\n    }\n  }\n\n  /**\n   *  These are for methods that where determining when the method gets \"flushed\" is not important.\n   *  These methods will resolve when receiver is fully initialized, and return type (other than Receiver)will not be available.\n   */\n  private _createChainableMethod<T extends PreInitMethodName>(methodName: T) {\n    return (...args: Parameters<Receiver[T]>): ReceiverBuffered => {\n      if (this.instance) {\n        void (this.instance[methodName] as Function)(...args)\n        return this\n      } else {\n        this._preInitBuffer.push(new PreInitMethodCall(methodName, args))\n      }\n\n      return this\n    }\n  }\n}\n","/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport const isThenable = (value: unknown): boolean =>\n  typeof value === 'object' &&\n  value !== null &&\n  'then' in value &&\n  typeof (value as any).then === 'function'\n","import {\n  DispatchedEvent,\n  EventParams,\n  resolveArguments,\n  resolveUserArguments,\n  IdentifyParams,\n} from '../arguments-resolver'\nimport type { FormArgs, LinkArgs } from '../auto-track'\nimport { isOffline } from '../connection'\nimport { Context } from '../context'\nimport { dispatch, Emitter } from '@tronic/receiver-core'\nimport {\n  Callback,\n  EventFactory,\n  Integrations,\n  Plan,\n  EventProperties,\n  TronicEvent,\n} from '../events'\nimport type { Plugin } from '../plugin'\nimport { EventQueue } from '../queue/event-queue'\nimport { Group, ID, User, UserOptions } from '../user'\nimport autoBind from '../../lib/bind-all'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\n// import type { LegacyDestination } from '../../plugins/ajs-destination'\nimport type {\n  LegacyIntegration,\n  ClassicIntegrationSource,\n} from '../../plugins/ajs-destination/types'\nimport type {\n  DestinationMiddlewareFunction,\n  MiddlewareFunction,\n} from '../../plugins/middleware'\nimport { version } from '../../generated/version'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { getGlobal } from '../../lib/get-global'\nimport { ReceiverClassic, ReceiverCore } from './interfaces'\nimport { HighEntropyHint } from '../../lib/client-hints/interfaces'\nimport type { LegacySettings } from '../../browser'\nimport {\n  CookieOptions,\n  MemoryStorage,\n  UniversalStorage,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\nimport { PluginFactory } from '../../plugins/remote-loader'\nimport { setGlobalReceiver } from '../../lib/global-receiver-helper'\nimport { popPageContext } from '../buffer'\n\ntype LegacyDestination = any;\n\nconst deprecationWarning =\n  'This is being deprecated and will be not be available in future releases of Receiver JS'\n\n// reference any pre-existing \"receiver\" object so a user can restore the reference\nconst global: any = getGlobal()\nconst _receiver = global?.receiver\n\nfunction createDefaultQueue(\n  name: string,\n  retryQueue = false,\n  disablePersistance = false\n) {\n  const maxAttempts = retryQueue ? 4 : 1\n  const priorityQueue = disablePersistance\n    ? new PriorityQueue(maxAttempts, [])\n    : new PersistedPriorityQueue(maxAttempts, name)\n  return new EventQueue(priorityQueue)\n}\n\nexport interface ReceiverSettings {\n  writeKey: string\n  timeout?: number\n  plugins?: (Plugin | PluginFactory)[]\n  classicIntegrations?: ClassicIntegrationSource[]\n}\n\nexport interface InitOptions {\n  /**\n   * Disables storing any data on the client-side via cookies or localstorage.\n   * Defaults to `false`.\n   *\n   */\n  disableClientPersistence?: boolean\n  /**\n   * Disables automatically converting ISO string event properties into Dates.\n   * ISO string to Date conversions occur right before sending events to a classic device mode integration,\n   * after any destination middleware have been ran.\n   * Defaults to `false`.\n   */\n  disableAutoISOConversion?: boolean\n  initialPageview?: boolean\n  cookie?: CookieOptions\n  storage?: StorageSettings\n  user?: UserOptions\n  group?: UserOptions\n  integrations?: Integrations\n  plan?: Plan\n  retryQueue?: boolean\n  obfuscate?: boolean\n  /**\n   * This callback allows you to update/mutate CDN Settings.\n   * This is called directly after settings are fetched from the CDN.\n   */\n  updateCDNSettings?: (settings: LegacySettings) => LegacySettings\n  /**\n   * Disables or sets constraints on processing of query string parameters\n   */\n  useQueryString?:\n  | boolean\n  | {\n    aid?: RegExp\n    uid?: RegExp\n  }\n  /**\n   * Array of high entropy Client Hints to request. These may be rejected by the user agent - only required hints should be requested.\n   */\n  highEntropyValuesClientHints?: HighEntropyHint[]\n  /**\n   * When using the snippet, this is the key that points to the global receiver instance (e.g. window.receiver).\n   * default: receiver\n   */\n  globalReceiverKey?: string\n}\n\nexport class Receiver\n  extends Emitter\n  implements ReceiverCore { // , ReceiverClassic {\n  protected settings: ReceiverSettings\n  private _user: User\n  private _group: Group\n  private eventFactory: EventFactory\n  private _debug = false\n  private _universalStorage: UniversalStorage\n\n  initialized = false\n  integrations: Integrations\n  options: InitOptions\n  queue: EventQueue\n\n  constructor(\n    settings: ReceiverSettings,\n    options?: InitOptions,\n    queue?: EventQueue,\n    user?: User,\n    group?: Group\n  ) {\n    super()\n    const cookieOptions = options?.cookie\n    const disablePersistance = options?.disableClientPersistence ?? false\n    this.settings = settings\n    this.settings.timeout = this.settings.timeout ?? 300\n    this.queue =\n      queue ??\n      createDefaultQueue(\n        `${settings.writeKey}:event-queue`,\n        options?.retryQueue,\n        disablePersistance\n      )\n\n    const storageSetting = options?.storage\n    this._universalStorage = this.createStore(\n      disablePersistance,\n      storageSetting,\n      cookieOptions\n    )\n\n    this._user =\n      user ??\n      new User(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any User specific options override everything else\n          ...options?.user,\n        },\n        cookieOptions\n      ).load()\n    this._group =\n      group ??\n      new Group(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any group specific options override everything else\n          ...options?.group,\n        },\n        cookieOptions\n      ).load()\n    this.eventFactory = new EventFactory(this._user)\n    this.integrations = options?.integrations ?? {}\n    this.options = options ?? {}\n    autoBind(this)\n  }\n\n  user = (): User => {\n    return this._user\n  }\n\n  /**\n   * Creates the storage system based on the settings received\n   * @returns Storage\n   */\n  private createStore(\n    disablePersistance: boolean,\n    storageSetting: InitOptions['storage'],\n    cookieOptions?: CookieOptions | undefined\n  ): UniversalStorage {\n    // DisablePersistance option overrides all, no storage will be used outside of memory even if specified\n    if (disablePersistance) {\n      return new UniversalStorage([new MemoryStorage()])\n    } else {\n      if (storageSetting) {\n        if (isArrayOfStoreType(storageSetting)) {\n          // We will create the store with the priority for customer settings\n          return new UniversalStorage(\n            initializeStorages(\n              applyCookieOptions(storageSetting.stores, cookieOptions)\n            )\n          )\n        }\n      }\n    }\n    // We default to our multi storage with priority\n    return new UniversalStorage(\n      initializeStorages([\n        StoreType.LocalStorage,\n        {\n          name: StoreType.Cookie,\n          settings: cookieOptions,\n        },\n        StoreType.Memory,\n      ])\n    )\n  }\n\n  get storage(): UniversalStorage {\n    return this._universalStorage\n  }\n\n  async track(...args: EventParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [channelId, userId, name, data, opts, cb] = resolveArguments(...args)\n\n    const tronicEvent = this.eventFactory.track(\n      channelId,\n      userId,\n      name,\n      data as EventProperties,\n      // opts,\n      // this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(tronicEvent, cb).then((ctx) => {\n      this.emit('track', name, ctx.event.properties) // , ctx.event.options)\n      return ctx\n    })\n  }\n\n  async identify(...args: IdentifyParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [/*channelId,*/ id, _traits, options, callback] = resolveUserArguments(this._user)(\n      ...args\n    )\n\n    this._user.identify(id, _traits)\n    const tronicEvent = this.eventFactory.identify(\n      'channelId',\n      this._user.id(),\n      this._user.traits(),\n      // options,\n      // this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(tronicEvent, callback).then((ctx) => {\n      this.emit(\n        'identify',\n        ctx.event.userId,\n        ctx.event.traits,\n        // ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  async trackClick(...args: LinkArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackLink(...args: LinkArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackSubmit(...args: FormArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async trackForm(...args: FormArgs): Promise<Receiver> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async register(...plugins: Plugin[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const registrations = plugins.map((xt) =>\n      this.queue.register(ctx, xt, this)\n    )\n    await Promise.all(registrations)\n\n    return ctx\n  }\n\n  async deregister(...plugins: string[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const deregistrations = plugins.map((pl) => {\n      const plugin = this.queue.plugins.find((p) => p.name === pl)\n      if (plugin) {\n        return this.queue.deregister(ctx, plugin, this)\n      } else {\n        ctx.log('warn', `plugin ${pl} not found`)\n      }\n    })\n\n    await Promise.all(deregistrations)\n\n    return ctx\n  }\n\n  debug(toggle: boolean): Receiver {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug')\n    }\n    this._debug = toggle\n    return this\n  }\n\n  reset(): void {\n    this._user.reset()\n    this._group.reset()\n    this.emit('reset')\n  }\n\n  timeout(timeout: number): void {\n    this.settings.timeout = timeout\n  }\n\n  private async _dispatch(\n    event: TronicEvent,\n    callback?: Callback\n  ): Promise<DispatchedEvent> {\n    const ctx = new Context(event)\n    if (isOffline() && !this.options.retryQueue) {\n      return ctx\n    }\n    return dispatch(ctx, this.queue, this, {\n      callback,\n      debug: this._debug,\n      timeout: this.settings.timeout,\n    })\n  }\n\n  async addSourceMiddleware(fn: MiddlewareFunction): Promise<Receiver> {\n    await this.queue.criticalTasks.run(async () => {\n      const { sourceMiddlewarePlugin } = await import(\n        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware'\n      )\n\n      const integrations: Record<string, boolean> = {}\n      /*\n    this.queue.plugins.forEach((plugin) => {\n      if (plugin.type === 'destination') {\n        return (integrations[plugin.name] = true)\n      }\n    })\n       */\n      const plugin = sourceMiddlewarePlugin(fn) //, integrations)\n      await this.register(plugin)\n    })\n\n    return this\n  }\n\n  /* TODO: This does not have to return a promise? */\n  addDestinationMiddleware(\n    integrationName: string,\n    ...middlewares: DestinationMiddlewareFunction[]\n  ): Promise<Receiver> {\n    const legacyDestinations = this.queue.plugins.filter(\n      (xt) => xt.name.toLowerCase() === integrationName.toLowerCase()\n    ) as LegacyDestination[]\n\n    legacyDestinations.forEach((destination) => {\n      destination.addMiddleware(...middlewares)\n    })\n    return Promise.resolve(this)\n  }\n\n  setAnonymousId(id?: string): ID {\n    return this._user.anonymousId(id)\n  }\n\n  async queryString(query: string): Promise<Context[]> {\n    if (this.options.useQueryString === false) {\n      return []\n    }\n\n    const { queryString } = await import(\n      /* webpackChunkName: \"queryString\" */ '../query-string'\n    )\n    return queryString(this, query)\n  }\n\n  async ready(\n    callback: Function = (res: Promise<unknown>[]): Promise<unknown>[] => res\n  ): Promise<unknown> {\n    return Promise.all(\n      this.queue.plugins.map((i) => (i.ready ? i.ready() : Promise.resolve()))\n    ).then((res) => {\n      callback(res)\n      return res\n    })\n  }\n\n  get VERSION(): string {\n    return version\n  }\n\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  push(args: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const an = this as any\n    const method = args.shift()\n    if (method) {\n      if (!an[method]) return\n    }\n    an[method].apply(this, args)\n  }\n}\n","/**\n * Return a promise that can be externally resolved\n */\nexport const createDeferred = <T>() => {\n  let resolve!: (value: T | PromiseLike<T>) => void\n  let reject!: (reason: any) => void\n  const promise = new Promise<T>((_resolve, _reject) => {\n    resolve = _resolve\n    reject = _reject\n  })\n  return {\n    resolve,\n    reject,\n    promise,\n  }\n}\n","import { HighEntropyHint, NavigatorUAData, UADataValues } from './interfaces'\n\nexport async function clientHints(\n  hints?: HighEntropyHint[]\n): Promise<UADataValues | undefined> {\n  const userAgentData = (navigator as any).userAgentData as\n    | NavigatorUAData\n    | undefined\n\n  if (!userAgentData) return undefined\n\n  if (!hints) return userAgentData.toJSON()\n  return userAgentData\n    .getHighEntropyValues(hints)\n    .catch(() => userAgentData.toJSON())\n}\n","import jar from 'js-cookie'\nimport type { Context } from '../../core/context'\nimport type { Plugin } from '../../core/plugin'\nimport { version } from '../../generated/version'\nimport { TronicEvent } from '../../core/events'\nimport { Campaign, PluginType } from '@tronic/receiver-core'\nimport { getVersionType } from '../../lib/version-type'\nimport { tld } from '../../core/user/tld'\nimport { gracefulDecodeURIComponent } from '../../core/query-string/gracefulDecodeURIComponent'\nimport { CookieStorage, UniversalStorage } from '../../core/storage'\nimport { Receiver } from '../../core/receiver'\nimport { clientHints } from '../../lib/client-hints'\nimport { UADataValues } from '../../lib/client-hints/interfaces'\n\nlet cookieOptions: jar.CookieAttributes | undefined\nfunction getCookieOptions(): jar.CookieAttributes {\n  if (cookieOptions) {\n    return cookieOptions\n  }\n\n  const domain = tld(window.location.href)\n  cookieOptions = {\n    expires: 31536000000, // 1 year\n    secure: false,\n    path: '/',\n  }\n  if (domain) {\n    cookieOptions.domain = domain\n  }\n\n  return cookieOptions\n}\n\ntype Ad = { id: string; type: string }\n\nfunction ads(query: string): Ad | undefined {\n  const queryIds: Record<string, string> = {\n    btid: 'dataxu',\n    urid: 'millennial-media',\n  }\n\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n  const parts = query.split('&')\n\n  for (const part of parts) {\n    const [k, v] = part.split('=')\n    if (queryIds[k]) {\n      return {\n        id: v,\n        type: queryIds[k],\n      }\n    }\n  }\n}\n\nexport function utm(query: string): Campaign {\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n\n  return query.split('&').reduce((acc, str) => {\n    const [k, v = ''] = str.split('=')\n    if (k.includes('utm_') && k.length > 4) {\n      let utmParam = k.slice(4) as keyof Campaign\n      if (utmParam === 'campaign') {\n        utmParam = 'name'\n      }\n      acc[utmParam] = gracefulDecodeURIComponent(v)\n    }\n    return acc\n  }, {} as Campaign)\n}\n\nexport function ampId(): string | undefined {\n  const ampId = jar.get('_ga')\n  if (ampId && ampId.startsWith('amp')) {\n    return ampId\n  }\n}\n\nfunction referrerId(\n  query: string,\n  ctx: TronicEvent['context'],\n  disablePersistance: boolean\n): void {\n  const storage = new UniversalStorage<{\n    's:context.referrer': Ad\n  }>(disablePersistance ? [] : [new CookieStorage(getCookieOptions())])\n\n  const stored = storage.get('s:context.referrer')\n\n  const ad = ads(query) ?? stored\n\n  if (!ad) {\n    return\n  }\n\n  if (ctx) {\n    ctx.referrer = { ...ctx.referrer, ...ad }\n  }\n\n  storage.set('s:context.referrer', ad)\n}\n\n/**\n *\n * @param obj e.g. { foo: 'b', bar: 'd', baz: ['123', '456']}\n * @returns e.g. 'foo=b&bar=d&baz=123&baz=456'\n */\nconst objectToQueryString = (\n  obj: Record<string, string | string[]>\n): string => {\n  try {\n    const searchParams = new URLSearchParams()\n    Object.entries(obj).forEach(([k, v]) => {\n      if (Array.isArray(v)) {\n        v.forEach((value) => searchParams.append(k, value))\n      } else {\n        searchParams.append(k, v)\n      }\n    })\n    return searchParams.toString()\n  } catch {\n    return ''\n  }\n}\n\nclass EnvironmentEnrichmentPlugin implements Plugin {\n  private instance!: Receiver\n  private userAgentData: UADataValues | undefined\n\n  name = 'Page Enrichment'\n  type: PluginType = 'before'\n  version = '0.1.0'\n  isLoaded = () => true\n  load = async (_ctx: Context, instance: Receiver) => {\n    this.instance = instance\n    try {\n      this.userAgentData = await clientHints(\n        this.instance.options.highEntropyValuesClientHints\n      )\n    } catch (_) {\n      // if client hints API doesn't return anything leave undefined\n    }\n    return Promise.resolve()\n  }\n\n  private enrich = (ctx: Context): Context => {\n    // Note: Types are off - context should never be undefined here, since it is set as part of event creation.\n    const evtCtx = ctx.event.context!\n\n    const search = evtCtx.page!.search || ''\n\n    const query =\n      typeof search === 'object' ? objectToQueryString(search) : search\n\n    evtCtx.userAgent = navigator.userAgent\n    evtCtx.userAgentData = this.userAgentData\n\n    // @ts-ignore\n    const locale = navigator.userLanguage || navigator.language\n\n    if (typeof evtCtx.locale === 'undefined' && typeof locale !== 'undefined') {\n      evtCtx.locale = locale\n    }\n\n    evtCtx.library ??= {\n      name: 'receiver.js',\n      version: `${getVersionType() === 'web' ? 'next' : 'npm:next'}-${version}`,\n    }\n\n    if (query && !evtCtx.campaign) {\n      evtCtx.campaign = utm(query)\n    }\n\n    const amp = ampId()\n    if (amp) {\n      evtCtx.amp = { id: amp }\n    }\n\n    referrerId(\n      query,\n      evtCtx,\n      this.instance.options.disableClientPersistence ?? false\n    )\n\n    try {\n      evtCtx.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone\n    } catch (_) {\n      // If browser doesn't have support leave timezone undefined\n    }\n\n    return ctx\n  }\n\n  track = this.enrich\n  identify = this.enrich\n}\n\nexport const envEnrichment = new EnvironmentEnrichmentPlugin()\n","import type { Integrations } from '../../core/events/interfaces'\nimport { LegacySettings } from '../../browser'\nimport { JSONObject, JSONValue } from '../../core/events'\nimport { DestinationPlugin, Plugin } from '../../core/plugin'\nimport { loadScript } from '../../lib/load-script'\nimport { getCDN } from '../../lib/parse-cdn'\nimport {\n  applyDestinationMiddleware,\n  DestinationMiddlewareFunction,\n} from '../middleware'\nimport { Context, ContextCancelation } from '../../core/context'\nimport { Receiver } from '../../core/receiver'\n\nexport interface RemotePlugin {\n  /** The name of the remote plugin */\n  name: string\n  /** The creation name of the remote plugin */\n  creationName: string\n  /** The url of the javascript file to load */\n  url: string\n  /** The UMD/global name the plugin uses. Plugins are expected to exist here with the `PluginFactory` method signature */\n  libraryName: string\n  /** The settings related to this plugin. */\n  settings: JSONObject\n}\n\nexport class ActionDestination implements DestinationPlugin {\n  name: string // destination name\n  version = '1.0.0'\n  type: Plugin['type']\n\n  alternativeNames: string[] = []\n\n  middleware: DestinationMiddlewareFunction[] = []\n\n  action: Plugin\n\n  constructor(name: string, action: Plugin) {\n    this.action = action\n    this.name = name\n    this.type = action.type\n    this.alternativeNames.push(action.name)\n  }\n\n  addMiddleware(...fn: DestinationMiddlewareFunction[]): void {\n    if (this.type === 'destination') {\n      this.middleware.push(...fn)\n    }\n  }\n\n  private async transform(ctx: Context): Promise<Context> {\n    const modifiedEvent = await applyDestinationMiddleware(\n      this.name,\n      ctx.event,\n      this.middleware\n    )\n\n    if (modifiedEvent === null) {\n      ctx.cancel(\n        new ContextCancelation({\n          retry: false,\n          reason: 'dropped by destination middleware',\n        })\n      )\n    }\n\n    return new Context(modifiedEvent!)\n  }\n\n  private _createMethod(\n    methodName: 'track' | 'identify'\n  ) {\n    return async (ctx: Context): Promise<Context> => {\n      if (!this.action[methodName]) return ctx\n\n      let transformedContext: Context = ctx\n      // Transformations only allowed for destination plugins. Other plugin types support mutating events.\n      if (this.type === 'destination') {\n        transformedContext = await this.transform(ctx)\n      }\n\n      await this.action[methodName]!(transformedContext)\n\n      return ctx\n    }\n  }\n\n  identify = this._createMethod('identify')\n  track = this._createMethod('track')\n\n  /* --- PASSTHROUGH METHODS --- */\n  isLoaded(): boolean {\n    return this.action.isLoaded()\n  }\n\n  ready(): Promise<unknown> {\n    return this.action.ready ? this.action.ready() : Promise.resolve()\n  }\n\n  load(ctx: Context, receiver: Receiver): Promise<unknown> {\n    return this.action.load(ctx, receiver)\n  }\n\n  unload(ctx: Context, receiver: Receiver): Promise<unknown> | unknown {\n    return this.action.unload?.(ctx, receiver)\n  }\n}\n\nexport type PluginFactory = {\n  (settings: JSONValue): Plugin | Plugin[] | Promise<Plugin | Plugin[]>\n  pluginName: string\n}\n\nfunction validate(pluginLike: unknown): pluginLike is Plugin[] {\n  if (!Array.isArray(pluginLike)) {\n    throw new Error('Not a valid list of plugins')\n  }\n\n  const required = ['load', 'isLoaded', 'name', 'version', 'type']\n  pluginLike.forEach((plugin) => {\n    required.forEach((method) => {\n      if (plugin[method] === undefined) {\n        throw new Error(\n          `Plugin: ${\n            plugin.name ?? 'unknown'\n          } missing required function ${method}`\n        )\n      }\n    })\n  })\n\n  return true\n}\n\nfunction isPluginDisabled(\n  userIntegrations: Integrations,\n  remotePlugin: RemotePlugin\n) {\n  const creationNameEnabled = userIntegrations[remotePlugin.creationName]\n  const currentNameEnabled = userIntegrations[remotePlugin.name]\n\n  // Check that the plugin isn't explicitly enabled when All: false\n  if (\n    userIntegrations.All === false &&\n    !creationNameEnabled &&\n    !currentNameEnabled\n  ) {\n    return true\n  }\n\n  // Check that the plugin isn't explicitly disabled\n  if (creationNameEnabled === false || currentNameEnabled === false) {\n    return true\n  }\n\n  return false\n}\n\nasync function loadPluginFactory(\n  remotePlugin: RemotePlugin,\n  obfuscate?: boolean\n): Promise<void | PluginFactory> {\n  const defaultCdn = new RegExp('https://cdn.tronic.(com|build)')\n  const cdn = getCDN()\n\n  if (obfuscate) {\n    const urlSplit = remotePlugin.url.split('/')\n    const name = urlSplit[urlSplit.length - 2]\n    const obfuscatedURL = remotePlugin.url.replace(\n      name,\n      btoa(name).replace(/=/g, '')\n    )\n    try {\n      await loadScript(obfuscatedURL.replace(defaultCdn, cdn))\n    } catch (error) {\n      // Due to syncing concerns it is possible that the obfuscated action destination (or requested version) might not exist.\n      // We should use the unobfuscated version as a fallback.\n      await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n    }\n  } else {\n    await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n  }\n\n  // @ts-expect-error\n  if (typeof window[remotePlugin.libraryName] === 'function') {\n    // @ts-expect-error\n    return window[remotePlugin.libraryName] as PluginFactory\n  }\n}\n\nexport async function remoteLoader(\n  settings: LegacySettings,\n  userIntegrations: Integrations,\n  mergedIntegrations: Record<string, JSONObject>,\n  obfuscate?: boolean,\n  routingMiddleware?: DestinationMiddlewareFunction,\n  pluginSources?: PluginFactory[]\n): Promise<Plugin[]> {\n  const allPlugins: Plugin[] = []\n\n  const routingRules = settings.middlewareSettings?.routingRules ?? []\n\n  const pluginPromises = (settings.remotePlugins ?? []).map(\n    async (remotePlugin) => {\n      if (isPluginDisabled(userIntegrations, remotePlugin)) return\n\n      try {\n        const pluginFactory =\n          pluginSources?.find(\n            ({ pluginName }) => pluginName === remotePlugin.name\n          ) || (await loadPluginFactory(remotePlugin, obfuscate))\n\n        if (pluginFactory) {\n          const plugin = await pluginFactory({\n            ...remotePlugin.settings,\n            ...mergedIntegrations[remotePlugin.name],\n          })\n          const plugins = Array.isArray(plugin) ? plugin : [plugin]\n\n          validate(plugins)\n\n          const routing = routingRules.filter(\n            (rule) => rule.destinationName === remotePlugin.creationName\n          )\n\n          plugins.forEach((plugin) => {\n            const wrapper = new ActionDestination(\n              remotePlugin.creationName,\n              plugin\n            )\n\n            /** Make sure we only apply destination filters to actions of the \"destination\" type to avoid causing issues for hybrid destinations */\n            if (\n              routing.length &&\n              routingMiddleware &&\n              plugin.type === 'destination'\n            ) {\n              wrapper.addMiddleware(routingMiddleware)\n            }\n\n            allPlugins.push(wrapper)\n          })\n        }\n      } catch (error) {\n        console.warn('Failed to load Remote Plugin', error)\n      }\n    }\n  )\n\n  await Promise.all(pluginPromises)\n  return allPlugins.filter(Boolean)\n}\n","/**\n * Register event listener on document that fires when:\n * * tab change or tab close (in mobile or desktop)\n * * click back / forward button\n * * click any link or perform any other navigation action\n * * soft refresh / hard refresh\n *\n * adapted from https://stackoverflow.com/questions/3239834/window-onbeforeunload-not-working-on-the-ipad/52864508#52864508,\n */\nexport const onPageChange = (cb: (unloaded: boolean) => void) => {\n  let unloaded = false // prevents double firing if both are supported\n\n  window.addEventListener('pagehide', () => {\n    if (unloaded) return\n    unloaded = true\n    cb(unloaded)\n  })\n\n  // using document instead of window because of bug affecting browsers before safari 14 (detail in footnotes https://caniuse.com/?search=visibilitychange)\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState == 'hidden') {\n      if (unloaded) return\n      unloaded = true\n    } else {\n      unloaded = false\n    }\n    cb(unloaded)\n  })\n}\n","import { TronicEvent } from '../../core/events'\nimport { fetch } from '../../lib/fetch'\nimport { onPageChange } from '../../lib/on-page-change'\n\nexport type BatchingDispatchConfig = {\n  size?: number\n  timeout?: number\n}\n\nconst MAX_PAYLOAD_SIZE = 500\n\nfunction kilobytes(buffer: unknown): number {\n  const size = encodeURI(JSON.stringify(buffer)).split(/%..|./).length - 1\n  return size / 1024\n}\n\n/**\n * Checks if the payload is over or close to\n * the maximum payload size allowed by tracking\n * API.\n */\nfunction approachingTrackingAPILimit(buffer: unknown): boolean {\n  return kilobytes(buffer) >= MAX_PAYLOAD_SIZE - 50\n}\n\nfunction chunks(batch: object[]): Array<object[]> {\n  const result: object[][] = []\n  let index = 0\n\n  batch.forEach((item) => {\n    const size = kilobytes(result[index])\n    if (size >= 64) {\n      index++\n    }\n\n    if (result[index]) {\n      result[index].push(item)\n    } else {\n      result[index] = [item]\n    }\n  })\n\n  return result\n}\n\nexport default function batch(\n  apiHost: string,\n  config?: BatchingDispatchConfig\n) {\n  let buffer: object[] = []\n  let pageUnloaded = false\n\n  const limit = config?.size ?? 10\n  const timeout = config?.timeout ?? 5000\n\n  function sendBatch(batch: object[]) {\n    if (batch.length === 0) {\n      return\n    }\n\n    const writeKey = (batch[0] as TronicEvent)?.writeKey\n\n    // Remove sentAt from every event as batching only needs a single timestamp\n    const updatedBatch = batch.map((event) => {\n      const { sentAt, ...newEvent } = event as TronicEvent\n      return newEvent\n    })\n\n    return fetch(`https://${apiHost}/b`, {\n      keepalive: pageUnloaded,\n      headers: {\n        'Content-Type': 'text/plain',\n      },\n      method: 'post',\n      body: JSON.stringify({\n        writeKey,\n        batch: updatedBatch,\n        sentAt: new Date().toISOString(),\n      }),\n    })\n  }\n\n  async function flush(): Promise<unknown> {\n    if (buffer.length) {\n      const batch = buffer\n      buffer = []\n      return sendBatch(batch)\n    }\n  }\n\n  let schedule: NodeJS.Timeout | undefined\n\n  function scheduleFlush(): void {\n    if (schedule) {\n      return\n    }\n\n    schedule = setTimeout(() => {\n      schedule = undefined\n      flush().catch(console.error)\n    }, timeout)\n  }\n\n  onPageChange((unloaded) => {\n    pageUnloaded = unloaded\n\n    if (pageUnloaded && buffer.length) {\n      const reqs = chunks(buffer).map(sendBatch)\n      Promise.all(reqs).catch(console.error)\n    }\n  })\n\n  async function dispatch(_url: string, body: object): Promise<unknown> {\n    buffer.push(body)\n\n    const bufferOverflow =\n      buffer.length >= limit || approachingTrackingAPILimit(buffer)\n\n    return bufferOverflow || pageUnloaded ? flush() : scheduleFlush()\n  }\n\n  return {\n    dispatch,\n  }\n}\n","export const pWhile = async <T>(\n  condition: (value: T | undefined) => boolean,\n  action: () => T | PromiseLike<T>\n): Promise<void> => {\n  const loop = async (actionResult: T | undefined): Promise<void> => {\n    if (condition(actionResult)) {\n      return loop(await action())\n    }\n  }\n\n  return loop(undefined)\n}\n","import { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { attempt } from '@tronic/receiver-core'\nimport { pWhile } from '../../lib/p-while'\nimport { PriorityQueue } from '../../lib/priority-queue'\n\nasync function flushQueue(\n  xt: Plugin,\n  queue: PriorityQueue<Context>\n): Promise<PriorityQueue<Context>> {\n  const failedQueue: Context[] = []\n  if (isOffline()) {\n    return queue\n  }\n\n  await pWhile(\n    () => queue.length > 0 && !isOffline(),\n    async () => {\n      const ctx = queue.pop()\n      if (!ctx) {\n        return\n      }\n\n      const result = await attempt(ctx, xt)\n      const success = result instanceof Context\n      if (!success) {\n        failedQueue.push(ctx)\n      }\n    }\n  )\n  // re-add failed tasks\n  failedQueue.map((failed) => queue.pushWithBackoff(failed))\n  return queue\n}\n\nexport function scheduleFlush(\n  flushing: boolean,\n  buffer: PriorityQueue<Context>,\n  xt: Plugin,\n  scheduleFlush: Function\n): void {\n  if (flushing) {\n    return\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  setTimeout(async () => {\n    let isFlushing = true\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const newBuffer = await flushQueue(xt, buffer)\n    isFlushing = false\n\n    if (buffer.todo > 0) {\n      scheduleFlush(isFlushing, newBuffer, xt, scheduleFlush)\n    }\n  }, Math.random() * 5000)\n}\n","import { Facade } from '@segment/facade'\nimport { Receiver } from '../../core/receiver'\nimport { LegacySettings } from '../../browser'\nimport { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { toFacade } from '../../lib/to-facade'\nimport batch, { BatchingDispatchConfig } from './batched-dispatcher'\nimport standard, { StandardDispatcherConfig } from './fetch-dispatcher'\nimport { normalize } from './normalize'\nimport { scheduleFlush } from './schedule-flush'\nimport { TRONIC_API_HOST } from '../../core/constants'\n\ntype DeliveryStrategy =\n  | {\n      strategy?: 'standard'\n      config?: StandardDispatcherConfig\n    }\n  | {\n      strategy?: 'batching'\n      config?: BatchingDispatchConfig\n    }\n\nexport type TronicSettings = {\n  apiKey: string\n  apiHost?: string\n  protocol?: 'http' | 'https'\n\n  addBundledMetadata?: boolean\n  unbundledIntegrations?: string[]\n  bundledConfigIds?: string[]\n  unbundledConfigIds?: string[]\n\n  maybeBundledConfigIds?: Record<string, string[]>\n\n  deliveryStrategy?: DeliveryStrategy\n}\n\ntype JSON = ReturnType<Facade['json']>\n\nfunction onAlias(receiver: Receiver, json: JSON): JSON {\n  const user = receiver.user()\n  json.previousId =\n    json.previousId ?? json.from ?? user.id() ?? user.anonymousId()\n  json.userId = json.userId ?? json.to\n  delete json.from\n  delete json.to\n  return json\n}\n\nexport function tronic(\n  receiver: Receiver,\n  settings?: TronicSettings,\n  integrations?: LegacySettings['integrations']\n): Plugin {\n  // Attach `pagehide` before buffer is created so that inflight events are added\n  // to the buffer before the buffer persists events in its own `pagehide` handler.\n  window.addEventListener('pagehide', () => {\n    buffer.push(...Array.from(inflightEvents))\n    inflightEvents.clear()\n  })\n\n  const writeKey = settings?.apiKey ?? ''\n\n  const buffer = receiver.options.disableClientPersistence\n    ? new PriorityQueue<Context>(receiver.queue.queue.maxAttempts, [])\n    : new PersistedPriorityQueue(\n        receiver.queue.queue.maxAttempts,\n        `${writeKey}:dest-tronic`\n      )\n\n  const inflightEvents = new Set<Context>()\n  const flushing = false\n\n  const apiHost = settings?.apiHost ?? TRONIC_API_HOST\n  const protocol = settings?.protocol ?? 'https'\n  const remote = `${protocol}://${apiHost}`\n\n  const deliveryStrategy = settings?.deliveryStrategy\n  const client =\n    deliveryStrategy?.strategy === 'batching'\n      ? batch(apiHost, deliveryStrategy.config)\n      : standard(writeKey, deliveryStrategy?.config as StandardDispatcherConfig)\n\n  async function send(ctx: Context): Promise<Context> {\n    if (isOffline()) {\n      buffer.push(ctx)\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n      return ctx\n    }\n\n    inflightEvents.add(ctx)\n\n    const path = 'external/' + ctx.event.type; // ctx.event.type.charAt(0)\n\n    let _json = toFacade(ctx.event).json()\n\n    if (ctx.event.type === 'track') {\n      delete _json.type\n      delete _json.traits\n      delete _json.anonymousId\n      delete _json.sentAt\n      delete _json.context\n    }\n\n    /*\n    if (ctx.event.type === 'alias') {\n      json = onAlias(receiver, json)\n    }\n     */\n\n    const json = _json;\n    // {\"userId\":\"2XWyaIZf7Tm2uQqa8fYH6GC0oYl\",\"event\":\"event0\",\"properties\":{\"test\":\"property\"},\"channelId\":\"2XWyaIasy88a5SJMoLKpkDuDt2O\",\"timestamp\":\"2023-10-31T18:28:57.818Z\"};\n\n    return client\n      .dispatch(\n        `${remote}/${path}`,\n        json, // normalize(receiver, json, settings, integrations)\n      )\n      .then(() => ctx)\n      .catch(() => {\n        buffer.pushWithBackoff(ctx)\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n        return ctx\n      })\n      .finally(() => {\n        inflightEvents.delete(ctx)\n      })\n  }\n\n  const tronic: Plugin = {\n    name: 'Tronic',\n    type: 'after',\n    version: '0.1.0',\n    isLoaded: (): boolean => true,\n    load: (): Promise<void> => Promise.resolve(),\n    track: send,\n    identify: send,\n  }\n\n  // Buffer may already have items if they were previously stored in localStorage.\n  // Start flushing them immediately.\n  if (buffer.todo) {\n    scheduleFlush(flushing, buffer, tronic, scheduleFlush)\n  }\n\n  return tronic\n}\n","import { fetch } from '../../lib/fetch'\n\nexport type Dispatcher = (url: string, body: object) => Promise<unknown>\n\nexport type StandardDispatcherConfig = {\n  keepalive?: boolean\n}\n\nexport default function (writeKey: string, config?: StandardDispatcherConfig): {\n  dispatch: Dispatcher\n} {\n  function dispatch(url: string, body: object): Promise<unknown> {\n    return fetch(url, {\n      keepalive: config?.keepalive,\n      headers: {\n        // 'Content-Type': 'text/plain',\n        'Content-Type': 'application/json',\n        'X-Api-Key': writeKey,\n      },\n      method: 'post',\n      body: JSON.stringify(body),\n    })\n  }\n\n  return {\n    dispatch,\n  }\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar ValidationError = /** @class */ (function (_super) {\n    __extends(ValidationError, _super);\n    function ValidationError(field, message) {\n        var _this = _super.call(this, \"\".concat(field, \" \").concat(message)) || this;\n        _this.field = field;\n        return _this;\n    }\n    return ValidationError;\n}(Error));\nexport { ValidationError };\n//# sourceMappingURL=errors.js.map","import { ValidationError } from './errors';\nimport { isString, isPlainObject, exists } from './helpers';\nvar stringError = 'is not a string';\nvar objError = 'is not an object';\nvar nilError = 'is nil';\nexport function assertUserIdentity(event) {\n    var USER_FIELD_NAME = '.userId/anonymousId/previousId/groupId';\n    var getAnyUserId = function (event) { var _a, _b, _c; return (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId; };\n    var id = getAnyUserId(event);\n    if (!exists(id)) {\n        throw new ValidationError(USER_FIELD_NAME, nilError);\n    }\n    else if (!isString(id)) {\n        throw new ValidationError(USER_FIELD_NAME, stringError);\n    }\n}\nexport function assertEventExists(event) {\n    if (!exists(event)) {\n        throw new ValidationError('Event', nilError);\n    }\n    if (typeof event !== 'object') {\n        throw new ValidationError('Event', objError);\n    }\n}\nexport function assertEventType(event) {\n    if (!isString(event.type)) {\n        throw new ValidationError('.type', stringError);\n    }\n}\nexport function assertTrackEventName(event) {\n    if (!isString(event.event)) {\n        throw new ValidationError('.event', stringError);\n    }\n}\nexport function assertTrackEventProperties(event) {\n    if (!isPlainObject(event.properties)) {\n        throw new ValidationError('.properties', objError);\n    }\n}\nexport function assertTraits(event) {\n    if (!isPlainObject(event.traits)) {\n        throw new ValidationError('.traits', objError);\n    }\n}\nexport function validateEvent(event) {\n    assertEventExists(event);\n    assertEventType(event);\n    if (event.type === 'track') {\n        assertTrackEventName(event);\n        assertTrackEventProperties(event);\n    }\n    if (['group', 'identify'].includes(event.type)) {\n        assertTraits(event);\n    }\n    assertUserIdentity(event);\n}\n//# sourceMappingURL=assertions.js.map","import type { Plugin } from '../../core/plugin'\nimport type { Context } from '../../core/context'\nimport {\n  assertUserIdentity,\n  isPlainObject,\n  ValidationError,\n  assertEventExists,\n  assertEventType,\n  assertTrackEventName,\n} from '@tronic/receiver-core'\n\nfunction validate(ctx: Context): Context {\n  const event = ctx.event\n  assertEventExists(event)\n  assertEventType(event)\n\n  if (event.type === 'track') {\n    assertTrackEventName(event)\n  }\n\n    /*\n  const props = event.properties ?? event.traits\n  if (event.type !== 'alias' && !isPlainObject(props)) {\n    throw new ValidationError('.properties', 'is not an object')\n  }\n     */\n\n  assertUserIdentity(event)\n  return ctx\n}\n\nexport const validation: Plugin = {\n  name: 'Event Validation',\n  type: 'before',\n  version: '1.0.0',\n\n  isLoaded: () => true,\n  load: () => Promise.resolve(),\n\n  track: validate,\n  identify: validate,\n}\n","import { getGlobal } from '../../lib/get-global'\nimport type { Receiver } from '../receiver'\n\nconst env = getGlobal()\n\n// The code below assumes the inspector extension will use Object.assign\n// to add the inspect interface on to this object reference (unless the\n// extension code ran first and has already set up the variable)\nconst inspectorHost: {\n  attach: (receiver: Receiver) => void\n} = ((env as any)['__TRONIC_INSPECTOR__'] ??= {})\n\nexport const attachInspector = (receiver: Receiver) =>\n  inspectorHost.attach?.(receiver as any)\n","import { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\n\nimport { fetch } from '../lib/fetch'\nimport { Receiver, ReceiverSettings, InitOptions } from '../core/receiver'\nimport { Context } from '../core/context'\nimport { Plugin } from '../core/plugin'\nimport { MetricsOptions } from '../core/stats/remote-metrics'\nimport { mergedOptions } from '../lib/merged-options'\nimport { createDeferred } from '../lib/create-deferred'\nimport { envEnrichment } from '../plugins/env-enrichment'\nimport {\n  PluginFactory,\n  remoteLoader,\n  RemotePlugin,\n} from '../plugins/remote-loader'\nimport type { RoutingRule } from '../plugins/routing-middleware'\nimport { tronic, TronicSettings } from '../plugins/tronic'\nimport { validation } from '../plugins/validation'\nimport {\n  ReceiverBuffered,\n  PreInitMethodCallBuffer,\n  flushReceiverCallsInNewTask,\n  flushAddSourceMiddleware,\n  // flushSetAnonymousID,\n  flushOn,\n} from '../core/buffer'\nimport { ClassicIntegrationSource } from '../plugins/ajs-destination/types'\nimport { attachInspector } from '../core/inspector'\nimport { Stats } from '../core/stats'\nimport { setGlobalReceiverKey } from '../lib/global-receiver-helper'\n\nexport interface LegacyIntegrationConfiguration {\n  /* @deprecated - This does not indicate browser types anymore */\n  type?: string\n\n  versionSettings?: {\n    version?: string\n    override?: string\n    componentTypes?: Array<'browser' | 'android' | 'ios' | 'server'>\n  }\n\n  bundlingStatus?: string\n\n  /**\n   * Consent settings for the integration\n   */\n  consentSettings?: {\n    /**\n     * Consent categories for the integration\n     * @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n     */\n    categories: string[]\n  }\n\n  // Tronic.com specific\n  retryQueue?: boolean\n\n  // any extra unknown settings\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\n\nexport interface LegacySettings {\n  integrations: {\n    [name: string]: LegacyIntegrationConfiguration\n  }\n\n  middlewareSettings?: {\n    routingRules: RoutingRule[]\n  }\n\n  enabledMiddleware?: Record<string, boolean>\n  metrics?: MetricsOptions\n\n  remotePlugins?: RemotePlugin[]\n\n  /**\n   * Top level consent settings\n   */\n  consentSettings?: {\n    /**\n     * All unique consent categories.\n     * There can be categories in this array that are important for consent that are not included in any integration  (e.g. 2 cloud mode categories).\n     * @example [\"Receiver\", \"Advertising\", \"CAT001\"]\n     */\n    allCategories: string[]\n  }\n}\n\nexport interface ReceiverBrowserSettings extends ReceiverSettings {\n  /**\n   * The settings for the Tronic Source.\n   * If provided, `ReceiverBrowser` will not fetch remote settings\n   * for the source.\n   */\n  cdnSettings?: LegacySettings & Record<string, unknown>\n  /**\n   * If provided, will override the default CDN.\n   */\n  cdnURL?: string\n}\n\nexport function loadLegacySettings(\n  writeKey: string,\n  cdnURL?: string\n): Promise<LegacySettings> {\n  const baseUrl = cdnURL ?? getCDN()\n\n  return fetch(`${baseUrl}/v1/projects/${writeKey}/settings`)\n    .then((res) => {\n      if (!res.ok) {\n        return res.text().then((errorResponseMessage) => {\n          throw new Error(errorResponseMessage)\n        })\n      }\n      return res.json()\n    })\n    .catch((err) => {\n      console.error(err.message)\n      throw err\n    })\n}\n\n/**\n * With AJS classic, we allow users to call setAnonymousId before the library initialization.\n * This is important because some of the destinations will use the anonymousId during the initialization,\n * and if we set anonId afterwards, that wouldnt impact the destination.\n *\n * Also Ensures events can be registered before library initialization.\n * This is important so users can register to 'initialize' and any events that may fire early during setup.\n */\nfunction flushPreBuffer(\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): void {\n  // flushSetAnonymousID(receiver, buffer)\n  flushOn(receiver, buffer)\n}\n\n/**\n * Finish flushing buffer and cleanup.\n */\nasync function flushFinalBuffer(\n  receiver: Receiver,\n  buffer: PreInitMethodCallBuffer\n): Promise<void> {\n  // Call popSnippetWindowBuffer before each flush task since there may be\n  // receiver calls during async function calls.\n  await flushAddSourceMiddleware(receiver, buffer)\n  flushReceiverCallsInNewTask(receiver, buffer)\n  // Clear buffer, just in case receiver is loaded twice; we don't want to fire events off again.\n  buffer.clear()\n}\n\nasync function registerPlugins(\n  writeKey: string,\n  legacySettings: LegacySettings,\n  receiver: Receiver,\n  opts: InitOptions,\n  options: InitOptions,\n  pluginLikes: (Plugin | PluginFactory)[] = [],\n  legacyIntegrationSources: ClassicIntegrationSource[]\n): Promise<Context> {\n  const plugins = pluginLikes?.filter(\n    (pluginLike) => typeof pluginLike === 'object'\n  ) as Plugin[]\n\n  const pluginSources = pluginLikes?.filter(\n    (pluginLike) =>\n      typeof pluginLike === 'function' &&\n      typeof pluginLike.pluginName === 'string'\n  ) as PluginFactory[]\n\n  const mergedSettings = mergedOptions(legacySettings, options)\n  const remotePlugins = await remoteLoader(\n    legacySettings,\n    receiver.integrations,\n    mergedSettings,\n    options.obfuscate,\n    undefined,\n    pluginSources\n  ).catch(() => [])\n\n  const toRegister = [\n    validation,\n    envEnrichment,\n    ...plugins,\n    ...remotePlugins,\n    await tronic(\n      receiver,\n      mergedSettings['Tronic'] as TronicSettings,\n      /*\n      {\n        protocol: 'http',\n        apiHost: ,\n        apiKey: writeKey,\n      },\n        */\n      legacySettings.integrations\n    ),\n  ]\n\n  const ctx = await receiver.register(...toRegister)\n\n  if (\n    Object.entries(legacySettings.enabledMiddleware ?? {}).some(\n      ([, enabled]) => enabled\n    )\n  ) {\n    await import(\n      /* webpackChunkName: \"remoteMiddleware\" */ '../plugins/remote-middleware'\n    ).then(async ({ remoteMiddlewares }) => {\n      const middleware = await remoteMiddlewares(\n        ctx,\n        legacySettings,\n        options.obfuscate\n      )\n      const promises = middleware.map((mdw) =>\n        receiver.addSourceMiddleware(mdw)\n      )\n      return Promise.all(promises)\n    })\n  }\n\n  return ctx\n}\n\nasync function loadReceiver(\n  settings: ReceiverBrowserSettings,\n  options: InitOptions = {},\n  preInitBuffer: PreInitMethodCallBuffer\n): Promise<[Receiver, Context]> {\n  if (options.globalReceiverKey)\n    setGlobalReceiverKey(options.globalReceiverKey)\n  // this is an ugly side-effect, but it's for the benefits of the plugins that get their cdn via getCDN()\n  if (settings.cdnURL) setGlobalCDNUrl(settings.cdnURL)\n\n  let legacySettings = {\n    integrations: options.integrations,\n  } as LegacySettings/*\n    settings.cdnSettings ??\n    (await loadLegacySettings(settings.writeKey, settings.cdnURL))\n                           */\n\n  if (options.updateCDNSettings) {\n    legacySettings = options.updateCDNSettings(legacySettings)\n  }\n\n  const retryQueue: boolean =\n    legacySettings?.integrations?.['Segment.io']?.retryQueue ?? true\n\n  const opts: InitOptions = { retryQueue, ...options }\n  const receiver = new Receiver(settings, opts)\n\n  attachInspector(receiver)\n\n  const plugins = settings.plugins ?? []\n\n  const classicIntegrations = settings.classicIntegrations ?? []\n  Stats.initRemoteMetrics(legacySettings.metrics)\n\n  // needs to be flushed before plugins are registered\n  flushPreBuffer(receiver, preInitBuffer)\n\n  const ctx = await registerPlugins(\n    settings.writeKey,\n    legacySettings,\n    receiver,\n    opts,\n    options,\n    plugins,\n    classicIntegrations\n  )\n\n  const search = window.location.search ?? ''\n  const hash = window.location.hash ?? ''\n\n  const term = search.length ? search : hash.replace(/(?=#).*(?=\\?)/, '')\n\n  if (term.includes('ajs_')) {\n    await receiver.queryString(term).catch(console.error)\n  }\n\n  receiver.initialized = true\n  receiver.emit('initialize', settings, options)\n\n  /*\nif (options.initialPageview) {\n  receiver.page().catch(console.error)\n}\n   */\n\n  await flushFinalBuffer(receiver, preInitBuffer)\n\n  return [receiver, ctx]\n}\n\n/**\n * The public browser interface for Tronic Receiver\n *\n * @example\n * ```ts\n *  export const receiver = new ReceiverBrowser()\n *  receiver.load({ writeKey: 'foo' })\n * ```\n * @link https://github.com/tronic/tronic-receiver/#readme\n */\nexport class ReceiverBrowser extends ReceiverBuffered {\n  private _resolveLoadStart: (\n    settings: ReceiverBrowserSettings,\n    options: InitOptions\n  ) => void\n\n  constructor() {\n    const { promise: loadStart, resolve: resolveLoadStart } =\n      createDeferred<Parameters<ReceiverBrowser['load']>>()\n\n    super((buffer) =>\n      loadStart.then(([settings, options]) =>\n        loadReceiver(settings, options, buffer)\n      )\n    )\n\n    this._resolveLoadStart = (settings, options) =>\n      resolveLoadStart([settings, options])\n  }\n\n  /**\n   * Fully initialize an receiver instance, including:\n   *\n   * * Fetching settings from the Tronic CDN (by default).\n   * * Fetching all remote destinations configured by the user (if applicable).\n   * * Flushing buffered receiver events.\n   * * Loading all middleware.\n   *\n   * Note:  This method should only be called *once* in your application.\n   *\n   * @example\n   * ```ts\n   * export const receiver = new ReceiverBrowser()\n   * receiver.load({ writeKey: 'foo' })\n   * ```\n   */\n  load(\n    settings: ReceiverBrowserSettings,\n    options: InitOptions = {}\n  ): ReceiverBrowser {\n    this._resolveLoadStart(settings, options)\n    return this\n  }\n\n  /**\n   * Instantiates an object exposing Receiver methods.\n   *\n   * @example\n   * ```ts\n   * const ajs = ReceiverBrowser.load({ writeKey: '<YOUR_WRITE_KEY>' })\n   *\n   * ajs.track(\"foo\")\n   * ...\n   * ```\n   */\n  static load(\n    settings: ReceiverBrowserSettings,\n    options: InitOptions = {}\n  ): ReceiverBrowser {\n    return new ReceiverBrowser().load(settings, options)\n  }\n\n  static standalone(\n    writeKey: string,\n    options?: InitOptions\n  ): Promise<Receiver> {\n    return ReceiverBrowser.load({ writeKey }, options).then((res) => res[0])\n  }\n}\n","import { JSONObject, Options } from '../core/events/interfaces'\nimport { LegacySettings } from '../browser'\n\n/**\n * Merge legacy settings and initialized Integration option overrides.\n *\n * This will merge any options that were passed from initialization into\n * overrides for settings that are returned by the Tronic CDN.\n *\n * i.e. this allows for passing options directly into destinations from\n * the Receiver constructor.\n */\nexport function mergedOptions(\n  settings: LegacySettings,\n  options: Options\n): Record<string, JSONObject> {\n  const optionOverrides = Object.entries(options.integrations ?? {}).reduce(\n    (overrides, [integration, options]) => {\n      if (typeof options === 'object') {\n        return {\n          ...overrides,\n          [integration]: options,\n        }\n      }\n\n      return {\n        ...overrides,\n        [integration]: {},\n      }\n    },\n    {} as Record<string, JSONObject>\n  )\n\n  return Object.entries(settings.integrations).reduce(\n    (integrationSettings, [integration, settings]) => {\n      return {\n        ...integrationSettings,\n        [integration]: {\n          ...settings,\n          ...optionOverrides[integration],\n        },\n      }\n    },\n    {} as Record<string, JSONObject>\n  )\n}\n","import { ReceiverBrowser } from '.'\nimport { embeddedWriteKey } from '../lib/embedded-write-key'\nimport { ReceiverSnippet } from './standalone-interface'\nimport {\n  getGlobalReceiver,\n  setGlobalReceiver,\n} from '../lib/global-receiver-helper'\n\nfunction getWriteKey(): string | undefined {\n  if (embeddedWriteKey()) {\n    return embeddedWriteKey()\n  }\n\n  const receiver = getGlobalReceiver()\n  if (receiver?._writeKey) {\n    return receiver._writeKey\n  }\n\n  const regex = /http.*\\/receiver\\.js\\/v1\\/([^/]*)(\\/platform)?\\/receiver.*/\n  const scripts = Array.prototype.slice.call(\n    document.querySelectorAll('script')\n  )\n  let writeKey: string | undefined = undefined\n\n  for (const s of scripts) {\n    const src = s.getAttribute('src') ?? ''\n    const result = regex.exec(src)\n\n    if (result && result[1]) {\n      writeKey = result[1]\n      break\n    }\n  }\n\n  if (!writeKey && document.currentScript) {\n    const script = document.currentScript as HTMLScriptElement\n    const src = script.src\n\n    const result = regex.exec(src)\n\n    if (result && result[1]) {\n      writeKey = result[1]\n    }\n  }\n\n  return writeKey\n}\n\nexport async function install(): Promise<void> {\n  const writeKey = getWriteKey()\n  const options = getGlobalReceiver()?._loadOptions ?? {}\n  if (!writeKey) {\n    console.error(\n      'Failed to load Write Key. Make sure to use the latest version of the Tronic snippet, which can be found in your source settings.'\n    )\n    return\n  }\n\n  setGlobalReceiver(\n    (await ReceiverBrowser.standalone(writeKey, options)) as ReceiverSnippet\n  )\n}\n","/* eslint-disable @typescript-eslint/no-floating-promises */\nimport { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\nimport { setVersionType } from '../lib/version-type'\n\nif (process.env.ASSET_PATH) {\n  if (process.env.ASSET_PATH === '/dist/umd/') {\n    // @ts-ignore\n    __webpack_public_path__ = '/dist/umd/'\n  } else {\n    const cdn = getCDN()\n    setGlobalCDNUrl(cdn)\n\n    // @ts-ignore\n    __webpack_public_path__ = cdn\n      ? cdn + '/tronic-receiver/bundles/'\n      : 'https://cdn.tronic.com/tronic-receiver/bundles/'\n  }\n}\n\nsetVersionType('web')\n\nimport { install } from './standalone-receiver'\nimport '../lib/csp-detection'\nimport { shouldPolyfill } from '../lib/browser-polyfill'\nimport { RemoteMetrics } from '../core/stats/remote-metrics'\nimport { embeddedWriteKey } from '../lib/embedded-write-key'\nimport {\n  loadAjsClassicFallback,\n  isReceiverCSPError,\n} from '../lib/csp-detection'\n\nlet ajsIdentifiedCSP = false\n\nconst sendErrorMetrics = (tags: string[]) => {\n  // this should not be instantied at the root, or it will break ie11.\n  const metrics = new RemoteMetrics()\n  metrics.increment('receiver_js.invoke.error', [\n    ...tags,\n    `wk:${embeddedWriteKey()}`,\n  ])\n}\n\nfunction onError(err?: unknown) {\n  console.error('[receiver.js]', 'Failed to load Receiver.js', err)\n  sendErrorMetrics([\n    'type:initialization',\n    ...(err instanceof Error\n      ? [`message:${err?.message}`, `name:${err?.name}`]\n      : []),\n  ])\n}\n\ndocument.addEventListener('securitypolicyviolation', (e) => {\n  if (ajsIdentifiedCSP || !isReceiverCSPError(e)) {\n    return\n  }\n  ajsIdentifiedCSP = true\n  sendErrorMetrics(['type:csp'])\n  loadAjsClassicFallback().catch(console.error)\n})\n\n/**\n * Attempts to run a promise and catch both sync and async errors.\n **/\nasync function attempt<T>(promise: () => Promise<T>) {\n  try {\n    const result = await promise()\n    return result\n  } catch (err) {\n    onError(err)\n  }\n}\n\nif (shouldPolyfill()) {\n  // load polyfills in order to get AJS to work with old browsers\n  const script = document.createElement('script')\n  script.setAttribute(\n    'src',\n    'https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.7.0/polyfill.min.js'\n  )\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () =>\n      document.body.appendChild(script)\n    )\n  } else {\n    document.body.appendChild(script)\n  }\n\n  script.onload = function (): void {\n    attempt(install)\n  }\n} else {\n  attempt(install)\n}\n","import { loadScript } from './load-script'\nimport { getLegacyAJSPath } from './parse-cdn'\n\ntype CSPErrorEvent = SecurityPolicyViolationEvent & {\n  disposition?: 'enforce' | 'report'\n}\nexport const isReceiverCSPError = (e: CSPErrorEvent) => {\n  return e.disposition !== 'report' && e.blockedURI.includes('cdn.tronic')\n}\n\nexport async function loadAjsClassicFallback(): Promise<void> {\n  console.warn(\n    'Your CSP policy is missing permissions required in order to run Receiver.js 2.0',\n    'https://tronic.com/docs'\n  )\n  console.warn('Reverting to Receiver.js 1.0')\n\n  const classicPath = getLegacyAJSPath()\n  await loadScript(classicPath)\n}\n","export function shouldPolyfill(): boolean {\n  const browserVersionCompatList: { [browser: string]: number } = {\n    Firefox: 46,\n    Edge: 13,\n  }\n\n  // Unfortunately IE doesn't follow the same pattern as other browsers, so we\n  // need to check `isIE11` differently.\n  // @ts-expect-error\n  const isIE11 = !!window.MSInputMethodContext && !!document.documentMode\n\n  const userAgent = navigator.userAgent.split(' ')\n  const [browser, version] = userAgent[userAgent.length - 1].split('/')\n\n  return (\n    isIE11 ||\n    (browserVersionCompatList[browser] !== undefined &&\n      browserVersionCompatList[browser] >= parseInt(version))\n  )\n}\n\n// appName = Netscape IE / Edge\n// edge 13 Edge/13... same as FF\n"],"names":["inProgress","dataWebpackPrefix","__importDefault","this","mod","__esModule","Object","defineProperty","exports","value","obj_case_1","trait","a","b","traits","props","properties","default","proto","zip","country","street","state","city","region","Alias","inherits_1","facade_1","dictionary","opts","Facade","call","prototype","action","type","previousId","field","from","userId","to","clone","toString","temp","key","hasOwnProperty","Array","isArray","map","Delete","address_1","clone_1","is_enabled_1","new_date_1","isodate_traverse_1","obj","raw","traverse","timestamp","Date","f","transform","proxy","fields","split","shift","length","join","multi","path","one","json","ret","rawEvent","options","integration","context","enabled","integrations","allEnabled","providers","settings","active","anonymousId","sessionId","groupId","aliases","id","alias","library","name","version","device","indexOf","userAgent","timezone","channel","ip","Group","is_email_1","g","created","email","industry","employees","Identify","trim","str","i","companyCreated","companyName","firstName","lastName","space","substr","uid","username","description","age","date","birthday","getFullYear","avatar","position","website","websites","phone","phones","address","gender","__assign","assign","t","s","n","arguments","p","apply","Screen","Page","Track","enumerable","get","alias_1","group_1","identify_1","track_1","page_1","screen_1","delete_1","matcher","string","test","disabled","Salesforce","category","title","url","referrer","fullName","event","track","productId","promotionId","cartId","checkoutId","paymentId","couponId","wishlistId","reviewId","orderId","sku","tax","price","total","repeat","coupon","shipping","discount","shippingMethod","paymentMethod","plan","subtotal","revenue","products","filter","item","quantity","currency","query","match","val","replace","parseFloat","isNaN","cents","identify","isodate","input","strict","undefined","keys","forEach","traverseObject","arr","index","traverseArray","is","parse","module","iso","numericKeys","exec","offset","parseInt","substring","getTimezoneOffset","millis","UTC","create","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","milliseconds","seconds","toStr","isNumber","num","multiple","fn","normalize","isFunction","normalizer","defaultNormalize","finished","loop","normalizedKey","charAt","child","del","toLowerCase","find","isBrowser","window","isServer","gracefulDecodeURIComponent","encodedURIComponent","decodeURIComponent","receiverWriteKey","_","embeddedWriteKey","_globalReceiverKey","getGlobalReceiver","setGlobalReceiverKey","setGlobalReceiver","receiver","findScript","src","slice","document","querySelectorAll","loadScript","attributes","found","status","getAttribute","Promise","resolve","reject","addEventListener","err","script","createElement","async","setAttribute","entries","k","v","onload","onerror","Error","tag","getElementsByTagName","parentElement","insertBefore","_globalCDN","receiverScriptRegex","setGlobalCDNUrl","cdn","globalReceiver","_cdn","getCDN","globalCdnUrl","cdnFromScriptTag","result","getNextIntegrationsURL","getLegacyAJSPath","writeKey","_writeKey","toFacade","evt","fcd","applyDestinationMiddleware","destination","middleware","applyMiddleware","returnedEvent","payload","next","modifiedEvent","md","sourceMiddlewarePlugin","ctx","nextCalled","retry","reason","isLoaded","load","pTimeout","promise","timeout","timeoutId","setTimeout","then","clearTimeout","catch","invokeCallback","callback","delay","timeoutInMs","cb","log","error","stats","increment","CoreLogger","_logs","level","message","extras","time","push","flush","logs","formatted","reduce","_a","_b","_c","line","JSON","stringify","toISOString","concat","Math","random","console","table","logEntry","ContextCancelation","CoreContext","logger","attempts","_id","system","isSame","other","cancel","updateEvent","failedDelivery","_failedDelivery","setFailedDelivery","toJSON","metrics","extendStatics","__extends","d","setPrototypeOf","__proto__","TypeError","String","__","CoreStats","metric","by","tags","now","gauge","m","serialize","counter","e","NullStats","_super","_args","_i","isString","exists","isPlainObject","BUFFER","IDX","HEX","v4","out","dset","x","l","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","definition","o","chunkId","all","promises","u","prop","done","needAttach","scripts","charset","nc","onScriptComplete","prev","doneFns","parentNode","removeChild","bind","target","head","appendChild","r","Symbol","toStringTag","installedChunks","j","installedChunkData","errorType","realSrc","request","webpackJsonpCallback","parentChunkLoadingFunction","data","chunkIds","moreModules","runtime","some","chunkLoadingGlobal","self","_version","getVersionType","resolveArguments","channelId","eventName","args","isOffline","navigator","onLine","XMLHttpRequest","ok","statusText","responseURL","text","responseText","blob","Blob","response","headers","has","open","method","getAllResponseHeaders","withCredentials","credentials","setRequestHeader","send","body","getGlobal","globalThis","global","fetch","TRONIC_API_HOST","logError","remoteMetrics","host","sampleRate","flushTimer","maxQueueSize","queue","includes","remoteMetric","versionType","formattedTags","acc","library_version","createRemoteMetric","series","initRemoteMetrics","RemoteMetrics","Stats","thisArg","_arguments","P","generator","fulfilled","step","rejected","y","label","sent","trys","ops","verb","iterator","op","pop","dispatch","emitter","startTime","dispatched","emit","isEmpty","dispatchSingle","startTimeInEpochMS","timeoutInMS","elapsedTime","max","debug","Emitter","callbacks","on","once","_this","off","without","createBufferedPageContext","canonicalUrl","search","__t","c","BUFFERED_PAGE_CONTEXT_KEYS","createPageContext","href","hashIdx","pathname","newPath","URL","_e","parseCanonicalPath","newUrl","searchParams","createCanonicalURL","getDefaultBufferedPageContext","querySelector","location","addPageContext","pageCtx","evtCtx","page","pageContextFromEventProps","user","baseEvent","optionsKeys","providedOptionsKeys","overrides","rest","newEvent","ON_REMOVE_FROM_FUTURE","PriorityQueue","maxAttempts","seen","future","items","accepted","operation","updateAttempts","sort","getAttempts","pushWithBackoff","attempt","params","minTimeout","factor","maxTimeout","Infinity","min","pow","backoff","Boolean","loc","getItem","setItem","removeItem","localStorage","warn","persisted","Context","stored","remove","mutex","onUnlock","lockKey","rawLock","lock","allowed","getTime","expired","itemsKey","seenKey","saved","lastSeen","todo","existing","merged","values","persistItems","memory","persistSeen","pack","ar","plugin","start","hook","newCtx","err_1","tryAsync","ensure","newContext","CoreEventQueue","priorityQueue","taskCompletionPromise","resolvePromise","count","criticalTasks","run","returnValue","res","finally","plugins","failedInitializations","flushing","scheduleFlush","register","instance","deregister","e_1","unload","willDeliver","subscribeToDelivery","onDeliver","flushed","delivered","deliver","enqueuRetry","flushOne","err_2","isReady","availableExtensions","denyList","grouper","results","available","alternativeNameMatch","alternativeNames","All","suggestedKey","Function","before","enrichment","_d","after","destinations","before_1","beforeWare","enrichment_1","enrichmentWare","afterCalls","nameOrQueue","PersistedPriorityQueue","bindAll","getOwnPropertyNames","desc","getOwnPropertyDescriptor","StoreType","Cookie","LocalStorage","Memory","_logStoreKeyError","store","stores","set","clear","getAndSync","coercedValue","cache","isArrayOfStoreType","every","source","api","init","converter","defaultAttributes","expires","toUTCString","encodeURIComponent","escape","stringifiedAttributes","attributeName","cookie","write","cookies","jar","parts","foundKey","read","withAttributes","withConverter","freeze","tld","parsedUrl","parseUrl","lvls","hostname","last","levels","cname","domain","CookieStorage","defaults","maxage","sameSite","secure","localStorageWarning","initializeStorages","isStoreTypeWithSettings","MemoryStorage","applyCookieOptions","storeTypes","cookieOptions","persist","oldKey","disable","prevId","identityStore","idKey","retId","retLeg","legacyUserStore","anonKey","legacySIO","traitsStore","traitsKey","createStorage","legacyUser","currentId","logout","reset","User","save","cookieOpts","filterStores","UniversalStorage","storage","localStorageFallbackDisabled","groupDefaults","flushAddSourceMiddleware","buffer","getCalls","callReceiverMethod","flushOn","flushReceiverCallsInNewTask","toArray","popPageContext","hasBufferedPageContextAsLastArg","bufferedPageCtx","isBufferedPageContext","called","_callMap","calls","_pushSnippetWindowBuffer","methodName","wa","splice","PreInitMethodCall","loader","_createMethod","ready","_createChainableMethod","addSourceMiddleware","VERSION","_preInitBuffer","PreInitMethodCallBuffer","_promise","ajs","group","_debug","initialized","_user","disablePersistance","disableClientPersistence","retryQueue","EventQueue","createDefaultQueue","storageSetting","_universalStorage","createStore","_group","eventFactory","EventFactory","tronicEvent","_dispatch","orderStack","arg","current","_traits","trackClick","autotrack","link","trackLink","trackSubmit","form","trackForm","registrations","xt","deregistrations","pl","toggle","addDestinationMiddleware","integrationName","addMiddleware","middlewares","setAnonymousId","queryString","useQueryString","clientHints","hints","userAgentData","getHighEntropyValues","getCookieOptions","_ctx","highEntropyValuesClientHints","enrich","URLSearchParams","append","objectToQueryString","locale","userLanguage","language","campaign","startsWith","utmParam","utm","amp","ampId","ad","queryIds","btid","urid","ads","referrerId","Intl","DateTimeFormat","resolvedOptions","timeZone","envEnrichment","EnvironmentEnrichmentPlugin","transformedContext","loadPluginFactory","remotePlugin","obfuscate","defaultCdn","RegExp","urlSplit","obfuscatedURL","btoa","libraryName","remoteLoader","userIntegrations","mergedIntegrations","routingMiddleware","pluginSources","allPlugins","routingRules","middlewareSettings","pluginPromises","remotePlugins","creationNameEnabled","creationName","currentNameEnabled","isPluginDisabled","pluginFactory","pluginLike","required","validate","rule","destinationName","wrapper","ActionDestination","onPageChange","unloaded","visibilityState","MAX_PAYLOAD_SIZE","kilobytes","encodeURI","batch","apiHost","config","schedule","pageUnloaded","limit","size","sendBatch","updatedBatch","keepalive","sentAt","reqs","chunks","_url","bufferOverflow","approachingTrackingAPILimit","pWhile","condition","actionResult","flushQueue","failedQueue","failed","isFlushing","newBuffer","tronic","inflightEvents","apiKey","Set","protocol","remote","deliveryStrategy","client","strategy","add","_json","delete","ValidationError","stringError","objError","nilError","assertUserIdentity","USER_FIELD_NAME","getAnyUserId","assertEventExists","assertEventType","assertTrackEventName","validation","inspectorHost","flushFinalBuffer","registerPlugins","legacySettings","pluginLikes","legacyIntegrationSources","pluginName","mergedSettings","optionOverrides","integrationSettings","mergedOptions","toRegister","enabledMiddleware","remoteMiddlewares","mdw","loadReceiver","preInitBuffer","globalReceiverKey","cdnURL","updateCDNSettings","attach","attachInspector","Receiver","classicIntegrations","flushPreBuffer","hash","term","_resolve","_reject","loadStart","resolveLoadStart","_resolveLoadStart","ReceiverBrowser","standalone","ReceiverBuffered","install","regex","currentScript","getWriteKey","_loadOptions","setVersionType","ajsIdentifiedCSP","sendErrorMetrics","disposition","blockedURI","isReceiverCSPError","classicPath","loadAjsClassicFallback","browserVersionCompatList","Firefox","Edge","isIE11","MSInputMethodContext","documentMode","browser","shouldPolyfill","readyState"],"sourceRoot":""}